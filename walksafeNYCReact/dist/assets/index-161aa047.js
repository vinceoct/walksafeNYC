function Lk(t,o){for(var u=0;u<o.length;u++){const p=o[u];if(typeof p!="string"&&!Array.isArray(p)){for(const y in p)if(y!=="default"&&!(y in t)){const w=Object.getOwnPropertyDescriptor(p,y);w&&Object.defineProperty(t,y,w.get?w:{enumerable:!0,get:()=>p[y]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))p(y);new MutationObserver(y=>{for(const w of y)if(w.type==="childList")for(const C of w.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&p(C)}).observe(document,{childList:!0,subtree:!0});function u(y){const w={};return y.integrity&&(w.integrity=y.integrity),y.referrerPolicy&&(w.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?w.credentials="include":y.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function p(y){if(y.ep)return;y.ep=!0;const w=u(y);fetch(y.href,w)}})();var BE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Rv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var FE={exports:{}},kg={},NE={exports:{}},nn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ef=Symbol.for("react.element"),Rk=Symbol.for("react.portal"),Ok=Symbol.for("react.fragment"),Bk=Symbol.for("react.strict_mode"),Fk=Symbol.for("react.profiler"),Nk=Symbol.for("react.provider"),jk=Symbol.for("react.context"),Uk=Symbol.for("react.forward_ref"),Vk=Symbol.for("react.suspense"),$k=Symbol.for("react.memo"),Gk=Symbol.for("react.lazy"),Ab=Symbol.iterator;function qk(t){return t===null||typeof t!="object"?null:(t=Ab&&t[Ab]||t["@@iterator"],typeof t=="function"?t:null)}var jE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},UE=Object.assign,VE={};function Vu(t,o,u){this.props=t,this.context=o,this.refs=VE,this.updater=u||jE}Vu.prototype.isReactComponent={};Vu.prototype.setState=function(t,o){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,o,"setState")};Vu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function $E(){}$E.prototype=Vu.prototype;function Ov(t,o,u){this.props=t,this.context=o,this.refs=VE,this.updater=u||jE}var Bv=Ov.prototype=new $E;Bv.constructor=Ov;UE(Bv,Vu.prototype);Bv.isPureReactComponent=!0;var Mb=Array.isArray,GE=Object.prototype.hasOwnProperty,Fv={current:null},qE={key:!0,ref:!0,__self:!0,__source:!0};function ZE(t,o,u){var p,y={},w=null,C=null;if(o!=null)for(p in o.ref!==void 0&&(C=o.ref),o.key!==void 0&&(w=""+o.key),o)GE.call(o,p)&&!qE.hasOwnProperty(p)&&(y[p]=o[p]);var a=arguments.length-2;if(a===1)y.children=u;else if(1<a){for(var z=Array(a),F=0;F<a;F++)z[F]=arguments[F+2];y.children=z}if(t&&t.defaultProps)for(p in a=t.defaultProps,a)y[p]===void 0&&(y[p]=a[p]);return{$$typeof:Ef,type:t,key:w,ref:C,props:y,_owner:Fv.current}}function Zk(t,o){return{$$typeof:Ef,type:t.type,key:o,ref:t.ref,props:t.props,_owner:t._owner}}function Nv(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ef}function Wk(t){var o={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(u){return o[u]})}var kb=/\/+/g;function Oy(t,o){return typeof t=="object"&&t!==null&&t.key!=null?Wk(""+t.key):o.toString(36)}function Lm(t,o,u,p,y){var w=typeof t;(w==="undefined"||w==="boolean")&&(t=null);var C=!1;if(t===null)C=!0;else switch(w){case"string":case"number":C=!0;break;case"object":switch(t.$$typeof){case Ef:case Rk:C=!0}}if(C)return C=t,y=y(C),t=p===""?"."+Oy(C,0):p,Mb(y)?(u="",t!=null&&(u=t.replace(kb,"$&/")+"/"),Lm(y,o,u,"",function(F){return F})):y!=null&&(Nv(y)&&(y=Zk(y,u+(!y.key||C&&C.key===y.key?"":(""+y.key).replace(kb,"$&/")+"/")+t)),o.push(y)),1;if(C=0,p=p===""?".":p+":",Mb(t))for(var a=0;a<t.length;a++){w=t[a];var z=p+Oy(w,a);C+=Lm(w,o,u,z,y)}else if(z=qk(t),typeof z=="function")for(t=z.call(t),a=0;!(w=t.next()).done;)w=w.value,z=p+Oy(w,a++),C+=Lm(w,o,u,z,y);else if(w==="object")throw o=String(t),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return C}function am(t,o,u){if(t==null)return t;var p=[],y=0;return Lm(t,p,"","",function(w){return o.call(u,w,y++)}),p}function Xk(t){if(t._status===-1){var o=t._result;o=o(),o.then(function(u){(t._status===0||t._status===-1)&&(t._status=1,t._result=u)},function(u){(t._status===0||t._status===-1)&&(t._status=2,t._result=u)}),t._status===-1&&(t._status=0,t._result=o)}if(t._status===1)return t._result.default;throw t._result}var ri={current:null},Rm={transition:null},Hk={ReactCurrentDispatcher:ri,ReactCurrentBatchConfig:Rm,ReactCurrentOwner:Fv};nn.Children={map:am,forEach:function(t,o,u){am(t,function(){o.apply(this,arguments)},u)},count:function(t){var o=0;return am(t,function(){o++}),o},toArray:function(t){return am(t,function(o){return o})||[]},only:function(t){if(!Nv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};nn.Component=Vu;nn.Fragment=Ok;nn.Profiler=Fk;nn.PureComponent=Ov;nn.StrictMode=Bk;nn.Suspense=Vk;nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hk;nn.cloneElement=function(t,o,u){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var p=UE({},t.props),y=t.key,w=t.ref,C=t._owner;if(o!=null){if(o.ref!==void 0&&(w=o.ref,C=Fv.current),o.key!==void 0&&(y=""+o.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(z in o)GE.call(o,z)&&!qE.hasOwnProperty(z)&&(p[z]=o[z]===void 0&&a!==void 0?a[z]:o[z])}var z=arguments.length-2;if(z===1)p.children=u;else if(1<z){a=Array(z);for(var F=0;F<z;F++)a[F]=arguments[F+2];p.children=a}return{$$typeof:Ef,type:t.type,key:y,ref:w,props:p,_owner:C}};nn.createContext=function(t){return t={$$typeof:jk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Nk,_context:t},t.Consumer=t};nn.createElement=ZE;nn.createFactory=function(t){var o=ZE.bind(null,t);return o.type=t,o};nn.createRef=function(){return{current:null}};nn.forwardRef=function(t){return{$$typeof:Uk,render:t}};nn.isValidElement=Nv;nn.lazy=function(t){return{$$typeof:Gk,_payload:{_status:-1,_result:t},_init:Xk}};nn.memo=function(t,o){return{$$typeof:$k,type:t,compare:o===void 0?null:o}};nn.startTransition=function(t){var o=Rm.transition;Rm.transition={};try{t()}finally{Rm.transition=o}};nn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};nn.useCallback=function(t,o){return ri.current.useCallback(t,o)};nn.useContext=function(t){return ri.current.useContext(t)};nn.useDebugValue=function(){};nn.useDeferredValue=function(t){return ri.current.useDeferredValue(t)};nn.useEffect=function(t,o){return ri.current.useEffect(t,o)};nn.useId=function(){return ri.current.useId()};nn.useImperativeHandle=function(t,o,u){return ri.current.useImperativeHandle(t,o,u)};nn.useInsertionEffect=function(t,o){return ri.current.useInsertionEffect(t,o)};nn.useLayoutEffect=function(t,o){return ri.current.useLayoutEffect(t,o)};nn.useMemo=function(t,o){return ri.current.useMemo(t,o)};nn.useReducer=function(t,o,u){return ri.current.useReducer(t,o,u)};nn.useRef=function(t){return ri.current.useRef(t)};nn.useState=function(t){return ri.current.useState(t)};nn.useSyncExternalStore=function(t,o,u){return ri.current.useSyncExternalStore(t,o,u)};nn.useTransition=function(){return ri.current.useTransition()};nn.version="18.2.0";NE.exports=nn;var Ve=NE.exports;const Ig=Rv(Ve),Yk=Lk({__proto__:null,default:Ig},[Ve]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kk=Ve,Jk=Symbol.for("react.element"),Qk=Symbol.for("react.fragment"),eI=Object.prototype.hasOwnProperty,tI=Kk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,nI={key:!0,ref:!0,__self:!0,__source:!0};function WE(t,o,u){var p,y={},w=null,C=null;u!==void 0&&(w=""+u),o.key!==void 0&&(w=""+o.key),o.ref!==void 0&&(C=o.ref);for(p in o)eI.call(o,p)&&!nI.hasOwnProperty(p)&&(y[p]=o[p]);if(t&&t.defaultProps)for(p in o=t.defaultProps,o)y[p]===void 0&&(y[p]=o[p]);return{$$typeof:Jk,type:t,key:w,ref:C,props:y,_owner:tI.current}}kg.Fragment=Qk;kg.jsx=WE;kg.jsxs=WE;FE.exports=kg;var V=FE.exports;/**
 * @remix-run/router v1.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Kd(){return Kd=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(t[p]=u[p])}return t},Kd.apply(this,arguments)}var Ma;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ma||(Ma={}));const Ib="popstate";function rI(t){t===void 0&&(t={});function o(p,y){let{pathname:w,search:C,hash:a}=p.location;return v0("",{pathname:w,search:C,hash:a},y.state&&y.state.usr||null,y.state&&y.state.key||"default")}function u(p,y){return typeof y=="string"?y:Jm(y)}return oI(o,u,null,t)}function dr(t,o){if(t===!1||t===null||typeof t>"u")throw new Error(o)}function jv(t,o){if(!t){typeof console<"u"&&console.warn(o);try{throw new Error(o)}catch{}}}function iI(){return Math.random().toString(36).substr(2,8)}function Pb(t,o){return{usr:t.state,key:t.key,idx:o}}function v0(t,o,u,p){return u===void 0&&(u=null),Kd({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof o=="string"?$u(o):o,{state:u,key:o&&o.key||p||iI()})}function Jm(t){let{pathname:o="/",search:u="",hash:p=""}=t;return u&&u!=="?"&&(o+=u.charAt(0)==="?"?u:"?"+u),p&&p!=="#"&&(o+=p.charAt(0)==="#"?p:"#"+p),o}function $u(t){let o={};if(t){let u=t.indexOf("#");u>=0&&(o.hash=t.substr(u),t=t.substr(0,u));let p=t.indexOf("?");p>=0&&(o.search=t.substr(p),t=t.substr(0,p)),t&&(o.pathname=t)}return o}function oI(t,o,u,p){p===void 0&&(p={});let{window:y=document.defaultView,v5Compat:w=!1}=p,C=y.history,a=Ma.Pop,z=null,F=H();F==null&&(F=0,C.replaceState(Kd({},C.state,{idx:F}),""));function H(){return(C.state||{idx:null}).idx}function Z(){a=Ma.Pop;let ze=H(),le=ze==null?null:ze-F;F=ze,z&&z({action:a,location:_e.location,delta:le})}function Y(ze,le){a=Ma.Push;let ee=v0(_e.location,ze,le);u&&u(ee,ze),F=H()+1;let ue=Pb(ee,F),Be=_e.createHref(ee);try{C.pushState(ue,"",Be)}catch($e){if($e instanceof DOMException&&$e.name==="DataCloneError")throw $e;y.location.assign(Be)}w&&z&&z({action:a,location:_e.location,delta:1})}function ie(ze,le){a=Ma.Replace;let ee=v0(_e.location,ze,le);u&&u(ee,ze),F=H();let ue=Pb(ee,F),Be=_e.createHref(ee);C.replaceState(ue,"",Be),w&&z&&z({action:a,location:_e.location,delta:0})}function ce(ze){let le=y.location.origin!=="null"?y.location.origin:y.location.href,ee=typeof ze=="string"?ze:Jm(ze);return dr(le,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,le)}let _e={get action(){return a},get location(){return t(y,C)},listen(ze){if(z)throw new Error("A history only accepts one active listener");return y.addEventListener(Ib,Z),z=ze,()=>{y.removeEventListener(Ib,Z),z=null}},createHref(ze){return o(y,ze)},createURL:ce,encodeLocation(ze){let le=ce(ze);return{pathname:le.pathname,search:le.search,hash:le.hash}},push:Y,replace:ie,go(ze){return C.go(ze)}};return _e}var zb;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(zb||(zb={}));function sI(t,o,u){u===void 0&&(u="/");let p=typeof o=="string"?$u(o):o,y=Uv(p.pathname||"/",u);if(y==null)return null;let w=XE(t);aI(w);let C=null;for(let a=0;C==null&&a<w.length;++a)C=gI(w[a],vI(y));return C}function XE(t,o,u,p){o===void 0&&(o=[]),u===void 0&&(u=[]),p===void 0&&(p="");let y=(w,C,a)=>{let z={relativePath:a===void 0?w.path||"":a,caseSensitive:w.caseSensitive===!0,childrenIndex:C,route:w};z.relativePath.startsWith("/")&&(dr(z.relativePath.startsWith(p),'Absolute route path "'+z.relativePath+'" nested under path '+('"'+p+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),z.relativePath=z.relativePath.slice(p.length));let F=za([p,z.relativePath]),H=u.concat(z);w.children&&w.children.length>0&&(dr(w.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+F+'".')),XE(w.children,o,H,F)),!(w.path==null&&!w.index)&&o.push({path:F,score:pI(F,w.index),routesMeta:H})};return t.forEach((w,C)=>{var a;if(w.path===""||!((a=w.path)!=null&&a.includes("?")))y(w,C);else for(let z of HE(w.path))y(w,C,z)}),o}function HE(t){let o=t.split("/");if(o.length===0)return[];let[u,...p]=o,y=u.endsWith("?"),w=u.replace(/\?$/,"");if(p.length===0)return y?[w,""]:[w];let C=HE(p.join("/")),a=[];return a.push(...C.map(z=>z===""?w:[w,z].join("/"))),y&&a.push(...C),a.map(z=>t.startsWith("/")&&z===""?"/":z)}function aI(t){t.sort((o,u)=>o.score!==u.score?u.score-o.score:mI(o.routesMeta.map(p=>p.childrenIndex),u.routesMeta.map(p=>p.childrenIndex)))}const lI=/^:\w+$/,cI=3,uI=2,hI=1,dI=10,fI=-2,Db=t=>t==="*";function pI(t,o){let u=t.split("/"),p=u.length;return u.some(Db)&&(p+=fI),o&&(p+=uI),u.filter(y=>!Db(y)).reduce((y,w)=>y+(lI.test(w)?cI:w===""?hI:dI),p)}function mI(t,o){return t.length===o.length&&t.slice(0,-1).every((p,y)=>p===o[y])?t[t.length-1]-o[o.length-1]:0}function gI(t,o){let{routesMeta:u}=t,p={},y="/",w=[];for(let C=0;C<u.length;++C){let a=u[C],z=C===u.length-1,F=y==="/"?o:o.slice(y.length)||"/",H=_I({path:a.relativePath,caseSensitive:a.caseSensitive,end:z},F);if(!H)return null;Object.assign(p,H.params);let Z=a.route;w.push({params:p,pathname:za([y,H.pathname]),pathnameBase:EI(za([y,H.pathnameBase])),route:Z}),H.pathnameBase!=="/"&&(y=za([y,H.pathnameBase]))}return w}function _I(t,o){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[u,p]=yI(t.path,t.caseSensitive,t.end),y=o.match(u);if(!y)return null;let w=y[0],C=w.replace(/(.)\/+$/,"$1"),a=y.slice(1);return{params:p.reduce((F,H,Z)=>{if(H==="*"){let Y=a[Z]||"";C=w.slice(0,w.length-Y.length).replace(/(.)\/+$/,"$1")}return F[H]=xI(a[Z]||"",H),F},{}),pathname:w,pathnameBase:C,pattern:t}}function yI(t,o,u){o===void 0&&(o=!1),u===void 0&&(u=!0),jv(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let p=[],y="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(C,a)=>(p.push(a),"/([^\\/]+)"));return t.endsWith("*")?(p.push("*"),y+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?y+="\\/*$":t!==""&&t!=="/"&&(y+="(?:(?=\\/|$))"),[new RegExp(y,o?void 0:"i"),p]}function vI(t){try{return decodeURI(t)}catch(o){return jv(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+o+").")),t}}function xI(t,o){try{return decodeURIComponent(t)}catch(u){return jv(!1,'The value for the URL param "'+o+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+u+").")),t}}function Uv(t,o){if(o==="/")return t;if(!t.toLowerCase().startsWith(o.toLowerCase()))return null;let u=o.endsWith("/")?o.length-1:o.length,p=t.charAt(u);return p&&p!=="/"?null:t.slice(u)||"/"}function wI(t,o){o===void 0&&(o="/");let{pathname:u,search:p="",hash:y=""}=typeof t=="string"?$u(t):t;return{pathname:u?u.startsWith("/")?u:bI(u,o):o,search:TI(p),hash:SI(y)}}function bI(t,o){let u=o.replace(/\/+$/,"").split("/");return t.split("/").forEach(y=>{y===".."?u.length>1&&u.pop():y!=="."&&u.push(y)}),u.length>1?u.join("/"):"/"}function By(t,o,u,p){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+o+"` field ["+JSON.stringify(p)+"].  Please separate it out to the ")+("`to."+u+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function YE(t){return t.filter((o,u)=>u===0||o.route.path&&o.route.path.length>0)}function KE(t,o,u,p){p===void 0&&(p=!1);let y;typeof t=="string"?y=$u(t):(y=Kd({},t),dr(!y.pathname||!y.pathname.includes("?"),By("?","pathname","search",y)),dr(!y.pathname||!y.pathname.includes("#"),By("#","pathname","hash",y)),dr(!y.search||!y.search.includes("#"),By("#","search","hash",y)));let w=t===""||y.pathname==="",C=w?"/":y.pathname,a;if(p||C==null)a=u;else{let Z=o.length-1;if(C.startsWith("..")){let Y=C.split("/");for(;Y[0]==="..";)Y.shift(),Z-=1;y.pathname=Y.join("/")}a=Z>=0?o[Z]:"/"}let z=wI(y,a),F=C&&C!=="/"&&C.endsWith("/"),H=(w||C===".")&&u.endsWith("/");return!z.pathname.endsWith("/")&&(F||H)&&(z.pathname+="/"),z}const za=t=>t.join("/").replace(/\/\/+/g,"/"),EI=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),TI=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,SI=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function CI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const JE=["post","put","patch","delete"];new Set(JE);const AI=["get",...JE];new Set(AI);/**
 * React Router v6.14.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qm(){return Qm=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(t[p]=u[p])}return t},Qm.apply(this,arguments)}const Vv=Ve.createContext(null),MI=Ve.createContext(null),Gu=Ve.createContext(null),Pg=Ve.createContext(null),Za=Ve.createContext({outlet:null,matches:[],isDataRoute:!1}),QE=Ve.createContext(null);function kI(t,o){let{relative:u}=o===void 0?{}:o;Tf()||dr(!1);let{basename:p,navigator:y}=Ve.useContext(Gu),{hash:w,pathname:C,search:a}=tT(t,{relative:u}),z=C;return p!=="/"&&(z=C==="/"?p:za([p,C])),y.createHref({pathname:z,search:a,hash:w})}function Tf(){return Ve.useContext(Pg)!=null}function Sf(){return Tf()||dr(!1),Ve.useContext(Pg).location}function eT(t){Ve.useContext(Gu).static||Ve.useLayoutEffect(t)}function Cf(){let{isDataRoute:t}=Ve.useContext(Za);return t?$I():II()}function II(){Tf()||dr(!1);let t=Ve.useContext(Vv),{basename:o,navigator:u}=Ve.useContext(Gu),{matches:p}=Ve.useContext(Za),{pathname:y}=Sf(),w=JSON.stringify(YE(p).map(z=>z.pathnameBase)),C=Ve.useRef(!1);return eT(()=>{C.current=!0}),Ve.useCallback(function(z,F){if(F===void 0&&(F={}),!C.current)return;if(typeof z=="number"){u.go(z);return}let H=KE(z,JSON.parse(w),y,F.relative==="path");t==null&&o!=="/"&&(H.pathname=H.pathname==="/"?o:za([o,H.pathname])),(F.replace?u.replace:u.push)(H,F.state,F)},[o,u,w,y,t])}function PI(){let{matches:t}=Ve.useContext(Za),o=t[t.length-1];return o?o.params:{}}function tT(t,o){let{relative:u}=o===void 0?{}:o,{matches:p}=Ve.useContext(Za),{pathname:y}=Sf(),w=JSON.stringify(YE(p).map(C=>C.pathnameBase));return Ve.useMemo(()=>KE(t,JSON.parse(w),y,u==="path"),[t,w,y,u])}function zI(t,o){return DI(t,o)}function DI(t,o,u){Tf()||dr(!1);let{navigator:p}=Ve.useContext(Gu),{matches:y}=Ve.useContext(Za),w=y[y.length-1],C=w?w.params:{};w&&w.pathname;let a=w?w.pathnameBase:"/";w&&w.route;let z=Sf(),F;if(o){var H;let _e=typeof o=="string"?$u(o):o;a==="/"||(H=_e.pathname)!=null&&H.startsWith(a)||dr(!1),F=_e}else F=z;let Z=F.pathname||"/",Y=a==="/"?Z:Z.slice(a.length)||"/",ie=sI(t,{pathname:Y}),ce=FI(ie&&ie.map(_e=>Object.assign({},_e,{params:Object.assign({},C,_e.params),pathname:za([a,p.encodeLocation?p.encodeLocation(_e.pathname).pathname:_e.pathname]),pathnameBase:_e.pathnameBase==="/"?a:za([a,p.encodeLocation?p.encodeLocation(_e.pathnameBase).pathname:_e.pathnameBase])})),y,u);return o&&ce?Ve.createElement(Pg.Provider,{value:{location:Qm({pathname:"/",search:"",hash:"",state:null,key:"default"},F),navigationType:Ma.Pop}},ce):ce}function LI(){let t=VI(),o=CI(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),u=t instanceof Error?t.stack:null,y={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},w=null;return Ve.createElement(Ve.Fragment,null,Ve.createElement("h2",null,"Unexpected Application Error!"),Ve.createElement("h3",{style:{fontStyle:"italic"}},o),u?Ve.createElement("pre",{style:y},u):null,w)}const RI=Ve.createElement(LI,null);class OI extends Ve.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,u){return u.location!==o.location||u.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error||u.error,location:u.location,revalidation:o.revalidation||u.revalidation}}componentDidCatch(o,u){console.error("React Router caught the following error during render",o,u)}render(){return this.state.error?Ve.createElement(Za.Provider,{value:this.props.routeContext},Ve.createElement(QE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function BI(t){let{routeContext:o,match:u,children:p}=t,y=Ve.useContext(Vv);return y&&y.static&&y.staticContext&&(u.route.errorElement||u.route.ErrorBoundary)&&(y.staticContext._deepestRenderedBoundaryId=u.route.id),Ve.createElement(Za.Provider,{value:o},p)}function FI(t,o,u){var p;if(o===void 0&&(o=[]),u===void 0&&(u=null),t==null){var y;if((y=u)!=null&&y.errors)t=u.matches;else return null}let w=t,C=(p=u)==null?void 0:p.errors;if(C!=null){let a=w.findIndex(z=>z.route.id&&(C==null?void 0:C[z.route.id]));a>=0||dr(!1),w=w.slice(0,Math.min(w.length,a+1))}return w.reduceRight((a,z,F)=>{let H=z.route.id?C==null?void 0:C[z.route.id]:null,Z=null;u&&(Z=z.route.errorElement||RI);let Y=o.concat(w.slice(0,F+1)),ie=()=>{let ce;return H?ce=Z:z.route.Component?ce=Ve.createElement(z.route.Component,null):z.route.element?ce=z.route.element:ce=a,Ve.createElement(BI,{match:z,routeContext:{outlet:a,matches:Y,isDataRoute:u!=null},children:ce})};return u&&(z.route.ErrorBoundary||z.route.errorElement||F===0)?Ve.createElement(OI,{location:u.location,revalidation:u.revalidation,component:Z,error:H,children:ie(),routeContext:{outlet:null,matches:Y,isDataRoute:!0}}):ie()},null)}var x0;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate"})(x0||(x0={}));var Jd;(function(t){t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId"})(Jd||(Jd={}));function NI(t){let o=Ve.useContext(Vv);return o||dr(!1),o}function jI(t){let o=Ve.useContext(MI);return o||dr(!1),o}function UI(t){let o=Ve.useContext(Za);return o||dr(!1),o}function nT(t){let o=UI(),u=o.matches[o.matches.length-1];return u.route.id||dr(!1),u.route.id}function VI(){var t;let o=Ve.useContext(QE),u=jI(Jd.UseRouteError),p=nT(Jd.UseRouteError);return o||((t=u.errors)==null?void 0:t[p])}function $I(){let{router:t}=NI(x0.UseNavigateStable),o=nT(Jd.UseNavigateStable),u=Ve.useRef(!1);return eT(()=>{u.current=!0}),Ve.useCallback(function(y,w){w===void 0&&(w={}),u.current&&(typeof y=="number"?t.navigate(y):t.navigate(y,Qm({fromRouteId:o},w)))},[t,o])}function Zr(t){dr(!1)}function GI(t){let{basename:o="/",children:u=null,location:p,navigationType:y=Ma.Pop,navigator:w,static:C=!1}=t;Tf()&&dr(!1);let a=o.replace(/^\/*/,"/"),z=Ve.useMemo(()=>({basename:a,navigator:w,static:C}),[a,w,C]);typeof p=="string"&&(p=$u(p));let{pathname:F="/",search:H="",hash:Z="",state:Y=null,key:ie="default"}=p,ce=Ve.useMemo(()=>{let _e=Uv(F,a);return _e==null?null:{location:{pathname:_e,search:H,hash:Z,state:Y,key:ie},navigationType:y}},[a,F,H,Z,Y,ie,y]);return ce==null?null:Ve.createElement(Gu.Provider,{value:z},Ve.createElement(Pg.Provider,{children:u,value:ce}))}function Lb(t){let{children:o,location:u}=t;return zI(w0(o),u)}var Rb;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(Rb||(Rb={}));new Promise(()=>{});function w0(t,o){o===void 0&&(o=[]);let u=[];return Ve.Children.forEach(t,(p,y)=>{if(!Ve.isValidElement(p))return;let w=[...o,y];if(p.type===Ve.Fragment){u.push.apply(u,w0(p.props.children,w));return}p.type!==Zr&&dr(!1),!p.props.index||!p.props.children||dr(!1);let C={id:p.props.id||w.join("-"),caseSensitive:p.props.caseSensitive,element:p.props.element,Component:p.props.Component,index:p.props.index,path:p.props.path,loader:p.props.loader,action:p.props.action,errorElement:p.props.errorElement,ErrorBoundary:p.props.ErrorBoundary,hasErrorBoundary:p.props.ErrorBoundary!=null||p.props.errorElement!=null,shouldRevalidate:p.props.shouldRevalidate,handle:p.props.handle,lazy:p.props.lazy};p.props.children&&(C.children=w0(p.props.children,w)),u.push(C)}),u}/**
 * React Router DOM v6.14.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function b0(){return b0=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var p in u)Object.prototype.hasOwnProperty.call(u,p)&&(t[p]=u[p])}return t},b0.apply(this,arguments)}function qI(t,o){if(t==null)return{};var u={},p=Object.keys(t),y,w;for(w=0;w<p.length;w++)y=p[w],!(o.indexOf(y)>=0)&&(u[y]=t[y]);return u}function ZI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function WI(t,o){return t.button===0&&(!o||o==="_self")&&!ZI(t)}const XI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],HI="startTransition",Ob=Yk[HI];function YI(t){let{basename:o,children:u,future:p,window:y}=t,w=Ve.useRef();w.current==null&&(w.current=rI({window:y,v5Compat:!0}));let C=w.current,[a,z]=Ve.useState({action:C.action,location:C.location}),{v7_startTransition:F}=p||{},H=Ve.useCallback(Z=>{F&&Ob?Ob(()=>z(Z)):z(Z)},[z,F]);return Ve.useLayoutEffect(()=>C.listen(H),[C,H]),Ve.createElement(GI,{basename:o,children:u,location:a.location,navigationType:a.action,navigator:C})}const KI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",JI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ti=Ve.forwardRef(function(o,u){let{onClick:p,relative:y,reloadDocument:w,replace:C,state:a,target:z,to:F,preventScrollReset:H}=o,Z=qI(o,XI),{basename:Y}=Ve.useContext(Gu),ie,ce=!1;if(typeof F=="string"&&JI.test(F)&&(ie=F,KI))try{let ee=new URL(window.location.href),ue=F.startsWith("//")?new URL(ee.protocol+F):new URL(F),Be=Uv(ue.pathname,Y);ue.origin===ee.origin&&Be!=null?F=Be+ue.search+ue.hash:ce=!0}catch{}let _e=kI(F,{relative:y}),ze=QI(F,{replace:C,state:a,target:z,preventScrollReset:H,relative:y});function le(ee){p&&p(ee),ee.defaultPrevented||ze(ee)}return Ve.createElement("a",b0({},Z,{href:ie||_e,onClick:ce||w?p:le,ref:u,target:z}))});var Bb;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher"})(Bb||(Bb={}));var Fb;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Fb||(Fb={}));function QI(t,o){let{target:u,replace:p,state:y,preventScrollReset:w,relative:C}=o===void 0?{}:o,a=Cf(),z=Sf(),F=tT(t,{relative:C});return Ve.useCallback(H=>{if(WI(H,u)){H.preventDefault();let Z=p!==void 0?p:Jm(z)===Jm(F);a(t,{replace:Z,state:y,preventScrollReset:w,relative:C})}},[z,a,F,p,y,u,t,w,C])}var E0={},rT={exports:{}},Di={},iT={exports:{}},oT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function o(Ke,Mt){var Tt=Ke.length;Ke.push(Mt);e:for(;0<Tt;){var Gt=Tt-1>>>1,_n=Ke[Gt];if(0<y(_n,Mt))Ke[Gt]=Mt,Ke[Tt]=_n,Tt=Gt;else break e}}function u(Ke){return Ke.length===0?null:Ke[0]}function p(Ke){if(Ke.length===0)return null;var Mt=Ke[0],Tt=Ke.pop();if(Tt!==Mt){Ke[0]=Tt;e:for(var Gt=0,_n=Ke.length,Bt=_n>>>1;Gt<Bt;){var ir=2*(Gt+1)-1,xr=Ke[ir],wr=ir+1,Rr=Ke[wr];if(0>y(xr,Tt))wr<_n&&0>y(Rr,xr)?(Ke[Gt]=Rr,Ke[wr]=Tt,Gt=wr):(Ke[Gt]=xr,Ke[ir]=Tt,Gt=ir);else if(wr<_n&&0>y(Rr,Tt))Ke[Gt]=Rr,Ke[wr]=Tt,Gt=wr;else break e}}return Mt}function y(Ke,Mt){var Tt=Ke.sortIndex-Mt.sortIndex;return Tt!==0?Tt:Ke.id-Mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;t.unstable_now=function(){return w.now()}}else{var C=Date,a=C.now();t.unstable_now=function(){return C.now()-a}}var z=[],F=[],H=1,Z=null,Y=3,ie=!1,ce=!1,_e=!1,ze=typeof setTimeout=="function"?setTimeout:null,le=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(Ke){for(var Mt=u(F);Mt!==null;){if(Mt.callback===null)p(F);else if(Mt.startTime<=Ke)p(F),Mt.sortIndex=Mt.expirationTime,o(z,Mt);else break;Mt=u(F)}}function Be(Ke){if(_e=!1,ue(Ke),!ce)if(u(z)!==null)ce=!0,Oi($e);else{var Mt=u(F);Mt!==null&&wi(Be,Mt.startTime-Ke)}}function $e(Ke,Mt){ce=!1,_e&&(_e=!1,le(Je),Je=-1),ie=!0;var Tt=Y;try{for(ue(Mt),Z=u(z);Z!==null&&(!(Z.expirationTime>Mt)||Ke&&!sn());){var Gt=Z.callback;if(typeof Gt=="function"){Z.callback=null,Y=Z.priorityLevel;var _n=Gt(Z.expirationTime<=Mt);Mt=t.unstable_now(),typeof _n=="function"?Z.callback=_n:Z===u(z)&&p(z),ue(Mt)}else p(z);Z=u(z)}if(Z!==null)var Bt=!0;else{var ir=u(F);ir!==null&&wi(Be,ir.startTime-Mt),Bt=!1}return Bt}finally{Z=null,Y=Tt,ie=!1}}var ot=!1,rt=null,Je=-1,De=5,_t=-1;function sn(){return!(t.unstable_now()-_t<De)}function At(){if(rt!==null){var Ke=t.unstable_now();_t=Ke;var Mt=!0;try{Mt=rt(!0,Ke)}finally{Mt?rn():(ot=!1,rt=null)}}else ot=!1}var rn;if(typeof ee=="function")rn=function(){ee(At)};else if(typeof MessageChannel<"u"){var kr=new MessageChannel,Po=kr.port2;kr.port1.onmessage=At,rn=function(){Po.postMessage(null)}}else rn=function(){ze(At,0)};function Oi(Ke){rt=Ke,ot||(ot=!0,rn())}function wi(Ke,Mt){Je=ze(function(){Ke(t.unstable_now())},Mt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ke){Ke.callback=null},t.unstable_continueExecution=function(){ce||ie||(ce=!0,Oi($e))},t.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):De=0<Ke?Math.floor(1e3/Ke):5},t.unstable_getCurrentPriorityLevel=function(){return Y},t.unstable_getFirstCallbackNode=function(){return u(z)},t.unstable_next=function(Ke){switch(Y){case 1:case 2:case 3:var Mt=3;break;default:Mt=Y}var Tt=Y;Y=Mt;try{return Ke()}finally{Y=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ke,Mt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Tt=Y;Y=Ke;try{return Mt()}finally{Y=Tt}},t.unstable_scheduleCallback=function(Ke,Mt,Tt){var Gt=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?Gt+Tt:Gt):Tt=Gt,Ke){case 1:var _n=-1;break;case 2:_n=250;break;case 5:_n=1073741823;break;case 4:_n=1e4;break;default:_n=5e3}return _n=Tt+_n,Ke={id:H++,callback:Mt,priorityLevel:Ke,startTime:Tt,expirationTime:_n,sortIndex:-1},Tt>Gt?(Ke.sortIndex=Tt,o(F,Ke),u(z)===null&&Ke===u(F)&&(_e?(le(Je),Je=-1):_e=!0,wi(Be,Tt-Gt))):(Ke.sortIndex=_n,o(z,Ke),ce||ie||(ce=!0,Oi($e))),Ke},t.unstable_shouldYield=sn,t.unstable_wrapCallback=function(Ke){var Mt=Y;return function(){var Tt=Y;Y=Mt;try{return Ke.apply(this,arguments)}finally{Y=Tt}}}})(oT);iT.exports=oT;var eP=iT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sT=Ve,zi=eP;function at(t){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+t,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+t+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var aT=new Set,Qd={};function ic(t,o){Du(t,o),Du(t+"Capture",o)}function Du(t,o){for(Qd[t]=o,t=0;t<o.length;t++)aT.add(o[t])}var Is=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),T0=Object.prototype.hasOwnProperty,tP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Nb={},jb={};function nP(t){return T0.call(jb,t)?!0:T0.call(Nb,t)?!1:tP.test(t)?jb[t]=!0:(Nb[t]=!0,!1)}function rP(t,o,u,p){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return p?!1:u!==null?!u.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function iP(t,o,u,p){if(o===null||typeof o>"u"||rP(t,o,u,p))return!0;if(p)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function ii(t,o,u,p,y,w,C){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=p,this.attributeNamespace=y,this.mustUseProperty=u,this.propertyName=t,this.type=o,this.sanitizeURL=w,this.removeEmptyString=C}var Lr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Lr[t]=new ii(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var o=t[0];Lr[o]=new ii(o,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Lr[t]=new ii(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Lr[t]=new ii(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Lr[t]=new ii(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Lr[t]=new ii(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Lr[t]=new ii(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Lr[t]=new ii(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Lr[t]=new ii(t,5,!1,t.toLowerCase(),null,!1,!1)});var $v=/[\-:]([a-z])/g;function Gv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var o=t.replace($v,Gv);Lr[o]=new ii(o,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var o=t.replace($v,Gv);Lr[o]=new ii(o,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var o=t.replace($v,Gv);Lr[o]=new ii(o,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Lr[t]=new ii(t,1,!1,t.toLowerCase(),null,!1,!1)});Lr.xlinkHref=new ii("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Lr[t]=new ii(t,1,!1,t.toLowerCase(),null,!0,!0)});function qv(t,o,u,p){var y=Lr.hasOwnProperty(o)?Lr[o]:null;(y!==null?y.type!==0:p||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(iP(o,u,y,p)&&(u=null),p||y===null?nP(o)&&(u===null?t.removeAttribute(o):t.setAttribute(o,""+u)):y.mustUseProperty?t[y.propertyName]=u===null?y.type===3?!1:"":u:(o=y.attributeName,p=y.attributeNamespace,u===null?t.removeAttribute(o):(y=y.type,u=y===3||y===4&&u===!0?"":""+u,p?t.setAttributeNS(p,o,u):t.setAttribute(o,u))))}var Bs=sT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lm=Symbol.for("react.element"),hu=Symbol.for("react.portal"),du=Symbol.for("react.fragment"),Zv=Symbol.for("react.strict_mode"),S0=Symbol.for("react.profiler"),lT=Symbol.for("react.provider"),cT=Symbol.for("react.context"),Wv=Symbol.for("react.forward_ref"),C0=Symbol.for("react.suspense"),A0=Symbol.for("react.suspense_list"),Xv=Symbol.for("react.memo"),Ta=Symbol.for("react.lazy"),uT=Symbol.for("react.offscreen"),Ub=Symbol.iterator;function Cd(t){return t===null||typeof t!="object"?null:(t=Ub&&t[Ub]||t["@@iterator"],typeof t=="function"?t:null)}var Jn=Object.assign,Fy;function Rd(t){if(Fy===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);Fy=o&&o[1]||""}return`
`+Fy+t}var Ny=!1;function jy(t,o){if(!t||Ny)return"";Ny=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(F){var p=F}Reflect.construct(t,[],o)}else{try{o.call()}catch(F){p=F}t.call(o.prototype)}else{try{throw Error()}catch(F){p=F}t()}}catch(F){if(F&&p&&typeof F.stack=="string"){for(var y=F.stack.split(`
`),w=p.stack.split(`
`),C=y.length-1,a=w.length-1;1<=C&&0<=a&&y[C]!==w[a];)a--;for(;1<=C&&0<=a;C--,a--)if(y[C]!==w[a]){if(C!==1||a!==1)do if(C--,a--,0>a||y[C]!==w[a]){var z=`
`+y[C].replace(" at new "," at ");return t.displayName&&z.includes("<anonymous>")&&(z=z.replace("<anonymous>",t.displayName)),z}while(1<=C&&0<=a);break}}}finally{Ny=!1,Error.prepareStackTrace=u}return(t=t?t.displayName||t.name:"")?Rd(t):""}function oP(t){switch(t.tag){case 5:return Rd(t.type);case 16:return Rd("Lazy");case 13:return Rd("Suspense");case 19:return Rd("SuspenseList");case 0:case 2:case 15:return t=jy(t.type,!1),t;case 11:return t=jy(t.type.render,!1),t;case 1:return t=jy(t.type,!0),t;default:return""}}function M0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case du:return"Fragment";case hu:return"Portal";case S0:return"Profiler";case Zv:return"StrictMode";case C0:return"Suspense";case A0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case cT:return(t.displayName||"Context")+".Consumer";case lT:return(t._context.displayName||"Context")+".Provider";case Wv:var o=t.render;return t=t.displayName,t||(t=o.displayName||o.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Xv:return o=t.displayName||null,o!==null?o:M0(t.type)||"Memo";case Ta:o=t._payload,t=t._init;try{return M0(t(o))}catch{}}return null}function sP(t){var o=t.type;switch(t.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=o.render,t=t.displayName||t.name||"",o.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M0(o);case 8:return o===Zv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Ua(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function hT(t){var o=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function aP(t){var o=hT(t)?"checked":"value",u=Object.getOwnPropertyDescriptor(t.constructor.prototype,o),p=""+t[o];if(!t.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var y=u.get,w=u.set;return Object.defineProperty(t,o,{configurable:!0,get:function(){return y.call(this)},set:function(C){p=""+C,w.call(this,C)}}),Object.defineProperty(t,o,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function(C){p=""+C},stopTracking:function(){t._valueTracker=null,delete t[o]}}}}function cm(t){t._valueTracker||(t._valueTracker=aP(t))}function dT(t){if(!t)return!1;var o=t._valueTracker;if(!o)return!0;var u=o.getValue(),p="";return t&&(p=hT(t)?t.checked?"true":"false":t.value),t=p,t!==u?(o.setValue(t),!0):!1}function eg(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function k0(t,o){var u=o.checked;return Jn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??t._wrapperState.initialChecked})}function Vb(t,o){var u=o.defaultValue==null?"":o.defaultValue,p=o.checked!=null?o.checked:o.defaultChecked;u=Ua(o.value!=null?o.value:u),t._wrapperState={initialChecked:p,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function fT(t,o){o=o.checked,o!=null&&qv(t,"checked",o,!1)}function I0(t,o){fT(t,o);var u=Ua(o.value),p=o.type;if(u!=null)p==="number"?(u===0&&t.value===""||t.value!=u)&&(t.value=""+u):t.value!==""+u&&(t.value=""+u);else if(p==="submit"||p==="reset"){t.removeAttribute("value");return}o.hasOwnProperty("value")?P0(t,o.type,u):o.hasOwnProperty("defaultValue")&&P0(t,o.type,Ua(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(t.defaultChecked=!!o.defaultChecked)}function $b(t,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var p=o.type;if(!(p!=="submit"&&p!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+t._wrapperState.initialValue,u||o===t.value||(t.value=o),t.defaultValue=o}u=t.name,u!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,u!==""&&(t.name=u)}function P0(t,o,u){(o!=="number"||eg(t.ownerDocument)!==t)&&(u==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+u&&(t.defaultValue=""+u))}var Od=Array.isArray;function Cu(t,o,u,p){if(t=t.options,o){o={};for(var y=0;y<u.length;y++)o["$"+u[y]]=!0;for(u=0;u<t.length;u++)y=o.hasOwnProperty("$"+t[u].value),t[u].selected!==y&&(t[u].selected=y),y&&p&&(t[u].defaultSelected=!0)}else{for(u=""+Ua(u),o=null,y=0;y<t.length;y++){if(t[y].value===u){t[y].selected=!0,p&&(t[y].defaultSelected=!0);return}o!==null||t[y].disabled||(o=t[y])}o!==null&&(o.selected=!0)}}function z0(t,o){if(o.dangerouslySetInnerHTML!=null)throw Error(at(91));return Jn({},o,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Gb(t,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(at(92));if(Od(u)){if(1<u.length)throw Error(at(93));u=u[0]}o=u}o==null&&(o=""),u=o}t._wrapperState={initialValue:Ua(u)}}function pT(t,o){var u=Ua(o.value),p=Ua(o.defaultValue);u!=null&&(u=""+u,u!==t.value&&(t.value=u),o.defaultValue==null&&t.defaultValue!==u&&(t.defaultValue=u)),p!=null&&(t.defaultValue=""+p)}function qb(t){var o=t.textContent;o===t._wrapperState.initialValue&&o!==""&&o!==null&&(t.value=o)}function mT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function D0(t,o){return t==null||t==="http://www.w3.org/1999/xhtml"?mT(o):t==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var um,gT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,p,y){MSApp.execUnsafeLocalFunction(function(){return t(o,u,p,y)})}:t}(function(t,o){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=o;else{for(um=um||document.createElement("div"),um.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=um.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;o.firstChild;)t.appendChild(o.firstChild)}});function ef(t,o){if(o){var u=t.firstChild;if(u&&u===t.lastChild&&u.nodeType===3){u.nodeValue=o;return}}t.textContent=o}var jd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lP=["Webkit","ms","Moz","O"];Object.keys(jd).forEach(function(t){lP.forEach(function(o){o=o+t.charAt(0).toUpperCase()+t.substring(1),jd[o]=jd[t]})});function _T(t,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||jd.hasOwnProperty(t)&&jd[t]?(""+o).trim():o+"px"}function yT(t,o){t=t.style;for(var u in o)if(o.hasOwnProperty(u)){var p=u.indexOf("--")===0,y=_T(u,o[u],p);u==="float"&&(u="cssFloat"),p?t.setProperty(u,y):t[u]=y}}var cP=Jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function L0(t,o){if(o){if(cP[t]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(at(137,t));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(at(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(at(61))}if(o.style!=null&&typeof o.style!="object")throw Error(at(62))}}function R0(t,o){if(t.indexOf("-")===-1)return typeof o.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var O0=null;function Hv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var B0=null,Au=null,Mu=null;function Zb(t){if(t=kf(t)){if(typeof B0!="function")throw Error(at(280));var o=t.stateNode;o&&(o=Og(o),B0(t.stateNode,t.type,o))}}function vT(t){Au?Mu?Mu.push(t):Mu=[t]:Au=t}function xT(){if(Au){var t=Au,o=Mu;if(Mu=Au=null,Zb(t),o)for(t=0;t<o.length;t++)Zb(o[t])}}function wT(t,o){return t(o)}function bT(){}var Uy=!1;function ET(t,o,u){if(Uy)return t(o,u);Uy=!0;try{return wT(t,o,u)}finally{Uy=!1,(Au!==null||Mu!==null)&&(bT(),xT())}}function tf(t,o){var u=t.stateNode;if(u===null)return null;var p=Og(u);if(p===null)return null;u=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(t=t.type,p=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!p;break e;default:t=!1}if(t)return null;if(u&&typeof u!="function")throw Error(at(231,o,typeof u));return u}var F0=!1;if(Is)try{var Ad={};Object.defineProperty(Ad,"passive",{get:function(){F0=!0}}),window.addEventListener("test",Ad,Ad),window.removeEventListener("test",Ad,Ad)}catch{F0=!1}function uP(t,o,u,p,y,w,C,a,z){var F=Array.prototype.slice.call(arguments,3);try{o.apply(u,F)}catch(H){this.onError(H)}}var Ud=!1,tg=null,ng=!1,N0=null,hP={onError:function(t){Ud=!0,tg=t}};function dP(t,o,u,p,y,w,C,a,z){Ud=!1,tg=null,uP.apply(hP,arguments)}function fP(t,o,u,p,y,w,C,a,z){if(dP.apply(this,arguments),Ud){if(Ud){var F=tg;Ud=!1,tg=null}else throw Error(at(198));ng||(ng=!0,N0=F)}}function oc(t){var o=t,u=t;if(t.alternate)for(;o.return;)o=o.return;else{t=o;do o=t,o.flags&4098&&(u=o.return),t=o.return;while(t)}return o.tag===3?u:null}function TT(t){if(t.tag===13){var o=t.memoizedState;if(o===null&&(t=t.alternate,t!==null&&(o=t.memoizedState)),o!==null)return o.dehydrated}return null}function Wb(t){if(oc(t)!==t)throw Error(at(188))}function pP(t){var o=t.alternate;if(!o){if(o=oc(t),o===null)throw Error(at(188));return o!==t?null:t}for(var u=t,p=o;;){var y=u.return;if(y===null)break;var w=y.alternate;if(w===null){if(p=y.return,p!==null){u=p;continue}break}if(y.child===w.child){for(w=y.child;w;){if(w===u)return Wb(y),t;if(w===p)return Wb(y),o;w=w.sibling}throw Error(at(188))}if(u.return!==p.return)u=y,p=w;else{for(var C=!1,a=y.child;a;){if(a===u){C=!0,u=y,p=w;break}if(a===p){C=!0,p=y,u=w;break}a=a.sibling}if(!C){for(a=w.child;a;){if(a===u){C=!0,u=w,p=y;break}if(a===p){C=!0,p=w,u=y;break}a=a.sibling}if(!C)throw Error(at(189))}}if(u.alternate!==p)throw Error(at(190))}if(u.tag!==3)throw Error(at(188));return u.stateNode.current===u?t:o}function ST(t){return t=pP(t),t!==null?CT(t):null}function CT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var o=CT(t);if(o!==null)return o;t=t.sibling}return null}var AT=zi.unstable_scheduleCallback,Xb=zi.unstable_cancelCallback,mP=zi.unstable_shouldYield,gP=zi.unstable_requestPaint,rr=zi.unstable_now,_P=zi.unstable_getCurrentPriorityLevel,Yv=zi.unstable_ImmediatePriority,MT=zi.unstable_UserBlockingPriority,rg=zi.unstable_NormalPriority,yP=zi.unstable_LowPriority,kT=zi.unstable_IdlePriority,zg=null,Jo=null;function vP(t){if(Jo&&typeof Jo.onCommitFiberRoot=="function")try{Jo.onCommitFiberRoot(zg,t,void 0,(t.current.flags&128)===128)}catch{}}var Mo=Math.clz32?Math.clz32:bP,xP=Math.log,wP=Math.LN2;function bP(t){return t>>>=0,t===0?32:31-(xP(t)/wP|0)|0}var hm=64,dm=4194304;function Bd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ig(t,o){var u=t.pendingLanes;if(u===0)return 0;var p=0,y=t.suspendedLanes,w=t.pingedLanes,C=u&268435455;if(C!==0){var a=C&~y;a!==0?p=Bd(a):(w&=C,w!==0&&(p=Bd(w)))}else C=u&~y,C!==0?p=Bd(C):w!==0&&(p=Bd(w));if(p===0)return 0;if(o!==0&&o!==p&&!(o&y)&&(y=p&-p,w=o&-o,y>=w||y===16&&(w&4194240)!==0))return o;if(p&4&&(p|=u&16),o=t.entangledLanes,o!==0)for(t=t.entanglements,o&=p;0<o;)u=31-Mo(o),y=1<<u,p|=t[u],o&=~y;return p}function EP(t,o){switch(t){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TP(t,o){for(var u=t.suspendedLanes,p=t.pingedLanes,y=t.expirationTimes,w=t.pendingLanes;0<w;){var C=31-Mo(w),a=1<<C,z=y[C];z===-1?(!(a&u)||a&p)&&(y[C]=EP(a,o)):z<=o&&(t.expiredLanes|=a),w&=~a}}function j0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function IT(){var t=hm;return hm<<=1,!(hm&4194240)&&(hm=64),t}function Vy(t){for(var o=[],u=0;31>u;u++)o.push(t);return o}function Af(t,o,u){t.pendingLanes|=o,o!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,o=31-Mo(o),t[o]=u}function SP(t,o){var u=t.pendingLanes&~o;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=o,t.mutableReadLanes&=o,t.entangledLanes&=o,o=t.entanglements;var p=t.eventTimes;for(t=t.expirationTimes;0<u;){var y=31-Mo(u),w=1<<y;o[y]=0,p[y]=-1,t[y]=-1,u&=~w}}function Kv(t,o){var u=t.entangledLanes|=o;for(t=t.entanglements;u;){var p=31-Mo(u),y=1<<p;y&o|t[p]&o&&(t[p]|=o),u&=~y}}var Tn=0;function PT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var zT,Jv,DT,LT,RT,U0=!1,fm=[],Da=null,La=null,Ra=null,nf=new Map,rf=new Map,Ca=[],CP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Hb(t,o){switch(t){case"focusin":case"focusout":Da=null;break;case"dragenter":case"dragleave":La=null;break;case"mouseover":case"mouseout":Ra=null;break;case"pointerover":case"pointerout":nf.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":rf.delete(o.pointerId)}}function Md(t,o,u,p,y,w){return t===null||t.nativeEvent!==w?(t={blockedOn:o,domEventName:u,eventSystemFlags:p,nativeEvent:w,targetContainers:[y]},o!==null&&(o=kf(o),o!==null&&Jv(o)),t):(t.eventSystemFlags|=p,o=t.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),t)}function AP(t,o,u,p,y){switch(o){case"focusin":return Da=Md(Da,t,o,u,p,y),!0;case"dragenter":return La=Md(La,t,o,u,p,y),!0;case"mouseover":return Ra=Md(Ra,t,o,u,p,y),!0;case"pointerover":var w=y.pointerId;return nf.set(w,Md(nf.get(w)||null,t,o,u,p,y)),!0;case"gotpointercapture":return w=y.pointerId,rf.set(w,Md(rf.get(w)||null,t,o,u,p,y)),!0}return!1}function OT(t){var o=Gl(t.target);if(o!==null){var u=oc(o);if(u!==null){if(o=u.tag,o===13){if(o=TT(u),o!==null){t.blockedOn=o,RT(t.priority,function(){DT(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){t.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Om(t){if(t.blockedOn!==null)return!1;for(var o=t.targetContainers;0<o.length;){var u=V0(t.domEventName,t.eventSystemFlags,o[0],t.nativeEvent);if(u===null){u=t.nativeEvent;var p=new u.constructor(u.type,u);O0=p,u.target.dispatchEvent(p),O0=null}else return o=kf(u),o!==null&&Jv(o),t.blockedOn=u,!1;o.shift()}return!0}function Yb(t,o,u){Om(t)&&u.delete(o)}function MP(){U0=!1,Da!==null&&Om(Da)&&(Da=null),La!==null&&Om(La)&&(La=null),Ra!==null&&Om(Ra)&&(Ra=null),nf.forEach(Yb),rf.forEach(Yb)}function kd(t,o){t.blockedOn===o&&(t.blockedOn=null,U0||(U0=!0,zi.unstable_scheduleCallback(zi.unstable_NormalPriority,MP)))}function of(t){function o(y){return kd(y,t)}if(0<fm.length){kd(fm[0],t);for(var u=1;u<fm.length;u++){var p=fm[u];p.blockedOn===t&&(p.blockedOn=null)}}for(Da!==null&&kd(Da,t),La!==null&&kd(La,t),Ra!==null&&kd(Ra,t),nf.forEach(o),rf.forEach(o),u=0;u<Ca.length;u++)p=Ca[u],p.blockedOn===t&&(p.blockedOn=null);for(;0<Ca.length&&(u=Ca[0],u.blockedOn===null);)OT(u),u.blockedOn===null&&Ca.shift()}var ku=Bs.ReactCurrentBatchConfig,og=!0;function kP(t,o,u,p){var y=Tn,w=ku.transition;ku.transition=null;try{Tn=1,Qv(t,o,u,p)}finally{Tn=y,ku.transition=w}}function IP(t,o,u,p){var y=Tn,w=ku.transition;ku.transition=null;try{Tn=4,Qv(t,o,u,p)}finally{Tn=y,ku.transition=w}}function Qv(t,o,u,p){if(og){var y=V0(t,o,u,p);if(y===null)Jy(t,o,p,sg,u),Hb(t,p);else if(AP(y,t,o,u,p))p.stopPropagation();else if(Hb(t,p),o&4&&-1<CP.indexOf(t)){for(;y!==null;){var w=kf(y);if(w!==null&&zT(w),w=V0(t,o,u,p),w===null&&Jy(t,o,p,sg,u),w===y)break;y=w}y!==null&&p.stopPropagation()}else Jy(t,o,p,null,u)}}var sg=null;function V0(t,o,u,p){if(sg=null,t=Hv(p),t=Gl(t),t!==null)if(o=oc(t),o===null)t=null;else if(u=o.tag,u===13){if(t=TT(o),t!==null)return t;t=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;t=null}else o!==t&&(t=null);return sg=t,null}function BT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_P()){case Yv:return 1;case MT:return 4;case rg:case yP:return 16;case kT:return 536870912;default:return 16}default:return 16}}var ka=null,ex=null,Bm=null;function FT(){if(Bm)return Bm;var t,o=ex,u=o.length,p,y="value"in ka?ka.value:ka.textContent,w=y.length;for(t=0;t<u&&o[t]===y[t];t++);var C=u-t;for(p=1;p<=C&&o[u-p]===y[w-p];p++);return Bm=y.slice(t,1<p?1-p:void 0)}function Fm(t){var o=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&o===13&&(t=13)):t=o,t===10&&(t=13),32<=t||t===13?t:0}function pm(){return!0}function Kb(){return!1}function Li(t){function o(u,p,y,w,C){this._reactName=u,this._targetInst=y,this.type=p,this.nativeEvent=w,this.target=C,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(u=t[a],this[a]=u?u(w):w[a]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?pm:Kb,this.isPropagationStopped=Kb,this}return Jn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=pm)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=pm)},persist:function(){},isPersistent:pm}),o}var qu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tx=Li(qu),Mf=Jn({},qu,{view:0,detail:0}),PP=Li(Mf),$y,Gy,Id,Dg=Jn({},Mf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nx,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Id&&(Id&&t.type==="mousemove"?($y=t.screenX-Id.screenX,Gy=t.screenY-Id.screenY):Gy=$y=0,Id=t),$y)},movementY:function(t){return"movementY"in t?t.movementY:Gy}}),Jb=Li(Dg),zP=Jn({},Dg,{dataTransfer:0}),DP=Li(zP),LP=Jn({},Mf,{relatedTarget:0}),qy=Li(LP),RP=Jn({},qu,{animationName:0,elapsedTime:0,pseudoElement:0}),OP=Li(RP),BP=Jn({},qu,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),FP=Li(BP),NP=Jn({},qu,{data:0}),Qb=Li(NP),jP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},VP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $P(t){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(t):(t=VP[t])?!!o[t]:!1}function nx(){return $P}var GP=Jn({},Mf,{key:function(t){if(t.key){var o=jP[t.key]||t.key;if(o!=="Unidentified")return o}return t.type==="keypress"?(t=Fm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?UP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nx,charCode:function(t){return t.type==="keypress"?Fm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Fm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),qP=Li(GP),ZP=Jn({},Dg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e2=Li(ZP),WP=Jn({},Mf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nx}),XP=Li(WP),HP=Jn({},qu,{propertyName:0,elapsedTime:0,pseudoElement:0}),YP=Li(HP),KP=Jn({},Dg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),JP=Li(KP),QP=[9,13,27,32],rx=Is&&"CompositionEvent"in window,Vd=null;Is&&"documentMode"in document&&(Vd=document.documentMode);var ez=Is&&"TextEvent"in window&&!Vd,NT=Is&&(!rx||Vd&&8<Vd&&11>=Vd),t2=String.fromCharCode(32),n2=!1;function jT(t,o){switch(t){case"keyup":return QP.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function UT(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var fu=!1;function tz(t,o){switch(t){case"compositionend":return UT(o);case"keypress":return o.which!==32?null:(n2=!0,t2);case"textInput":return t=o.data,t===t2&&n2?null:t;default:return null}}function nz(t,o){if(fu)return t==="compositionend"||!rx&&jT(t,o)?(t=FT(),Bm=ex=ka=null,fu=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return NT&&o.locale!=="ko"?null:o.data;default:return null}}var rz={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r2(t){var o=t&&t.nodeName&&t.nodeName.toLowerCase();return o==="input"?!!rz[t.type]:o==="textarea"}function VT(t,o,u,p){vT(p),o=ag(o,"onChange"),0<o.length&&(u=new tx("onChange","change",null,u,p),t.push({event:u,listeners:o}))}var $d=null,sf=null;function iz(t){QT(t,0)}function Lg(t){var o=gu(t);if(dT(o))return t}function oz(t,o){if(t==="change")return o}var $T=!1;if(Is){var Zy;if(Is){var Wy="oninput"in document;if(!Wy){var i2=document.createElement("div");i2.setAttribute("oninput","return;"),Wy=typeof i2.oninput=="function"}Zy=Wy}else Zy=!1;$T=Zy&&(!document.documentMode||9<document.documentMode)}function o2(){$d&&($d.detachEvent("onpropertychange",GT),sf=$d=null)}function GT(t){if(t.propertyName==="value"&&Lg(sf)){var o=[];VT(o,sf,t,Hv(t)),ET(iz,o)}}function sz(t,o,u){t==="focusin"?(o2(),$d=o,sf=u,$d.attachEvent("onpropertychange",GT)):t==="focusout"&&o2()}function az(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lg(sf)}function lz(t,o){if(t==="click")return Lg(o)}function cz(t,o){if(t==="input"||t==="change")return Lg(o)}function uz(t,o){return t===o&&(t!==0||1/t===1/o)||t!==t&&o!==o}var Io=typeof Object.is=="function"?Object.is:uz;function af(t,o){if(Io(t,o))return!0;if(typeof t!="object"||t===null||typeof o!="object"||o===null)return!1;var u=Object.keys(t),p=Object.keys(o);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var y=u[p];if(!T0.call(o,y)||!Io(t[y],o[y]))return!1}return!0}function s2(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function a2(t,o){var u=s2(t);t=0;for(var p;u;){if(u.nodeType===3){if(p=t+u.textContent.length,t<=o&&p>=o)return{node:u,offset:o-t};t=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=s2(u)}}function qT(t,o){return t&&o?t===o?!0:t&&t.nodeType===3?!1:o&&o.nodeType===3?qT(t,o.parentNode):"contains"in t?t.contains(o):t.compareDocumentPosition?!!(t.compareDocumentPosition(o)&16):!1:!1}function ZT(){for(var t=window,o=eg();o instanceof t.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)t=o.contentWindow;else break;o=eg(t.document)}return o}function ix(t){var o=t&&t.nodeName&&t.nodeName.toLowerCase();return o&&(o==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||o==="textarea"||t.contentEditable==="true")}function hz(t){var o=ZT(),u=t.focusedElem,p=t.selectionRange;if(o!==u&&u&&u.ownerDocument&&qT(u.ownerDocument.documentElement,u)){if(p!==null&&ix(u)){if(o=p.start,t=p.end,t===void 0&&(t=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(t,u.value.length);else if(t=(o=u.ownerDocument||document)&&o.defaultView||window,t.getSelection){t=t.getSelection();var y=u.textContent.length,w=Math.min(p.start,y);p=p.end===void 0?w:Math.min(p.end,y),!t.extend&&w>p&&(y=p,p=w,w=y),y=a2(u,w);var C=a2(u,p);y&&C&&(t.rangeCount!==1||t.anchorNode!==y.node||t.anchorOffset!==y.offset||t.focusNode!==C.node||t.focusOffset!==C.offset)&&(o=o.createRange(),o.setStart(y.node,y.offset),t.removeAllRanges(),w>p?(t.addRange(o),t.extend(C.node,C.offset)):(o.setEnd(C.node,C.offset),t.addRange(o)))}}for(o=[],t=u;t=t.parentNode;)t.nodeType===1&&o.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)t=o[u],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var dz=Is&&"documentMode"in document&&11>=document.documentMode,pu=null,$0=null,Gd=null,G0=!1;function l2(t,o,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;G0||pu==null||pu!==eg(p)||(p=pu,"selectionStart"in p&&ix(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Gd&&af(Gd,p)||(Gd=p,p=ag($0,"onSelect"),0<p.length&&(o=new tx("onSelect","select",null,o,u),t.push({event:o,listeners:p}),o.target=pu)))}function mm(t,o){var u={};return u[t.toLowerCase()]=o.toLowerCase(),u["Webkit"+t]="webkit"+o,u["Moz"+t]="moz"+o,u}var mu={animationend:mm("Animation","AnimationEnd"),animationiteration:mm("Animation","AnimationIteration"),animationstart:mm("Animation","AnimationStart"),transitionend:mm("Transition","TransitionEnd")},Xy={},WT={};Is&&(WT=document.createElement("div").style,"AnimationEvent"in window||(delete mu.animationend.animation,delete mu.animationiteration.animation,delete mu.animationstart.animation),"TransitionEvent"in window||delete mu.transitionend.transition);function Rg(t){if(Xy[t])return Xy[t];if(!mu[t])return t;var o=mu[t],u;for(u in o)if(o.hasOwnProperty(u)&&u in WT)return Xy[t]=o[u];return t}var XT=Rg("animationend"),HT=Rg("animationiteration"),YT=Rg("animationstart"),KT=Rg("transitionend"),JT=new Map,c2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wa(t,o){JT.set(t,o),ic(o,[t])}for(var Hy=0;Hy<c2.length;Hy++){var Yy=c2[Hy],fz=Yy.toLowerCase(),pz=Yy[0].toUpperCase()+Yy.slice(1);Wa(fz,"on"+pz)}Wa(XT,"onAnimationEnd");Wa(HT,"onAnimationIteration");Wa(YT,"onAnimationStart");Wa("dblclick","onDoubleClick");Wa("focusin","onFocus");Wa("focusout","onBlur");Wa(KT,"onTransitionEnd");Du("onMouseEnter",["mouseout","mouseover"]);Du("onMouseLeave",["mouseout","mouseover"]);Du("onPointerEnter",["pointerout","pointerover"]);Du("onPointerLeave",["pointerout","pointerover"]);ic("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ic("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ic("onBeforeInput",["compositionend","keypress","textInput","paste"]);ic("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ic("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ic("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mz=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fd));function u2(t,o,u){var p=t.type||"unknown-event";t.currentTarget=u,fP(p,o,void 0,t),t.currentTarget=null}function QT(t,o){o=(o&4)!==0;for(var u=0;u<t.length;u++){var p=t[u],y=p.event;p=p.listeners;e:{var w=void 0;if(o)for(var C=p.length-1;0<=C;C--){var a=p[C],z=a.instance,F=a.currentTarget;if(a=a.listener,z!==w&&y.isPropagationStopped())break e;u2(y,a,F),w=z}else for(C=0;C<p.length;C++){if(a=p[C],z=a.instance,F=a.currentTarget,a=a.listener,z!==w&&y.isPropagationStopped())break e;u2(y,a,F),w=z}}}if(ng)throw t=N0,ng=!1,N0=null,t}function Ln(t,o){var u=o[H0];u===void 0&&(u=o[H0]=new Set);var p=t+"__bubble";u.has(p)||(eS(o,t,2,!1),u.add(p))}function Ky(t,o,u){var p=0;o&&(p|=4),eS(u,t,p,o)}var gm="_reactListening"+Math.random().toString(36).slice(2);function lf(t){if(!t[gm]){t[gm]=!0,aT.forEach(function(u){u!=="selectionchange"&&(mz.has(u)||Ky(u,!1,t),Ky(u,!0,t))});var o=t.nodeType===9?t:t.ownerDocument;o===null||o[gm]||(o[gm]=!0,Ky("selectionchange",!1,o))}}function eS(t,o,u,p){switch(BT(o)){case 1:var y=kP;break;case 4:y=IP;break;default:y=Qv}u=y.bind(null,o,u,t),y=void 0,!F0||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),p?y!==void 0?t.addEventListener(o,u,{capture:!0,passive:y}):t.addEventListener(o,u,!0):y!==void 0?t.addEventListener(o,u,{passive:y}):t.addEventListener(o,u,!1)}function Jy(t,o,u,p,y){var w=p;if(!(o&1)&&!(o&2)&&p!==null)e:for(;;){if(p===null)return;var C=p.tag;if(C===3||C===4){var a=p.stateNode.containerInfo;if(a===y||a.nodeType===8&&a.parentNode===y)break;if(C===4)for(C=p.return;C!==null;){var z=C.tag;if((z===3||z===4)&&(z=C.stateNode.containerInfo,z===y||z.nodeType===8&&z.parentNode===y))return;C=C.return}for(;a!==null;){if(C=Gl(a),C===null)return;if(z=C.tag,z===5||z===6){p=w=C;continue e}a=a.parentNode}}p=p.return}ET(function(){var F=w,H=Hv(u),Z=[];e:{var Y=JT.get(t);if(Y!==void 0){var ie=tx,ce=t;switch(t){case"keypress":if(Fm(u)===0)break e;case"keydown":case"keyup":ie=qP;break;case"focusin":ce="focus",ie=qy;break;case"focusout":ce="blur",ie=qy;break;case"beforeblur":case"afterblur":ie=qy;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=Jb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=DP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=XP;break;case XT:case HT:case YT:ie=OP;break;case KT:ie=YP;break;case"scroll":ie=PP;break;case"wheel":ie=JP;break;case"copy":case"cut":case"paste":ie=FP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=e2}var _e=(o&4)!==0,ze=!_e&&t==="scroll",le=_e?Y!==null?Y+"Capture":null:Y;_e=[];for(var ee=F,ue;ee!==null;){ue=ee;var Be=ue.stateNode;if(ue.tag===5&&Be!==null&&(ue=Be,le!==null&&(Be=tf(ee,le),Be!=null&&_e.push(cf(ee,Be,ue)))),ze)break;ee=ee.return}0<_e.length&&(Y=new ie(Y,ce,null,u,H),Z.push({event:Y,listeners:_e}))}}if(!(o&7)){e:{if(Y=t==="mouseover"||t==="pointerover",ie=t==="mouseout"||t==="pointerout",Y&&u!==O0&&(ce=u.relatedTarget||u.fromElement)&&(Gl(ce)||ce[Ps]))break e;if((ie||Y)&&(Y=H.window===H?H:(Y=H.ownerDocument)?Y.defaultView||Y.parentWindow:window,ie?(ce=u.relatedTarget||u.toElement,ie=F,ce=ce?Gl(ce):null,ce!==null&&(ze=oc(ce),ce!==ze||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(ie=null,ce=F),ie!==ce)){if(_e=Jb,Be="onMouseLeave",le="onMouseEnter",ee="mouse",(t==="pointerout"||t==="pointerover")&&(_e=e2,Be="onPointerLeave",le="onPointerEnter",ee="pointer"),ze=ie==null?Y:gu(ie),ue=ce==null?Y:gu(ce),Y=new _e(Be,ee+"leave",ie,u,H),Y.target=ze,Y.relatedTarget=ue,Be=null,Gl(H)===F&&(_e=new _e(le,ee+"enter",ce,u,H),_e.target=ue,_e.relatedTarget=ze,Be=_e),ze=Be,ie&&ce)t:{for(_e=ie,le=ce,ee=0,ue=_e;ue;ue=uu(ue))ee++;for(ue=0,Be=le;Be;Be=uu(Be))ue++;for(;0<ee-ue;)_e=uu(_e),ee--;for(;0<ue-ee;)le=uu(le),ue--;for(;ee--;){if(_e===le||le!==null&&_e===le.alternate)break t;_e=uu(_e),le=uu(le)}_e=null}else _e=null;ie!==null&&h2(Z,Y,ie,_e,!1),ce!==null&&ze!==null&&h2(Z,ze,ce,_e,!0)}}e:{if(Y=F?gu(F):window,ie=Y.nodeName&&Y.nodeName.toLowerCase(),ie==="select"||ie==="input"&&Y.type==="file")var $e=oz;else if(r2(Y))if($T)$e=cz;else{$e=az;var ot=sz}else(ie=Y.nodeName)&&ie.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&($e=lz);if($e&&($e=$e(t,F))){VT(Z,$e,u,H);break e}ot&&ot(t,Y,F),t==="focusout"&&(ot=Y._wrapperState)&&ot.controlled&&Y.type==="number"&&P0(Y,"number",Y.value)}switch(ot=F?gu(F):window,t){case"focusin":(r2(ot)||ot.contentEditable==="true")&&(pu=ot,$0=F,Gd=null);break;case"focusout":Gd=$0=pu=null;break;case"mousedown":G0=!0;break;case"contextmenu":case"mouseup":case"dragend":G0=!1,l2(Z,u,H);break;case"selectionchange":if(dz)break;case"keydown":case"keyup":l2(Z,u,H)}var rt;if(rx)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else fu?jT(t,u)&&(Je="onCompositionEnd"):t==="keydown"&&u.keyCode===229&&(Je="onCompositionStart");Je&&(NT&&u.locale!=="ko"&&(fu||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&fu&&(rt=FT()):(ka=H,ex="value"in ka?ka.value:ka.textContent,fu=!0)),ot=ag(F,Je),0<ot.length&&(Je=new Qb(Je,t,null,u,H),Z.push({event:Je,listeners:ot}),rt?Je.data=rt:(rt=UT(u),rt!==null&&(Je.data=rt)))),(rt=ez?tz(t,u):nz(t,u))&&(F=ag(F,"onBeforeInput"),0<F.length&&(H=new Qb("onBeforeInput","beforeinput",null,u,H),Z.push({event:H,listeners:F}),H.data=rt))}QT(Z,o)})}function cf(t,o,u){return{instance:t,listener:o,currentTarget:u}}function ag(t,o){for(var u=o+"Capture",p=[];t!==null;){var y=t,w=y.stateNode;y.tag===5&&w!==null&&(y=w,w=tf(t,u),w!=null&&p.unshift(cf(t,w,y)),w=tf(t,o),w!=null&&p.push(cf(t,w,y))),t=t.return}return p}function uu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function h2(t,o,u,p,y){for(var w=o._reactName,C=[];u!==null&&u!==p;){var a=u,z=a.alternate,F=a.stateNode;if(z!==null&&z===p)break;a.tag===5&&F!==null&&(a=F,y?(z=tf(u,w),z!=null&&C.unshift(cf(u,z,a))):y||(z=tf(u,w),z!=null&&C.push(cf(u,z,a)))),u=u.return}C.length!==0&&t.push({event:o,listeners:C})}var gz=/\r\n?/g,_z=/\u0000|\uFFFD/g;function d2(t){return(typeof t=="string"?t:""+t).replace(gz,`
`).replace(_z,"")}function _m(t,o,u){if(o=d2(o),d2(t)!==o&&u)throw Error(at(425))}function lg(){}var q0=null,Z0=null;function W0(t,o){return t==="textarea"||t==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var X0=typeof setTimeout=="function"?setTimeout:void 0,yz=typeof clearTimeout=="function"?clearTimeout:void 0,f2=typeof Promise=="function"?Promise:void 0,vz=typeof queueMicrotask=="function"?queueMicrotask:typeof f2<"u"?function(t){return f2.resolve(null).then(t).catch(xz)}:X0;function xz(t){setTimeout(function(){throw t})}function Qy(t,o){var u=o,p=0;do{var y=u.nextSibling;if(t.removeChild(u),y&&y.nodeType===8)if(u=y.data,u==="/$"){if(p===0){t.removeChild(y),of(o);return}p--}else u!=="$"&&u!=="$?"&&u!=="$!"||p++;u=y}while(u);of(o)}function Oa(t){for(;t!=null;t=t.nextSibling){var o=t.nodeType;if(o===1||o===3)break;if(o===8){if(o=t.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return t}function p2(t){t=t.previousSibling;for(var o=0;t;){if(t.nodeType===8){var u=t.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return t;o--}else u==="/$"&&o++}t=t.previousSibling}return null}var Zu=Math.random().toString(36).slice(2),Ho="__reactFiber$"+Zu,uf="__reactProps$"+Zu,Ps="__reactContainer$"+Zu,H0="__reactEvents$"+Zu,wz="__reactListeners$"+Zu,bz="__reactHandles$"+Zu;function Gl(t){var o=t[Ho];if(o)return o;for(var u=t.parentNode;u;){if(o=u[Ps]||u[Ho]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(t=p2(t);t!==null;){if(u=t[Ho])return u;t=p2(t)}return o}t=u,u=t.parentNode}return null}function kf(t){return t=t[Ho]||t[Ps],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function gu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(at(33))}function Og(t){return t[uf]||null}var Y0=[],_u=-1;function Xa(t){return{current:t}}function On(t){0>_u||(t.current=Y0[_u],Y0[_u]=null,_u--)}function Pn(t,o){_u++,Y0[_u]=t.current,t.current=o}var Va={},Xr=Xa(Va),yi=Xa(!1),Kl=Va;function Lu(t,o){var u=t.type.contextTypes;if(!u)return Va;var p=t.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===o)return p.__reactInternalMemoizedMaskedChildContext;var y={},w;for(w in u)y[w]=o[w];return p&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=y),y}function vi(t){return t=t.childContextTypes,t!=null}function cg(){On(yi),On(Xr)}function m2(t,o,u){if(Xr.current!==Va)throw Error(at(168));Pn(Xr,o),Pn(yi,u)}function tS(t,o,u){var p=t.stateNode;if(o=o.childContextTypes,typeof p.getChildContext!="function")return u;p=p.getChildContext();for(var y in p)if(!(y in o))throw Error(at(108,sP(t)||"Unknown",y));return Jn({},u,p)}function ug(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Va,Kl=Xr.current,Pn(Xr,t),Pn(yi,yi.current),!0}function g2(t,o,u){var p=t.stateNode;if(!p)throw Error(at(169));u?(t=tS(t,o,Kl),p.__reactInternalMemoizedMergedChildContext=t,On(yi),On(Xr),Pn(Xr,t)):On(yi),Pn(yi,u)}var Ss=null,Bg=!1,e0=!1;function nS(t){Ss===null?Ss=[t]:Ss.push(t)}function Ez(t){Bg=!0,nS(t)}function Ha(){if(!e0&&Ss!==null){e0=!0;var t=0,o=Tn;try{var u=Ss;for(Tn=1;t<u.length;t++){var p=u[t];do p=p(!0);while(p!==null)}Ss=null,Bg=!1}catch(y){throw Ss!==null&&(Ss=Ss.slice(t+1)),AT(Yv,Ha),y}finally{Tn=o,e0=!1}}return null}var yu=[],vu=0,hg=null,dg=0,Xi=[],Hi=0,Jl=null,Cs=1,As="";function Vl(t,o){yu[vu++]=dg,yu[vu++]=hg,hg=t,dg=o}function rS(t,o,u){Xi[Hi++]=Cs,Xi[Hi++]=As,Xi[Hi++]=Jl,Jl=t;var p=Cs;t=As;var y=32-Mo(p)-1;p&=~(1<<y),u+=1;var w=32-Mo(o)+y;if(30<w){var C=y-y%5;w=(p&(1<<C)-1).toString(32),p>>=C,y-=C,Cs=1<<32-Mo(o)+y|u<<y|p,As=w+t}else Cs=1<<w|u<<y|p,As=t}function ox(t){t.return!==null&&(Vl(t,1),rS(t,1,0))}function sx(t){for(;t===hg;)hg=yu[--vu],yu[vu]=null,dg=yu[--vu],yu[vu]=null;for(;t===Jl;)Jl=Xi[--Hi],Xi[Hi]=null,As=Xi[--Hi],Xi[Hi]=null,Cs=Xi[--Hi],Xi[Hi]=null}var Ii=null,ki=null,jn=!1,Co=null;function iS(t,o){var u=Yi(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=t,o=t.deletions,o===null?(t.deletions=[u],t.flags|=16):o.push(u)}function _2(t,o){switch(t.tag){case 5:var u=t.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(t.stateNode=o,Ii=t,ki=Oa(o.firstChild),!0):!1;case 6:return o=t.pendingProps===""||o.nodeType!==3?null:o,o!==null?(t.stateNode=o,Ii=t,ki=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=Jl!==null?{id:Cs,overflow:As}:null,t.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=Yi(18,null,null,0),u.stateNode=o,u.return=t,t.child=u,Ii=t,ki=null,!0):!1;default:return!1}}function K0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function J0(t){if(jn){var o=ki;if(o){var u=o;if(!_2(t,o)){if(K0(t))throw Error(at(418));o=Oa(u.nextSibling);var p=Ii;o&&_2(t,o)?iS(p,u):(t.flags=t.flags&-4097|2,jn=!1,Ii=t)}}else{if(K0(t))throw Error(at(418));t.flags=t.flags&-4097|2,jn=!1,Ii=t}}}function y2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Ii=t}function ym(t){if(t!==Ii)return!1;if(!jn)return y2(t),jn=!0,!1;var o;if((o=t.tag!==3)&&!(o=t.tag!==5)&&(o=t.type,o=o!=="head"&&o!=="body"&&!W0(t.type,t.memoizedProps)),o&&(o=ki)){if(K0(t))throw oS(),Error(at(418));for(;o;)iS(t,o),o=Oa(o.nextSibling)}if(y2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(at(317));e:{for(t=t.nextSibling,o=0;t;){if(t.nodeType===8){var u=t.data;if(u==="/$"){if(o===0){ki=Oa(t.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}t=t.nextSibling}ki=null}}else ki=Ii?Oa(t.stateNode.nextSibling):null;return!0}function oS(){for(var t=ki;t;)t=Oa(t.nextSibling)}function Ru(){ki=Ii=null,jn=!1}function ax(t){Co===null?Co=[t]:Co.push(t)}var Tz=Bs.ReactCurrentBatchConfig;function To(t,o){if(t&&t.defaultProps){o=Jn({},o),t=t.defaultProps;for(var u in t)o[u]===void 0&&(o[u]=t[u]);return o}return o}var fg=Xa(null),pg=null,xu=null,lx=null;function cx(){lx=xu=pg=null}function ux(t){var o=fg.current;On(fg),t._currentValue=o}function Q0(t,o,u){for(;t!==null;){var p=t.alternate;if((t.childLanes&o)!==o?(t.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),t===u)break;t=t.return}}function Iu(t,o){pg=t,lx=xu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&o&&(_i=!0),t.firstContext=null)}function Qi(t){var o=t._currentValue;if(lx!==t)if(t={context:t,memoizedValue:o,next:null},xu===null){if(pg===null)throw Error(at(308));xu=t,pg.dependencies={lanes:0,firstContext:t}}else xu=xu.next=t;return o}var ql=null;function hx(t){ql===null?ql=[t]:ql.push(t)}function sS(t,o,u,p){var y=o.interleaved;return y===null?(u.next=u,hx(o)):(u.next=y.next,y.next=u),o.interleaved=u,zs(t,p)}function zs(t,o){t.lanes|=o;var u=t.alternate;for(u!==null&&(u.lanes|=o),u=t,t=t.return;t!==null;)t.childLanes|=o,u=t.alternate,u!==null&&(u.childLanes|=o),u=t,t=t.return;return u.tag===3?u.stateNode:null}var Sa=!1;function dx(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aS(t,o){t=t.updateQueue,o.updateQueue===t&&(o.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ms(t,o){return{eventTime:t,lane:o,tag:0,payload:null,callback:null,next:null}}function Ba(t,o,u){var p=t.updateQueue;if(p===null)return null;if(p=p.shared,ln&2){var y=p.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),p.pending=o,zs(t,u)}return y=p.interleaved,y===null?(o.next=o,hx(p)):(o.next=y.next,y.next=o),p.interleaved=o,zs(t,u)}function Nm(t,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var p=o.lanes;p&=t.pendingLanes,u|=p,o.lanes=u,Kv(t,u)}}function v2(t,o){var u=t.updateQueue,p=t.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var y=null,w=null;if(u=u.firstBaseUpdate,u!==null){do{var C={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};w===null?y=w=C:w=w.next=C,u=u.next}while(u!==null);w===null?y=w=o:w=w.next=o}else y=w=o;u={baseState:p.baseState,firstBaseUpdate:y,lastBaseUpdate:w,shared:p.shared,effects:p.effects},t.updateQueue=u;return}t=u.lastBaseUpdate,t===null?u.firstBaseUpdate=o:t.next=o,u.lastBaseUpdate=o}function mg(t,o,u,p){var y=t.updateQueue;Sa=!1;var w=y.firstBaseUpdate,C=y.lastBaseUpdate,a=y.shared.pending;if(a!==null){y.shared.pending=null;var z=a,F=z.next;z.next=null,C===null?w=F:C.next=F,C=z;var H=t.alternate;H!==null&&(H=H.updateQueue,a=H.lastBaseUpdate,a!==C&&(a===null?H.firstBaseUpdate=F:a.next=F,H.lastBaseUpdate=z))}if(w!==null){var Z=y.baseState;C=0,H=F=z=null,a=w;do{var Y=a.lane,ie=a.eventTime;if((p&Y)===Y){H!==null&&(H=H.next={eventTime:ie,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var ce=t,_e=a;switch(Y=o,ie=u,_e.tag){case 1:if(ce=_e.payload,typeof ce=="function"){Z=ce.call(ie,Z,Y);break e}Z=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=_e.payload,Y=typeof ce=="function"?ce.call(ie,Z,Y):ce,Y==null)break e;Z=Jn({},Z,Y);break e;case 2:Sa=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,Y=y.effects,Y===null?y.effects=[a]:Y.push(a))}else ie={eventTime:ie,lane:Y,tag:a.tag,payload:a.payload,callback:a.callback,next:null},H===null?(F=H=ie,z=Z):H=H.next=ie,C|=Y;if(a=a.next,a===null){if(a=y.shared.pending,a===null)break;Y=a,a=Y.next,Y.next=null,y.lastBaseUpdate=Y,y.shared.pending=null}}while(1);if(H===null&&(z=Z),y.baseState=z,y.firstBaseUpdate=F,y.lastBaseUpdate=H,o=y.shared.interleaved,o!==null){y=o;do C|=y.lane,y=y.next;while(y!==o)}else w===null&&(y.shared.lanes=0);ec|=C,t.lanes=C,t.memoizedState=Z}}function x2(t,o,u){if(t=o.effects,o.effects=null,t!==null)for(o=0;o<t.length;o++){var p=t[o],y=p.callback;if(y!==null){if(p.callback=null,p=u,typeof y!="function")throw Error(at(191,y));y.call(p)}}}var lS=new sT.Component().refs;function ev(t,o,u,p){o=t.memoizedState,u=u(p,o),u=u==null?o:Jn({},o,u),t.memoizedState=u,t.lanes===0&&(t.updateQueue.baseState=u)}var Fg={isMounted:function(t){return(t=t._reactInternals)?oc(t)===t:!1},enqueueSetState:function(t,o,u){t=t._reactInternals;var p=ni(),y=Na(t),w=Ms(p,y);w.payload=o,u!=null&&(w.callback=u),o=Ba(t,w,y),o!==null&&(ko(o,t,y,p),Nm(o,t,y))},enqueueReplaceState:function(t,o,u){t=t._reactInternals;var p=ni(),y=Na(t),w=Ms(p,y);w.tag=1,w.payload=o,u!=null&&(w.callback=u),o=Ba(t,w,y),o!==null&&(ko(o,t,y,p),Nm(o,t,y))},enqueueForceUpdate:function(t,o){t=t._reactInternals;var u=ni(),p=Na(t),y=Ms(u,p);y.tag=2,o!=null&&(y.callback=o),o=Ba(t,y,p),o!==null&&(ko(o,t,p,u),Nm(o,t,p))}};function w2(t,o,u,p,y,w,C){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(p,w,C):o.prototype&&o.prototype.isPureReactComponent?!af(u,p)||!af(y,w):!0}function cS(t,o,u){var p=!1,y=Va,w=o.contextType;return typeof w=="object"&&w!==null?w=Qi(w):(y=vi(o)?Kl:Xr.current,p=o.contextTypes,w=(p=p!=null)?Lu(t,y):Va),o=new o(u,w),t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Fg,t.stateNode=o,o._reactInternals=t,p&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=y,t.__reactInternalMemoizedMaskedChildContext=w),o}function b2(t,o,u,p){t=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,p),o.state!==t&&Fg.enqueueReplaceState(o,o.state,null)}function tv(t,o,u,p){var y=t.stateNode;y.props=u,y.state=t.memoizedState,y.refs=lS,dx(t);var w=o.contextType;typeof w=="object"&&w!==null?y.context=Qi(w):(w=vi(o)?Kl:Xr.current,y.context=Lu(t,w)),y.state=t.memoizedState,w=o.getDerivedStateFromProps,typeof w=="function"&&(ev(t,o,w,u),y.state=t.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(o=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),o!==y.state&&Fg.enqueueReplaceState(y,y.state,null),mg(t,u,y,p),y.state=t.memoizedState),typeof y.componentDidMount=="function"&&(t.flags|=4194308)}function Pd(t,o,u){if(t=u.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(at(309));var p=u.stateNode}if(!p)throw Error(at(147,t));var y=p,w=""+t;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===w?o.ref:(o=function(C){var a=y.refs;a===lS&&(a=y.refs={}),C===null?delete a[w]:a[w]=C},o._stringRef=w,o)}if(typeof t!="string")throw Error(at(284));if(!u._owner)throw Error(at(290,t))}return t}function vm(t,o){throw t=Object.prototype.toString.call(o),Error(at(31,t==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":t))}function E2(t){var o=t._init;return o(t._payload)}function uS(t){function o(le,ee){if(t){var ue=le.deletions;ue===null?(le.deletions=[ee],le.flags|=16):ue.push(ee)}}function u(le,ee){if(!t)return null;for(;ee!==null;)o(le,ee),ee=ee.sibling;return null}function p(le,ee){for(le=new Map;ee!==null;)ee.key!==null?le.set(ee.key,ee):le.set(ee.index,ee),ee=ee.sibling;return le}function y(le,ee){return le=ja(le,ee),le.index=0,le.sibling=null,le}function w(le,ee,ue){return le.index=ue,t?(ue=le.alternate,ue!==null?(ue=ue.index,ue<ee?(le.flags|=2,ee):ue):(le.flags|=2,ee)):(le.flags|=1048576,ee)}function C(le){return t&&le.alternate===null&&(le.flags|=2),le}function a(le,ee,ue,Be){return ee===null||ee.tag!==6?(ee=a0(ue,le.mode,Be),ee.return=le,ee):(ee=y(ee,ue),ee.return=le,ee)}function z(le,ee,ue,Be){var $e=ue.type;return $e===du?H(le,ee,ue.props.children,Be,ue.key):ee!==null&&(ee.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===Ta&&E2($e)===ee.type)?(Be=y(ee,ue.props),Be.ref=Pd(le,ee,ue),Be.return=le,Be):(Be=qm(ue.type,ue.key,ue.props,null,le.mode,Be),Be.ref=Pd(le,ee,ue),Be.return=le,Be)}function F(le,ee,ue,Be){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==ue.containerInfo||ee.stateNode.implementation!==ue.implementation?(ee=l0(ue,le.mode,Be),ee.return=le,ee):(ee=y(ee,ue.children||[]),ee.return=le,ee)}function H(le,ee,ue,Be,$e){return ee===null||ee.tag!==7?(ee=Yl(ue,le.mode,Be,$e),ee.return=le,ee):(ee=y(ee,ue),ee.return=le,ee)}function Z(le,ee,ue){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=a0(""+ee,le.mode,ue),ee.return=le,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case lm:return ue=qm(ee.type,ee.key,ee.props,null,le.mode,ue),ue.ref=Pd(le,null,ee),ue.return=le,ue;case hu:return ee=l0(ee,le.mode,ue),ee.return=le,ee;case Ta:var Be=ee._init;return Z(le,Be(ee._payload),ue)}if(Od(ee)||Cd(ee))return ee=Yl(ee,le.mode,ue,null),ee.return=le,ee;vm(le,ee)}return null}function Y(le,ee,ue,Be){var $e=ee!==null?ee.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number")return $e!==null?null:a(le,ee,""+ue,Be);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case lm:return ue.key===$e?z(le,ee,ue,Be):null;case hu:return ue.key===$e?F(le,ee,ue,Be):null;case Ta:return $e=ue._init,Y(le,ee,$e(ue._payload),Be)}if(Od(ue)||Cd(ue))return $e!==null?null:H(le,ee,ue,Be,null);vm(le,ue)}return null}function ie(le,ee,ue,Be,$e){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return le=le.get(ue)||null,a(ee,le,""+Be,$e);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case lm:return le=le.get(Be.key===null?ue:Be.key)||null,z(ee,le,Be,$e);case hu:return le=le.get(Be.key===null?ue:Be.key)||null,F(ee,le,Be,$e);case Ta:var ot=Be._init;return ie(le,ee,ue,ot(Be._payload),$e)}if(Od(Be)||Cd(Be))return le=le.get(ue)||null,H(ee,le,Be,$e,null);vm(ee,Be)}return null}function ce(le,ee,ue,Be){for(var $e=null,ot=null,rt=ee,Je=ee=0,De=null;rt!==null&&Je<ue.length;Je++){rt.index>Je?(De=rt,rt=null):De=rt.sibling;var _t=Y(le,rt,ue[Je],Be);if(_t===null){rt===null&&(rt=De);break}t&&rt&&_t.alternate===null&&o(le,rt),ee=w(_t,ee,Je),ot===null?$e=_t:ot.sibling=_t,ot=_t,rt=De}if(Je===ue.length)return u(le,rt),jn&&Vl(le,Je),$e;if(rt===null){for(;Je<ue.length;Je++)rt=Z(le,ue[Je],Be),rt!==null&&(ee=w(rt,ee,Je),ot===null?$e=rt:ot.sibling=rt,ot=rt);return jn&&Vl(le,Je),$e}for(rt=p(le,rt);Je<ue.length;Je++)De=ie(rt,le,Je,ue[Je],Be),De!==null&&(t&&De.alternate!==null&&rt.delete(De.key===null?Je:De.key),ee=w(De,ee,Je),ot===null?$e=De:ot.sibling=De,ot=De);return t&&rt.forEach(function(sn){return o(le,sn)}),jn&&Vl(le,Je),$e}function _e(le,ee,ue,Be){var $e=Cd(ue);if(typeof $e!="function")throw Error(at(150));if(ue=$e.call(ue),ue==null)throw Error(at(151));for(var ot=$e=null,rt=ee,Je=ee=0,De=null,_t=ue.next();rt!==null&&!_t.done;Je++,_t=ue.next()){rt.index>Je?(De=rt,rt=null):De=rt.sibling;var sn=Y(le,rt,_t.value,Be);if(sn===null){rt===null&&(rt=De);break}t&&rt&&sn.alternate===null&&o(le,rt),ee=w(sn,ee,Je),ot===null?$e=sn:ot.sibling=sn,ot=sn,rt=De}if(_t.done)return u(le,rt),jn&&Vl(le,Je),$e;if(rt===null){for(;!_t.done;Je++,_t=ue.next())_t=Z(le,_t.value,Be),_t!==null&&(ee=w(_t,ee,Je),ot===null?$e=_t:ot.sibling=_t,ot=_t);return jn&&Vl(le,Je),$e}for(rt=p(le,rt);!_t.done;Je++,_t=ue.next())_t=ie(rt,le,Je,_t.value,Be),_t!==null&&(t&&_t.alternate!==null&&rt.delete(_t.key===null?Je:_t.key),ee=w(_t,ee,Je),ot===null?$e=_t:ot.sibling=_t,ot=_t);return t&&rt.forEach(function(At){return o(le,At)}),jn&&Vl(le,Je),$e}function ze(le,ee,ue,Be){if(typeof ue=="object"&&ue!==null&&ue.type===du&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case lm:e:{for(var $e=ue.key,ot=ee;ot!==null;){if(ot.key===$e){if($e=ue.type,$e===du){if(ot.tag===7){u(le,ot.sibling),ee=y(ot,ue.props.children),ee.return=le,le=ee;break e}}else if(ot.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===Ta&&E2($e)===ot.type){u(le,ot.sibling),ee=y(ot,ue.props),ee.ref=Pd(le,ot,ue),ee.return=le,le=ee;break e}u(le,ot);break}else o(le,ot);ot=ot.sibling}ue.type===du?(ee=Yl(ue.props.children,le.mode,Be,ue.key),ee.return=le,le=ee):(Be=qm(ue.type,ue.key,ue.props,null,le.mode,Be),Be.ref=Pd(le,ee,ue),Be.return=le,le=Be)}return C(le);case hu:e:{for(ot=ue.key;ee!==null;){if(ee.key===ot)if(ee.tag===4&&ee.stateNode.containerInfo===ue.containerInfo&&ee.stateNode.implementation===ue.implementation){u(le,ee.sibling),ee=y(ee,ue.children||[]),ee.return=le,le=ee;break e}else{u(le,ee);break}else o(le,ee);ee=ee.sibling}ee=l0(ue,le.mode,Be),ee.return=le,le=ee}return C(le);case Ta:return ot=ue._init,ze(le,ee,ot(ue._payload),Be)}if(Od(ue))return ce(le,ee,ue,Be);if(Cd(ue))return _e(le,ee,ue,Be);vm(le,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"?(ue=""+ue,ee!==null&&ee.tag===6?(u(le,ee.sibling),ee=y(ee,ue),ee.return=le,le=ee):(u(le,ee),ee=a0(ue,le.mode,Be),ee.return=le,le=ee),C(le)):u(le,ee)}return ze}var Ou=uS(!0),hS=uS(!1),If={},Qo=Xa(If),hf=Xa(If),df=Xa(If);function Zl(t){if(t===If)throw Error(at(174));return t}function fx(t,o){switch(Pn(df,o),Pn(hf,t),Pn(Qo,If),t=o.nodeType,t){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:D0(null,"");break;default:t=t===8?o.parentNode:o,o=t.namespaceURI||null,t=t.tagName,o=D0(o,t)}On(Qo),Pn(Qo,o)}function Bu(){On(Qo),On(hf),On(df)}function dS(t){Zl(df.current);var o=Zl(Qo.current),u=D0(o,t.type);o!==u&&(Pn(hf,t),Pn(Qo,u))}function px(t){hf.current===t&&(On(Qo),On(hf))}var Yn=Xa(0);function gg(t){for(var o=t;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var t0=[];function mx(){for(var t=0;t<t0.length;t++)t0[t]._workInProgressVersionPrimary=null;t0.length=0}var jm=Bs.ReactCurrentDispatcher,n0=Bs.ReactCurrentBatchConfig,Ql=0,Kn=null,gr=null,Ar=null,_g=!1,qd=!1,ff=0,Sz=0;function Gr(){throw Error(at(321))}function gx(t,o){if(o===null)return!1;for(var u=0;u<o.length&&u<t.length;u++)if(!Io(t[u],o[u]))return!1;return!0}function _x(t,o,u,p,y,w){if(Ql=w,Kn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,jm.current=t===null||t.memoizedState===null?kz:Iz,t=u(p,y),qd){w=0;do{if(qd=!1,ff=0,25<=w)throw Error(at(301));w+=1,Ar=gr=null,o.updateQueue=null,jm.current=Pz,t=u(p,y)}while(qd)}if(jm.current=yg,o=gr!==null&&gr.next!==null,Ql=0,Ar=gr=Kn=null,_g=!1,o)throw Error(at(300));return t}function yx(){var t=ff!==0;return ff=0,t}function Wo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ar===null?Kn.memoizedState=Ar=t:Ar=Ar.next=t,Ar}function eo(){if(gr===null){var t=Kn.alternate;t=t!==null?t.memoizedState:null}else t=gr.next;var o=Ar===null?Kn.memoizedState:Ar.next;if(o!==null)Ar=o,gr=t;else{if(t===null)throw Error(at(310));gr=t,t={memoizedState:gr.memoizedState,baseState:gr.baseState,baseQueue:gr.baseQueue,queue:gr.queue,next:null},Ar===null?Kn.memoizedState=Ar=t:Ar=Ar.next=t}return Ar}function pf(t,o){return typeof o=="function"?o(t):o}function r0(t){var o=eo(),u=o.queue;if(u===null)throw Error(at(311));u.lastRenderedReducer=t;var p=gr,y=p.baseQueue,w=u.pending;if(w!==null){if(y!==null){var C=y.next;y.next=w.next,w.next=C}p.baseQueue=y=w,u.pending=null}if(y!==null){w=y.next,p=p.baseState;var a=C=null,z=null,F=w;do{var H=F.lane;if((Ql&H)===H)z!==null&&(z=z.next={lane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),p=F.hasEagerState?F.eagerState:t(p,F.action);else{var Z={lane:H,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null};z===null?(a=z=Z,C=p):z=z.next=Z,Kn.lanes|=H,ec|=H}F=F.next}while(F!==null&&F!==w);z===null?C=p:z.next=a,Io(p,o.memoizedState)||(_i=!0),o.memoizedState=p,o.baseState=C,o.baseQueue=z,u.lastRenderedState=p}if(t=u.interleaved,t!==null){y=t;do w=y.lane,Kn.lanes|=w,ec|=w,y=y.next;while(y!==t)}else y===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function i0(t){var o=eo(),u=o.queue;if(u===null)throw Error(at(311));u.lastRenderedReducer=t;var p=u.dispatch,y=u.pending,w=o.memoizedState;if(y!==null){u.pending=null;var C=y=y.next;do w=t(w,C.action),C=C.next;while(C!==y);Io(w,o.memoizedState)||(_i=!0),o.memoizedState=w,o.baseQueue===null&&(o.baseState=w),u.lastRenderedState=w}return[w,p]}function fS(){}function pS(t,o){var u=Kn,p=eo(),y=o(),w=!Io(p.memoizedState,y);if(w&&(p.memoizedState=y,_i=!0),p=p.queue,vx(_S.bind(null,u,p,t),[t]),p.getSnapshot!==o||w||Ar!==null&&Ar.memoizedState.tag&1){if(u.flags|=2048,mf(9,gS.bind(null,u,p,y,o),void 0,null),Mr===null)throw Error(at(349));Ql&30||mS(u,o,y)}return y}function mS(t,o,u){t.flags|=16384,t={getSnapshot:o,value:u},o=Kn.updateQueue,o===null?(o={lastEffect:null,stores:null},Kn.updateQueue=o,o.stores=[t]):(u=o.stores,u===null?o.stores=[t]:u.push(t))}function gS(t,o,u,p){o.value=u,o.getSnapshot=p,yS(o)&&vS(t)}function _S(t,o,u){return u(function(){yS(o)&&vS(t)})}function yS(t){var o=t.getSnapshot;t=t.value;try{var u=o();return!Io(t,u)}catch{return!0}}function vS(t){var o=zs(t,1);o!==null&&ko(o,t,1,-1)}function T2(t){var o=Wo();return typeof t=="function"&&(t=t()),o.memoizedState=o.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pf,lastRenderedState:t},o.queue=t,t=t.dispatch=Mz.bind(null,Kn,t),[o.memoizedState,t]}function mf(t,o,u,p){return t={tag:t,create:o,destroy:u,deps:p,next:null},o=Kn.updateQueue,o===null?(o={lastEffect:null,stores:null},Kn.updateQueue=o,o.lastEffect=t.next=t):(u=o.lastEffect,u===null?o.lastEffect=t.next=t:(p=u.next,u.next=t,t.next=p,o.lastEffect=t)),t}function xS(){return eo().memoizedState}function Um(t,o,u,p){var y=Wo();Kn.flags|=t,y.memoizedState=mf(1|o,u,void 0,p===void 0?null:p)}function Ng(t,o,u,p){var y=eo();p=p===void 0?null:p;var w=void 0;if(gr!==null){var C=gr.memoizedState;if(w=C.destroy,p!==null&&gx(p,C.deps)){y.memoizedState=mf(o,u,w,p);return}}Kn.flags|=t,y.memoizedState=mf(1|o,u,w,p)}function S2(t,o){return Um(8390656,8,t,o)}function vx(t,o){return Ng(2048,8,t,o)}function wS(t,o){return Ng(4,2,t,o)}function bS(t,o){return Ng(4,4,t,o)}function ES(t,o){if(typeof o=="function")return t=t(),o(t),function(){o(null)};if(o!=null)return t=t(),o.current=t,function(){o.current=null}}function TS(t,o,u){return u=u!=null?u.concat([t]):null,Ng(4,4,ES.bind(null,o,t),u)}function xx(){}function SS(t,o){var u=eo();o=o===void 0?null:o;var p=u.memoizedState;return p!==null&&o!==null&&gx(o,p[1])?p[0]:(u.memoizedState=[t,o],t)}function CS(t,o){var u=eo();o=o===void 0?null:o;var p=u.memoizedState;return p!==null&&o!==null&&gx(o,p[1])?p[0]:(t=t(),u.memoizedState=[t,o],t)}function AS(t,o,u){return Ql&21?(Io(u,o)||(u=IT(),Kn.lanes|=u,ec|=u,t.baseState=!0),o):(t.baseState&&(t.baseState=!1,_i=!0),t.memoizedState=u)}function Cz(t,o){var u=Tn;Tn=u!==0&&4>u?u:4,t(!0);var p=n0.transition;n0.transition={};try{t(!1),o()}finally{Tn=u,n0.transition=p}}function MS(){return eo().memoizedState}function Az(t,o,u){var p=Na(t);if(u={lane:p,action:u,hasEagerState:!1,eagerState:null,next:null},kS(t))IS(o,u);else if(u=sS(t,o,u,p),u!==null){var y=ni();ko(u,t,p,y),PS(u,o,p)}}function Mz(t,o,u){var p=Na(t),y={lane:p,action:u,hasEagerState:!1,eagerState:null,next:null};if(kS(t))IS(o,y);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=o.lastRenderedReducer,w!==null))try{var C=o.lastRenderedState,a=w(C,u);if(y.hasEagerState=!0,y.eagerState=a,Io(a,C)){var z=o.interleaved;z===null?(y.next=y,hx(o)):(y.next=z.next,z.next=y),o.interleaved=y;return}}catch{}finally{}u=sS(t,o,y,p),u!==null&&(y=ni(),ko(u,t,p,y),PS(u,o,p))}}function kS(t){var o=t.alternate;return t===Kn||o!==null&&o===Kn}function IS(t,o){qd=_g=!0;var u=t.pending;u===null?o.next=o:(o.next=u.next,u.next=o),t.pending=o}function PS(t,o,u){if(u&4194240){var p=o.lanes;p&=t.pendingLanes,u|=p,o.lanes=u,Kv(t,u)}}var yg={readContext:Qi,useCallback:Gr,useContext:Gr,useEffect:Gr,useImperativeHandle:Gr,useInsertionEffect:Gr,useLayoutEffect:Gr,useMemo:Gr,useReducer:Gr,useRef:Gr,useState:Gr,useDebugValue:Gr,useDeferredValue:Gr,useTransition:Gr,useMutableSource:Gr,useSyncExternalStore:Gr,useId:Gr,unstable_isNewReconciler:!1},kz={readContext:Qi,useCallback:function(t,o){return Wo().memoizedState=[t,o===void 0?null:o],t},useContext:Qi,useEffect:S2,useImperativeHandle:function(t,o,u){return u=u!=null?u.concat([t]):null,Um(4194308,4,ES.bind(null,o,t),u)},useLayoutEffect:function(t,o){return Um(4194308,4,t,o)},useInsertionEffect:function(t,o){return Um(4,2,t,o)},useMemo:function(t,o){var u=Wo();return o=o===void 0?null:o,t=t(),u.memoizedState=[t,o],t},useReducer:function(t,o,u){var p=Wo();return o=u!==void 0?u(o):o,p.memoizedState=p.baseState=o,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},p.queue=t,t=t.dispatch=Az.bind(null,Kn,t),[p.memoizedState,t]},useRef:function(t){var o=Wo();return t={current:t},o.memoizedState=t},useState:T2,useDebugValue:xx,useDeferredValue:function(t){return Wo().memoizedState=t},useTransition:function(){var t=T2(!1),o=t[0];return t=Cz.bind(null,t[1]),Wo().memoizedState=t,[o,t]},useMutableSource:function(){},useSyncExternalStore:function(t,o,u){var p=Kn,y=Wo();if(jn){if(u===void 0)throw Error(at(407));u=u()}else{if(u=o(),Mr===null)throw Error(at(349));Ql&30||mS(p,o,u)}y.memoizedState=u;var w={value:u,getSnapshot:o};return y.queue=w,S2(_S.bind(null,p,w,t),[t]),p.flags|=2048,mf(9,gS.bind(null,p,w,u,o),void 0,null),u},useId:function(){var t=Wo(),o=Mr.identifierPrefix;if(jn){var u=As,p=Cs;u=(p&~(1<<32-Mo(p)-1)).toString(32)+u,o=":"+o+"R"+u,u=ff++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=Sz++,o=":"+o+"r"+u.toString(32)+":";return t.memoizedState=o},unstable_isNewReconciler:!1},Iz={readContext:Qi,useCallback:SS,useContext:Qi,useEffect:vx,useImperativeHandle:TS,useInsertionEffect:wS,useLayoutEffect:bS,useMemo:CS,useReducer:r0,useRef:xS,useState:function(){return r0(pf)},useDebugValue:xx,useDeferredValue:function(t){var o=eo();return AS(o,gr.memoizedState,t)},useTransition:function(){var t=r0(pf)[0],o=eo().memoizedState;return[t,o]},useMutableSource:fS,useSyncExternalStore:pS,useId:MS,unstable_isNewReconciler:!1},Pz={readContext:Qi,useCallback:SS,useContext:Qi,useEffect:vx,useImperativeHandle:TS,useInsertionEffect:wS,useLayoutEffect:bS,useMemo:CS,useReducer:i0,useRef:xS,useState:function(){return i0(pf)},useDebugValue:xx,useDeferredValue:function(t){var o=eo();return gr===null?o.memoizedState=t:AS(o,gr.memoizedState,t)},useTransition:function(){var t=i0(pf)[0],o=eo().memoizedState;return[t,o]},useMutableSource:fS,useSyncExternalStore:pS,useId:MS,unstable_isNewReconciler:!1};function Fu(t,o){try{var u="",p=o;do u+=oP(p),p=p.return;while(p);var y=u}catch(w){y=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:o,stack:y,digest:null}}function o0(t,o,u){return{value:t,source:null,stack:u??null,digest:o??null}}function nv(t,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var zz=typeof WeakMap=="function"?WeakMap:Map;function zS(t,o,u){u=Ms(-1,u),u.tag=3,u.payload={element:null};var p=o.value;return u.callback=function(){xg||(xg=!0,dv=p),nv(t,o)},u}function DS(t,o,u){u=Ms(-1,u),u.tag=3;var p=t.type.getDerivedStateFromError;if(typeof p=="function"){var y=o.value;u.payload=function(){return p(y)},u.callback=function(){nv(t,o)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(u.callback=function(){nv(t,o),typeof p!="function"&&(Fa===null?Fa=new Set([this]):Fa.add(this));var C=o.stack;this.componentDidCatch(o.value,{componentStack:C!==null?C:""})}),u}function C2(t,o,u){var p=t.pingCache;if(p===null){p=t.pingCache=new zz;var y=new Set;p.set(o,y)}else y=p.get(o),y===void 0&&(y=new Set,p.set(o,y));y.has(u)||(y.add(u),t=Zz.bind(null,t,o,u),o.then(t,t))}function A2(t){do{var o;if((o=t.tag===13)&&(o=t.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return t;t=t.return}while(t!==null);return null}function M2(t,o,u,p,y){return t.mode&1?(t.flags|=65536,t.lanes=y,t):(t===o?t.flags|=65536:(t.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=Ms(-1,1),o.tag=2,Ba(u,o,1))),u.lanes|=1),t)}var Dz=Bs.ReactCurrentOwner,_i=!1;function ei(t,o,u,p){o.child=t===null?hS(o,null,u,p):Ou(o,t.child,u,p)}function k2(t,o,u,p,y){u=u.render;var w=o.ref;return Iu(o,y),p=_x(t,o,u,p,w,y),u=yx(),t!==null&&!_i?(o.updateQueue=t.updateQueue,o.flags&=-2053,t.lanes&=~y,Ds(t,o,y)):(jn&&u&&ox(o),o.flags|=1,ei(t,o,p,y),o.child)}function I2(t,o,u,p,y){if(t===null){var w=u.type;return typeof w=="function"&&!Mx(w)&&w.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=w,LS(t,o,w,p,y)):(t=qm(u.type,null,p,o,o.mode,y),t.ref=o.ref,t.return=o,o.child=t)}if(w=t.child,!(t.lanes&y)){var C=w.memoizedProps;if(u=u.compare,u=u!==null?u:af,u(C,p)&&t.ref===o.ref)return Ds(t,o,y)}return o.flags|=1,t=ja(w,p),t.ref=o.ref,t.return=o,o.child=t}function LS(t,o,u,p,y){if(t!==null){var w=t.memoizedProps;if(af(w,p)&&t.ref===o.ref)if(_i=!1,o.pendingProps=p=w,(t.lanes&y)!==0)t.flags&131072&&(_i=!0);else return o.lanes=t.lanes,Ds(t,o,y)}return rv(t,o,u,p,y)}function RS(t,o,u){var p=o.pendingProps,y=p.children,w=t!==null?t.memoizedState:null;if(p.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},Pn(bu,Mi),Mi|=u;else{if(!(u&1073741824))return t=w!==null?w.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:t,cachePool:null,transitions:null},o.updateQueue=null,Pn(bu,Mi),Mi|=t,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=w!==null?w.baseLanes:u,Pn(bu,Mi),Mi|=p}else w!==null?(p=w.baseLanes|u,o.memoizedState=null):p=u,Pn(bu,Mi),Mi|=p;return ei(t,o,y,u),o.child}function OS(t,o){var u=o.ref;(t===null&&u!==null||t!==null&&t.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function rv(t,o,u,p,y){var w=vi(u)?Kl:Xr.current;return w=Lu(o,w),Iu(o,y),u=_x(t,o,u,p,w,y),p=yx(),t!==null&&!_i?(o.updateQueue=t.updateQueue,o.flags&=-2053,t.lanes&=~y,Ds(t,o,y)):(jn&&p&&ox(o),o.flags|=1,ei(t,o,u,y),o.child)}function P2(t,o,u,p,y){if(vi(u)){var w=!0;ug(o)}else w=!1;if(Iu(o,y),o.stateNode===null)Vm(t,o),cS(o,u,p),tv(o,u,p,y),p=!0;else if(t===null){var C=o.stateNode,a=o.memoizedProps;C.props=a;var z=C.context,F=u.contextType;typeof F=="object"&&F!==null?F=Qi(F):(F=vi(u)?Kl:Xr.current,F=Lu(o,F));var H=u.getDerivedStateFromProps,Z=typeof H=="function"||typeof C.getSnapshotBeforeUpdate=="function";Z||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(a!==p||z!==F)&&b2(o,C,p,F),Sa=!1;var Y=o.memoizedState;C.state=Y,mg(o,p,C,y),z=o.memoizedState,a!==p||Y!==z||yi.current||Sa?(typeof H=="function"&&(ev(o,u,H,p),z=o.memoizedState),(a=Sa||w2(o,u,a,p,Y,z,F))?(Z||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=z),C.props=p,C.state=z,C.context=F,p=a):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{C=o.stateNode,aS(t,o),a=o.memoizedProps,F=o.type===o.elementType?a:To(o.type,a),C.props=F,Z=o.pendingProps,Y=C.context,z=u.contextType,typeof z=="object"&&z!==null?z=Qi(z):(z=vi(u)?Kl:Xr.current,z=Lu(o,z));var ie=u.getDerivedStateFromProps;(H=typeof ie=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(a!==Z||Y!==z)&&b2(o,C,p,z),Sa=!1,Y=o.memoizedState,C.state=Y,mg(o,p,C,y);var ce=o.memoizedState;a!==Z||Y!==ce||yi.current||Sa?(typeof ie=="function"&&(ev(o,u,ie,p),ce=o.memoizedState),(F=Sa||w2(o,u,F,p,Y,ce,z)||!1)?(H||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(p,ce,z),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(p,ce,z)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=ce),C.props=p,C.state=ce,C.context=z,p=F):(typeof C.componentDidUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&Y===t.memoizedState||(o.flags|=1024),p=!1)}return iv(t,o,u,p,w,y)}function iv(t,o,u,p,y,w){OS(t,o);var C=(o.flags&128)!==0;if(!p&&!C)return y&&g2(o,u,!1),Ds(t,o,w);p=o.stateNode,Dz.current=o;var a=C&&typeof u.getDerivedStateFromError!="function"?null:p.render();return o.flags|=1,t!==null&&C?(o.child=Ou(o,t.child,null,w),o.child=Ou(o,null,a,w)):ei(t,o,a,w),o.memoizedState=p.state,y&&g2(o,u,!0),o.child}function BS(t){var o=t.stateNode;o.pendingContext?m2(t,o.pendingContext,o.pendingContext!==o.context):o.context&&m2(t,o.context,!1),fx(t,o.containerInfo)}function z2(t,o,u,p,y){return Ru(),ax(y),o.flags|=256,ei(t,o,u,p),o.child}var ov={dehydrated:null,treeContext:null,retryLane:0};function sv(t){return{baseLanes:t,cachePool:null,transitions:null}}function FS(t,o,u){var p=o.pendingProps,y=Yn.current,w=!1,C=(o.flags&128)!==0,a;if((a=C)||(a=t!==null&&t.memoizedState===null?!1:(y&2)!==0),a?(w=!0,o.flags&=-129):(t===null||t.memoizedState!==null)&&(y|=1),Pn(Yn,y&1),t===null)return J0(o),t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(o.mode&1?t.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(C=p.children,t=p.fallback,w?(p=o.mode,w=o.child,C={mode:"hidden",children:C},!(p&1)&&w!==null?(w.childLanes=0,w.pendingProps=C):w=Vg(C,p,0,null),t=Yl(t,p,u,null),w.return=o,t.return=o,w.sibling=t,o.child=w,o.child.memoizedState=sv(u),o.memoizedState=ov,t):wx(o,C));if(y=t.memoizedState,y!==null&&(a=y.dehydrated,a!==null))return Lz(t,o,C,p,a,y,u);if(w){w=p.fallback,C=o.mode,y=t.child,a=y.sibling;var z={mode:"hidden",children:p.children};return!(C&1)&&o.child!==y?(p=o.child,p.childLanes=0,p.pendingProps=z,o.deletions=null):(p=ja(y,z),p.subtreeFlags=y.subtreeFlags&14680064),a!==null?w=ja(a,w):(w=Yl(w,C,u,null),w.flags|=2),w.return=o,p.return=o,p.sibling=w,o.child=p,p=w,w=o.child,C=t.child.memoizedState,C=C===null?sv(u):{baseLanes:C.baseLanes|u,cachePool:null,transitions:C.transitions},w.memoizedState=C,w.childLanes=t.childLanes&~u,o.memoizedState=ov,p}return w=t.child,t=w.sibling,p=ja(w,{mode:"visible",children:p.children}),!(o.mode&1)&&(p.lanes=u),p.return=o,p.sibling=null,t!==null&&(u=o.deletions,u===null?(o.deletions=[t],o.flags|=16):u.push(t)),o.child=p,o.memoizedState=null,p}function wx(t,o){return o=Vg({mode:"visible",children:o},t.mode,0,null),o.return=t,t.child=o}function xm(t,o,u,p){return p!==null&&ax(p),Ou(o,t.child,null,u),t=wx(o,o.pendingProps.children),t.flags|=2,o.memoizedState=null,t}function Lz(t,o,u,p,y,w,C){if(u)return o.flags&256?(o.flags&=-257,p=o0(Error(at(422))),xm(t,o,C,p)):o.memoizedState!==null?(o.child=t.child,o.flags|=128,null):(w=p.fallback,y=o.mode,p=Vg({mode:"visible",children:p.children},y,0,null),w=Yl(w,y,C,null),w.flags|=2,p.return=o,w.return=o,p.sibling=w,o.child=p,o.mode&1&&Ou(o,t.child,null,C),o.child.memoizedState=sv(C),o.memoizedState=ov,w);if(!(o.mode&1))return xm(t,o,C,null);if(y.data==="$!"){if(p=y.nextSibling&&y.nextSibling.dataset,p)var a=p.dgst;return p=a,w=Error(at(419)),p=o0(w,p,void 0),xm(t,o,C,p)}if(a=(C&t.childLanes)!==0,_i||a){if(p=Mr,p!==null){switch(C&-C){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=y&(p.suspendedLanes|C)?0:y,y!==0&&y!==w.retryLane&&(w.retryLane=y,zs(t,y),ko(p,t,y,-1))}return Ax(),p=o0(Error(at(421))),xm(t,o,C,p)}return y.data==="$?"?(o.flags|=128,o.child=t.child,o=Wz.bind(null,t),y._reactRetry=o,null):(t=w.treeContext,ki=Oa(y.nextSibling),Ii=o,jn=!0,Co=null,t!==null&&(Xi[Hi++]=Cs,Xi[Hi++]=As,Xi[Hi++]=Jl,Cs=t.id,As=t.overflow,Jl=o),o=wx(o,p.children),o.flags|=4096,o)}function D2(t,o,u){t.lanes|=o;var p=t.alternate;p!==null&&(p.lanes|=o),Q0(t.return,o,u)}function s0(t,o,u,p,y){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:y}:(w.isBackwards=o,w.rendering=null,w.renderingStartTime=0,w.last=p,w.tail=u,w.tailMode=y)}function NS(t,o,u){var p=o.pendingProps,y=p.revealOrder,w=p.tail;if(ei(t,o,p.children,u),p=Yn.current,p&2)p=p&1|2,o.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=o.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&D2(t,u,o);else if(t.tag===19)D2(t,u,o);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===o)break e;for(;t.sibling===null;){if(t.return===null||t.return===o)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}p&=1}if(Pn(Yn,p),!(o.mode&1))o.memoizedState=null;else switch(y){case"forwards":for(u=o.child,y=null;u!==null;)t=u.alternate,t!==null&&gg(t)===null&&(y=u),u=u.sibling;u=y,u===null?(y=o.child,o.child=null):(y=u.sibling,u.sibling=null),s0(o,!1,y,u,w);break;case"backwards":for(u=null,y=o.child,o.child=null;y!==null;){if(t=y.alternate,t!==null&&gg(t)===null){o.child=y;break}t=y.sibling,y.sibling=u,u=y,y=t}s0(o,!0,u,null,w);break;case"together":s0(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Vm(t,o){!(o.mode&1)&&t!==null&&(t.alternate=null,o.alternate=null,o.flags|=2)}function Ds(t,o,u){if(t!==null&&(o.dependencies=t.dependencies),ec|=o.lanes,!(u&o.childLanes))return null;if(t!==null&&o.child!==t.child)throw Error(at(153));if(o.child!==null){for(t=o.child,u=ja(t,t.pendingProps),o.child=u,u.return=o;t.sibling!==null;)t=t.sibling,u=u.sibling=ja(t,t.pendingProps),u.return=o;u.sibling=null}return o.child}function Rz(t,o,u){switch(o.tag){case 3:BS(o),Ru();break;case 5:dS(o);break;case 1:vi(o.type)&&ug(o);break;case 4:fx(o,o.stateNode.containerInfo);break;case 10:var p=o.type._context,y=o.memoizedProps.value;Pn(fg,p._currentValue),p._currentValue=y;break;case 13:if(p=o.memoizedState,p!==null)return p.dehydrated!==null?(Pn(Yn,Yn.current&1),o.flags|=128,null):u&o.child.childLanes?FS(t,o,u):(Pn(Yn,Yn.current&1),t=Ds(t,o,u),t!==null?t.sibling:null);Pn(Yn,Yn.current&1);break;case 19:if(p=(u&o.childLanes)!==0,t.flags&128){if(p)return NS(t,o,u);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Pn(Yn,Yn.current),p)break;return null;case 22:case 23:return o.lanes=0,RS(t,o,u)}return Ds(t,o,u)}var jS,av,US,VS;jS=function(t,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)t.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};av=function(){};US=function(t,o,u,p){var y=t.memoizedProps;if(y!==p){t=o.stateNode,Zl(Qo.current);var w=null;switch(u){case"input":y=k0(t,y),p=k0(t,p),w=[];break;case"select":y=Jn({},y,{value:void 0}),p=Jn({},p,{value:void 0}),w=[];break;case"textarea":y=z0(t,y),p=z0(t,p),w=[];break;default:typeof y.onClick!="function"&&typeof p.onClick=="function"&&(t.onclick=lg)}L0(u,p);var C;u=null;for(F in y)if(!p.hasOwnProperty(F)&&y.hasOwnProperty(F)&&y[F]!=null)if(F==="style"){var a=y[F];for(C in a)a.hasOwnProperty(C)&&(u||(u={}),u[C]="")}else F!=="dangerouslySetInnerHTML"&&F!=="children"&&F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(Qd.hasOwnProperty(F)?w||(w=[]):(w=w||[]).push(F,null));for(F in p){var z=p[F];if(a=y!=null?y[F]:void 0,p.hasOwnProperty(F)&&z!==a&&(z!=null||a!=null))if(F==="style")if(a){for(C in a)!a.hasOwnProperty(C)||z&&z.hasOwnProperty(C)||(u||(u={}),u[C]="");for(C in z)z.hasOwnProperty(C)&&a[C]!==z[C]&&(u||(u={}),u[C]=z[C])}else u||(w||(w=[]),w.push(F,u)),u=z;else F==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,a=a?a.__html:void 0,z!=null&&a!==z&&(w=w||[]).push(F,z)):F==="children"?typeof z!="string"&&typeof z!="number"||(w=w||[]).push(F,""+z):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&(Qd.hasOwnProperty(F)?(z!=null&&F==="onScroll"&&Ln("scroll",t),w||a===z||(w=[])):(w=w||[]).push(F,z))}u&&(w=w||[]).push("style",u);var F=w;(o.updateQueue=F)&&(o.flags|=4)}};VS=function(t,o,u,p){u!==p&&(o.flags|=4)};function zd(t,o){if(!jn)switch(t.tailMode){case"hidden":o=t.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?t.tail=null:u.sibling=null;break;case"collapsed":u=t.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?o||t.tail===null?t.tail=null:t.tail.sibling=null:p.sibling=null}}function qr(t){var o=t.alternate!==null&&t.alternate.child===t.child,u=0,p=0;if(o)for(var y=t.child;y!==null;)u|=y.lanes|y.childLanes,p|=y.subtreeFlags&14680064,p|=y.flags&14680064,y.return=t,y=y.sibling;else for(y=t.child;y!==null;)u|=y.lanes|y.childLanes,p|=y.subtreeFlags,p|=y.flags,y.return=t,y=y.sibling;return t.subtreeFlags|=p,t.childLanes=u,o}function Oz(t,o,u){var p=o.pendingProps;switch(sx(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qr(o),null;case 1:return vi(o.type)&&cg(),qr(o),null;case 3:return p=o.stateNode,Bu(),On(yi),On(Xr),mx(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(t===null||t.child===null)&&(ym(o)?o.flags|=4:t===null||t.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Co!==null&&(mv(Co),Co=null))),av(t,o),qr(o),null;case 5:px(o);var y=Zl(df.current);if(u=o.type,t!==null&&o.stateNode!=null)US(t,o,u,p,y),t.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!p){if(o.stateNode===null)throw Error(at(166));return qr(o),null}if(t=Zl(Qo.current),ym(o)){p=o.stateNode,u=o.type;var w=o.memoizedProps;switch(p[Ho]=o,p[uf]=w,t=(o.mode&1)!==0,u){case"dialog":Ln("cancel",p),Ln("close",p);break;case"iframe":case"object":case"embed":Ln("load",p);break;case"video":case"audio":for(y=0;y<Fd.length;y++)Ln(Fd[y],p);break;case"source":Ln("error",p);break;case"img":case"image":case"link":Ln("error",p),Ln("load",p);break;case"details":Ln("toggle",p);break;case"input":Vb(p,w),Ln("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!w.multiple},Ln("invalid",p);break;case"textarea":Gb(p,w),Ln("invalid",p)}L0(u,w),y=null;for(var C in w)if(w.hasOwnProperty(C)){var a=w[C];C==="children"?typeof a=="string"?p.textContent!==a&&(w.suppressHydrationWarning!==!0&&_m(p.textContent,a,t),y=["children",a]):typeof a=="number"&&p.textContent!==""+a&&(w.suppressHydrationWarning!==!0&&_m(p.textContent,a,t),y=["children",""+a]):Qd.hasOwnProperty(C)&&a!=null&&C==="onScroll"&&Ln("scroll",p)}switch(u){case"input":cm(p),$b(p,w,!0);break;case"textarea":cm(p),qb(p);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(p.onclick=lg)}p=y,o.updateQueue=p,p!==null&&(o.flags|=4)}else{C=y.nodeType===9?y:y.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=mT(u)),t==="http://www.w3.org/1999/xhtml"?u==="script"?(t=C.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof p.is=="string"?t=C.createElement(u,{is:p.is}):(t=C.createElement(u),u==="select"&&(C=t,p.multiple?C.multiple=!0:p.size&&(C.size=p.size))):t=C.createElementNS(t,u),t[Ho]=o,t[uf]=p,jS(t,o,!1,!1),o.stateNode=t;e:{switch(C=R0(u,p),u){case"dialog":Ln("cancel",t),Ln("close",t),y=p;break;case"iframe":case"object":case"embed":Ln("load",t),y=p;break;case"video":case"audio":for(y=0;y<Fd.length;y++)Ln(Fd[y],t);y=p;break;case"source":Ln("error",t),y=p;break;case"img":case"image":case"link":Ln("error",t),Ln("load",t),y=p;break;case"details":Ln("toggle",t),y=p;break;case"input":Vb(t,p),y=k0(t,p),Ln("invalid",t);break;case"option":y=p;break;case"select":t._wrapperState={wasMultiple:!!p.multiple},y=Jn({},p,{value:void 0}),Ln("invalid",t);break;case"textarea":Gb(t,p),y=z0(t,p),Ln("invalid",t);break;default:y=p}L0(u,y),a=y;for(w in a)if(a.hasOwnProperty(w)){var z=a[w];w==="style"?yT(t,z):w==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,z!=null&&gT(t,z)):w==="children"?typeof z=="string"?(u!=="textarea"||z!=="")&&ef(t,z):typeof z=="number"&&ef(t,""+z):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(Qd.hasOwnProperty(w)?z!=null&&w==="onScroll"&&Ln("scroll",t):z!=null&&qv(t,w,z,C))}switch(u){case"input":cm(t),$b(t,p,!1);break;case"textarea":cm(t),qb(t);break;case"option":p.value!=null&&t.setAttribute("value",""+Ua(p.value));break;case"select":t.multiple=!!p.multiple,w=p.value,w!=null?Cu(t,!!p.multiple,w,!1):p.defaultValue!=null&&Cu(t,!!p.multiple,p.defaultValue,!0);break;default:typeof y.onClick=="function"&&(t.onclick=lg)}switch(u){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return qr(o),null;case 6:if(t&&o.stateNode!=null)VS(t,o,t.memoizedProps,p);else{if(typeof p!="string"&&o.stateNode===null)throw Error(at(166));if(u=Zl(df.current),Zl(Qo.current),ym(o)){if(p=o.stateNode,u=o.memoizedProps,p[Ho]=o,(w=p.nodeValue!==u)&&(t=Ii,t!==null))switch(t.tag){case 3:_m(p.nodeValue,u,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_m(p.nodeValue,u,(t.mode&1)!==0)}w&&(o.flags|=4)}else p=(u.nodeType===9?u:u.ownerDocument).createTextNode(p),p[Ho]=o,o.stateNode=p}return qr(o),null;case 13:if(On(Yn),p=o.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(jn&&ki!==null&&o.mode&1&&!(o.flags&128))oS(),Ru(),o.flags|=98560,w=!1;else if(w=ym(o),p!==null&&p.dehydrated!==null){if(t===null){if(!w)throw Error(at(318));if(w=o.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(at(317));w[Ho]=o}else Ru(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;qr(o),w=!1}else Co!==null&&(mv(Co),Co=null),w=!0;if(!w)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(p=p!==null,p!==(t!==null&&t.memoizedState!==null)&&p&&(o.child.flags|=8192,o.mode&1&&(t===null||Yn.current&1?_r===0&&(_r=3):Ax())),o.updateQueue!==null&&(o.flags|=4),qr(o),null);case 4:return Bu(),av(t,o),t===null&&lf(o.stateNode.containerInfo),qr(o),null;case 10:return ux(o.type._context),qr(o),null;case 17:return vi(o.type)&&cg(),qr(o),null;case 19:if(On(Yn),w=o.memoizedState,w===null)return qr(o),null;if(p=(o.flags&128)!==0,C=w.rendering,C===null)if(p)zd(w,!1);else{if(_r!==0||t!==null&&t.flags&128)for(t=o.child;t!==null;){if(C=gg(t),C!==null){for(o.flags|=128,zd(w,!1),p=C.updateQueue,p!==null&&(o.updateQueue=p,o.flags|=4),o.subtreeFlags=0,p=u,u=o.child;u!==null;)w=u,t=p,w.flags&=14680066,C=w.alternate,C===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=C.childLanes,w.lanes=C.lanes,w.child=C.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=C.memoizedProps,w.memoizedState=C.memoizedState,w.updateQueue=C.updateQueue,w.type=C.type,t=C.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),u=u.sibling;return Pn(Yn,Yn.current&1|2),o.child}t=t.sibling}w.tail!==null&&rr()>Nu&&(o.flags|=128,p=!0,zd(w,!1),o.lanes=4194304)}else{if(!p)if(t=gg(C),t!==null){if(o.flags|=128,p=!0,u=t.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),zd(w,!0),w.tail===null&&w.tailMode==="hidden"&&!C.alternate&&!jn)return qr(o),null}else 2*rr()-w.renderingStartTime>Nu&&u!==1073741824&&(o.flags|=128,p=!0,zd(w,!1),o.lanes=4194304);w.isBackwards?(C.sibling=o.child,o.child=C):(u=w.last,u!==null?u.sibling=C:o.child=C,w.last=C)}return w.tail!==null?(o=w.tail,w.rendering=o,w.tail=o.sibling,w.renderingStartTime=rr(),o.sibling=null,u=Yn.current,Pn(Yn,p?u&1|2:u&1),o):(qr(o),null);case 22:case 23:return Cx(),p=o.memoizedState!==null,t!==null&&t.memoizedState!==null!==p&&(o.flags|=8192),p&&o.mode&1?Mi&1073741824&&(qr(o),o.subtreeFlags&6&&(o.flags|=8192)):qr(o),null;case 24:return null;case 25:return null}throw Error(at(156,o.tag))}function Bz(t,o){switch(sx(o),o.tag){case 1:return vi(o.type)&&cg(),t=o.flags,t&65536?(o.flags=t&-65537|128,o):null;case 3:return Bu(),On(yi),On(Xr),mx(),t=o.flags,t&65536&&!(t&128)?(o.flags=t&-65537|128,o):null;case 5:return px(o),null;case 13:if(On(Yn),t=o.memoizedState,t!==null&&t.dehydrated!==null){if(o.alternate===null)throw Error(at(340));Ru()}return t=o.flags,t&65536?(o.flags=t&-65537|128,o):null;case 19:return On(Yn),null;case 4:return Bu(),null;case 10:return ux(o.type._context),null;case 22:case 23:return Cx(),null;case 24:return null;default:return null}}var wm=!1,Wr=!1,Fz=typeof WeakSet=="function"?WeakSet:Set,wt=null;function wu(t,o){var u=t.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(p){tr(t,o,p)}else u.current=null}function lv(t,o,u){try{u()}catch(p){tr(t,o,p)}}var L2=!1;function Nz(t,o){if(q0=og,t=ZT(),ix(t)){if("selectionStart"in t)var u={start:t.selectionStart,end:t.selectionEnd};else e:{u=(u=t.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var y=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{u.nodeType,w.nodeType}catch{u=null;break e}var C=0,a=-1,z=-1,F=0,H=0,Z=t,Y=null;t:for(;;){for(var ie;Z!==u||y!==0&&Z.nodeType!==3||(a=C+y),Z!==w||p!==0&&Z.nodeType!==3||(z=C+p),Z.nodeType===3&&(C+=Z.nodeValue.length),(ie=Z.firstChild)!==null;)Y=Z,Z=ie;for(;;){if(Z===t)break t;if(Y===u&&++F===y&&(a=C),Y===w&&++H===p&&(z=C),(ie=Z.nextSibling)!==null)break;Z=Y,Y=Z.parentNode}Z=ie}u=a===-1||z===-1?null:{start:a,end:z}}else u=null}u=u||{start:0,end:0}}else u=null;for(Z0={focusedElem:t,selectionRange:u},og=!1,wt=o;wt!==null;)if(o=wt,t=o.child,(o.subtreeFlags&1028)!==0&&t!==null)t.return=o,wt=t;else for(;wt!==null;){o=wt;try{var ce=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var _e=ce.memoizedProps,ze=ce.memoizedState,le=o.stateNode,ee=le.getSnapshotBeforeUpdate(o.elementType===o.type?_e:To(o.type,_e),ze);le.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var ue=o.stateNode.containerInfo;ue.nodeType===1?ue.textContent="":ue.nodeType===9&&ue.documentElement&&ue.removeChild(ue.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(at(163))}}catch(Be){tr(o,o.return,Be)}if(t=o.sibling,t!==null){t.return=o.return,wt=t;break}wt=o.return}return ce=L2,L2=!1,ce}function Zd(t,o,u){var p=o.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var y=p=p.next;do{if((y.tag&t)===t){var w=y.destroy;y.destroy=void 0,w!==void 0&&lv(o,u,w)}y=y.next}while(y!==p)}}function jg(t,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&t)===t){var p=u.create;u.destroy=p()}u=u.next}while(u!==o)}}function cv(t){var o=t.ref;if(o!==null){var u=t.stateNode;switch(t.tag){case 5:t=u;break;default:t=u}typeof o=="function"?o(t):o.current=t}}function $S(t){var o=t.alternate;o!==null&&(t.alternate=null,$S(o)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(o=t.stateNode,o!==null&&(delete o[Ho],delete o[uf],delete o[H0],delete o[wz],delete o[bz])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function GS(t){return t.tag===5||t.tag===3||t.tag===4}function R2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||GS(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function uv(t,o,u){var p=t.tag;if(p===5||p===6)t=t.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(t,o):u.insertBefore(t,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(t,u)):(o=u,o.appendChild(t)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=lg));else if(p!==4&&(t=t.child,t!==null))for(uv(t,o,u),t=t.sibling;t!==null;)uv(t,o,u),t=t.sibling}function hv(t,o,u){var p=t.tag;if(p===5||p===6)t=t.stateNode,o?u.insertBefore(t,o):u.appendChild(t);else if(p!==4&&(t=t.child,t!==null))for(hv(t,o,u),t=t.sibling;t!==null;)hv(t,o,u),t=t.sibling}var zr=null,So=!1;function wa(t,o,u){for(u=u.child;u!==null;)qS(t,o,u),u=u.sibling}function qS(t,o,u){if(Jo&&typeof Jo.onCommitFiberUnmount=="function")try{Jo.onCommitFiberUnmount(zg,u)}catch{}switch(u.tag){case 5:Wr||wu(u,o);case 6:var p=zr,y=So;zr=null,wa(t,o,u),zr=p,So=y,zr!==null&&(So?(t=zr,u=u.stateNode,t.nodeType===8?t.parentNode.removeChild(u):t.removeChild(u)):zr.removeChild(u.stateNode));break;case 18:zr!==null&&(So?(t=zr,u=u.stateNode,t.nodeType===8?Qy(t.parentNode,u):t.nodeType===1&&Qy(t,u),of(t)):Qy(zr,u.stateNode));break;case 4:p=zr,y=So,zr=u.stateNode.containerInfo,So=!0,wa(t,o,u),zr=p,So=y;break;case 0:case 11:case 14:case 15:if(!Wr&&(p=u.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){y=p=p.next;do{var w=y,C=w.destroy;w=w.tag,C!==void 0&&(w&2||w&4)&&lv(u,o,C),y=y.next}while(y!==p)}wa(t,o,u);break;case 1:if(!Wr&&(wu(u,o),p=u.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=u.memoizedProps,p.state=u.memoizedState,p.componentWillUnmount()}catch(a){tr(u,o,a)}wa(t,o,u);break;case 21:wa(t,o,u);break;case 22:u.mode&1?(Wr=(p=Wr)||u.memoizedState!==null,wa(t,o,u),Wr=p):wa(t,o,u);break;default:wa(t,o,u)}}function O2(t){var o=t.updateQueue;if(o!==null){t.updateQueue=null;var u=t.stateNode;u===null&&(u=t.stateNode=new Fz),o.forEach(function(p){var y=Xz.bind(null,t,p);u.has(p)||(u.add(p),p.then(y,y))})}}function Eo(t,o){var u=o.deletions;if(u!==null)for(var p=0;p<u.length;p++){var y=u[p];try{var w=t,C=o,a=C;e:for(;a!==null;){switch(a.tag){case 5:zr=a.stateNode,So=!1;break e;case 3:zr=a.stateNode.containerInfo,So=!0;break e;case 4:zr=a.stateNode.containerInfo,So=!0;break e}a=a.return}if(zr===null)throw Error(at(160));qS(w,C,y),zr=null,So=!1;var z=y.alternate;z!==null&&(z.return=null),y.return=null}catch(F){tr(y,o,F)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)ZS(o,t),o=o.sibling}function ZS(t,o){var u=t.alternate,p=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Eo(o,t),Zo(t),p&4){try{Zd(3,t,t.return),jg(3,t)}catch(_e){tr(t,t.return,_e)}try{Zd(5,t,t.return)}catch(_e){tr(t,t.return,_e)}}break;case 1:Eo(o,t),Zo(t),p&512&&u!==null&&wu(u,u.return);break;case 5:if(Eo(o,t),Zo(t),p&512&&u!==null&&wu(u,u.return),t.flags&32){var y=t.stateNode;try{ef(y,"")}catch(_e){tr(t,t.return,_e)}}if(p&4&&(y=t.stateNode,y!=null)){var w=t.memoizedProps,C=u!==null?u.memoizedProps:w,a=t.type,z=t.updateQueue;if(t.updateQueue=null,z!==null)try{a==="input"&&w.type==="radio"&&w.name!=null&&fT(y,w),R0(a,C);var F=R0(a,w);for(C=0;C<z.length;C+=2){var H=z[C],Z=z[C+1];H==="style"?yT(y,Z):H==="dangerouslySetInnerHTML"?gT(y,Z):H==="children"?ef(y,Z):qv(y,H,Z,F)}switch(a){case"input":I0(y,w);break;case"textarea":pT(y,w);break;case"select":var Y=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!w.multiple;var ie=w.value;ie!=null?Cu(y,!!w.multiple,ie,!1):Y!==!!w.multiple&&(w.defaultValue!=null?Cu(y,!!w.multiple,w.defaultValue,!0):Cu(y,!!w.multiple,w.multiple?[]:"",!1))}y[uf]=w}catch(_e){tr(t,t.return,_e)}}break;case 6:if(Eo(o,t),Zo(t),p&4){if(t.stateNode===null)throw Error(at(162));y=t.stateNode,w=t.memoizedProps;try{y.nodeValue=w}catch(_e){tr(t,t.return,_e)}}break;case 3:if(Eo(o,t),Zo(t),p&4&&u!==null&&u.memoizedState.isDehydrated)try{of(o.containerInfo)}catch(_e){tr(t,t.return,_e)}break;case 4:Eo(o,t),Zo(t);break;case 13:Eo(o,t),Zo(t),y=t.child,y.flags&8192&&(w=y.memoizedState!==null,y.stateNode.isHidden=w,!w||y.alternate!==null&&y.alternate.memoizedState!==null||(Tx=rr())),p&4&&O2(t);break;case 22:if(H=u!==null&&u.memoizedState!==null,t.mode&1?(Wr=(F=Wr)||H,Eo(o,t),Wr=F):Eo(o,t),Zo(t),p&8192){if(F=t.memoizedState!==null,(t.stateNode.isHidden=F)&&!H&&t.mode&1)for(wt=t,H=t.child;H!==null;){for(Z=wt=H;wt!==null;){switch(Y=wt,ie=Y.child,Y.tag){case 0:case 11:case 14:case 15:Zd(4,Y,Y.return);break;case 1:wu(Y,Y.return);var ce=Y.stateNode;if(typeof ce.componentWillUnmount=="function"){p=Y,u=Y.return;try{o=p,ce.props=o.memoizedProps,ce.state=o.memoizedState,ce.componentWillUnmount()}catch(_e){tr(p,u,_e)}}break;case 5:wu(Y,Y.return);break;case 22:if(Y.memoizedState!==null){F2(Z);continue}}ie!==null?(ie.return=Y,wt=ie):F2(Z)}H=H.sibling}e:for(H=null,Z=t;;){if(Z.tag===5){if(H===null){H=Z;try{y=Z.stateNode,F?(w=y.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(a=Z.stateNode,z=Z.memoizedProps.style,C=z!=null&&z.hasOwnProperty("display")?z.display:null,a.style.display=_T("display",C))}catch(_e){tr(t,t.return,_e)}}}else if(Z.tag===6){if(H===null)try{Z.stateNode.nodeValue=F?"":Z.memoizedProps}catch(_e){tr(t,t.return,_e)}}else if((Z.tag!==22&&Z.tag!==23||Z.memoizedState===null||Z===t)&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===t)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===t)break e;H===Z&&(H=null),Z=Z.return}H===Z&&(H=null),Z.sibling.return=Z.return,Z=Z.sibling}}break;case 19:Eo(o,t),Zo(t),p&4&&O2(t);break;case 21:break;default:Eo(o,t),Zo(t)}}function Zo(t){var o=t.flags;if(o&2){try{e:{for(var u=t.return;u!==null;){if(GS(u)){var p=u;break e}u=u.return}throw Error(at(160))}switch(p.tag){case 5:var y=p.stateNode;p.flags&32&&(ef(y,""),p.flags&=-33);var w=R2(t);hv(t,w,y);break;case 3:case 4:var C=p.stateNode.containerInfo,a=R2(t);uv(t,a,C);break;default:throw Error(at(161))}}catch(z){tr(t,t.return,z)}t.flags&=-3}o&4096&&(t.flags&=-4097)}function jz(t,o,u){wt=t,WS(t)}function WS(t,o,u){for(var p=(t.mode&1)!==0;wt!==null;){var y=wt,w=y.child;if(y.tag===22&&p){var C=y.memoizedState!==null||wm;if(!C){var a=y.alternate,z=a!==null&&a.memoizedState!==null||Wr;a=wm;var F=Wr;if(wm=C,(Wr=z)&&!F)for(wt=y;wt!==null;)C=wt,z=C.child,C.tag===22&&C.memoizedState!==null?N2(y):z!==null?(z.return=C,wt=z):N2(y);for(;w!==null;)wt=w,WS(w),w=w.sibling;wt=y,wm=a,Wr=F}B2(t)}else y.subtreeFlags&8772&&w!==null?(w.return=y,wt=w):B2(t)}}function B2(t){for(;wt!==null;){var o=wt;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Wr||jg(5,o);break;case 1:var p=o.stateNode;if(o.flags&4&&!Wr)if(u===null)p.componentDidMount();else{var y=o.elementType===o.type?u.memoizedProps:To(o.type,u.memoizedProps);p.componentDidUpdate(y,u.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var w=o.updateQueue;w!==null&&x2(o,w,p);break;case 3:var C=o.updateQueue;if(C!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}x2(o,C,u)}break;case 5:var a=o.stateNode;if(u===null&&o.flags&4){u=a;var z=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":z.autoFocus&&u.focus();break;case"img":z.src&&(u.src=z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var F=o.alternate;if(F!==null){var H=F.memoizedState;if(H!==null){var Z=H.dehydrated;Z!==null&&of(Z)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(at(163))}Wr||o.flags&512&&cv(o)}catch(Y){tr(o,o.return,Y)}}if(o===t){wt=null;break}if(u=o.sibling,u!==null){u.return=o.return,wt=u;break}wt=o.return}}function F2(t){for(;wt!==null;){var o=wt;if(o===t){wt=null;break}var u=o.sibling;if(u!==null){u.return=o.return,wt=u;break}wt=o.return}}function N2(t){for(;wt!==null;){var o=wt;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{jg(4,o)}catch(z){tr(o,u,z)}break;case 1:var p=o.stateNode;if(typeof p.componentDidMount=="function"){var y=o.return;try{p.componentDidMount()}catch(z){tr(o,y,z)}}var w=o.return;try{cv(o)}catch(z){tr(o,w,z)}break;case 5:var C=o.return;try{cv(o)}catch(z){tr(o,C,z)}}}catch(z){tr(o,o.return,z)}if(o===t){wt=null;break}var a=o.sibling;if(a!==null){a.return=o.return,wt=a;break}wt=o.return}}var Uz=Math.ceil,vg=Bs.ReactCurrentDispatcher,bx=Bs.ReactCurrentOwner,Ki=Bs.ReactCurrentBatchConfig,ln=0,Mr=null,hr=null,Dr=0,Mi=0,bu=Xa(0),_r=0,gf=null,ec=0,Ug=0,Ex=0,Wd=null,gi=null,Tx=0,Nu=1/0,Ts=null,xg=!1,dv=null,Fa=null,bm=!1,Ia=null,wg=0,Xd=0,fv=null,$m=-1,Gm=0;function ni(){return ln&6?rr():$m!==-1?$m:$m=rr()}function Na(t){return t.mode&1?ln&2&&Dr!==0?Dr&-Dr:Tz.transition!==null?(Gm===0&&(Gm=IT()),Gm):(t=Tn,t!==0||(t=window.event,t=t===void 0?16:BT(t.type)),t):1}function ko(t,o,u,p){if(50<Xd)throw Xd=0,fv=null,Error(at(185));Af(t,u,p),(!(ln&2)||t!==Mr)&&(t===Mr&&(!(ln&2)&&(Ug|=u),_r===4&&Aa(t,Dr)),xi(t,p),u===1&&ln===0&&!(o.mode&1)&&(Nu=rr()+500,Bg&&Ha()))}function xi(t,o){var u=t.callbackNode;TP(t,o);var p=ig(t,t===Mr?Dr:0);if(p===0)u!==null&&Xb(u),t.callbackNode=null,t.callbackPriority=0;else if(o=p&-p,t.callbackPriority!==o){if(u!=null&&Xb(u),o===1)t.tag===0?Ez(j2.bind(null,t)):nS(j2.bind(null,t)),vz(function(){!(ln&6)&&Ha()}),u=null;else{switch(PT(p)){case 1:u=Yv;break;case 4:u=MT;break;case 16:u=rg;break;case 536870912:u=kT;break;default:u=rg}u=tC(u,XS.bind(null,t))}t.callbackPriority=o,t.callbackNode=u}}function XS(t,o){if($m=-1,Gm=0,ln&6)throw Error(at(327));var u=t.callbackNode;if(Pu()&&t.callbackNode!==u)return null;var p=ig(t,t===Mr?Dr:0);if(p===0)return null;if(p&30||p&t.expiredLanes||o)o=bg(t,p);else{o=p;var y=ln;ln|=2;var w=YS();(Mr!==t||Dr!==o)&&(Ts=null,Nu=rr()+500,Hl(t,o));do try{Gz();break}catch(a){HS(t,a)}while(1);cx(),vg.current=w,ln=y,hr!==null?o=0:(Mr=null,Dr=0,o=_r)}if(o!==0){if(o===2&&(y=j0(t),y!==0&&(p=y,o=pv(t,y))),o===1)throw u=gf,Hl(t,0),Aa(t,p),xi(t,rr()),u;if(o===6)Aa(t,p);else{if(y=t.current.alternate,!(p&30)&&!Vz(y)&&(o=bg(t,p),o===2&&(w=j0(t),w!==0&&(p=w,o=pv(t,w))),o===1))throw u=gf,Hl(t,0),Aa(t,p),xi(t,rr()),u;switch(t.finishedWork=y,t.finishedLanes=p,o){case 0:case 1:throw Error(at(345));case 2:$l(t,gi,Ts);break;case 3:if(Aa(t,p),(p&130023424)===p&&(o=Tx+500-rr(),10<o)){if(ig(t,0)!==0)break;if(y=t.suspendedLanes,(y&p)!==p){ni(),t.pingedLanes|=t.suspendedLanes&y;break}t.timeoutHandle=X0($l.bind(null,t,gi,Ts),o);break}$l(t,gi,Ts);break;case 4:if(Aa(t,p),(p&4194240)===p)break;for(o=t.eventTimes,y=-1;0<p;){var C=31-Mo(p);w=1<<C,C=o[C],C>y&&(y=C),p&=~w}if(p=y,p=rr()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*Uz(p/1960))-p,10<p){t.timeoutHandle=X0($l.bind(null,t,gi,Ts),p);break}$l(t,gi,Ts);break;case 5:$l(t,gi,Ts);break;default:throw Error(at(329))}}}return xi(t,rr()),t.callbackNode===u?XS.bind(null,t):null}function pv(t,o){var u=Wd;return t.current.memoizedState.isDehydrated&&(Hl(t,o).flags|=256),t=bg(t,o),t!==2&&(o=gi,gi=u,o!==null&&mv(o)),t}function mv(t){gi===null?gi=t:gi.push.apply(gi,t)}function Vz(t){for(var o=t;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var p=0;p<u.length;p++){var y=u[p],w=y.getSnapshot;y=y.value;try{if(!Io(w(),y))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===t)break;for(;o.sibling===null;){if(o.return===null||o.return===t)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Aa(t,o){for(o&=~Ex,o&=~Ug,t.suspendedLanes|=o,t.pingedLanes&=~o,t=t.expirationTimes;0<o;){var u=31-Mo(o),p=1<<u;t[u]=-1,o&=~p}}function j2(t){if(ln&6)throw Error(at(327));Pu();var o=ig(t,0);if(!(o&1))return xi(t,rr()),null;var u=bg(t,o);if(t.tag!==0&&u===2){var p=j0(t);p!==0&&(o=p,u=pv(t,p))}if(u===1)throw u=gf,Hl(t,0),Aa(t,o),xi(t,rr()),u;if(u===6)throw Error(at(345));return t.finishedWork=t.current.alternate,t.finishedLanes=o,$l(t,gi,Ts),xi(t,rr()),null}function Sx(t,o){var u=ln;ln|=1;try{return t(o)}finally{ln=u,ln===0&&(Nu=rr()+500,Bg&&Ha())}}function tc(t){Ia!==null&&Ia.tag===0&&!(ln&6)&&Pu();var o=ln;ln|=1;var u=Ki.transition,p=Tn;try{if(Ki.transition=null,Tn=1,t)return t()}finally{Tn=p,Ki.transition=u,ln=o,!(ln&6)&&Ha()}}function Cx(){Mi=bu.current,On(bu)}function Hl(t,o){t.finishedWork=null,t.finishedLanes=0;var u=t.timeoutHandle;if(u!==-1&&(t.timeoutHandle=-1,yz(u)),hr!==null)for(u=hr.return;u!==null;){var p=u;switch(sx(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&cg();break;case 3:Bu(),On(yi),On(Xr),mx();break;case 5:px(p);break;case 4:Bu();break;case 13:On(Yn);break;case 19:On(Yn);break;case 10:ux(p.type._context);break;case 22:case 23:Cx()}u=u.return}if(Mr=t,hr=t=ja(t.current,null),Dr=Mi=o,_r=0,gf=null,Ex=Ug=ec=0,gi=Wd=null,ql!==null){for(o=0;o<ql.length;o++)if(u=ql[o],p=u.interleaved,p!==null){u.interleaved=null;var y=p.next,w=u.pending;if(w!==null){var C=w.next;w.next=y,p.next=C}u.pending=p}ql=null}return t}function HS(t,o){do{var u=hr;try{if(cx(),jm.current=yg,_g){for(var p=Kn.memoizedState;p!==null;){var y=p.queue;y!==null&&(y.pending=null),p=p.next}_g=!1}if(Ql=0,Ar=gr=Kn=null,qd=!1,ff=0,bx.current=null,u===null||u.return===null){_r=1,gf=o,hr=null;break}e:{var w=t,C=u.return,a=u,z=o;if(o=Dr,a.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){var F=z,H=a,Z=H.tag;if(!(H.mode&1)&&(Z===0||Z===11||Z===15)){var Y=H.alternate;Y?(H.updateQueue=Y.updateQueue,H.memoizedState=Y.memoizedState,H.lanes=Y.lanes):(H.updateQueue=null,H.memoizedState=null)}var ie=A2(C);if(ie!==null){ie.flags&=-257,M2(ie,C,a,w,o),ie.mode&1&&C2(w,F,o),o=ie,z=F;var ce=o.updateQueue;if(ce===null){var _e=new Set;_e.add(z),o.updateQueue=_e}else ce.add(z);break e}else{if(!(o&1)){C2(w,F,o),Ax();break e}z=Error(at(426))}}else if(jn&&a.mode&1){var ze=A2(C);if(ze!==null){!(ze.flags&65536)&&(ze.flags|=256),M2(ze,C,a,w,o),ax(Fu(z,a));break e}}w=z=Fu(z,a),_r!==4&&(_r=2),Wd===null?Wd=[w]:Wd.push(w),w=C;do{switch(w.tag){case 3:w.flags|=65536,o&=-o,w.lanes|=o;var le=zS(w,z,o);v2(w,le);break e;case 1:a=z;var ee=w.type,ue=w.stateNode;if(!(w.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||ue!==null&&typeof ue.componentDidCatch=="function"&&(Fa===null||!Fa.has(ue)))){w.flags|=65536,o&=-o,w.lanes|=o;var Be=DS(w,a,o);v2(w,Be);break e}}w=w.return}while(w!==null)}JS(u)}catch($e){o=$e,hr===u&&u!==null&&(hr=u=u.return);continue}break}while(1)}function YS(){var t=vg.current;return vg.current=yg,t===null?yg:t}function Ax(){(_r===0||_r===3||_r===2)&&(_r=4),Mr===null||!(ec&268435455)&&!(Ug&268435455)||Aa(Mr,Dr)}function bg(t,o){var u=ln;ln|=2;var p=YS();(Mr!==t||Dr!==o)&&(Ts=null,Hl(t,o));do try{$z();break}catch(y){HS(t,y)}while(1);if(cx(),ln=u,vg.current=p,hr!==null)throw Error(at(261));return Mr=null,Dr=0,_r}function $z(){for(;hr!==null;)KS(hr)}function Gz(){for(;hr!==null&&!mP();)KS(hr)}function KS(t){var o=eC(t.alternate,t,Mi);t.memoizedProps=t.pendingProps,o===null?JS(t):hr=o,bx.current=null}function JS(t){var o=t;do{var u=o.alternate;if(t=o.return,o.flags&32768){if(u=Bz(u,o),u!==null){u.flags&=32767,hr=u;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_r=6,hr=null;return}}else if(u=Oz(u,o,Mi),u!==null){hr=u;return}if(o=o.sibling,o!==null){hr=o;return}hr=o=t}while(o!==null);_r===0&&(_r=5)}function $l(t,o,u){var p=Tn,y=Ki.transition;try{Ki.transition=null,Tn=1,qz(t,o,u,p)}finally{Ki.transition=y,Tn=p}return null}function qz(t,o,u,p){do Pu();while(Ia!==null);if(ln&6)throw Error(at(327));u=t.finishedWork;var y=t.finishedLanes;if(u===null)return null;if(t.finishedWork=null,t.finishedLanes=0,u===t.current)throw Error(at(177));t.callbackNode=null,t.callbackPriority=0;var w=u.lanes|u.childLanes;if(SP(t,w),t===Mr&&(hr=Mr=null,Dr=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||bm||(bm=!0,tC(rg,function(){return Pu(),null})),w=(u.flags&15990)!==0,u.subtreeFlags&15990||w){w=Ki.transition,Ki.transition=null;var C=Tn;Tn=1;var a=ln;ln|=4,bx.current=null,Nz(t,u),ZS(u,t),hz(Z0),og=!!q0,Z0=q0=null,t.current=u,jz(u),gP(),ln=a,Tn=C,Ki.transition=w}else t.current=u;if(bm&&(bm=!1,Ia=t,wg=y),w=t.pendingLanes,w===0&&(Fa=null),vP(u.stateNode),xi(t,rr()),o!==null)for(p=t.onRecoverableError,u=0;u<o.length;u++)y=o[u],p(y.value,{componentStack:y.stack,digest:y.digest});if(xg)throw xg=!1,t=dv,dv=null,t;return wg&1&&t.tag!==0&&Pu(),w=t.pendingLanes,w&1?t===fv?Xd++:(Xd=0,fv=t):Xd=0,Ha(),null}function Pu(){if(Ia!==null){var t=PT(wg),o=Ki.transition,u=Tn;try{if(Ki.transition=null,Tn=16>t?16:t,Ia===null)var p=!1;else{if(t=Ia,Ia=null,wg=0,ln&6)throw Error(at(331));var y=ln;for(ln|=4,wt=t.current;wt!==null;){var w=wt,C=w.child;if(wt.flags&16){var a=w.deletions;if(a!==null){for(var z=0;z<a.length;z++){var F=a[z];for(wt=F;wt!==null;){var H=wt;switch(H.tag){case 0:case 11:case 15:Zd(8,H,w)}var Z=H.child;if(Z!==null)Z.return=H,wt=Z;else for(;wt!==null;){H=wt;var Y=H.sibling,ie=H.return;if($S(H),H===F){wt=null;break}if(Y!==null){Y.return=ie,wt=Y;break}wt=ie}}}var ce=w.alternate;if(ce!==null){var _e=ce.child;if(_e!==null){ce.child=null;do{var ze=_e.sibling;_e.sibling=null,_e=ze}while(_e!==null)}}wt=w}}if(w.subtreeFlags&2064&&C!==null)C.return=w,wt=C;else e:for(;wt!==null;){if(w=wt,w.flags&2048)switch(w.tag){case 0:case 11:case 15:Zd(9,w,w.return)}var le=w.sibling;if(le!==null){le.return=w.return,wt=le;break e}wt=w.return}}var ee=t.current;for(wt=ee;wt!==null;){C=wt;var ue=C.child;if(C.subtreeFlags&2064&&ue!==null)ue.return=C,wt=ue;else e:for(C=ee;wt!==null;){if(a=wt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:jg(9,a)}}catch($e){tr(a,a.return,$e)}if(a===C){wt=null;break e}var Be=a.sibling;if(Be!==null){Be.return=a.return,wt=Be;break e}wt=a.return}}if(ln=y,Ha(),Jo&&typeof Jo.onPostCommitFiberRoot=="function")try{Jo.onPostCommitFiberRoot(zg,t)}catch{}p=!0}return p}finally{Tn=u,Ki.transition=o}}return!1}function U2(t,o,u){o=Fu(u,o),o=zS(t,o,1),t=Ba(t,o,1),o=ni(),t!==null&&(Af(t,1,o),xi(t,o))}function tr(t,o,u){if(t.tag===3)U2(t,t,u);else for(;o!==null;){if(o.tag===3){U2(o,t,u);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Fa===null||!Fa.has(p))){t=Fu(u,t),t=DS(o,t,1),o=Ba(o,t,1),t=ni(),o!==null&&(Af(o,1,t),xi(o,t));break}}o=o.return}}function Zz(t,o,u){var p=t.pingCache;p!==null&&p.delete(o),o=ni(),t.pingedLanes|=t.suspendedLanes&u,Mr===t&&(Dr&u)===u&&(_r===4||_r===3&&(Dr&130023424)===Dr&&500>rr()-Tx?Hl(t,0):Ex|=u),xi(t,o)}function QS(t,o){o===0&&(t.mode&1?(o=dm,dm<<=1,!(dm&130023424)&&(dm=4194304)):o=1);var u=ni();t=zs(t,o),t!==null&&(Af(t,o,u),xi(t,u))}function Wz(t){var o=t.memoizedState,u=0;o!==null&&(u=o.retryLane),QS(t,u)}function Xz(t,o){var u=0;switch(t.tag){case 13:var p=t.stateNode,y=t.memoizedState;y!==null&&(u=y.retryLane);break;case 19:p=t.stateNode;break;default:throw Error(at(314))}p!==null&&p.delete(o),QS(t,u)}var eC;eC=function(t,o,u){if(t!==null)if(t.memoizedProps!==o.pendingProps||yi.current)_i=!0;else{if(!(t.lanes&u)&&!(o.flags&128))return _i=!1,Rz(t,o,u);_i=!!(t.flags&131072)}else _i=!1,jn&&o.flags&1048576&&rS(o,dg,o.index);switch(o.lanes=0,o.tag){case 2:var p=o.type;Vm(t,o),t=o.pendingProps;var y=Lu(o,Xr.current);Iu(o,u),y=_x(null,o,p,t,y,u);var w=yx();return o.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,vi(p)?(w=!0,ug(o)):w=!1,o.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,dx(o),y.updater=Fg,o.stateNode=y,y._reactInternals=o,tv(o,p,t,u),o=iv(null,o,p,!0,w,u)):(o.tag=0,jn&&w&&ox(o),ei(null,o,y,u),o=o.child),o;case 16:p=o.elementType;e:{switch(Vm(t,o),t=o.pendingProps,y=p._init,p=y(p._payload),o.type=p,y=o.tag=Yz(p),t=To(p,t),y){case 0:o=rv(null,o,p,t,u);break e;case 1:o=P2(null,o,p,t,u);break e;case 11:o=k2(null,o,p,t,u);break e;case 14:o=I2(null,o,p,To(p.type,t),u);break e}throw Error(at(306,p,""))}return o;case 0:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:To(p,y),rv(t,o,p,y,u);case 1:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:To(p,y),P2(t,o,p,y,u);case 3:e:{if(BS(o),t===null)throw Error(at(387));p=o.pendingProps,w=o.memoizedState,y=w.element,aS(t,o),mg(o,p,null,u);var C=o.memoizedState;if(p=C.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},o.updateQueue.baseState=w,o.memoizedState=w,o.flags&256){y=Fu(Error(at(423)),o),o=z2(t,o,p,u,y);break e}else if(p!==y){y=Fu(Error(at(424)),o),o=z2(t,o,p,u,y);break e}else for(ki=Oa(o.stateNode.containerInfo.firstChild),Ii=o,jn=!0,Co=null,u=hS(o,null,p,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Ru(),p===y){o=Ds(t,o,u);break e}ei(t,o,p,u)}o=o.child}return o;case 5:return dS(o),t===null&&J0(o),p=o.type,y=o.pendingProps,w=t!==null?t.memoizedProps:null,C=y.children,W0(p,y)?C=null:w!==null&&W0(p,w)&&(o.flags|=32),OS(t,o),ei(t,o,C,u),o.child;case 6:return t===null&&J0(o),null;case 13:return FS(t,o,u);case 4:return fx(o,o.stateNode.containerInfo),p=o.pendingProps,t===null?o.child=Ou(o,null,p,u):ei(t,o,p,u),o.child;case 11:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:To(p,y),k2(t,o,p,y,u);case 7:return ei(t,o,o.pendingProps,u),o.child;case 8:return ei(t,o,o.pendingProps.children,u),o.child;case 12:return ei(t,o,o.pendingProps.children,u),o.child;case 10:e:{if(p=o.type._context,y=o.pendingProps,w=o.memoizedProps,C=y.value,Pn(fg,p._currentValue),p._currentValue=C,w!==null)if(Io(w.value,C)){if(w.children===y.children&&!yi.current){o=Ds(t,o,u);break e}}else for(w=o.child,w!==null&&(w.return=o);w!==null;){var a=w.dependencies;if(a!==null){C=w.child;for(var z=a.firstContext;z!==null;){if(z.context===p){if(w.tag===1){z=Ms(-1,u&-u),z.tag=2;var F=w.updateQueue;if(F!==null){F=F.shared;var H=F.pending;H===null?z.next=z:(z.next=H.next,H.next=z),F.pending=z}}w.lanes|=u,z=w.alternate,z!==null&&(z.lanes|=u),Q0(w.return,u,o),a.lanes|=u;break}z=z.next}}else if(w.tag===10)C=w.type===o.type?null:w.child;else if(w.tag===18){if(C=w.return,C===null)throw Error(at(341));C.lanes|=u,a=C.alternate,a!==null&&(a.lanes|=u),Q0(C,u,o),C=w.sibling}else C=w.child;if(C!==null)C.return=w;else for(C=w;C!==null;){if(C===o){C=null;break}if(w=C.sibling,w!==null){w.return=C.return,C=w;break}C=C.return}w=C}ei(t,o,y.children,u),o=o.child}return o;case 9:return y=o.type,p=o.pendingProps.children,Iu(o,u),y=Qi(y),p=p(y),o.flags|=1,ei(t,o,p,u),o.child;case 14:return p=o.type,y=To(p,o.pendingProps),y=To(p.type,y),I2(t,o,p,y,u);case 15:return LS(t,o,o.type,o.pendingProps,u);case 17:return p=o.type,y=o.pendingProps,y=o.elementType===p?y:To(p,y),Vm(t,o),o.tag=1,vi(p)?(t=!0,ug(o)):t=!1,Iu(o,u),cS(o,p,y),tv(o,p,y,u),iv(null,o,p,!0,t,u);case 19:return NS(t,o,u);case 22:return RS(t,o,u)}throw Error(at(156,o.tag))};function tC(t,o){return AT(t,o)}function Hz(t,o,u,p){this.tag=t,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yi(t,o,u,p){return new Hz(t,o,u,p)}function Mx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Yz(t){if(typeof t=="function")return Mx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Wv)return 11;if(t===Xv)return 14}return 2}function ja(t,o){var u=t.alternate;return u===null?(u=Yi(t.tag,o,t.key,t.mode),u.elementType=t.elementType,u.type=t.type,u.stateNode=t.stateNode,u.alternate=t,t.alternate=u):(u.pendingProps=o,u.type=t.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=t.flags&14680064,u.childLanes=t.childLanes,u.lanes=t.lanes,u.child=t.child,u.memoizedProps=t.memoizedProps,u.memoizedState=t.memoizedState,u.updateQueue=t.updateQueue,o=t.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=t.sibling,u.index=t.index,u.ref=t.ref,u}function qm(t,o,u,p,y,w){var C=2;if(p=t,typeof t=="function")Mx(t)&&(C=1);else if(typeof t=="string")C=5;else e:switch(t){case du:return Yl(u.children,y,w,o);case Zv:C=8,y|=8;break;case S0:return t=Yi(12,u,o,y|2),t.elementType=S0,t.lanes=w,t;case C0:return t=Yi(13,u,o,y),t.elementType=C0,t.lanes=w,t;case A0:return t=Yi(19,u,o,y),t.elementType=A0,t.lanes=w,t;case uT:return Vg(u,y,w,o);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case lT:C=10;break e;case cT:C=9;break e;case Wv:C=11;break e;case Xv:C=14;break e;case Ta:C=16,p=null;break e}throw Error(at(130,t==null?t:typeof t,""))}return o=Yi(C,u,o,y),o.elementType=t,o.type=p,o.lanes=w,o}function Yl(t,o,u,p){return t=Yi(7,t,p,o),t.lanes=u,t}function Vg(t,o,u,p){return t=Yi(22,t,p,o),t.elementType=uT,t.lanes=u,t.stateNode={isHidden:!1},t}function a0(t,o,u){return t=Yi(6,t,null,o),t.lanes=u,t}function l0(t,o,u){return o=Yi(4,t.children!==null?t.children:[],t.key,o),o.lanes=u,o.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},o}function Kz(t,o,u,p,y){this.tag=o,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vy(0),this.expirationTimes=Vy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vy(0),this.identifierPrefix=p,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function kx(t,o,u,p,y,w,C,a,z){return t=new Kz(t,o,u,a,z),o===1?(o=1,w===!0&&(o|=8)):o=0,w=Yi(3,null,null,o),t.current=w,w.stateNode=t,w.memoizedState={element:p,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},dx(w),t}function Jz(t,o,u){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hu,key:p==null?null:""+p,children:t,containerInfo:o,implementation:u}}function nC(t){if(!t)return Va;t=t._reactInternals;e:{if(oc(t)!==t||t.tag!==1)throw Error(at(170));var o=t;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(vi(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(at(171))}if(t.tag===1){var u=t.type;if(vi(u))return tS(t,u,o)}return o}function rC(t,o,u,p,y,w,C,a,z){return t=kx(u,p,!0,t,y,w,C,a,z),t.context=nC(null),u=t.current,p=ni(),y=Na(u),w=Ms(p,y),w.callback=o??null,Ba(u,w,y),t.current.lanes=y,Af(t,y,p),xi(t,p),t}function $g(t,o,u,p){var y=o.current,w=ni(),C=Na(y);return u=nC(u),o.context===null?o.context=u:o.pendingContext=u,o=Ms(w,C),o.payload={element:t},p=p===void 0?null:p,p!==null&&(o.callback=p),t=Ba(y,o,C),t!==null&&(ko(t,y,C,w),Nm(t,y,C)),C}function Eg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function V2(t,o){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var u=t.retryLane;t.retryLane=u!==0&&u<o?u:o}}function Ix(t,o){V2(t,o),(t=t.alternate)&&V2(t,o)}function Qz(){return null}var iC=typeof reportError=="function"?reportError:function(t){console.error(t)};function Px(t){this._internalRoot=t}Gg.prototype.render=Px.prototype.render=function(t){var o=this._internalRoot;if(o===null)throw Error(at(409));$g(t,o,null,null)};Gg.prototype.unmount=Px.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var o=t.containerInfo;tc(function(){$g(null,t,null,null)}),o[Ps]=null}};function Gg(t){this._internalRoot=t}Gg.prototype.unstable_scheduleHydration=function(t){if(t){var o=LT();t={blockedOn:null,target:t,priority:o};for(var u=0;u<Ca.length&&o!==0&&o<Ca[u].priority;u++);Ca.splice(u,0,t),u===0&&OT(t)}};function zx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function qg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $2(){}function eD(t,o,u,p,y){if(y){if(typeof p=="function"){var w=p;p=function(){var F=Eg(C);w.call(F)}}var C=rC(o,p,t,0,null,!1,!1,"",$2);return t._reactRootContainer=C,t[Ps]=C.current,lf(t.nodeType===8?t.parentNode:t),tc(),C}for(;y=t.lastChild;)t.removeChild(y);if(typeof p=="function"){var a=p;p=function(){var F=Eg(z);a.call(F)}}var z=kx(t,0,!1,null,null,!1,!1,"",$2);return t._reactRootContainer=z,t[Ps]=z.current,lf(t.nodeType===8?t.parentNode:t),tc(function(){$g(o,z,u,p)}),z}function Zg(t,o,u,p,y){var w=u._reactRootContainer;if(w){var C=w;if(typeof y=="function"){var a=y;y=function(){var z=Eg(C);a.call(z)}}$g(o,C,t,y)}else C=eD(u,o,t,y,p);return Eg(C)}zT=function(t){switch(t.tag){case 3:var o=t.stateNode;if(o.current.memoizedState.isDehydrated){var u=Bd(o.pendingLanes);u!==0&&(Kv(o,u|1),xi(o,rr()),!(ln&6)&&(Nu=rr()+500,Ha()))}break;case 13:tc(function(){var p=zs(t,1);if(p!==null){var y=ni();ko(p,t,1,y)}}),Ix(t,1)}};Jv=function(t){if(t.tag===13){var o=zs(t,134217728);if(o!==null){var u=ni();ko(o,t,134217728,u)}Ix(t,134217728)}};DT=function(t){if(t.tag===13){var o=Na(t),u=zs(t,o);if(u!==null){var p=ni();ko(u,t,o,p)}Ix(t,o)}};LT=function(){return Tn};RT=function(t,o){var u=Tn;try{return Tn=t,o()}finally{Tn=u}};B0=function(t,o,u){switch(o){case"input":if(I0(t,u),o=u.name,u.type==="radio"&&o!=null){for(u=t;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var p=u[o];if(p!==t&&p.form===t.form){var y=Og(p);if(!y)throw Error(at(90));dT(p),I0(p,y)}}}break;case"textarea":pT(t,u);break;case"select":o=u.value,o!=null&&Cu(t,!!u.multiple,o,!1)}};wT=Sx;bT=tc;var tD={usingClientEntryPoint:!1,Events:[kf,gu,Og,vT,xT,Sx]},Dd={findFiberByHostInstance:Gl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},nD={bundleType:Dd.bundleType,version:Dd.version,rendererPackageName:Dd.rendererPackageName,rendererConfig:Dd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ST(t),t===null?null:t.stateNode},findFiberByHostInstance:Dd.findFiberByHostInstance||Qz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Em=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Em.isDisabled&&Em.supportsFiber)try{zg=Em.inject(nD),Jo=Em}catch{}}Di.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tD;Di.createPortal=function(t,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!zx(o))throw Error(at(200));return Jz(t,o,null,u)};Di.createRoot=function(t,o){if(!zx(t))throw Error(at(299));var u=!1,p="",y=iC;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onRecoverableError!==void 0&&(y=o.onRecoverableError)),o=kx(t,1,!1,null,null,u,!1,p,y),t[Ps]=o.current,lf(t.nodeType===8?t.parentNode:t),new Px(o)};Di.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var o=t._reactInternals;if(o===void 0)throw typeof t.render=="function"?Error(at(188)):(t=Object.keys(t).join(","),Error(at(268,t)));return t=ST(o),t=t===null?null:t.stateNode,t};Di.flushSync=function(t){return tc(t)};Di.hydrate=function(t,o,u){if(!qg(o))throw Error(at(200));return Zg(null,t,o,!0,u)};Di.hydrateRoot=function(t,o,u){if(!zx(t))throw Error(at(405));var p=u!=null&&u.hydratedSources||null,y=!1,w="",C=iC;if(u!=null&&(u.unstable_strictMode===!0&&(y=!0),u.identifierPrefix!==void 0&&(w=u.identifierPrefix),u.onRecoverableError!==void 0&&(C=u.onRecoverableError)),o=rC(o,null,t,1,u??null,y,!1,w,C),t[Ps]=o.current,lf(t),p)for(t=0;t<p.length;t++)u=p[t],y=u._getVersion,y=y(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,y]:o.mutableSourceEagerHydrationData.push(u,y);return new Gg(o)};Di.render=function(t,o,u){if(!qg(o))throw Error(at(200));return Zg(null,t,o,!1,u)};Di.unmountComponentAtNode=function(t){if(!qg(t))throw Error(at(40));return t._reactRootContainer?(tc(function(){Zg(null,null,t,!1,function(){t._reactRootContainer=null,t[Ps]=null})}),!0):!1};Di.unstable_batchedUpdates=Sx;Di.unstable_renderSubtreeIntoContainer=function(t,o,u,p){if(!qg(u))throw Error(at(200));if(t==null||t._reactInternals===void 0)throw Error(at(38));return Zg(t,o,u,!1,p)};Di.version="18.2.0-next-9e3b772b8-20220608";function oC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oC)}catch(t){console.error(t)}}oC(),rT.exports=Di;var rD=rT.exports,G2=rD;E0.createRoot=G2.createRoot,E0.hydrateRoot=G2.hydrateRoot;var sC={exports:{}};(function(t,o){(function(u,p){t.exports=p()})(BE,function(){var u,p,y;function w(a,z){if(!u)u=z;else if(!p)p=z;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",H={};u(H),y=z(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}w(["exports"],function(a){var z=typeof self<"u"?self:{},F="2.15.0";let H;const Z={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(H==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{H={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{H=n}}return H},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Z.API_URL)return null;try{const n=new URL(Z.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Y={supported:!1,testSupport:function(n){!_e&&ce&&(ze?le(n):ie=n)}};let ie,ce,_e=!1,ze=!1;function le(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,ce),n.isContextLost())return;Y.supported=!0}catch{}n.deleteTexture(e),_e=!0}z.document&&(ce=z.document.createElement("img"),ce.onload=function(){ie&&le(ie),ie=null,ze=!0},ce.onerror=function(){_e=!0,ie=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ee="01";function ue(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Be=$e;function $e(n,e,r,s){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=s}$e.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,s=0;s<8;s++){var c=this.sampleCurveX(r)-n;if(Math.abs(c)<e)return r;var d=this.sampleCurveDerivativeX(r);if(Math.abs(d)<1e-6)break;r-=c/d}var m=0,_=1;for(r=n,s=0;s<20&&(c=this.sampleCurveX(r),!(Math.abs(c-n)<e));s++)n>c?m=r:_=r,r=.5*(_-m)+m;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var ot=ue(Be),rt=Je;function Je(n,e){this.x=n,this.y=e}Je.prototype={clone:function(){return new Je(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(n,e){var r=Math.cos(n),s=Math.sin(n),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Je.convert=function(n){return n instanceof Je?n:Array.isArray(n)?new Je(n[0],n[1]):n};var De=ue(rt);const _t=Math.PI/180,sn=180/Math.PI;function At(n){return n*_t}function rn(n){return n*sn}const kr=[[0,0],[1,0],[1,1],[0,1]];function Po(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function Oi(n,e,r,s){const c=new ot(n,e,r,s);return function(d){return c.solve(d)}}const wi=Oi(.25,.1,.25,1);function Ke(n,e,r){return Math.min(r,Math.max(e,n))}function Mt(n,e,r){return(r=Ke((r-n)/(e-n),0,1))*r*(3-2*r)}function Tt(n,e,r){const s=r-e,c=((n-e)%s+s)%s+e;return c===e?r:c}function Gt(n,e,r){if(!n.length)return r(null,[]);let s=n.length;const c=new Array(n.length);let d=null;n.forEach((m,_)=>{e(m,(x,b)=>{x&&(d=x),c[_]=b,--s==0&&r(d,c)})})}function _n(n){const e=[];for(const r in n)e.push(n[r]);return e}function Bt(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}let ir=1;function xr(){return ir++}function wr(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function Rr(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function lc(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function ts(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Ns(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Zt(n,e,r){const s={};for(const c in n)s[c]=e.call(r||this,n[c],c,n);return s}function js(n,e,r){const s={};for(const c in n)e.call(r||this,n[c],c,n)&&(s[c]=n[c]);return s}function Hr(n){return Array.isArray(n)?n.map(Hr):typeof n=="object"&&n?Zt(n,Hr):n}const Ya={};function An(n){Ya[n]||(typeof console<"u"&&console.warn(n),Ya[n]=!0)}function oi(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function cc(n){let e=0;for(let r,s,c=0,d=n.length,m=d-1;c<d;m=c++)r=n[c],s=n[m],e+=(s.x-r.x)*(r.y+s.y);return e}function to(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Yr(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,d)=>{const m=c||d;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ka=null;function Us(n){if(Ka==null){const e=n.navigator?n.navigator.userAgent:null;Ka=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ka}function Ja(n){try{const e=z[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function zo(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Vs="mapbox-tiles";let uc=500,hc=50,si,Do;function Qa(){try{return z.caches}catch{}}function ns(){Qa()&&!si&&(si=z.caches.open(Vs))}function $s(n){const e=n.indexOf("?");if(e<0)return n;const r=function(c){const d=c.indexOf("?");return d>0?c.slice(d+1).split("&"):[]}(n),s=r.filter(c=>{const d=c.split("=");return d[0]==="language"||d[0]==="worldview"});return s.length?`${n.slice(0,e)}?${s.join("&")}`:n.slice(0,e)}let el=1/0;const rs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(rs);class Lo extends Error{constructor(e,r,s){r===401&&Ee(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const is=to()?()=>self.worker&&self.worker.referrer:()=>(z.location.protocol==="blob:"?z.parent:z).location.href,os=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(is())&&!/^\w+:/.test(r))){if(z.fetch&&z.Request&&z.AbortController&&z.Request.prototype.hasOwnProperty("signal"))return function(s,c){const d=new z.AbortController,m=new z.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:is(),referrerPolicy:s.referrerPolicy,signal:d.signal});let _=!1,x=!1;const b=(S=m.url).indexOf("sku=")>0&&Ee(S);var S;s.type==="json"&&m.headers.set("Accept","application/json");const M=(D,L,B)=>{if(x)return;if(D&&D.message!=="SecurityError"&&An(D.toString()),L&&B)return k(L);const $=Date.now();z.fetch(m).then(J=>{if(J.ok){const ae=b?J.clone():null;return k(J,ae,$)}return c(new Lo(J.statusText,J.status,s.url))}).catch(J=>{J.name!=="AbortError"&&c(new Error(`${J.message} ${s.url}`))})},k=(D,L,B)=>{(s.type==="arrayBuffer"?D.arrayBuffer():s.type==="json"?D.json():D.text()).then($=>{x||(L&&B&&function(J,ae,Q){if(ns(),!si)return;const oe={status:ae.status,statusText:ae.statusText,headers:new z.Headers};ae.headers.forEach((Me,Se)=>oe.headers.set(Se,Me));const de=Yr(ae.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&oe.headers.set("Expires",new Date(Q+1e3*de["max-age"]).toUTCString());const he=oe.headers.get("Expires");he&&(new Date(he).getTime()-Q<42e4||function(Me,Se){if(Do===void 0)try{new Response(new ReadableStream),Do=!0}catch{Do=!1}Do?Se(Me.body):Me.blob().then(Se)}(ae,Me=>{const Se=new z.Response(Me,oe);ns(),si&&si.then(Oe=>Oe.put($s(J.url),Se)).catch(Oe=>An(Oe.message))}))}(m,L,B),_=!0,c(null,$,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch($=>{x||c(new Error($.message))})};return b?function(D,L){if(ns(),!si)return L(null);const B=$s(D.url);si.then($=>{$.match(B).then(J=>{const ae=function(Q){if(!Q)return!1;const oe=new Date(Q.headers.get("Expires")||0),de=Yr(Q.headers.get("Cache-Control")||"");return oe>Date.now()&&!de["no-cache"]}(J);$.delete(B),ae&&$.put(B,J.clone()),L(null,J,ae)}).catch(L)}).catch(L)}(m,M):M(null,null),{cancel:()=>{x=!0,_||d.abort()}}}(n,e);if(to()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(s,c){const d=new z.XMLHttpRequest;d.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const m in s.headers)d.setRequestHeader(m,s.headers[m]);return s.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=s.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let m=d.response;if(s.type==="json")try{m=JSON.parse(d.response)}catch(_){return c(_)}c(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new Lo(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(n,e)},Gs=function(n,e){return os(Bt(n,{type:"arrayBuffer"}),e)};function dc(n){const e=z.document.createElement("a");return e.href=n,e.protocol===z.document.location.protocol&&e.host===z.document.location.host}const se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let N,j;N=[],j=0;const re=function(n,e){if(Y.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),j>=Z.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return N.push(d),d}j++;let r=!1;const s=()=>{if(!r)for(r=!0,j--;N.length&&j<Z.MAX_PARALLEL_IMAGE_REQUESTS;){const d=N.shift(),{requestParameters:m,callback:_,cancelled:x}=d;x||(d.cancel=re(m,_).cancel)}},c=Gs(n,(d,m,_,x)=>{s(),d?e(d):m&&(z.createImageBitmap?function(b,S){const M=new z.Blob([new Uint8Array(b)],{type:"image/png"});z.createImageBitmap(M).then(k=>{S(null,k)}).catch(k=>{S(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,S)=>e(b,S,_,x)):function(b,S){const M=new z.Image,k=z.URL;M.onload=()=>{S(null,M),k.revokeObjectURL(M.src),M.onload=null,z.requestAnimationFrame(()=>{M.src=se})},M.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new z.Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?k.createObjectURL(D):se}(m,(b,S)=>e(b,S,_,x)))});return{cancel:()=>{c.cancel(),s()}}},fe="NO_ACCESS_TOKEN";function ve(n){return n.indexOf("mapbox:")===0}function Ee(n){return Z.API_URL_REGEX.test(n)}function be(n){return Z.API_CDN_URL_REGEX.test(n)}function ye(n){return Z.API_STYLE_REGEX.test(n)&&!Pe(n)}function Pe(n){return Z.API_SPRITE_REGEX.test(n)}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(n){const e=n.match(it);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function et(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const Dt="mapbox.eventData";function Ft(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(z.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Ft(Z.ACCESS_TOKEN);let s="";return s=r&&r.u?z.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(+("0x"+d)))):Z.ACCESS_TOKEN||"",e?`${Dt}.${e}:${s}`:`${Dt}:${s}`}fetchEventData(){const e=Ja("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=z.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));const d=z.localStorage.getItem(s);d&&(this.anonId=d)}catch{An("Unable to read from LocalStorage")}}saveEventData(){const e=Ja("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{z.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&z.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{An("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,c){if(!Z.EVENTS_URL)return;const d=st(Z.EVENTS_URL);d.params.push(`access_token=${c||Z.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},_=r?Bt(m,r):m,x={url:et(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(b,S){return os(Bt(b,{method:"POST"}),S)}(x,b=>{this.pendingRequest=null,s(b),this.saveEventData(),this.processRequests(c)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Nt=new class extends Lt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){Z.EVENTS_URL&&Z.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>ve(r)||Ee(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ft(Z.ACCESS_TOKEN),r=e?e.u:Z.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;lc(this.anonId)||(this.anonId=wr(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(c),_=(c-this.eventData.lastSuccess)/864e5;s=s||_>=1||_<-1||d.getDate()!==m.getDate()}else s=!0;s?this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:ee,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=r)},n):this.processRequests()}},Wt=Nt.postTurnstileEvent.bind(Nt),Mn=new class extends Lt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,s){this.skuToken=e,this.errorCb=s,Z.EVENTS_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(fe)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),lc(this.anonId)||(this.anonId=wr()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:F,skuId:ee,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n))}},Un=Mn.postMapLoadEvent.bind(Mn),br=new class extends Lt{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){Z.EVENTS_URL&&(n||Z.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),s=function(c){const d=z.performance.getEntriesByType("resource"),m=z.performance.getEntriesByType("mark"),_=function(k){const D={};if(k){for(const L in k)if(L!=="other")for(const B of k[L]){const $=`${L}ResolveRangeMin`,J=`${L}ResolveRangeMax`,ae=`${L}RequestCount`,Q=`${L}RequestCachedCount`;D[$]=Math.min(D[$]||1/0,B.startTime),D[J]=Math.max(D[J]||-1/0,B.responseEnd);const oe=de=>{D[de]===void 0&&(D[de]=0),++D[de]};B.transferSize!==void 0&&B.transferSize===0&&oe(Q),oe(ae)}}return D}(function(k,D){const L={};if(k)for(const B of k){const $=D(B);L[$]===void 0&&(L[$]=[]),L[$].push(B)}return L}(d,Of)),x=z.devicePixelRatio,b=z.navigator.connection||z.navigator.mozConnection||z.navigator.webkitConnection,S={counters:[],metadata:[],attributes:[]},M=(k,D,L)=>{L!=null&&k.push({name:D,value:L.toString()})};for(const k in _)M(S.counters,k,_[k]);if(c.interactionRange[0]!==1/0&&c.interactionRange[1]!==-1/0&&(M(S.counters,"interactionRangeMin",c.interactionRange[0]),M(S.counters,"interactionRangeMax",c.interactionRange[1])),m)for(const k of Object.keys(qs)){const D=qs[k],L=m.find(B=>B.name===D);L&&M(S.counters,D,L.startTime)}return M(S.counters,"visibilityHidden",c.visibilityHidden),M(S.attributes,"style",function(k){if(k)for(const D of k){const L=D.name.split("?")[0];if(ye(L)){const B=L.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(d)),M(S.attributes,"terrainEnabled",c.terrainEnabled?"true":"false"),M(S.attributes,"fogEnabled",c.fogEnabled?"true":"false"),M(S.attributes,"projection",c.projection),M(S.attributes,"zoom",c.zoom),M(S.metadata,"devicePixelRatio",x),M(S.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),M(S.metadata,"navigatorUserAgent",z.navigator.userAgent),M(S.metadata,"screenWidth",z.screen.width),M(S.metadata,"screenHeight",z.screen.height),M(S.metadata,"windowWidth",z.innerWidth),M(S.metadata,"windowHeight",z.innerHeight),M(S.metadata,"mapWidth",c.width/x),M(S.metadata,"mapHeight",c.height/x),M(S.metadata,"webglRenderer",c.renderer),M(S.metadata,"webglVendor",c.vendor),M(S.metadata,"sdkVersion",F),M(S.metadata,"sdkIdentifier","mapbox-gl-js"),S}(r);for(const c of s.metadata);for(const c of s.counters);for(const c of s.attributes);this.postEvent(e,s,()=>{},n)}},Qn=br.postPerformanceEvent.bind(br),Bi=new class extends Lt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,s){if(!Z.API_URL||!Z.SESSION_PATH)return;const c=st(Z.API_URL+Z.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||Z.ACCESS_TOKEN||""}`);const d={url:et(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,_){return os(Bt(m,{method:"GET"}),_)}(d,m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(n,e,r,s){this.skuToken=e,this.errorCb=s,Z.SESSION_PATH&&Z.API_URL&&(r||Z.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(fe)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},n)}},or=Bi.getSessionAPI.bind(Bi),Ir=new Set,qs={create:"create",load:"load",fullLoad:"fullLoad"},r_={mark(n){z.performance.mark(n)},measure(n,e,r){z.performance.measure(n,e,r)}};function Of(n){const e=n.name.split("?")[0];return be(e)&&e.includes("mapbox-gl.js")?"javascript":be(e)&&e.includes("mapbox-gl.css")?"css":function(r){return Z.API_FONTS_REGEX.test(r)}(e)?"fontRange":Pe(e)?"sprite":ye(e)?"style":function(r){return Z.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const en=z.performance;function Hu(n){const e=n?n.url.toString():void 0;return en.getEntriesByName(e)}let tl,Yu,fc,Fi;const no={now:()=>fc!==void 0?fc:z.performance.now(),setNow(n){fc=n},restoreNow(){fc=void 0},frame(n){const e=z.requestAnimationFrame(n);return{cancel:()=>z.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:s}=n;Fi||(Fi=z.document.createElement("canvas"));const c=Fi.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(r>Fi.width||s>Fi.height)&&(Fi.width=r,Fi.height=s),c.clearRect(-e,-e,r+2*e,s+2*e),c.drawImage(n,0,0,r,s),c.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:n=>(tl||(tl=z.document.createElement("a")),tl.href=n,tl.href),get devicePixelRatio(){return z.devicePixelRatio},get prefersReducedMotion(){return!!z.matchMedia&&(Yu==null&&(Yu=z.matchMedia("(prefers-reduced-motion: reduce)")),Yu.matches)}};function Ku(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function Ju(n,e,r){if(r&&r[n]){const s=r[n].indexOf(e);s!==-1&&r[n].splice(s,1)}}class ss{constructor(e,r={}){Bt(this,r),this.type=e}}class ro extends ss{constructor(e,r={}){super("error",Bt({error:e},r))}}class nl{on(e,r){return this._listeners=this._listeners||{},Ku(e,r,this._listeners),this}off(e,r){return Ju(e,r,this._listeners),Ju(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ku(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){typeof e=="string"&&(e=new ss(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of c)_.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of d)Ju(s,_,this._oneTimeListeners),_.call(this,e);const m=this._eventedParent;m&&(Bt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof ro&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Re=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function io(n,...e){for(const r of e)for(const s in r)n[s]=r[s];return n}function Vn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function sr(n){if(Array.isArray(n))return n.map(sr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=sr(n[r]);return e}return Vn(n)}class Bf extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Ni=Bf;class Qu{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Qu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ff=Qu;const Zs={kind:"null"},ht={kind:"number"},qt={kind:"string"},Ut={kind:"boolean"},Kr={kind:"color"},bi={kind:"object"},Vt={kind:"value"},Jr={kind:"collator"},rl={kind:"formatted"},as={kind:"resolvedImage"};function ai(n,e){return{kind:"array",itemType:n,N:e}}function Sn(n){if(n.kind==="array"){const e=Sn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Nf=[Zs,ht,qt,Ut,Kr,rl,bi,ai(Vt),as];function oo(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!oo(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of Nf)if(!oo(r,e))return null}}return`Expected ${Sn(n)} but found ${Sn(e)} instead.`}function il(n,e){return e.some(r=>r.kind===n.kind)}function ol(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}var eh,jf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function sl(n){return(n=Math.round(n))<0?0:n>255?255:n}function al(n){return sl(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function pc(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function Ws(n,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(e-n)*r*6:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n}try{eh={}.parseCSSColor=function(n){var e,r=n.replace(/ /g,"").toLowerCase();if(r in jf)return jf[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),c=r.indexOf(")");if(s!==-1&&c+1===r.length){var d=r.substr(0,s),m=r.substr(s+1,c-(s+1)).split(","),_=1;switch(d){case"rgba":if(m.length!==4)return null;_=pc(m.pop());case"rgb":return m.length!==3?null:[al(m[0]),al(m[1]),al(m[2]),_];case"hsla":if(m.length!==4)return null;_=pc(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,b=pc(m[1]),S=pc(m[2]),M=S<=.5?S*(b+1):S+b-S*b,k=2*S-M;return[sl(255*Ws(k,M,x+1/3)),sl(255*Ws(k,M,x)),sl(255*Ws(k,M,x-1/3)),_];default:return null}}return null}}catch{}class Or{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Or)return e;if(typeof e!="string")return;const r=eh(e);return r?new Or(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}toArray01(){const{r:e,g:r,b:s,a:c}=this;return c===0?[0,0,0,0]:[e/c,r/c,s/c,c]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:c}=this;return[e,r,s,c]}}Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1),Or.blue=new Or(0,0,1,1);var Fn=Or;class th{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class nh{constructor(e,r,s,c,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=d}}class Br{constructor(e){this.sections=e}static fromString(e){return new Br([new nh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Br?e:Br.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class li{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new li({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Uf(n,e,r,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,r,s]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ll(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Fn||n instanceof th||n instanceof Br||n instanceof li)return!0;if(Array.isArray(n)){for(const e of n)if(!ll(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!ll(n[e]))return!1;return!0}return!1}function zn(n){if(n===null)return Zs;if(typeof n=="string")return qt;if(typeof n=="boolean")return Ut;if(typeof n=="number")return ht;if(n instanceof Fn)return Kr;if(n instanceof th)return Jr;if(n instanceof Br)return rl;if(n instanceof li)return as;if(Array.isArray(n)){const e=n.length;let r;for(const s of n){const c=zn(s);if(r){if(r===c)continue;r=Vt;break}r=c}return ai(r||Vt,e)}return bi}function cl(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Fn||n instanceof Br||n instanceof li?n.toString():JSON.stringify(n)}class rh{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ll(e[1]))return r.error("invalid value");const s=e[1];let c=zn(s);const d=r.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new rh(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Fn?["rgba"].concat(this.value.toArray()):this.value instanceof Br?this.value.serialize():this.value}}var ls=rh,fr=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ih={string:qt,number:ht,boolean:Ut,object:bi};class oh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const d=e[0];if(d==="array"){let _,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in ih)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=ih[b],c++}else _=Vt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=e[2],c++}s=ai(_,x)}else s=ih[d];const m=[];for(;c<e.length;c++){const _=r.parse(e[c],c,Vt);if(!_)return null;m.push(_)}return new oh(s,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!oo(this.type,zn(s)))return s;if(r===this.args.length-1)throw new fr(`Expected value to be of type ${Sn(this.type)}, but found ${Sn(zn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(s=>s.serialize()))}}var so=oh;class Ro{constructor(e){this.type=rl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const c=[];let d=!1;for(let m=1;m<=e.length-1;++m){const _=e[m];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let x=null;if(_["font-scale"]&&(x=r.parse(_["font-scale"],1,ht),!x))return null;let b=null;if(_["text-font"]&&(b=r.parse(_["text-font"],1,ai(qt)),!b))return null;let S=null;if(_["text-color"]&&(S=r.parse(_["text-color"],1,Kr),!S))return null;const M=c[c.length-1];M.scale=x,M.font=b,M.textColor=S}else{const x=r.parse(e[m],1,Vt);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Ro(c)}evaluate(e){return new Br(this.sections.map(r=>{const s=r.content.evaluate(e);return zn(s)===as?new nh("",s,null,null,null):new nh(cl(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class mc{constructor(e){this.type=as,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const s=r.parse(e[1],1,qt);return s?new mc(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=li.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const i_={"to-boolean":Ut,"to-color":Kr,"to-number":ht,"to-string":qt};class sh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");const c=i_[s],d=[];for(let m=1;m<e.length;m++){const _=r.parse(e[m],m,Vt);if(!_)return null;d.push(_)}return new sh(c,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof Fn)return r;if(typeof r=="string"){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Uf(r[0],r[1],r[2],r[3]),!s))return new Fn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new fr(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new fr(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Br.fromString(cl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?li.fromString(cl(this.args[0].evaluate(e))):cl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ro([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Xs=sh;const ji=["Unknown","Point","LineString","Polygon"];var ah=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ji[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-n[0])+this.featureDistanceData.bearing[1]*(s*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Fn.parse(n)),e}};class cs{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],c=cs.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=m.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let x=null;for(const[b,S]of _){x=new fh(r.registry,r.path,null,r.scope);const M=[];let k=!1;for(let D=1;D<e.length;D++){const L=e[D],B=Array.isArray(b)?b[D-1]:b.type,$=x.parse(L,1+M.length,B);if(!$){k=!0;break}M.push($)}if(!k)if(Array.isArray(b)&&b.length!==M.length)x.error(`Expected ${b.length} arguments, but found ${M.length} instead.`);else{for(let D=0;D<M.length;D++){const L=Array.isArray(b)?b[D]:b.type,B=M[D];x.concat(D+1).checkSubtype(L,B.type)}if(x.errors.length===0)return new cs(s,d,S,M)}}if(_.length===1)r.errors.push(...x.errors);else{const b=(_.length?_:m).map(([M])=>{return k=M,Array.isArray(k)?`(${k.map(Sn).join(", ")})`:`(${Sn(k.type)}...)`;var k}).join(" | "),S=[];for(let M=1;M<e.length;M++){const k=r.parse(e[M],1+S.length);if(!k)return null;S.push(Sn(k.type))}r.error(`Expected arguments of type ${b}, but found (${S.join(", ")}) instead.`)}return null}static register(e,r){cs.definitions=r;for(const s in r)e[s]=cs}}var ao=cs;class ul{constructor(e,r,s){this.type=Jr,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Ut);if(!c)return null;const d=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Ut);if(!d)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,qt),!m)?null:new ul(c,d,m)}evaluate(e){return new th(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const lo=8192;function gc(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Hs(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function hl(n,e){const r=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*lo),Math.round(s*c*lo)]}function Vf(n,e,r){const s=n[0]-e[0],c=n[1]-e[1],d=n[0]-r[0],m=n[1]-r[1];return s*m-d*c==0&&s*d<=0&&c*m<=0}function _c(n,e){let r=!1;for(let m=0,_=e.length;m<_;m++){const x=e[m];for(let b=0,S=x.length;b<S-1;b++){if(Vf(n,x[b],x[b+1]))return!1;(c=x[b])[1]>(s=n)[1]!=(d=x[b+1])[1]>s[1]&&s[0]<(d[0]-c[0])*(s[1]-c[1])/(d[1]-c[1])+c[0]&&(r=!r)}}var s,c,d;return r}function lh(n,e){for(let r=0;r<e.length;r++)if(_c(n,e[r]))return!0;return!1}function ch(n,e,r,s){const c=s[0]-r[0],d=s[1]-r[1],m=(n[0]-r[0])*d-c*(n[1]-r[1]),_=(e[0]-r[0])*d-c*(e[1]-r[1]);return m>0&&_<0||m<0&&_>0}function Ys(n,e,r){for(const b of r)for(let S=0;S<b.length-1;++S)if((_=[(m=b[S+1])[0]-(d=b[S])[0],m[1]-d[1]])[0]*(x=[(c=e)[0]-(s=n)[0],c[1]-s[1]])[1]-_[1]*x[0]!=0&&ch(s,c,d,m)&&ch(d,m,s,c))return!0;var s,c,d,m,_,x;return!1}function tn(n,e){for(let r=0;r<n.length;++r)if(!_c(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(Ys(n[r],n[r+1],e))return!1;return!0}function o_(n,e){for(let r=0;r<e.length;r++)if(tn(n,e[r]))return!0;return!1}function uh(n,e,r){const s=[];for(let c=0;c<n.length;c++){const d=[];for(let m=0;m<n[c].length;m++){const _=hl(n[c][m],r);gc(e,_),d.push(_)}s.push(d)}return s}function $f(n,e,r){const s=[];for(let c=0;c<n.length;c++){const d=uh(n[c],e,r);s.push(d)}return s}function hh(n,e,r,s){if(n[0]<r[0]||n[0]>r[2]){const c=.5*s;let d=n[0]-r[0]>c?-s:r[0]-n[0]>c?s:0;d===0&&(d=n[0]-r[2]>c?-s:r[2]-n[0]>c?s:0),n[0]+=d}gc(e,n)}function Gf(n,e,r,s){const c=Math.pow(2,s.z)*lo,d=[s.x*lo,s.y*lo],m=[];if(!n)return m;for(const _ of n)for(const x of _){const b=[x.x+d[0],x.y+d[1]];hh(b,e,r,c),m.push(b)}return m}function dh(n,e,r,s){const c=Math.pow(2,s.z)*lo,d=[s.x*lo,s.y*lo],m=[];if(!n)return m;for(const x of n){const b=[];for(const S of x){const M=[S.x+d[0],S.y+d[1]];gc(e,M),b.push(M)}m.push(b)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of m)for(const b of x)hh(b,e,r,c)}var _;return m}class Ks{constructor(e,r){this.type=Ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ll(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let c=0;c<s.features.length;++c){const d=s.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ks(s,s.features[c].geometry)}else if(s.type==="Feature"){const c=s.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ks(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Ks(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const _=uh(s.coordinates,d,m),x=Gf(r.geometry(),c,d,m);if(!Hs(c,d))return!1;for(const b of x)if(!_c(b,_))return!1}if(s.type==="MultiPolygon"){const _=$f(s.coordinates,d,m),x=Gf(r.geometry(),c,d,m);if(!Hs(c,d))return!1;for(const b of x)if(!lh(b,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(s.type==="Polygon"){const _=uh(s.coordinates,d,m),x=dh(r.geometry(),c,d,m);if(!Hs(c,d))return!1;for(const b of x)if(!tn(b,_))return!1}if(s.type==="MultiPolygon"){const _=$f(s.coordinates,d,m),x=dh(r.geometry(),c,d,m);if(!Hs(c,d))return!1;for(const b of x)if(!o_(b,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var yc=Ks;function Js(n){if(n instanceof ao&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof yc)return!1;let e=!0;return n.eachChild(r=>{e&&!Js(r)&&(e=!1)}),e}function co(n){if(n instanceof ao&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!co(r)&&(e=!1)}),e}function us(n,e){if(n instanceof ao&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(s=>{r&&!us(s,e)&&(r=!1)}),r}class vc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new vc(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qf=vc;class dl{constructor(e,r=[],s,c=new Ff,d=[]){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=c,this.errors=d,this.expectedType=s}parse(e,r,s,c,d={}){return r?this.concat(r,s,c)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(c,d,m){return m==="assert"?new so(d,[c]):m==="coerce"?new Xs(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,x=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(_,x))return null}else m=s(m,_,r.typeAnnotation||"coerce");else m=s(m,_,r.typeAnnotation||"assert")}if(!(m instanceof ls)&&m.type.kind!=="resolvedImage"&&ph(m)){const _=new ah;try{m=new ls(m.type,m.evaluate(_))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c=typeof e=="number"?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new dl(this.registry,c,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Ni(s,e))}checkSubtype(e,r){const s=oo(e,r);return s&&this.error(s),s}}var fh=dl;function ph(n){if(n instanceof qf)return ph(n.boundExpression);if(n instanceof ao&&n.name==="error"||n instanceof ul||n instanceof yc)return!1;const e=n instanceof Xs||n instanceof so;let r=!0;return n.eachChild(s=>{r=e?r&&ph(s):r&&s instanceof ls}),!!r&&Js(n)&&us(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function xc(n,e){const r=n.length-1;let s,c,d=0,m=r,_=0;for(;d<=m;)if(_=Math.floor((d+m)/2),s=n[_],c=n[_+1],s<=e){if(_===r||e<c)return _;d=_+1}else{if(!(s>e))throw new fr("Input is not a number.");m=_-1}return 0}class wc{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,ht);if(!s)return null;const c=[];let d=null;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(let m=1;m<e.length;m+=2){const _=m===1?-1/0:e[m],x=e[m+1],b=m,S=m+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(c.length&&c[c.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const M=r.parse(x,S,d);if(!M)return null;d=d||M.type,c.push([_,M])}return new wc(d,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;return c>=r[d-1]?s[d-1].evaluate(e):s[xc(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var mh=wc;function Xt(n,e,r){return n*(1-r)+e*r}var fl=Object.freeze({__proto__:null,array:function(n,e,r){return n.map((s,c)=>Xt(s,e[c],r))},color:function(n,e,r){return new Fn(Xt(n.r,e.r,r),Xt(n.g,e.g,r),Xt(n.b,e.b,r),Xt(n.a,e.a,r))},number:Xt});const Zf=.95047,gh=1.08883,Wf=4/29,hs=6/29,_h=3*hs*hs,s_=hs*hs*hs,a_=Math.PI/180,l_=180/Math.PI;function yh(n){return n>s_?Math.pow(n,1/3):n/_h+Wf}function vh(n){return n>hs?n*n*n:_h*(n-Wf)}function xh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function bc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Xf(n){const e=bc(n.r),r=bc(n.g),s=bc(n.b),c=yh((.4124564*e+.3575761*r+.1804375*s)/Zf),d=yh((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-yh((.0193339*e+.119192*r+.9503041*s)/gh)),alpha:n.a}}function Hf(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*vh(e),r=Zf*vh(r),s=gh*vh(s),new Fn(xh(3.2404542*r-1.5371385*e-.4985314*s),xh(-.969266*r+1.8760108*e+.041556*s),xh(.0556434*r-.2040259*e+1.0572252*s),n.alpha)}function c_(n,e,r){const s=e-n;return n+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const pl={forward:Xf,reverse:Hf,interpolate:function(n,e,r){return{l:Xt(n.l,e.l,r),a:Xt(n.a,e.a,r),b:Xt(n.b,e.b,r),alpha:Xt(n.alpha,e.alpha,r)}}},Qs={forward:function(n){const{l:e,a:r,b:s}=Xf(n),c=Math.atan2(s,r)*l_;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*a_,r=n.c;return Hf({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:c_(n.h,e.h,r),c:Xt(n.c,e.c,r),l:Xt(n.l,e.l,r),alpha:Xt(n.alpha,e.alpha,r)}}};var wh=Object.freeze({__proto__:null,hcl:Qs,lab:pl});class ml{constructor(e,r,s,c,d){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,_]of d)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(e,r,s,c){let d=0;if(e.name==="exponential")d=bh(r,e.base,s,c);else if(e.name==="linear")d=bh(r,1,s,c);else if(e.name==="cubic-bezier"){const m=e.controlPoints;d=new ot(m[0],m[1],m[2],m[3]).solve(bh(r,1,s,c))}return d}static parse(e,r){let[s,c,d,...m]=e;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const b=c[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:b}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const b=c.slice(1);if(b.length!==4||b.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,ht),!d)return null;const _=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=Kr:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let b=0;b<m.length;b+=2){const S=m[b],M=m[b+1],k=b+3,D=b+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const L=r.parse(M,D,x);if(!L)return null;x=x||L.type,_.push([S,L])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new ml(x,s,c,d,_):r.error(`Type ${Sn(x)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;if(c>=r[d-1])return s[d-1].evaluate(e);const m=xc(r,c),_=ml.interpolationFactor(this.interpolation,c,r[m],r[m+1]),x=s[m].evaluate(e),b=s[m+1].evaluate(e);return this.operator==="interpolate"?fl[this.type.kind.toLowerCase()](x,b,_):this.operator==="interpolate-hcl"?Qs.reverse(Qs.interpolate(Qs.forward(x),Qs.forward(b),_)):pl.reverse(pl.interpolate(pl.forward(x),pl.forward(b),_))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function bh(n,e,r,s){const c=s-r,d=n-r;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}var Ui=ml;class Ec{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&c.kind!=="value"&&(s=c);const d=[];for(const _ of e.slice(1)){const x=r.parse(_,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,d.push(x)}const m=c&&d.some(_=>oo(c,_.type));return new Ec(m?Vt:s,d)}evaluate(e){let r,s=null,c=0;for(const d of this.args){if(c++,s=d.evaluate(e),s&&s instanceof li&&!s.available&&(r||(r=s),s=null,c===this.args.length))return r;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Eh=Ec;class Tc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const _=r.parse(e[d+1],d+1);if(!_)return null;s.push([m,_])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Tc(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}var Yf=Tc;class Th{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,ht),c=r.parse(e[2],2,ai(r.expectedType||Vt));return s&&c?new Th(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new fr(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new fr(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new fr(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var u_=Th;class Sh{constructor(e,r){this.type=Ut,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Vt),c=r.parse(e[2],2,Vt);return s&&c?il(s.type,[Ut,qt,ht,Zs,Vt])?new Sh(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!ol(r,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(zn(r))} instead.`);if(!ol(s,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${Sn(zn(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Sc=Sh;class gl{constructor(e,r,s){this.type=ht,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Vt),c=r.parse(e[2],2,Vt);if(!s||!c)return null;if(!il(s.type,[Ut,qt,ht,Zs,Vt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ht);return d?new gl(s,c,d):null}return new gl(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!ol(r,["boolean","string","number","null"]))throw new fr(`Expected first argument to be of type boolean, string, number or null, but found ${Sn(zn(r))} instead.`);if(!ol(s,["string","array"]))throw new fr(`Expected second argument to be of type array or string, but found ${Sn(zn(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Kf=gl;class Ch{constructor(e,r,s,c,d,m){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=d,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const d={},m=[];for(let b=2;b<e.length-1;b+=2){let S=e[b];const M=e[b+1];Array.isArray(S)||(S=[S]);const k=r.concat(b);if(S.length===0)return k.error("Expected at least one branch label.");for(const L of S){if(typeof L!="number"&&typeof L!="string")return k.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,zn(L)))return null}else s=zn(L);if(d[String(L)]!==void 0)return k.error("Branch labels must be unique.");d[String(L)]=m.length}const D=r.parse(M,b,c);if(!D)return null;c=c||D.type,m.push(D)}const _=r.parse(e[1],1,Vt);if(!_)return null;const x=r.parse(e[e.length-1],e.length-1,c);return x?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new Ch(s,c,_,d,m,x):null}evaluate(e){const r=this.input.evaluate(e);return(zn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],c={};for(const m of r){const _=c[this.cases[m]];_===void 0?(c[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[_][1].push(m)}const d=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,_]of s)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var h_=Ch;class Ah{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const _=r.parse(e[m],m,Ut);if(!_)return null;const x=r.parse(e[m+1],m+1,s);if(!x)return null;c.push([_,x]),s=s||x.type}const d=r.parse(e[e.length-1],e.length-1,s);return d?new Ah(s,c,d):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Jf=Ah;class _l{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Vt),c=r.parse(e[2],2,ht);if(!s||!c)return null;if(!il(s.type,[ai(Vt),qt,Vt]))return r.error(`Expected first argument to be of type array or string, but found ${Sn(s.type)} instead`);if(e.length===4){const d=r.parse(e[3],3,ht);return d?new _l(s.type,s,c,d):null}return new _l(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!ol(r,["string","array"]))throw new fr(`Expected first argument to be of type array or string, but found ${Sn(zn(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Qf=_l;function Cc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ep(n,e,r,s){return s.compare(e,r)===0}function ea(n,e,r){const s=n!=="=="&&n!=="!=";return class aC{constructor(d,m,_){this.type=Ut,this.lhs=d,this.rhs=m,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||m.type.kind==="value"}static parse(d,m){if(d.length!==3&&d.length!==4)return m.error("Expected two or three arguments.");const _=d[0];let x=m.parse(d[1],1,Vt);if(!x)return null;if(!Cc(_,x.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${Sn(x.type)}'.`);let b=m.parse(d[2],2,Vt);if(!b)return null;if(!Cc(_,b.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${Sn(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error(`Cannot compare types '${Sn(x.type)}' and '${Sn(b.type)}'.`);s&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new so(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new so(x.type,[b])));let S=null;if(d.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(S=m.parse(d[3],3,Jr),!S)return null}return new aC(x,b,S)}evaluate(d){const m=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const x=zn(m),b=zn(_);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new fr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=zn(m),b=zn(_);if(x.kind!=="string"||b.kind!=="string")return e(d,m,_)}return this.collator?r(d,m,_,this.collator.evaluate(d)):e(d,m,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const d_=ea("==",function(n,e,r){return e===r},ep),f_=ea("!=",function(n,e,r){return e!==r},function(n,e,r,s){return!ep(0,e,r,s)}),p_=ea("<",function(n,e,r){return e<r},function(n,e,r,s){return s.compare(e,r)<0}),m_=ea(">",function(n,e,r){return e>r},function(n,e,r,s){return s.compare(e,r)>0}),g_=ea("<=",function(n,e,r){return e<=r},function(n,e,r,s){return s.compare(e,r)<=0}),tp=ea(">=",function(n,e,r){return e>=r},function(n,e,r,s){return s.compare(e,r)>=0});class Ac{constructor(e,r,s,c,d,m){this.type=qt,this.number=e,this.locale=r,this.currency=s,this.unit=c,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,ht);if(!s)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=r.parse(c.locale,1,qt),!d))return null;let m=null;if(c.currency&&(m=r.parse(c.currency,1,qt),!m))return null;let _=null;if(c.unit&&(_=r.parse(c.unit,1,qt),!_))return null;let x=null;if(c["min-fraction-digits"]&&(x=r.parse(c["min-fraction-digits"],1,ht),!x))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,ht),!b)?null:new Ac(s,d,m,_,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ta{constructor(e){this.type=ht,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Sn(s.type)} instead.`):new ta(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new fr(`Expected value to be of type string or array, but found ${Sn(zn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const np={"==":d_,"!=":f_,">":m_,"<":p_,">=":tp,"<=":g_,array:so,at:u_,boolean:so,case:Jf,coalesce:Eh,collator:ul,format:Ro,image:mc,in:Sc,"index-of":Kf,interpolate:Ui,"interpolate-hcl":Ui,"interpolate-lab":Ui,length:ta,let:Yf,literal:ls,match:h_,number:so,"number-format":Ac,object:so,slice:Qf,step:mh,string:so,"to-boolean":Xs,"to-color":Xs,"to-number":Xs,"to-string":Xs,var:qf,within:yc};function rp(n,[e,r,s,c]){e=e.evaluate(n),r=r.evaluate(n),s=s.evaluate(n);const d=c?c.evaluate(n):1,m=Uf(e,r,s,d);if(m)throw new fr(m);return new Fn(e/255*d,r/255*d,s/255*d,d)}function uo(n,e){return n in e}function Mc(n,e){const r=e[n];return r===void 0?null:r}function ci(n){return{type:n}}ao.register(np,{error:[{kind:"error"},[qt],(n,[e])=>{throw new fr(e.evaluate(n))}],typeof:[qt,[Vt],(n,[e])=>Sn(zn(e.evaluate(n)))],"to-rgba":[ai(ht,4),[Kr],(n,[e])=>e.evaluate(n).toArray()],rgb:[Kr,[ht,ht,ht],rp],rgba:[Kr,[ht,ht,ht,ht],rp],has:{type:Ut,overloads:[[[qt],(n,[e])=>uo(e.evaluate(n),n.properties())],[[qt,bi],(n,[e,r])=>uo(e.evaluate(n),r.evaluate(n))]]},get:{type:Vt,overloads:[[[qt],(n,[e])=>Mc(e.evaluate(n),n.properties())],[[qt,bi],(n,[e,r])=>Mc(e.evaluate(n),r.evaluate(n))]]},"feature-state":[Vt,[qt],(n,[e])=>Mc(e.evaluate(n),n.featureState||{})],properties:[bi,[],n=>n.properties()],"geometry-type":[qt,[],n=>n.geometryType()],id:[Vt,[],n=>n.id()],zoom:[ht,[],n=>n.globals.zoom],pitch:[ht,[],n=>n.globals.pitch||0],"distance-from-center":[ht,[],n=>n.distanceFromCenter()],"heatmap-density":[ht,[],n=>n.globals.heatmapDensity||0],"line-progress":[ht,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[ht,[],n=>n.globals.skyRadialProgress||0],accumulated:[Vt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ht,ci(ht),(n,e)=>{let r=0;for(const s of e)r+=s.evaluate(n);return r}],"*":[ht,ci(ht),(n,e)=>{let r=1;for(const s of e)r*=s.evaluate(n);return r}],"-":{type:ht,overloads:[[[ht,ht],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[ht],(n,[e])=>-e.evaluate(n)]]},"/":[ht,[ht,ht],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[ht,[ht,ht],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[ht,[ht],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))],log2:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[ht,[ht],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ht,[ht],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ht,[ht],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ht,[ht],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ht,[ht],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ht,[ht],(n,[e])=>Math.atan(e.evaluate(n))],min:[ht,ci(ht),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[ht,ci(ht),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[ht,[ht],(n,[e])=>Math.abs(e.evaluate(n))],round:[ht,[ht],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ht,[ht],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ht,[ht],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Ut,[qt,Vt],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[Ut,[Vt],(n,[e])=>n.id()===e.value],"filter-type-==":[Ut,[qt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Ut,[qt,Vt],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Ut,[Vt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Ut,[qt,Vt],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[Ut,[Vt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Ut,[qt,Vt],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Ut,[Vt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Ut,[qt,Vt],(n,[e,r])=>{const s=n.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Ut,[Vt],(n,[e])=>{const r=n.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Ut,[Vt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Ut,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Ut,[ai(qt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Ut,[ai(Vt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Ut,[qt,ai(Vt)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Ut,[qt,ai(Vt)],(n,[e,r])=>function(s,c,d,m){for(;d<=m;){const _=d+m>>1;if(c[_]===s)return!0;c[_]>s?m=_-1:d=_+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Ut,overloads:[[[Ut,Ut],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[ci(Ut),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Ut,overloads:[[[Ut,Ut],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[ci(Ut),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[Ut,[Ut],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Ut,[qt],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[qt,[qt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[qt,[qt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[qt,ci(Vt),(n,e)=>e.map(r=>cl(r.evaluate(n))).join("")],"resolved-locale":[qt,[Jr],(n,[e])=>e.evaluate(n).resolvedLocale()]});var yl=np;function ip(n){return{result:"success",value:n}}function ds(n){return{result:"error",value:n}}function na(n){return n["property-type"]==="data-driven"}function kc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Ic(n){return!!n.expression&&n.expression.interpolated}function Ht(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function vl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function op(n){return n}function Pc(n,e){const r=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",c=s||!(s||n.property!==void 0),d=n.type||(Ic(e)?"exponential":"interval");if(r&&((n=io({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],Fn.parse(b[1])])),n.default=Fn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!wh[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,_,x;if(d==="exponential")m=ho;else if(d==="interval")m=zc;else if(d==="categorical"){m=sp,_=Object.create(null);for(const b of n.stops)_[b[0]]=b[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);m=ap}if(s){const b={},S=[];for(let D=0;D<n.stops.length;D++){const L=n.stops[D],B=L[0].zoom;b[B]===void 0&&(b[B]={zoom:B,type:n.type,property:n.property,default:n.default,stops:[]},S.push(B)),b[B].stops.push([L[0].value,L[1]])}const M=[];for(const D of S)M.push([b[D].zoom,Pc(b[D],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ui.interpolationFactor.bind(void 0,k),zoomStops:M.map(D=>D[0]),evaluate:({zoom:D},L)=>ho({stops:M,base:n.base},e,D).evaluate(D,L)}}if(c){const b=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:Ui.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(S=>S[0]),evaluate:({zoom:S})=>m(n,e,S,_,x)}}return{kind:"source",evaluate(b,S){const M=S&&S.properties?S.properties[n.property]:void 0;return M===void 0?ra(n.default,e.default):m(n,e,M,_,x)}}}function ra(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function sp(n,e,r,s,c){return ra(typeof r===c?s[r]:void 0,n.default,e.default)}function zc(n,e,r){if(Ht(r)!=="number")return ra(n.default,e.default);const s=n.stops.length;if(s===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[s-1][0])return n.stops[s-1][1];const c=xc(n.stops.map(d=>d[0]),r);return n.stops[c][1]}function ho(n,e,r){const s=n.base!==void 0?n.base:1;if(Ht(r)!=="number")return ra(n.default,e.default);const c=n.stops.length;if(c===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[c-1][0])return n.stops[c-1][1];const d=xc(n.stops.map(S=>S[0]),r),m=function(S,M,k,D){const L=D-k,B=S-k;return L===0?0:M===1?B/L:(Math.pow(M,B)-1)/(Math.pow(M,L)-1)}(r,s,n.stops[d][0],n.stops[d+1][0]),_=n.stops[d][1],x=n.stops[d+1][1];let b=fl[e.type]||op;if(n.colorSpace&&n.colorSpace!=="rgb"){const S=wh[n.colorSpace];b=(M,k)=>S.reverse(S.interpolate(S.forward(M),S.forward(k),m))}return typeof _.evaluate=="function"?{evaluate(...S){const M=_.evaluate.apply(void 0,S),k=x.evaluate.apply(void 0,S);if(M!==void 0&&k!==void 0)return b(M,k,m)}}:b(_,x,m)}function ap(n,e,r){return e.type==="color"?r=Fn.parse(r):e.type==="formatted"?r=Br.fromString(r.toString()):e.type==="resolvedImage"?r=li.fromString(r.toString()):Ht(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ra(r,n.default,e.default)}class Dc{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new ah,this._defaultValue=r?function(s){return s.type==="color"&&(vl(s.default)||Array.isArray(s.default))?new Fn(0,0,0,0):s.type==="color"?Fn.parse(s.default)||null:s.default===void 0?null:s.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,d,m,_,x){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,d,m,_,x){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new fr(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function ia(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in yl}function oa(n,e){const r=new fh(yl,[],e?function(c){const d={color:Kr,string:qt,number:ht,enum:qt,boolean:Ut,formatted:rl,resolvedImage:as};return c.type==="array"?ai(d[c.value]||Vt,c.length):d[c.type]}(e):void 0),s=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?ip(new Dc(s,e)):ds(r.errors)}class Mh{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!co(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,m)}evaluate(e,r,s,c,d,m){return this._styleExpression.evaluate(e,r,s,c,d,m)}}class xl{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!co(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,m)}evaluate(e,r,s,c,d,m){return this._styleExpression.evaluate(e,r,s,c,d,m)}interpolationFactor(e,r,s){return this.interpolationType?Ui.interpolationFactor(this.interpolationType,e,r,s):0}}function wl(n,e){if((n=oa(n,e)).result==="error")return n;const r=n.value.expression,s=Js(r);if(!s&&!na(e))return ds([new Ni("","data expressions not supported")]);const c=us(r,["zoom","pitch","distance-from-center"]);if(!c&&!kc(e))return ds([new Ni("","zoom expressions not supported")]);const d=Rc(r);return d||c?d instanceof Ni?ds([d]):d instanceof Ui&&!Ic(e)?ds([new Ni("",'"interpolate" expressions cannot be used with this property')]):ip(d?new xl(s?"camera":"composite",n.value,d.labels,d instanceof Ui?d.interpolation:void 0):new Mh(s?"constant":"source",n.value)):ds([new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lc{constructor(e,r){this._parameters=e,this._specification=r,io(this,Pc(this._parameters,this._specification))}static deserialize(e){return new Lc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Rc(n){let e=null;if(n instanceof Yf)e=Rc(n.result);else if(n instanceof Eh){for(const r of n.args)if(e=Rc(r),e)break}else(n instanceof mh||n instanceof Ui)&&n.input instanceof ao&&n.input.name==="zoom"&&(e=n);return e instanceof Ni||n.eachChild(r=>{const s=Rc(r);s instanceof Ni?e=s:!e&&s?e=new Ni("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Ni("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class dt{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function Ei(n){const e=n.key,r=n.value,s=n.valueSpec||{},c=n.objectElementValidators||{},d=n.style,m=n.styleSpec;let _=[];const x=Ht(r);if(x!=="object")return[new dt(e,r,`object expected, ${x} found`)];for(const b in r){const S=b.split(".")[0];let M;c[S]?M=c[S]:s[S]?M=Er:c["*"]?M=c["*"]:s["*"]&&(M=Er),M?_=_.concat(M({key:(e&&`${e}.`)+b,value:r[b],valueSpec:s[S]||s["*"],style:d,styleSpec:m,object:r,objectKey:b},r)):_.push(new dt(e,r[b],`unknown property "${b}"`))}for(const b in s)c[b]||s[b].required&&s[b].default===void 0&&r[b]===void 0&&_.push(new dt(e,r,`missing required property "${b}"`));return _}function lp(n){const e=n.value,r=n.valueSpec,s=n.style,c=n.styleSpec,d=n.key,m=n.arrayElementValidator||Er;if(Ht(e)!=="array")return[new dt(d,e,`array expected, ${Ht(e)} found`)];if(r.length&&e.length!==r.length)return[new dt(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new dt(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let _={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};c.$version<7&&(_.function=r.function),Ht(r.value)==="object"&&(_=r.value);let x=[];for(let b=0;b<e.length;b++)x=x.concat(m({array:e,arrayIndex:b,value:e[b],valueSpec:_,style:s,styleSpec:c,key:`${d}[${b}]`}));return x}function bl(n){const e=n.key,r=n.value,s=n.valueSpec;let c=Ht(r);if(c==="number"&&r!=r&&(c="NaN"),c!=="number")return[new dt(e,r,`number expected, ${c} found`)];if("minimum"in s){let d=s.minimum;if(Ht(s.minimum)==="array"&&(d=s.minimum[n.arrayIndex]),r<d)return[new dt(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in s){let d=s.maximum;if(Ht(s.maximum)==="array"&&(d=s.maximum[n.arrayIndex]),r>d)return[new dt(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function El(n){const e=n.valueSpec,r=Vn(n.value.type);let s,c,d,m={};const _=r!=="categorical"&&n.value.property===void 0,x=!_,b=Ht(n.value.stops)==="array"&&Ht(n.value.stops[0])==="array"&&Ht(n.value.stops[0][0])==="object",S=Ei({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(D){if(r==="identity")return[new dt(D.key,D.value,'identity function may not have a "stops" property')];let L=[];const B=D.value;return L=L.concat(lp({key:D.key,value:B,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:M})),Ht(B)==="array"&&B.length===0&&L.push(new dt(D.key,B,"array must have at least one stop")),L},default:function(D){return Er({key:D.key,value:D.value,valueSpec:e,style:D.style,styleSpec:D.styleSpec})}}});return r==="identity"&&_&&S.push(new dt(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||S.push(new dt(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Ic(n.valueSpec)&&S.push(new dt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!na(n.valueSpec)?S.push(new dt(n.key,n.value,"property functions not supported")):_&&!kc(n.valueSpec)&&S.push(new dt(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!b||n.value.property!==void 0||S.push(new dt(n.key,n.value,'"property" property is required')),S;function M(D){let L=[];const B=D.value,$=D.key;if(Ht(B)!=="array")return[new dt($,B,`array expected, ${Ht(B)} found`)];if(B.length!==2)return[new dt($,B,`array length 2 expected, length ${B.length} found`)];if(b){if(Ht(B[0])!=="object")return[new dt($,B,`object expected, ${Ht(B[0])} found`)];if(B[0].zoom===void 0)return[new dt($,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new dt($,B,"object stop key must have value")];const J=Vn(B[0].zoom);if(typeof J!="number")return[new dt($,B[0].zoom,"stop zoom values must be numbers")];if(d&&d>J)return[new dt($,B[0].zoom,"stop zoom values must appear in ascending order")];J!==d&&(d=J,c=void 0,m={}),L=L.concat(Ei({key:`${$}[0]`,value:B[0],valueSpec:{zoom:{}},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{zoom:bl,value:k}}))}else L=L.concat(k({key:`${$}[0]`,value:B[0],valueSpec:{},style:D.style,styleSpec:D.styleSpec},B));return ia(sr(B[1]))?L.concat([new dt(`${$}[1]`,B[1],"expressions are not allowed in function stops.")]):L.concat(Er({key:`${$}[1]`,value:B[1],valueSpec:e,style:D.style,styleSpec:D.styleSpec}))}function k(D,L){const B=Ht(D.value),$=Vn(D.value),J=D.value!==null?D.value:L;if(s){if(B!==s)return[new dt(D.key,J,`${B} stop domain type must match previous stop domain type ${s}`)]}else s=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new dt(D.key,J,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&r!=="categorical"){let ae=`number expected, ${B} found`;return na(e)&&r===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dt(D.key,J,ae)]}return r!=="categorical"||B!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?r!=="categorical"&&B==="number"&&typeof $=="number"&&typeof c=="number"&&c!==void 0&&$<c?[new dt(D.key,J,"stop domain values must appear in ascending order")]:(c=$,r==="categorical"&&$ in m?[new dt(D.key,J,"stop domain values must be unique")]:(m[$]=!0,[])):[new dt(D.key,J,`integer expected, found ${String($)}`)]}}function ar(n){const e=(n.expressionContext==="property"?wl:oa)(sr(n.value),n.valueSpec);if(e.result==="error")return e.value.map(s=>new dt(`${n.key}${s.key}`,n.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new dt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!co(r))return[new dt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return Tl(r,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!us(r,["zoom","feature-state"]))return[new dt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Js(r))return[new dt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tl(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const c of e.valueSpec.expression.parameters)r.delete(c);if(r.size===0)return[];const s=[];return n instanceof ao&&r.has(n.name)?[new dt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(c=>{s.push(...Tl(c,e))}),s)}function Oc(n){const e=n.key,r=n.value,s=n.valueSpec,c=[];return Array.isArray(s.values)?s.values.indexOf(Vn(r))===-1&&c.push(new dt(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Vn(r))===-1&&c.push(new dt(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function kh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!kh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Bc(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};kh(n)||(n=aa(n));const r=n;let s=!0;try{s=function(b){if(!sa(b))return b;let S=sr(b);return Fc(S),S=cp(S),S}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const c=Re[`filter_${e}`],d=oa(s,c);let m=null;if(d.result==="error")throw new Error(d.value.map(b=>`${b.key}: ${b.message}`).join(", "));m=(b,S,M)=>d.value.evaluate(b,S,{},M);let _=null,x=null;if(s!==r){const b=oa(r,c);if(b.result==="error")throw new Error(b.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,M,k,D,L)=>b.value.evaluate(S,M,{},k,void 0,void 0,D,L),x=!Js(b.value.expression)}return{filter:m,dynamicFilter:_||void 0,needGeometry:up(s),needFeature:!!x}}function cp(n){if(!Array.isArray(n))return n;const e=function(r){if(Ih.has(r[0])){for(let s=1;s<r.length;s++)if(sa(r[s]))return!0}return r}(n);return e===!0?e:e.map(r=>cp(r))}function Fc(n){let e=!1;const r=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||sa(n[s]),r.push(n[s+1]);r.push(n[n.length-1])}else if(n[0]==="match"){e=e||sa(n[1]);for(let s=2;s<n.length-1;s+=2)r.push(n[s+1]);r.push(n[n.length-1])}else if(n[0]==="step"){e=e||sa(n[1]);for(let s=1;s<n.length-1;s+=2)r.push(n[s+1])}e&&(n.length=0,n.push("any",...r));for(let s=1;s<n.length;s++)Fc(n[s])}function sa(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<n.length;r++)if(sa(n[r]))return!0;return!1}const Ih=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function __(n,e){return n<e?-1:n>e?1:0}function up(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(up(n[e]))return!0;return!1}function aa(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Ph(n[1],n[2],"=="):e==="!="?Nc(Ph(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ph(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(aa))):e==="all"?["all"].concat(n.slice(1).map(aa)):e==="none"?["all"].concat(n.slice(1).map(aa).map(Nc)):e==="in"?zh(n[1],n.slice(2)):e==="!in"?Nc(zh(n[1],n.slice(2))):e==="has"?Dh(n[1]):e==="!has"?Nc(Dh(n[1])):e!=="within"||n;var r}function Ph(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function zh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(__)]]:["filter-in-small",n,["literal",e]]}}function Dh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Nc(n){return["!",n]}function Sl(n){return kh(sr(n.value))?ar(io({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Cl(n)}function Cl(n){const e=n.value,r=n.key;if(Ht(e)!=="array")return[new dt(r,e,`array expected, ${Ht(e)} found`)];const s=n.styleSpec;let c,d=[];if(e.length<1)return[new dt(r,e,"filter array must have at least 1 element")];switch(d=d.concat(Oc({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:n.style,styleSpec:n.styleSpec})),Vn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Vn(e[1])==="$type"&&d.push(new dt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new dt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=Ht(e[1]),c!=="string"&&d.push(new dt(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=Ht(e[m]),Vn(e[1])==="$type"?d=d.concat(Oc({key:`${r}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:n.style,styleSpec:n.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new dt(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Cl({key:`${r}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":c=Ht(e[1]),e.length!==2?d.push(new dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new dt(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=Ht(e[1]),e.length!==2?d.push(new dt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new dt(`${r}[1]`,e[1],`object expected, ${c} found`))}return d}function Lh(n,e){const r=n.key,s=n.style,c=n.styleSpec,d=n.value,m=n.objectKey,_=c[`${e}_${n.layerType}`];if(!_)return[];const x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&_[x[1]]&&_[x[1]].transition)return Er({key:r,value:d,valueSpec:c.transition,style:s,styleSpec:c});const b=n.valueSpec||_[m];if(!b)return[new dt(r,d,`unknown property "${m}"`)];let S;if(Ht(d)==="string"&&na(b)&&!b.tokens&&(S=/^{([^}]+)}$/.exec(d))){const k=`\`{ "type": "identity", "property": ${S?JSON.stringify(S[1]):'"_"'} }\``;return[new dt(r,d,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${k}.`)]}const M=[];return n.layerType==="symbol"&&(m==="text-field"&&s&&!s.glyphs&&M.push(new dt(r,d,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&vl(sr(d))&&Vn(d.type)==="identity"&&M.push(new dt(r,d,'"text-font" does not support identity functions'))),M.concat(Er({key:n.key,value:d,valueSpec:b,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:m}))}function hp(n){return Lh(n,"paint")}function Rh(n){return Lh(n,"layout")}function dp(n){let e=[];const r=n.value,s=n.key,c=n.style,d=n.styleSpec;r.type||r.ref||e.push(new dt(s,r,'either "type" or "ref" is required'));let m=Vn(r.type);const _=Vn(r.ref);if(r.id){const x=Vn(r.id);for(let b=0;b<n.arrayIndex;b++){const S=c.layers[b];Vn(S.id)===x&&e.push(new dt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${S.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new dt(s,r[b],`"${b}" is prohibited for ref layers`))}),c.layers.forEach(b=>{Vn(b.id)===_&&(x=b)}),x?x.ref?e.push(new dt(s,r.ref,"ref cannot reference another ref layer")):m=Vn(x.type):typeof _=="string"&&e.push(new dt(s,r.ref,`ref layer "${_}" not found`))}else if(m!=="background"&&m!=="sky")if(r.source){const x=c.sources&&c.sources[r.source],b=x&&Vn(x.type);x?b==="vector"&&m==="raster"?e.push(new dt(s,r.source,`layer "${r.id}" requires a raster source`)):b==="raster"&&m!=="raster"?e.push(new dt(s,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&m!=="hillshade"?e.push(new dt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||b==="geojson"&&x.lineMetrics||e.push(new dt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new dt(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new dt(s,r.source,`source "${r.source}" not found`))}else e.push(new dt(s,r,'missing required property "source"'));return e=e.concat(Ei({key:s,value:r,valueSpec:d.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Er({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:x=>Sl(io({layerType:m},x)),layout:x=>Ei({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Rh(io({layerType:m},b))}}),paint:x=>Ei({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>hp(io({layerType:m},b))}})}})),e}function Oo(n){const e=n.value,r=n.key,s=Ht(e);return s!=="string"?[new dt(r,e,`string expected, ${s} found`)]:[]}const fp={promoteId:function({key:n,value:e}){if(Ht(e)==="string")return Oo({key:n,value:e});{const r=[];for(const s in e)r.push(...Oo({key:`${n}.${s}`,value:e[s]}));return r}}};function pp(n){const e=n.value,r=n.key,s=n.styleSpec,c=n.style;if(!e.type)return[new dt(r,e,'"type" is required')];const d=Vn(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Ei({key:r,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:n.style,styleSpec:s,objectElementValidators:fp}),m;case"geojson":if(m=Ei({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:fp}),e.cluster)for(const _ in e.clusterProperties){const[x,b]=e.clusterProperties[_],S=typeof x=="string"?[x,["accumulated"],["get",_]]:x;m.push(...ar({key:`${r}.${_}.map`,value:b,expressionContext:"cluster-map"})),m.push(...ar({key:`${r}.${_}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return m;case"video":return Ei({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return Ei({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new dt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oc({key:`${r}.type`,value:e.type,valueSpec:{values:y_(s)},style:c,styleSpec:s})}}function y_(n){return n.source.reduce((e,r)=>{const s=n[r];return s.type.type==="enum"&&(e=e.concat(Object.keys(s.type.values))),e},[])}function mp(n){const e=n.value,r=n.styleSpec,s=r.light,c=n.style;let d=[];const m=Ht(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new dt("light",e,`object expected, ${m} found`)]),d;for(const _ in e){const x=_.match(/^(.*)-transition$/);d=d.concat(x&&s[x[1]]&&s[x[1]].transition?Er({key:_,value:e[_],valueSpec:r.transition,style:c,styleSpec:r}):s[_]?Er({key:_,value:e[_],valueSpec:s[_],style:c,styleSpec:r}):[new dt(_,e[_],`unknown property "${_}"`)])}return d}function Oh(n){const e=n.value,r=n.key,s=n.style,c=n.styleSpec,d=c.terrain;let m=[];const _=Ht(e);if(e===void 0)return m;if(_!=="object")return m=m.concat([new dt("terrain",e,`object expected, ${_} found`)]),m;for(const x in e){const b=x.match(/^(.*)-transition$/);m=m.concat(b&&d[b[1]]&&d[b[1]].transition?Er({key:x,value:e[x],valueSpec:c.transition,style:s,styleSpec:c}):d[x]?Er({key:x,value:e[x],valueSpec:d[x],style:s,styleSpec:c}):[new dt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=s.sources&&s.sources[e.source],b=x&&Vn(x.type);x?b!=="raster-dem"&&m.push(new dt(r,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):m.push(new dt(r,e.source,`source "${e.source}" not found`))}else m.push(new dt(r,e,'terrain is missing required property "source"'));return m}function gp(n){const e=n.value,r=n.style,s=n.styleSpec,c=s.fog;let d=[];const m=Ht(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new dt("fog",e,`object expected, ${m} found`)]),d;for(const _ in e){const x=_.match(/^(.*)-transition$/);d=d.concat(x&&c[x[1]]&&c[x[1]].transition?Er({key:_,value:e[_],valueSpec:s.transition,style:r,styleSpec:s}):c[_]?Er({key:_,value:e[_],valueSpec:c[_],style:r,styleSpec:s}):[new dt(_,e[_],`unknown property "${_}"`)])}return d}const _p={"*":()=>[],array:lp,boolean:function(n){const e=n.value,r=n.key,s=Ht(e);return s!=="boolean"?[new dt(r,e,`boolean expected, ${s} found`)]:[]},number:bl,color:function(n){const e=n.key,r=n.value,s=Ht(r);return s!=="string"?[new dt(e,r,`color expected, ${s} found`)]:eh(r)===null?[new dt(e,r,`color expected, "${r}" found`)]:[]},enum:Oc,filter:Sl,function:El,layer:dp,object:Ei,source:pp,light:mp,terrain:Oh,fog:gp,string:Oo,formatted:function(n){return Oo(n).length===0?[]:ar(n)},resolvedImage:function(n){return Oo(n).length===0?[]:ar(n)},projection:function(n){const e=n.value,r=n.styleSpec,s=r.projection,c=n.style;let d=[];const m=Ht(e);if(m==="object")for(const _ in e)d=d.concat(Er({key:_,value:e[_],valueSpec:s[_],style:c,styleSpec:r}));else m!=="string"&&(d=d.concat([new dt("projection",e,`object or string expected, ${m} found`)]));return d}};function Er(n){const e=n.value,r=n.valueSpec,s=n.styleSpec;return r.expression&&vl(Vn(e))?El(n):r.expression&&ia(sr(e))?ar(n):r.type&&_p[r.type]?_p[r.type](n):Ei(io({},n,{valueSpec:r.type?s[r.type]:r}))}function v_(n){const e=n.value,r=n.key,s=Oo(n);return s.length||(e.indexOf("{fontstack}")===-1&&s.push(new dt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&s.push(new dt(r,e,'"glyphs" url must include a "{range}" token'))),s}function yp(n,e=Re){return ui(Er({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:v_,"*":()=>[]}}))}const x_=n=>ui(hp(n)),w_=n=>ui(Rh(n));function ui(n){return n.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function vp(n,e){let r=!1;if(e&&e.length)for(const s of e)n.fire(new ro(new Error(s.message))),r=!0;return r}var b_=Vi,Ti=3;function Vi(n,e,r){var s=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var c=new Int32Array(this.arrayBuffer);n=c[0],this.d=(e=c[1])+2*(r=c[2]);for(var d=0;d<this.d*this.d;d++){var m=c[Ti+d],_=c[Ti+d+1];s.push(m===_?null:c.subarray(m,_))}var x=c[Ti+s.length+1];this.keys=c.subarray(c[Ti+s.length],x),this.bboxes=c.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var S=r/e*n;this.min=-S,this.max=n+S}Vi.prototype.insert=function(n,e,r,s,c){this._forEachCell(e,r,s,c,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c)},Vi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Vi.prototype._insertCell=function(n,e,r,s,c,d){this.cells[c].push(d)},Vi.prototype.query=function(n,e,r,s,c){var d=this.min,m=this.max;if(n<=d&&e<=d&&m<=r&&m<=s&&!c)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(n,e,r,s,this._queryCell,_,{},c),_},Vi.prototype._queryCell=function(n,e,r,s,c,d,m,_){var x=this.cells[c];if(x!==null)for(var b=this.keys,S=this.bboxes,M=0;M<x.length;M++){var k=x[M];if(m[k]===void 0){var D=4*k;(_?_(S[D+0],S[D+1],S[D+2],S[D+3]):n<=S[D+2]&&e<=S[D+3]&&r>=S[D+0]&&s>=S[D+1])?(m[k]=!0,d.push(b[k])):m[k]=!1}}},Vi.prototype._forEachCell=function(n,e,r,s,c,d,m,_){for(var x=this._convertToCellCoord(n),b=this._convertToCellCoord(e),S=this._convertToCellCoord(r),M=this._convertToCellCoord(s),k=x;k<=S;k++)for(var D=b;D<=M;D++){var L=this.d*D+k;if((!_||_(this._convertFromCellCoord(k),this._convertFromCellCoord(D),this._convertFromCellCoord(k+1),this._convertFromCellCoord(D+1)))&&c.call(this,n,e,r,s,L,d,m,_))return}},Vi.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Vi.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Vi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=Ti+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var c=new Int32Array(e+r+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,m=0;m<n.length;m++){var _=n[m];c[Ti+m]=d,c.set(_,d),d+=_.length}return c[Ti+n.length]=d,c.set(this.keys,d),c[Ti+n.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};var fs=ue(b_);const jc={};function ft(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),jc[e]={klass:n,omit:r.omit||[]}}ft(Object,"Object"),fs.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},fs.deserialize=function(n){return new fs(n.buffer)},Object.defineProperty(fs,"name",{value:"Grid"}),ft(fs,"Grid"),ft(Fn,"Color"),ft(Error,"Error"),ft(Lo,"AJAXError"),ft(li,"ResolvedImage"),ft(Lc,"StylePropertyFunction"),ft(Dc,"StyleExpression",{omit:["_evaluator"]}),ft(xl,"ZoomDependentExpression"),ft(Mh,"ZoomConstantExpression"),ft(ao,"CompoundExpression",{omit:["_evaluate"]});for(const n in yl)jc[yl[n]._classRegistryKey]||ft(yl[n],`Expression${n}`);function Bh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Fh(n){return z.ImageBitmap&&n instanceof z.ImageBitmap}function la(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Bh(n)||Fh(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof z.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const s of n)r.push(la(s,e));return r}if(typeof n=="object"){const r=n.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const c=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const d in n)n.hasOwnProperty(d)&&(jc[s].omit.indexOf(d)>=0||(c[d]=la(n[d],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof n)}function ps(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Bh(n)||Fh(n)||ArrayBuffer.isView(n)||n instanceof z.ImageData)return n;if(Array.isArray(n))return n.map(ps);if(typeof n=="object"){const e=n.$name||"Object",{klass:r}=jc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const s=Object.create(r.prototype);for(const c of Object.keys(n))c!=="$name"&&(s[c]=ps(n[c]));return s}throw new Error("can't deserialize object of type "+typeof n)}const ut={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Nh(n){for(const e of n)if(jh(e.charCodeAt(0)))return!0;return!1}function E_(n){for(const e of n)if(!xp(e.charCodeAt(0)))return!1;return!0}function xp(n){return!(ut.Arabic(n)||ut["Arabic Supplement"](n)||ut["Arabic Extended-A"](n)||ut["Arabic Presentation Forms-A"](n)||ut["Arabic Presentation Forms-B"](n))}function jh(n){return!(n!==746&&n!==747&&(n<4352||!(ut["Bopomofo Extended"](n)||ut.Bopomofo(n)||ut["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||ut["CJK Compatibility Ideographs"](n)||ut["CJK Compatibility"](n)||ut["CJK Radicals Supplement"](n)||ut["CJK Strokes"](n)||!(!ut["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||ut["CJK Unified Ideographs Extension A"](n)||ut["CJK Unified Ideographs"](n)||ut["Enclosed CJK Letters and Months"](n)||ut["Hangul Compatibility Jamo"](n)||ut["Hangul Jamo Extended-A"](n)||ut["Hangul Jamo Extended-B"](n)||ut["Hangul Jamo"](n)||ut["Hangul Syllables"](n)||ut.Hiragana(n)||ut["Ideographic Description Characters"](n)||ut.Kanbun(n)||ut["Kangxi Radicals"](n)||ut["Katakana Phonetic Extensions"](n)||ut.Katakana(n)&&n!==12540||!(!ut["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!ut["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||ut["Unified Canadian Aboriginal Syllabics"](n)||ut["Unified Canadian Aboriginal Syllabics Extended"](n)||ut["Vertical Forms"](n)||ut["Yijing Hexagram Symbols"](n)||ut["Yi Syllables"](n)||ut["Yi Radicals"](n))))}function wp(n){return!(jh(n)||function(e){return!!(ut["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ut["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ut["Letterlike Symbols"](e)||ut["Number Forms"](e)||ut["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ut["Control Pictures"](e)&&e!==9251||ut["Optical Character Recognition"](e)||ut["Enclosed Alphanumerics"](e)||ut["Geometric Shapes"](e)||ut["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ut["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ut["CJK Symbols and Punctuation"](e)||ut.Katakana(e)||ut["Private Use Area"](e)||ut["CJK Compatibility Forms"](e)||ut["Small Form Variants"](e)||ut["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function bp(n){return n>=1424&&n<=2303||ut["Arabic Presentation Forms-A"](n)||ut["Arabic Presentation Forms-B"](n)}function T_(n,e){return!(!e&&bp(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||ut.Khmer(n))}function S_(n){for(const e of n)if(bp(e.charCodeAt(0)))return!0;return!1}const Uh="deferred",Vh="loading",$h="loaded";let ca=null,h="unavailable",i=null;const l=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(h="error"),ca&&ca(n)};function f(){g.fire(new ss("pluginStateChange",{pluginStatus:h,pluginURL:i}))}const g=new nl,v=function(){return h},E=function(){if(h!==Uh||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Vh,f(),i&&Gs({url:i},n=>{n?l(n):(h=$h,f())})},T={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===$h||T.applyArabicShaping!=null,isLoading:()=>h===Vh,setState(n){h=n.pluginStatus,i=n.pluginURL},isParsed:()=>T.applyArabicShaping!=null&&T.processBidirectionalText!=null&&T.processStyledBidirectionalText!=null,getPluginURL:()=>i};class A{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const c of r)if(!T_(c.charCodeAt(0),s))return!1;return!0}(e,T.isLoaded())}}class P{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(vl(s))return new Lc(s,c);if(ia(s)){const d=wl(s,c);if(d.result==="error")throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=s;return typeof s=="string"&&c.type==="color"&&(d=Fn.parse(s)),{kind:"constant",evaluate:()=>d}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class I{constructor(e){this.property=e,this.value=new P(e,void 0)}transitioned(e,r){return new U(this.property,this.value,r,Bt({},e.transition,this.transition),e.now)}untransitioned(){return new U(this.property,this.value,null,{},0)}}class R{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Hr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].value=new P(this._values[e].property,r===null?void 0:Hr(r))}getTransition(e){return Hr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new I(this._values[e].property)),this._values[e].transition=Hr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const c=this.getTransition(r);c!==void 0&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new q(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new q(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class U{constructor(e,r,s,c,d){const m=c.delay||0,_=c.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+m,this.end=this.begin+_,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,r,s),m=this.prior;if(m){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return m.possiblyEvaluate(e,r,s);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,s),d,Po(_))}}return d}}class q{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new K(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Hr(this._values[e].value)}setValue(e,r){this._values[e]=new P(this._values[e].property,r===null?void 0:Hr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new K(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}}class W{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class O{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const c=fl[this.specification.type];return c?c(e,r,s):e}}class G{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new W(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new W(this,{kind:"constant",value:void 0},e.parameters);const c=fl[this.specification.type];return c?new W(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,d,m){return e.kind==="constant"?e.value:e.evaluate(r,s,c,d,m)}}class te{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class ne{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new A(0,{});for(const s in e){const c=e[s];c.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new P(c,void 0),m=this.defaultTransitionablePropertyValues[s]=new I(c);this.defaultTransitioningPropertyValues[s]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate(r)}}}function pe(n,e){return 256*(n=Ke(Math.floor(n),0,255))+Ke(Math.floor(e),0,255)}ft(G,"DataDrivenProperty"),ft(O,"DataConstantProperty"),ft(te,"ColorRampProperty");const ge={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class me{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class we{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(n,e=1){let r=0,s=0;return{members:n.map(c=>{const d=ge[c.type].BYTES_PER_ELEMENT,m=r=Ae(r,Math.max(e,d)),_=c.components||1;return s=Math.max(s,d),r+=d*_,{name:c.name,type:c.type,components:_,offset:m}}),size:Ae(r,Math.max(s,e)),alignment:e}}function Ae(n,e){return Math.ceil(n/e)*e}class Xe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}Xe.prototype.bytesPerElement=4,ft(Xe,"StructArrayLayout2i4");class Te extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,e}}Te.prototype.bytesPerElement=6,ft(Te,"StructArrayLayout3i6");class Ne extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=c,this.int16[m+3]=d,e}}Ne.prototype.bytesPerElement=8,ft(Ne,"StructArrayLayout4i8");class ke extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,s,c,d,m,_)}emplace(e,r,s,c,d,m,_,x){const b=6*e,S=12*e,M=3*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.uint8[S+4]=c,this.uint8[S+5]=d,this.uint8[S+6]=m,this.uint8[S+7]=_,this.float32[M+2]=x,e}}ke.prototype.bytesPerElement=12,ft(ke,"StructArrayLayout2i4ub1f12");class We extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,this.float32[m+3]=d,e}}We.prototype.bytesPerElement=16,ft(We,"StructArrayLayout4f16");class Ce extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,d)}emplace(e,r,s,c,d,m){const _=6*e,x=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=s,this.uint16[_+2]=c,this.uint16[_+3]=d,this.float32[x+2]=m,e}}Ce.prototype.bytesPerElement=12,ft(Ce,"StructArrayLayout4ui1f12");class Fe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=s,this.uint16[m+2]=c,this.uint16[m+3]=d,e}}Fe.prototype.bytesPerElement=8,ft(Fe,"StructArrayLayout4ui8");class Ye extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,c,d,m)}emplace(e,r,s,c,d,m,_){const x=6*e;return this.int16[x+0]=r,this.int16[x+1]=s,this.int16[x+2]=c,this.int16[x+3]=d,this.int16[x+4]=m,this.int16[x+5]=_,e}}Ye.prototype.bytesPerElement=12,ft(Ye,"StructArrayLayout6i12");class Ge extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_,x,b,S,M,k){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,s,c,d,m,_,x,b,S,M,k)}emplace(e,r,s,c,d,m,_,x,b,S,M,k,D){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=s,this.int16[L+2]=c,this.int16[L+3]=d,this.uint16[L+4]=m,this.uint16[L+5]=_,this.uint16[L+6]=x,this.uint16[L+7]=b,this.int16[L+8]=S,this.int16[L+9]=M,this.int16[L+10]=k,this.int16[L+11]=D,e}}Ge.prototype.bytesPerElement=24,ft(Ge,"StructArrayLayout4i4ui4i24");class Qe extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,s,c,d,m)}emplace(e,r,s,c,d,m,_){const x=10*e,b=5*e;return this.int16[x+0]=r,this.int16[x+1]=s,this.int16[x+2]=c,this.float32[b+2]=d,this.float32[b+3]=m,this.float32[b+4]=_,e}}Qe.prototype.bytesPerElement=20,ft(Qe,"StructArrayLayout3i3f20");class yt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}yt.prototype.bytesPerElement=4,ft(yt,"StructArrayLayout1ul4");class kt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_,x,b,S,M,k,D){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,c,d,m,_,x,b,S,M,k,D)}emplace(e,r,s,c,d,m,_,x,b,S,M,k,D,L){const B=20*e,$=10*e;return this.int16[B+0]=r,this.int16[B+1]=s,this.int16[B+2]=c,this.int16[B+3]=d,this.int16[B+4]=m,this.float32[$+3]=_,this.float32[$+4]=x,this.float32[$+5]=b,this.float32[$+6]=S,this.int16[B+14]=M,this.uint32[$+8]=k,this.uint16[B+18]=D,this.uint16[B+19]=L,e}}kt.prototype.bytesPerElement=40,ft(kt,"StructArrayLayout5i4f1i1ul2ui40");class pt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,s,c,d,m,_)}emplace(e,r,s,c,d,m,_,x){const b=8*e;return this.int16[b+0]=r,this.int16[b+1]=s,this.int16[b+2]=c,this.int16[b+4]=d,this.int16[b+5]=m,this.int16[b+6]=_,this.int16[b+7]=x,e}}pt.prototype.bytesPerElement=16,ft(pt,"StructArrayLayout3i2i2i16");class Et extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,d)}emplace(e,r,s,c,d,m){const _=4*e,x=8*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=c,this.int16[x+6]=d,this.int16[x+7]=m,e}}Et.prototype.bytesPerElement=16,ft(Et,"StructArrayLayout2f1f2i16");class $t extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=12*e,_=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=s,this.float32[_+1]=c,this.float32[_+2]=d,e}}$t.prototype.bytesPerElement=12,ft($t,"StructArrayLayout2ub2f12");class jt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,e}}jt.prototype.bytesPerElement=12,ft(jt,"StructArrayLayout3f12");class gt extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}gt.prototype.bytesPerElement=6,ft(gt,"StructArrayLayout3ui6");class on extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de){const he=this.length;return this.resize(he+1),this.emplace(he,e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de)}emplace(e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de,he){const Me=30*e,Se=15*e,Oe=60*e;return this.int16[Me+0]=r,this.int16[Me+1]=s,this.int16[Me+2]=c,this.float32[Se+2]=d,this.float32[Se+3]=m,this.uint16[Me+8]=_,this.uint16[Me+9]=x,this.uint32[Se+5]=b,this.uint32[Se+6]=S,this.uint32[Se+7]=M,this.uint16[Me+16]=k,this.uint16[Me+17]=D,this.uint16[Me+18]=L,this.float32[Se+10]=B,this.float32[Se+11]=$,this.uint8[Oe+48]=J,this.uint8[Oe+49]=ae,this.uint8[Oe+50]=Q,this.uint32[Se+13]=oe,this.int16[Me+28]=de,this.uint8[Oe+58]=he,e}}on.prototype.bytesPerElement=60,ft(on,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class cn extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de,he,Me,Se,Oe,He,Ie,je,Ue,qe){const tt=this.length;return this.resize(tt+1),this.emplace(tt,e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de,he,Me,Se,Oe,He,Ie,je,Ue,qe)}emplace(e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$,J,ae,Q,oe,de,he,Me,Se,Oe,He,Ie,je,Ue,qe,tt){const Le=38*e,lt=19*e;return this.int16[Le+0]=r,this.int16[Le+1]=s,this.int16[Le+2]=c,this.float32[lt+2]=d,this.float32[lt+3]=m,this.int16[Le+8]=_,this.int16[Le+9]=x,this.int16[Le+10]=b,this.int16[Le+11]=S,this.int16[Le+12]=M,this.int16[Le+13]=k,this.uint16[Le+14]=D,this.uint16[Le+15]=L,this.uint16[Le+16]=B,this.uint16[Le+17]=$,this.uint16[Le+18]=J,this.uint16[Le+19]=ae,this.uint16[Le+20]=Q,this.uint16[Le+21]=oe,this.uint16[Le+22]=de,this.uint16[Le+23]=he,this.uint16[Le+24]=Me,this.uint16[Le+25]=Se,this.uint16[Le+26]=Oe,this.uint16[Le+27]=He,this.uint16[Le+28]=Ie,this.uint32[lt+15]=je,this.float32[lt+16]=Ue,this.float32[lt+17]=qe,this.float32[lt+18]=tt,e}}cn.prototype.bytesPerElement=76,ft(cn,"StructArrayLayout3i2f6i15ui1ul3f76");class un extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}un.prototype.bytesPerElement=4,ft(un,"StructArrayLayout1f4");class hn extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,d)}emplace(e,r,s,c,d,m){const _=5*e;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=c,this.float32[_+3]=d,this.float32[_+4]=m,e}}hn.prototype.bytesPerElement=20,ft(hn,"StructArrayLayout5f20");class Tr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=c,this.uint16[m+4]=d,e}}Tr.prototype.bytesPerElement=12,ft(Tr,"StructArrayLayout1ul3ui12");class lr extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}lr.prototype.bytesPerElement=4,ft(lr,"StructArrayLayout2ui4");class hi extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}hi.prototype.bytesPerElement=2,ft(hi,"StructArrayLayout1ui2");class $i extends we{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}$i.prototype.bytesPerElement=8,ft($i,"StructArrayLayout2f8");class Cn extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Cn.prototype.size=40;class dn extends kt{get(e){return new Cn(this,e)}}ft(dn,"CollisionBoxArray");class Kt extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Kt.prototype.size=60;class $n extends on{get(e){return new Kt(this,e)}}ft($n,"PlacedSymbolArray");class Pr extends me{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pr.prototype.size=76;class En extends cn{get(e){return new Pr(this,e)}}ft(En,"SymbolInstanceArray");class Fr extends un{getoffsetX(e){return this.float32[1*e+0]}}ft(Fr,"GlyphOffsetArray");class Uc extends Xe{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ft(Uc,"SymbolLineVertexArray");class ms extends me{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ms.prototype.size=12;class Al extends Tr{get(e){return new ms(this,e)}}ft(Al,"FeatureIndexArray");class fo extends lr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ft(fo,"FillExtrusionCentroidArray");const Bo=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),gs=xe([{name:"a_dash",components:4,type:"Uint16"}]);var Vc={exports:{}},Ml={exports:{}};Ml.exports=function(n,e){var r,s,c,d,m,_,x,b;for(s=n.length-(r=3&n.length),c=e,m=3432918353,_=461845907,b=0;b<s;)x=255&n.charCodeAt(b)|(255&n.charCodeAt(++b))<<8|(255&n.charCodeAt(++b))<<16|(255&n.charCodeAt(++b))<<24,++b,c=27492+(65535&(d=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&n.charCodeAt(b+2))<<16;case 2:x^=(255&n.charCodeAt(b+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(b)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=n.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Gh=Ml.exports,Kx={exports:{}};Kx.exports=function(n,e){for(var r,s=n.length,c=e^s,d=0;s>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(d)|(255&n.charCodeAt(++d))<<8|(255&n.charCodeAt(++d))<<16|(255&n.charCodeAt(++d))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++d;switch(s){case 3:c^=(255&n.charCodeAt(d+2))<<16;case 2:c^=(255&n.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&n.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Jx=Gh,sA=Kx.exports;Vc.exports=Jx,Vc.exports.murmur3=Jx,Vc.exports.murmur2=sA;var C_=ue(Vc.exports);class Ep{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Qx(e)),this.positions.push(r,s,c)}getPositions(e){const r=Qx(e);let s=0,c=this.ids.length-1;for(;s<c;){const m=s+c>>1;this.ids[m]>=r?c=m:s=m+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return A_(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new Ep;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Qx(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:C_(String(n))}function A_(n,e,r,s){for(;r<s;){const c=n[r+s>>1];let d=r-1,m=s+1;for(;;){do d++;while(n[d]<c);do m--;while(n[m]>c);if(d>=m)break;Tp(n,d,m),Tp(e,3*d,3*m),Tp(e,3*d+1,3*m+1),Tp(e,3*d+2,3*m+2)}m-r<s-m?(A_(n,e,r,m),r=m+1):(A_(n,e,m+1,s),s=m)}}function Tp(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}ft(Ep,"FeaturePositionMap");class _s{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class Sp extends _s{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class e1 extends _s{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class t1 extends _s{constructor(e){super(e),this.current=Fn.transparent}set(e,r,s){this.fetchUniformLocation(e,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const aA=new Float32Array(16),lA=new Float32Array(9),cA=new Float32Array(4);function M_(n){return[pe(255*n.r,255*n.g),pe(255*n.b,255*n.a)]}class qh{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s,c,d){r.set(e,d,c.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new t1(e):new Sp(e)}}class $c{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,s,c,d){const m=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,d,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new e1(e):new Sp(e)}}class ys{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,d,m){const _=this.paintVertexArray.length,x=this.expression.evaluate(new A(0),r,{},d,c,m);this.paintVertexArray.resize(e),this._setPaintValue(_,e,x)}updatePaintArray(e,r,s,c,d){const m=this.expression.evaluate({zoom:0},s,c,void 0,d);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if(this.type==="color"){const c=M_(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class po{constructor(e,r,s,c,d,m){this.expression=e,this.uniformNames=r.map(_=>`u_${_}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,s,c,d,m){const _=this.expression.evaluate(new A(this.zoom),r,{},d,c,m),x=this.expression.evaluate(new A(this.zoom+1),r,{},d,c,m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,_,x)}updatePaintArray(e,r,s,c,d){const m=this.expression.evaluate({zoom:this.zoom},s,c,void 0,d),_=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,d);this._setPaintValue(e,r,m,_)}_setPaintValue(e,r,s,c){if(this.type==="color"){const d=M_(s),m=M_(c);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1],m[0],m[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,s,c,d){const m=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,_=Ke(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(e,d,_)}getBinding(e,r){return new Sp(e)}}class ua{constructor(e,r,s,c,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(s==="array"?gs:Bo).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new c}populatePaintArray(e,r,s){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,d,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,c){if(!c||!s)return;const d=c[s];if(!d)return;const{tl:m,br:_,pixelRatio:x}=d;for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,m[0],m[1],_[0],_[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ha{constructor(e,r,s=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!s(d))continue;const m=e.paint.get(d);if(!(m instanceof W&&na(m.property.specification)))continue;const _=hA(d,e.type),x=m.value,b=m.property.specification.type,S=!!m.property.useIntegerZoom,M=d==="line-dasharray"||d.endsWith("pattern"),k=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||k)if(x.kind==="source"||k||M){const D=n1(d,b,"source");this.binders[d]=M?new ua(x,_,b,D,e.id):new ys(x,_,b,D),c.push(`/a_${d}`)}else{const D=n1(d,b,"composite");this.binders[d]=new po(x,_,b,S,r,D),c.push(`/z_${d}`)}else this.binders[d]=M?new $c(x.value,_):new qh(x.value,_,b),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof ys||r instanceof po?r.maxValue:0}populatePaintArrays(e,r,s,c,d,m){for(const _ in this.binders){const x=this.binders[_];(x instanceof ys||x instanceof po||x instanceof ua)&&x.populatePaintArray(e,r,s,c,d,m)}}setConstantPatternPositions(e){for(const r in this.binders){const s=this.binders[r];s instanceof $c&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,r,s,c,d,m){let _=!1;for(const x in e){const b=r.getPositions(x);for(const S of b){const M=s.feature(S.index);for(const k in this.binders){const D=this.binders[k];if((D instanceof ys||D instanceof po||D instanceof ua)&&D.expression.isStateDependent===!0){const L=c.paint.get(k);D.expression=L.value,D.updatePaintArray(S.start,S.end,M,e[x],d,m),_=!0}}}}return _}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof qh||s instanceof $c)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ys||s instanceof po||s instanceof ua)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof qh||s instanceof $c||s instanceof po)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof qh||c instanceof $c||c instanceof po)for(const d of c.uniformNames)r.push({name:d,property:s,binding:c.getBinding(e,d)})}return r}setUniforms(e,r,s,c,d){for(const{name:m,property:_,binding:x}of s)this.binders[_].setUniform(e,x,d,c.get(_),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof ys||r instanceof po||r instanceof ua)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof ys||s instanceof po||s instanceof ua)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof ys||r instanceof po||r instanceof ua)&&r.destroy()}}}class kl{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new ha(c,r,s);this.needsUpload=!1,this._featureMap=new Ep,this._bufferOffset=0}populatePaintArrays(e,r,s,c,d,m,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,r,c,d,m,_);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c,d){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const uA={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function hA(n,e){return uA[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const dA={"line-pattern":{source:Ce,composite:Ce},"fill-pattern":{source:Ce,composite:Ce},"fill-extrusion-pattern":{source:Ce,composite:Ce},"line-dasharray":{source:Fe,composite:Fe}},fA={color:{source:$i,composite:We},number:{source:un,composite:$i}};function n1(n,e,r){const s=dA[n];return s&&s[r]||fA[e][r]}ft(qh,"ConstantBinder"),ft($c,"PatternConstantBinder"),ft(ys,"SourceExpressionBinder"),ft(ua,"PatternCompositeBinder"),ft(po,"CompositeExpressionBinder"),ft(ha,"ProgramConfiguration",{omit:["_buffers"]}),ft(kl,"ProgramConfigurationSet");const r1="-transition";class mo extends nl{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new X(r.layout)),r.paint)){this._transitionablePaint=new R(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new K(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){r!=null&&this._validate(w_,`layers.${this.id}.layout.${e}`,e,r,s)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return Ns(e,r1)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(r!=null&&this._validate(x_,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(Ns(e,r1))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.value.isDataDriven(),m=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const _=this._transitionablePaint._values[e].value,x=_.isDataDriven(),b=Ns(e,"pattern")||e==="line-dasharray";return x||d||b||this._handleOverridablePaintPropertyUpdate(e,m,_)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),js(e,(r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length))}_validate(e,r,s,c,d={}){return(!d||d.validate!==!1)&&vp(this,e.call(yp,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:Re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof W&&na(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Bc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const pA=xe([{name:"a_pos",components:2,type:"Int16"}],4),mA=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Gn{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let d=this.segments[this.segments.length-1];return e>Gn.MAX_VERTEX_ARRAY_LENGTH&&An(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Gn.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new Gn([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft(Gn,"SegmentVector");var bt=8192;class da{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof fn?new fn(e.lng,e.lat):fn.convert(e),this}setSouthWest(e){return this._sw=e instanceof fn?new fn(e.lng,e.lat):fn.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,d;if(e instanceof fn)c=e,d=e;else{if(!(e instanceof da))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(da.convert(e)):this.extend(fn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(fn.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new fn(c.lng,c.lat),this._ne=new fn(d.lng,d.lat)),this}getCenter(){return new fn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new fn(this.getWest(),this.getNorth())}getSouthEast(){return new fn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=fn.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof da?e:new da(e)}}var Cp=1e-6,di=typeof Float32Array<"u"?Float32Array:Array;function i1(){var n=new di(9);return di!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function o1(n,e,r){var s=e[0],c=e[1],d=e[2],m=e[3],_=e[4],x=e[5],b=e[6],S=e[7],M=e[8],k=r[0],D=r[1],L=r[2],B=r[3],$=r[4],J=r[5],ae=r[6],Q=r[7],oe=r[8];return n[0]=k*s+D*m+L*b,n[1]=k*c+D*_+L*S,n[2]=k*d+D*x+L*M,n[3]=B*s+$*m+J*b,n[4]=B*c+$*_+J*S,n[5]=B*d+$*x+J*M,n[6]=ae*s+Q*m+oe*b,n[7]=ae*c+Q*_+oe*S,n[8]=ae*d+Q*x+oe*M,n}function go(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function k_(n,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=e[4],_=e[5],x=e[6],b=e[7],S=e[8],M=e[9],k=e[10],D=e[11],L=e[12],B=e[13],$=e[14],J=e[15],ae=r*_-s*m,Q=r*x-c*m,oe=r*b-d*m,de=s*x-c*_,he=s*b-d*_,Me=c*b-d*x,Se=S*B-M*L,Oe=S*$-k*L,He=S*J-D*L,Ie=M*$-k*B,je=M*J-D*B,Ue=k*J-D*$,qe=ae*Ue-Q*je+oe*Ie+de*He-he*Oe+Me*Se;return qe?(n[0]=(_*Ue-x*je+b*Ie)*(qe=1/qe),n[1]=(c*je-s*Ue-d*Ie)*qe,n[2]=(B*Me-$*he+J*de)*qe,n[3]=(k*he-M*Me-D*de)*qe,n[4]=(x*He-m*Ue-b*Oe)*qe,n[5]=(r*Ue-c*He+d*Oe)*qe,n[6]=($*oe-L*Me-J*Q)*qe,n[7]=(S*Me-k*oe+D*Q)*qe,n[8]=(m*je-_*He+b*Se)*qe,n[9]=(s*He-r*je-d*Se)*qe,n[10]=(L*he-B*oe+J*ae)*qe,n[11]=(M*oe-S*he-D*ae)*qe,n[12]=(_*Oe-m*Ie-x*Se)*qe,n[13]=(r*Ie-s*Oe+c*Se)*qe,n[14]=(B*Q-L*de-$*ae)*qe,n[15]=(S*de-M*Q+k*ae)*qe,n):null}function Il(n,e,r){var s=e[0],c=e[1],d=e[2],m=e[3],_=e[4],x=e[5],b=e[6],S=e[7],M=e[8],k=e[9],D=e[10],L=e[11],B=e[12],$=e[13],J=e[14],ae=e[15],Q=r[0],oe=r[1],de=r[2],he=r[3];return n[0]=Q*s+oe*_+de*M+he*B,n[1]=Q*c+oe*x+de*k+he*$,n[2]=Q*d+oe*b+de*D+he*J,n[3]=Q*m+oe*S+de*L+he*ae,n[4]=(Q=r[4])*s+(oe=r[5])*_+(de=r[6])*M+(he=r[7])*B,n[5]=Q*c+oe*x+de*k+he*$,n[6]=Q*d+oe*b+de*D+he*J,n[7]=Q*m+oe*S+de*L+he*ae,n[8]=(Q=r[8])*s+(oe=r[9])*_+(de=r[10])*M+(he=r[11])*B,n[9]=Q*c+oe*x+de*k+he*$,n[10]=Q*d+oe*b+de*D+he*J,n[11]=Q*m+oe*S+de*L+he*ae,n[12]=(Q=r[12])*s+(oe=r[13])*_+(de=r[14])*M+(he=r[15])*B,n[13]=Q*c+oe*x+de*k+he*$,n[14]=Q*d+oe*b+de*D+he*J,n[15]=Q*m+oe*S+de*L+he*ae,n}function Zh(n,e,r){var s,c,d,m,_,x,b,S,M,k,D,L,B=r[0],$=r[1],J=r[2];return e===n?(n[12]=e[0]*B+e[4]*$+e[8]*J+e[12],n[13]=e[1]*B+e[5]*$+e[9]*J+e[13],n[14]=e[2]*B+e[6]*$+e[10]*J+e[14],n[15]=e[3]*B+e[7]*$+e[11]*J+e[15]):(c=e[1],d=e[2],m=e[3],_=e[4],x=e[5],b=e[6],S=e[7],M=e[8],k=e[9],D=e[10],L=e[11],n[0]=s=e[0],n[1]=c,n[2]=d,n[3]=m,n[4]=_,n[5]=x,n[6]=b,n[7]=S,n[8]=M,n[9]=k,n[10]=D,n[11]=L,n[12]=s*B+_*$+M*J+e[12],n[13]=c*B+x*$+k*J+e[13],n[14]=d*B+b*$+D*J+e[14],n[15]=m*B+S*$+L*J+e[15]),n}function Pl(n,e,r){var s=r[0],c=r[1],d=r[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function I_(n,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[4],m=e[5],_=e[6],x=e[7],b=e[8],S=e[9],M=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*c+b*s,n[5]=m*c+S*s,n[6]=_*c+M*s,n[7]=x*c+k*s,n[8]=b*c-d*s,n[9]=S*c-m*s,n[10]=M*c-_*s,n[11]=k*c-x*s,n}function Ap(n,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],m=e[1],_=e[2],x=e[3],b=e[8],S=e[9],M=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c-b*s,n[1]=m*c-S*s,n[2]=_*c-M*s,n[3]=x*c-k*s,n[8]=d*s+b*c,n[9]=m*s+S*c,n[10]=_*s+M*c,n[11]=x*s+k*c,n}function s1(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function a1(n,e,r){var s,c,d,m=r[0],_=r[1],x=r[2],b=Math.hypot(m,_,x);return b<Cp?null:(m*=b=1/b,_*=b,x*=b,s=Math.sin(e),c=Math.cos(e),n[0]=m*m*(d=1-c)+c,n[1]=_*m*d+x*s,n[2]=x*m*d-_*s,n[3]=0,n[4]=m*_*d-x*s,n[5]=_*_*d+c,n[6]=x*_*d+m*s,n[7]=0,n[8]=m*x*d+_*s,n[9]=_*x*d-m*s,n[10]=x*x*d+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var gA=Il;function P_(){var n=new di(3);return di!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function l1(n){var e=new di(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Wh(n){return Math.hypot(n[0],n[1],n[2])}function Gc(n,e,r){var s=new di(3);return s[0]=n,s[1]=e,s[2]=r,s}function vs(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function z_(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function c1(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function Xh(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function Hh(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function Si(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function Yh(n,e,r,s){return n[0]=e[0]+r[0]*s,n[1]=e[1]+r[1]*s,n[2]=e[2]+r[2]*s,n}function Nr(n,e){var r=e[0],s=e[1],c=e[2],d=r*r+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function Gi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function D_(n,e,r){var s=e[0],c=e[1],d=e[2],m=r[0],_=r[1],x=r[2];return n[0]=c*x-d*_,n[1]=d*m-s*x,n[2]=s*_-c*m,n}function Nn(n,e,r){var s=e[0],c=e[1],d=e[2],m=r[3]*s+r[7]*c+r[11]*d+r[15];return n[0]=(r[0]*s+r[4]*c+r[8]*d+r[12])/(m=m||1),n[1]=(r[1]*s+r[5]*c+r[9]*d+r[13])/m,n[2]=(r[2]*s+r[6]*c+r[10]*d+r[14])/m,n}function u1(n,e,r){var s=r[0],c=r[1],d=r[2],m=e[0],_=e[1],x=e[2],b=c*x-d*_,S=d*m-s*x,M=s*_-c*m,k=c*M-d*S,D=d*b-s*M,L=s*S-c*b,B=2*r[3];return S*=B,M*=B,D*=2,L*=2,n[0]=m+(b*=B)+(k*=2),n[1]=_+S+D,n[2]=x+M+L,n}var Kh,_o=z_,_A=c1,yA=Wh;function h1(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function d1(n,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=r*r+s*s+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),n[0]=r*m,n[1]=s*m,n[2]=c*m,n[3]=d*m,n}function zl(n,e,r){var s=e[0],c=e[1],d=e[2],m=e[3];return n[0]=r[0]*s+r[4]*c+r[8]*d+r[12]*m,n[1]=r[1]*s+r[5]*c+r[9]*d+r[13]*m,n[2]=r[2]*s+r[6]*c+r[10]*d+r[14]*m,n[3]=r[3]*s+r[7]*c+r[11]*d+r[15]*m,n}function f1(){var n=new di(4);return di!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function p1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function m1(n,e,r){r*=.5;var s=e[0],c=e[1],d=e[2],m=e[3],_=Math.sin(r),x=Math.cos(r);return n[0]=s*x+m*_,n[1]=c*x+d*_,n[2]=d*x-c*_,n[3]=m*x-s*_,n}function g1(n,e,r){r*=.5;var s=e[0],c=e[1],d=e[2],m=e[3],_=Math.sin(r),x=Math.cos(r);return n[0]=s*x-d*_,n[1]=c*x+m*_,n[2]=d*x+s*_,n[3]=m*x-c*_,n}P_(),Kh=new di(4),di!=Float32Array&&(Kh[0]=0,Kh[1]=0,Kh[2]=0,Kh[3]=0);var vA=d1;P_(),Gc(1,0,0),Gc(0,1,0),f1(),f1(),i1();const xA=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_1}=xA,y1=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var Jh=xe([{name:"a_pos",type:"Int16",components:2}]);class L_{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const c=Gi(r,this.dir);if(Math.abs(c)<1e-6)return!1;const d=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/c;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,r,s){if(function(D,L){var B=D[0],$=D[1],J=D[2],ae=L[0],Q=L[1],oe=L[2];return Math.abs(B-ae)<=Cp*Math.max(1,Math.abs(B),Math.abs(ae))&&Math.abs($-Q)<=Cp*Math.max(1,Math.abs($),Math.abs(Q))&&Math.abs(J-oe)<=Cp*Math.max(1,Math.abs(J),Math.abs(oe))}(this.pos,e)||r===0)return s[0]=s[1]=s[2]=0,!1;const[c,d,m]=this.dir,_=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],S=c*c+d*d+m*m,M=2*(_*c+x*d+b*m),k=M*M-4*S*(_*_+x*x+b*b-r*r);if(k<0){const D=Math.max(-M/2,0),L=_+c*D,B=x+d*D,$=b+m*D,J=Math.hypot(L,B,$);return s[0]=L*r/J,s[1]=B*r/J,s[2]=$*r/J,!1}{const D=(-M-Math.sqrt(k))/(2*S);if(D<0){const L=Math.hypot(_,x,b);return s[0]=_*r/L,s[1]=x*r/L,s[2]=b*r/L,!1}return s[0]=_+c*D,s[1]=x+d*D,s[2]=b+m*D,!0}}}class R_{constructor(e,r,s,c,d){this.TL=e,this.TR=r,this.BR=s,this.BL=c,this.horizon=d}static fromInvProjectionMatrix(e,r,s){const c=[-1,1,1],d=[1,1,1],m=[1,-1,1],_=[-1,-1,1],x=Nn(c,c,e),b=Nn(d,d,e),S=Nn(m,m,e),M=Nn(_,_,e);return new R_(x,b,S,M,r/s)}}class O_{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,c){const d=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const b=zl([],x,e),S=1/b[3]/r*d;return function(M,k,D){return M[0]=k[0]*D[0],M[1]=k[1]*D[1],M[2]=k[2]*D[2],M[3]=k[3]*D[3],M}(b,b,[S,S,c?1/b[3]:S,S])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const b=Nr([],D_([],_o([],m[x[0]],m[x[1]]),_o([],m[x[2]],m[x[1]]))),S=-Gi(b,m[x[1]]);return b.concat(S)});return new O_(m,_)}}class jr{static fromPoints(e){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const c of e)Xh(r,r,c),Hh(s,s,c);return new jr(r,s)}static applyTransform(e,r){const s=e.getCorners();for(let c=0;c<s.length;++c)Nn(s[c],s[c],r);return jr.fromPoints(s)}constructor(e,r){this.min=e,this.max=r,this.center=Si([],vs([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=l1(this.min),c=l1(this.max);for(let d=0;d<r.length;d++)s[d]=r[d]?this.min[d]:this.center[d],c[d]=r[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new jr(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let m=0;for(let _=0;_<r.length;_++)m+=Gi(d,r[_])+d[3]>=0;if(m===0)return 0;m!==r.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let _=0;_<e.points.length;_++){const x=e.points[_][c]-this.min[c];d=Math.min(d,x),m=Math.max(m,x)}if(m<0||d>this.max[c]-this.min[c])return 0}return 1}}const B_=5,v1=6,Fo=bt/Math.PI/2,wA=16383,Dl=64,Qh=[Dl,32,16],qi=-Fo,Zi=Fo,bA=[new jr([qi,qi,qi],[Zi,Zi,Zi]),new jr([qi,qi,qi],[0,0,Zi]),new jr([0,qi,qi],[Zi,0,Zi]),new jr([qi,0,qi],[0,Zi,Zi]),new jr([0,0,qi],[Zi,Zi,Zi])];function Mp(n){return n*Fo/nd}function x1(n,e,r,s=!0){const c=Si([],n._camera.position,n.worldSize),d=[e,r,1,1];zl(d,d,n.pixelMatrixInverse),h1(d,d,1/d[3]);const m=Nr([],_o([],d,c)),_=n.globeMatrix,x=[_[12],_[13],_[14]],b=_o([],x,c),S=Wh(b),M=Nr([],b),k=n.worldSize/(2*Math.PI),D=Gi(M,m),L=Math.asin(k/S);if(L<Math.acos(D)){if(!s)return null;const He=[],Ie=[];Si(He,m,S/D),Nr(Ie,_o(Ie,He,b)),Nr(m,vs(m,b,Si(m,Ie,Math.tan(L)*S)))}const B=[];new L_(c,m).closestPointOnSphere(x,k,B);const $=Nr([],zo(_,0)),J=Nr([],zo(_,1)),ae=Nr([],zo(_,2)),Q=Gi($,B),oe=Gi(J,B),de=Gi(ae,B),he=rn(Math.asin(-oe/k));let Me=rn(Math.atan2(Q,de));Me=n.center.lng+function(He,Ie){const je=(Ie-He+180)%360-180;return je<-180?je+360:je}(n.center.lng,Me);const Se=jo(Me),Oe=Ke(Uo(he),0,1);return new Xc(Se,Oe)}class EA{constructor(e,r,s){this.a=_o([],e,s),this.b=_o([],r,s),this.center=s;const c=Nr([],this.a),d=Nr([],this.b);this.angle=Math.acos(Gi(c,d))}}function F_(n,e){if(n.angle===0)return null;let r;return r=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(s,c,d,m){const _=Math.sin(d);return s*(Math.sin((1-m)*d)/_)+c*(Math.sin(m*d)/_)}(n.a[e],n.b[e],n.angle,Ke(r,0,1))+n.center[e]}function No(n){if(n.z<=1)return bA[n.z+2*n.y+n.x];const e=N_(kp(n));return jr.fromPoints(e)}function Ll(n,e,r){return Si(n,n,1-r),Yh(n,n,e,r)}function w1(n,e){const r=Wc(e.zoom);if(r===0)return No(n);const s=kp(n),c=N_(s),d=jo(s.getWest())*e.worldSize,m=jo(s.getEast())*e.worldSize,_=Uo(s.getNorth())*e.worldSize,x=Uo(s.getSouth())*e.worldSize,b=[d,_,0],S=[m,_,0],M=[d,x,0],k=[m,x,0],D=k_([],e.globeMatrix);return Nn(b,b,D),Nn(S,S,D),Nn(M,M,D),Nn(k,k,D),c[0]=Ll(c[0],M,r),c[1]=Ll(c[1],k,r),c[2]=Ll(c[2],S,r),c[3]=Ll(c[3],b,r),jr.fromPoints(c)}function b1(n,e,r){for(const s of n)Nn(s,s,e),Si(s,s,r)}function TA(n,e,r){const s=e/n.worldSize,c=n.globeMatrix;if(r.z<=1){const Se=No(r).getCorners();return b1(Se,c,s),jr.fromPoints(Se)}const d=kp(r),m=N_(d);b1(m,c,s);const _=Number.MAX_VALUE,x=[-_,-_,-_],b=[_,_,_];if(d.contains(n.center)){for(const He of m)Xh(b,b,He),Hh(x,x,He);x[2]=0;const Se=n.point,Oe=[Se.x*s,Se.y*s,0];return Xh(b,b,Oe),Hh(x,x,Oe),new jr(b,x)}const S=[c[12]*s,c[13]*s,c[14]*s],M=d.getCenter(),k=Ke(n.center.lat,-Cr,Cr),D=Ke(M.lat,-Cr,Cr),L=jo(n.center.lng),B=Uo(k);let $=L-jo(M.lng);const J=B-Uo(D);$>.5?$-=1:$<-.5&&($+=1);let ae=0;Math.abs($)>Math.abs(J)?ae=$>=0?1:3:(ae=J>=0?0:2,Yh(S,S,[c[4]*s,c[5]*s,c[6]*s],-Math.sin(At(J>=0?d.getSouth():d.getNorth()))*Fo));const Q=m[ae],oe=m[(ae+1)%4],de=new EA(Q,oe,S),he=[F_(de,0)||Q[0],F_(de,1)||Q[1],F_(de,2)||Q[2]],Me=Wc(n.zoom);if(Me>0){const Se=function({x:He,y:Ie,z:je},Ue,qe,tt,Le){const lt=1/(1<<je);let mt=He*lt,ct=mt+lt,It=Ie*lt,nt=It+lt,vt=0;const Pt=(mt+ct)/2-tt;return Pt>.5?vt=-1:Pt<-.5&&(vt=1),mt=((mt+vt)*Ue-(tt*=Ue))*qe+tt,ct=((ct+vt)*Ue-tt)*qe+tt,It=(It*Ue-(Le*=Ue))*qe+Le,nt=(nt*Ue-Le)*qe+Le,[[mt,nt,0],[ct,nt,0],[ct,It,0],[mt,It,0]]}(r,e,n._pixelsPerMercatorPixel,L,B);for(let He=0;He<m.length;He++)Ll(m[He],Se[He],Me);const Oe=vs([],Se[ae],Se[(ae+1)%4]);Si(Oe,Oe,.5),Ll(he,Oe,Me)}for(const Se of m)Xh(b,b,Se),Hh(x,x,Se);return b[2]=Math.min(Q[2],oe[2]),Xh(b,b,he),Hh(x,x,he),new jr(b,x)}function kp({x:n,y:e,z:r}){const s=1/(1<<r),c=new fn(Ci(n*s),Sr((e+1)*s)),d=new fn(Ci((n+1)*s),Sr(e*s));return new da(c,d)}function N_(n){const e=At(n.getNorth()),r=At(n.getSouth()),s=Math.cos(e),c=Math.cos(r),d=Math.sin(e),m=Math.sin(r),_=n.getWest(),x=n.getEast();return[qc(c,m,_),qc(c,m,x),qc(s,d,x),qc(s,d,_)]}function qc(n,e,r,s=Fo){return r=At(r),[n*Math.sin(r)*s,-e*s,n*Math.cos(r)*s]}function Zc(n,e,r){return qc(Math.cos(At(n)),Math.sin(At(n)),e,r)}function ed(n,e,r,s){const c=1<<r.z,d=(n/bt+r.x)/c;return Zc(Sr((e/bt+r.y)/c),Ci(d),s)}function Ip({min:n,max:e}){return wA/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const E1=new Float64Array(16);function td(n){const e=Ip(n),r=s1(E1,[e,e,e]);return Zh(r,r,((s=[])[0]=-(c=n.min)[0],s[1]=-c[1],s[2]=-c[2],s));var s,c}function j_(n){const e=(s=n.min,(r=E1)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=s[0],r[13]=s[1],r[14]=s[2],r[15]=1,r);var r,s;const c=1/Ip(n);return Pl(e,e,[c,c,c])}function T1(n,e,r,s,c){const d=function(x){const b=bt/(2*Math.PI);return x/(2*Math.PI)/b}(r),m=[n,e,-r/(2*Math.PI)],_=go(new Float64Array(16));return Zh(_,_,m),Pl(_,_,[d,d,d]),I_(_,_,At(-c)),Ap(_,_,At(-s)),_}function Wc(n){return Mt(B_,v1,n)}function S1(n,e){const r=Zc(e.lat,e.lng),s=function(L){const B=Zc(L._center.lat,L._center.lng);let $=D_([],Gc(0,1,0),B);const J=a1([],-L.angle,B);$=Nn($,$,J),a1(J,-L._pitch,$);const ae=Nr([],B);return Si(ae,ae,Mp(L.cameraToCenterDistance/L.pixelsPerMeter)),Nn(ae,ae,J),vs([],B,ae)}(n);return m=(c=z_([],s,r))[0],_=c[1],x=c[2],b=(d=r)[0],S=d[1],M=d[2],D=(k=Math.sqrt(m*m+_*_+x*x)*Math.sqrt(b*b+S*S+M*M))&&Gi(c,d)/k,Math.acos(Math.min(Math.max(D,-1),1));var c,d,m,_,x,b,S,M,k,D}function U_(n,e){return S1(n,e)>Math.PI/2*1.01}const C1=At(85),SA=Math.cos(C1),CA=Math.sin(C1),nd=63710088e-1,A1=2*Math.PI*nd;class fa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new fa(Tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return nd*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new da(new fa(this.lng-s,this.lat-r),new fa(this.lng+s,this.lat+r))}toEcef(e){const r=Mp(e);return Zc(this.lat,this.lng,Fo+r)}static convert(e){if(e instanceof fa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new fa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new fa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var fn=fa;function V_(n){return A1*Math.cos(n*Math.PI/180)}function jo(n){return(180+n)/360}function Uo(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function yo(n,e){return n/V_(e)}function Ci(n){return 360*n-180}function Sr(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function M1(n,e){return n*V_(Sr(e))}const Cr=85.051129;function k1(n){return 1/Math.cos(n*Math.PI/180)}class Xc{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=fn.convert(e);return new Xc(jo(s.lng),Uo(s.lat),yo(r,s.lat))}toLngLat(){return new fn(Ci(this.x),Sr(this.y))}toAltitude(){return M1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/A1*k1(Sr(this.y))}}function $_(n,e,r,s,c,d,m,_,x){const b=(e+s)/2,S=(r+c)/2,M=new De(b,S);_(M),function(k,D,L,B,$,J){const ae=L-$,Q=B-J;return Math.abs((B-D)*ae-(L-k)*Q)/Math.hypot(ae,Q)}(M.x,M.y,d.x,d.y,m.x,m.y)>=x?($_(n,e,r,b,S,d,M,_,x),$_(n,b,S,s,c,M,m,_,x)):n.push(m)}function I1(n,e,r){let s=n[0],c=s.x,d=s.y;e(s);const m=[s];for(let _=1;_<n.length;_++){const x=n[_],{x:b,y:S}=x;e(x),$_(m,c,d,b,S,s,x,e,r),c=b,d=S,s=x}return m}function G_(n,e,r,s){if(s(e,r)){const c=e.add(r)._mult(.5);G_(n,e,c,s),G_(n,c,r,s)}else n.push(r)}function AA(n,e){let r=n[0];const s=[r];for(let c=1;c<n.length;c++){const d=n[c];G_(s,r,d,e),r=d}return s}const q_=Math.pow(2,14)-1,P1=-q_-1;function MA(n,e){const r=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=Ke(r,P1,q_),n.y=Ke(s,P1,q_),(r<n.x||r>n.x+1||s<n.y||s>n.y+1)&&An("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function xs(n,e,r){const s=n.loadGeometry(),c=n.extent,d=bt/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:_,x,y:b,projection:S}=r,M=k=>{const D=Ci((e.x+k.x/c)/m),L=Sr((e.y+k.y/c)/m),B=S.project(D,L);k.x=(B.x*_-x)*c,k.y=(B.y*_-b)*c};for(let k=0;k<s.length;k++)if(n.type!==1)s[k]=I1(s[k],M,1);else{const D=[];for(const L of s[k])L.x<0||L.x>=c||L.y<0||L.y>=c||(M(L),D.push(L));s[k]=D}}for(const m of s)for(const _ of m)MA(_,d);return s}function Rl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?xs(n):[]}}function Pp(n,e,r,s,c){n.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}function zp(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Z_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xe,this.indexArray=new gt,this.segments=new Gn,this.programConfigurations=new kl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){const d=this.layers[0],m=[];let _=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(const{feature:b,id:S,index:M,sourceLayerIndex:k}of e){const D=this.layers[0]._featureFilter.needGeometry,L=Rl(b,D);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),L,s))continue;const B=_?_.evaluate(L,{},s):void 0,$={id:S,properties:b.properties,type:b.type,sourceLayerIndex:k,index:M,geometry:D?L.geometry:xs(b,s,c),patterns:{},sortKey:B};m.push($)}_&&m.sort((b,S)=>b.sortKey-S.sortKey);let x=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Ye,x=c.projection);for(const b of m){const{geometry:S,index:M,sourceLayerIndex:k}=b,D=e[M].feature;this.addFeature(b,S,M,r.availableImages,s,x),r.featureIndex.insert(D,S,M,k,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mA.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,c,d,m){for(const _ of r)for(const x of _){const b=x.x,S=x.y;if(b<0||b>=bt||S<0||S>=bt)continue;if(m){const D=m.projectTilePoint(b,S,d),L=m.upVector(d,b,S),B=this.globeExtVertexArray;zp(B,D,L),zp(B,D,L),zp(B,D,L),zp(B,D,L)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=M.vertexLength;Pp(this.layoutVertexArray,b,S,-1,-1),Pp(this.layoutVertexArray,b,S,1,-1),Pp(this.layoutVertexArray,b,S,1,1),Pp(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,d)}}function z1(n,e){for(let r=0;r<n.length;r++)if(Ol(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Ol(n,e[r]))return!0;return!!W_(n,e)}function kA(n,e,r){return!!Ol(n,e)||!!X_(e,n,r)}function D1(n,e){if(n.length===1)return R1(e,n[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(Ol(n,s[c]))return!0}for(let r=0;r<n.length;r++)if(R1(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(W_(n,e[r]))return!0;return!1}function IA(n,e,r){if(n.length>1){if(W_(n,e))return!0;for(let s=0;s<e.length;s++)if(X_(e[s],n,r))return!0}for(let s=0;s<n.length;s++)if(X_(n[s],e,r))return!0;return!1}function W_(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const s=n[r],c=n[r+1];for(let d=0;d<e.length-1;d++)if(PA(s,c,e[d],e[d+1]))return!0}return!1}function PA(n,e,r,s){return oi(n,r,s)!==oi(e,r,s)&&oi(n,e,r)!==oi(n,e,s)}function X_(n,e,r){const s=r*r;if(e.length===1)return n.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(L1(n,e[c-1],e[c])<s)return!0;return!1}function L1(n,e,r){const s=e.distSqr(r);if(s===0)return n.distSqr(e);const c=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/s;return n.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function R1(n,e){let r,s,c,d=!1;for(let m=0;m<n.length;m++){r=n[m];for(let _=0,x=r.length-1;_<r.length;x=_++)s=r[_],c=r[x],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function Ol(n,e){let r=!1;for(let s=0,c=n.length-1;s<n.length;c=s++){const d=n[s],m=n[c];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(r=!r)}return r}function O1(n,e,r,s,c){for(const m of n)if(e<=m.x&&r<=m.y&&s>=m.x&&c>=m.y)return!0;const d=[new De(e,r),new De(e,c),new De(s,c),new De(s,r)];if(n.length>2){for(const m of d)if(Ol(n,m))return!0}for(let m=0;m<n.length-1;m++)if(zA(n[m],n[m+1],d))return!0;return!1}function zA(n,e,r){const s=r[0],c=r[2];if(n.x<s.x&&e.x<s.x||n.x>c.x&&e.x>c.x||n.y<s.y&&e.y<s.y||n.y>c.y&&e.y>c.y)return!1;const d=oi(n,e,r[0]);return d!==oi(n,e,r[1])||d!==oi(n,e,r[2])||d!==oi(n,e,r[3])}function Hc(n,e,r){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Dp(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function B1(n,e,r,s,c){if(!e[0]&&!e[1])return n;const d=De.convert(e)._mult(c);r==="viewport"&&d._rotate(-s);const m=[];for(let _=0;_<n.length;_++)m.push(n[_].sub(d));return m}function F1(n,e,r,s){const c=De.convert(n)._mult(s);return e==="viewport"&&c._rotate(-r),c}ft(Z_,"CircleBucket",{omit:["layers"]});const DA=new ne({"circle-sort-key":new G(Re.layout_circle["circle-sort-key"])});var LA={paint:new ne({"circle-radius":new G(Re.paint_circle["circle-radius"]),"circle-color":new G(Re.paint_circle["circle-color"]),"circle-blur":new G(Re.paint_circle["circle-blur"]),"circle-opacity":new G(Re.paint_circle["circle-opacity"]),"circle-translate":new O(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new O(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new O(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new O(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new G(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new G(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new G(Re.paint_circle["circle-stroke-opacity"])}),layout:DA};function N1(n,e,r,s,c,d,m,_,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const b=n.tileID.canonical,S=r.projection.upVectorScale(b,r.center.lat,r.worldSize).metersToTile;for(const M of e)for(const k of M){const D=k.add(_),L=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(D.x,D.y,!0):0,B=r.projection.projectTilePoint(D.x,D.y,b);if(L>0){const Q=r.projection.upVector(b,D.x,D.y);B.x+=Q[0]*S*L,B.y+=Q[1]*S*L,B.z+=Q[2]*S*L}const $=d?D:RA(B.x,B.y,B.z,s),J=d?n.tilespaceRays.map(Q=>BA(Q,L)):n.queryGeometry.screenGeometry,ae=zl([],[B.x,B.y,B.z,1],s);if(!m&&d?x*=ae[3]/r.cameraToCenterDistance:m&&!d&&(x*=r.cameraToCenterDistance/ae[3]),d){const Q=Sr((k.y/bt+b.y)/(1<<b.z));x/=r.projection.pixelsPerMeter(Q,1)/yo(1,Q)}if(kA(J,$,x))return!0}return!1}function RA(n,e,r,s){const c=zl([],[n,e,r,1],s);return new De(c[0]/c[3],c[1]/c[3])}const j1=Gc(0,0,0),OA=Gc(0,0,1);function BA(n,e){const r=P_();return j1[2]=e,n.intersectsPlane(j1,OA,r),new De(r[0],r[1])}class U1 extends Z_{}function V1(n,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*s);return n.width=e,n.height=r,n.data=c,n}function $1(n,e,r){const{width:s,height:c}=e;s===n.width&&c===n.height||(H_(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,c)},r),n.width=s,n.height=c,n.data=e.data)}function H_(n,e,r,s,c,d){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||r.x>n.width-c.width||r.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,_=e.data;for(let x=0;x<c.height;x++){const b=((r.y+x)*n.width+r.x)*d,S=((s.y+x)*e.width+s.x)*d;for(let M=0;M<c.width*d;M++)_[S+M]=m[b+M]}return e}ft(U1,"HeatmapBucket",{omit:["layers"]});class ws{constructor(e,r){V1(this,e,1,r)}resize(e){$1(this,new ws(e),1)}clone(){return new ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){H_(e,r,s,c,d,1)}}class fi{constructor(e,r){V1(this,e,4,r)}resize(e){$1(this,new fi(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new fi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){H_(e,r,s,c,d,4)}}ft(ws,"AlphaImage"),ft(fi,"RGBAImage");var FA={paint:new ne({"heatmap-radius":new G(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new G(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new O(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new te(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new O(Re.paint_heatmap["heatmap-opacity"])})};function Y_(n){const e={},r=n.resolution||256,s=n.clips?n.clips.length:1,c=n.image||new fi({width:r,height:s}),d=(m,_,x)=>{e[n.evaluationKey]=x;const b=n.expression.evaluate(e);c.data[m+_+0]=Math.floor(255*b.r/b.a),c.data[m+_+1]=Math.floor(255*b.g/b.a),c.data[m+_+2]=Math.floor(255*b.b/b.a),c.data[m+_+3]=Math.floor(255*b.a)};if(n.clips)for(let m=0,_=0;m<s;++m,_+=4*r)for(let x=0,b=0;x<r;x++,b+=4){const S=x/(r-1),{start:M,end:k}=n.clips[m];d(_,b,M*(1-S)+k*S)}else for(let m=0,_=0;m<r;m++,_+=4)d(0,_,m/(r-1));return c}var NA={paint:new ne({"hillshade-illumination-direction":new O(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new O(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new O(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new O(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new O(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new O(Re.paint_hillshade["hillshade-accent-color"])})};const jA=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:UA}=jA;var K_={exports:{}};function Lp(n,e,r){r=r||2;var s,c,d,m,_,x,b,S=e&&e.length,M=S?e[0]*r:n.length,k=G1(n,0,M,r,!0),D=[];if(!k||k.next===k.prev)return D;if(S&&(k=function(B,$,J,ae){var Q,oe,de,he=[];for(Q=0,oe=$.length;Q<oe;Q++)(de=G1(B,$[Q]*ae,Q<oe-1?$[Q+1]*ae:B.length,ae,!1))===de.next&&(de.steiner=!0),he.push(HA(de));for(he.sort(ZA),Q=0;Q<he.length;Q++)J=WA(he[Q],J);return J}(n,e,k,r)),n.length>80*r){s=d=n[0],c=m=n[1];for(var L=r;L<M;L+=r)(_=n[L])<s&&(s=_),(x=n[L+1])<c&&(c=x),_>d&&(d=_),x>m&&(m=x);b=(b=Math.max(d-s,m-c))!==0?32767/b:0}return rd(k,D,r,s,c,b,0),D}function G1(n,e,r,s,c){var d,m;if(c===ey(n,e,r,s)>0)for(d=e;d<r;d+=s)m=W1(d,n[d],n[d+1],m);else for(d=r-s;d>=e;d-=s)m=W1(d,n[d],n[d+1],m);return m&&Rp(m,m.next)&&(od(m),m=m.next),m}function Bl(n,e){if(!n)return n;e||(e=n);var r,s=n;do if(r=!1,s.steiner||!Rp(s,s.next)&&qn(s.prev,s,s.next)!==0)s=s.next;else{if(od(s),(s=e=s.prev)===s.next)break;r=!0}while(r||s!==e);return e}function rd(n,e,r,s,c,d,m){if(n){!m&&d&&function(S,M,k,D){var L=S;do L.z===0&&(L.z=J_(L.x,L.y,M,k,D)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==S);L.prevZ.nextZ=null,L.prevZ=null,function(B){var $,J,ae,Q,oe,de,he,Me,Se=1;do{for(J=B,B=null,oe=null,de=0;J;){for(de++,ae=J,he=0,$=0;$<Se&&(he++,ae=ae.nextZ);$++);for(Me=Se;he>0||Me>0&&ae;)he!==0&&(Me===0||!ae||J.z<=ae.z)?(Q=J,J=J.nextZ,he--):(Q=ae,ae=ae.nextZ,Me--),oe?oe.nextZ=Q:B=Q,Q.prevZ=oe,oe=Q;J=ae}oe.nextZ=null,Se*=2}while(de>1)}(L)}(n,s,c,d);for(var _,x,b=n;n.prev!==n.next;)if(_=n.prev,x=n.next,d?$A(n,s,c,d):VA(n))e.push(_.i/r|0),e.push(n.i/r|0),e.push(x.i/r|0),od(n),n=x.next,b=x.next;else if((n=x)===b){m?m===1?rd(n=GA(Bl(n),e,r),e,r,s,c,d,2):m===2&&qA(n,e,r,s,c,d):rd(Bl(n),e,r,s,c,d,1);break}}}function VA(n){var e=n.prev,r=n,s=n.next;if(qn(e,r,s)>=0)return!1;for(var c=e.x,d=r.x,m=s.x,_=e.y,x=r.y,b=s.y,S=c<d?c<m?c:m:d<m?d:m,M=_<x?_<b?_:b:x<b?x:b,k=c>d?c>m?c:m:d>m?d:m,D=_>x?_>b?_:b:x>b?x:b,L=s.next;L!==e;){if(L.x>=S&&L.x<=k&&L.y>=M&&L.y<=D&&Yc(c,_,d,x,m,b,L.x,L.y)&&qn(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function $A(n,e,r,s){var c=n.prev,d=n,m=n.next;if(qn(c,d,m)>=0)return!1;for(var _=c.x,x=d.x,b=m.x,S=c.y,M=d.y,k=m.y,D=_<x?_<b?_:b:x<b?x:b,L=S<M?S<k?S:k:M<k?M:k,B=_>x?_>b?_:b:x>b?x:b,$=S>M?S>k?S:k:M>k?M:k,J=J_(D,L,e,r,s),ae=J_(B,$,e,r,s),Q=n.prevZ,oe=n.nextZ;Q&&Q.z>=J&&oe&&oe.z<=ae;){if(Q.x>=D&&Q.x<=B&&Q.y>=L&&Q.y<=$&&Q!==c&&Q!==m&&Yc(_,S,x,M,b,k,Q.x,Q.y)&&qn(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,oe.x>=D&&oe.x<=B&&oe.y>=L&&oe.y<=$&&oe!==c&&oe!==m&&Yc(_,S,x,M,b,k,oe.x,oe.y)&&qn(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Q&&Q.z>=J;){if(Q.x>=D&&Q.x<=B&&Q.y>=L&&Q.y<=$&&Q!==c&&Q!==m&&Yc(_,S,x,M,b,k,Q.x,Q.y)&&qn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;oe&&oe.z<=ae;){if(oe.x>=D&&oe.x<=B&&oe.y>=L&&oe.y<=$&&oe!==c&&oe!==m&&Yc(_,S,x,M,b,k,oe.x,oe.y)&&qn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function GA(n,e,r){var s=n;do{var c=s.prev,d=s.next.next;!Rp(c,d)&&q1(c,s,s.next,d)&&id(c,d)&&id(d,c)&&(e.push(c.i/r|0),e.push(s.i/r|0),e.push(d.i/r|0),od(s),od(s.next),s=n=d),s=s.next}while(s!==n);return Bl(s)}function qA(n,e,r,s,c,d){var m=n;do{for(var _=m.next.next;_!==m.prev;){if(m.i!==_.i&&YA(m,_)){var x=Z1(m,_);return m=Bl(m,m.next),x=Bl(x,x.next),rd(m,e,r,s,c,d,0),void rd(x,e,r,s,c,d,0)}_=_.next}m=m.next}while(m!==n)}function ZA(n,e){return n.x-e.x}function WA(n,e){var r=function(c,d){var m,_=d,x=c.x,b=c.y,S=-1/0;do{if(b<=_.y&&b>=_.next.y&&_.next.y!==_.y){var M=_.x+(b-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(M<=x&&M>S&&(S=M,m=_.x<_.next.x?_:_.next,M===x))return m}_=_.next}while(_!==d);if(!m)return null;var k,D=m,L=m.x,B=m.y,$=1/0;_=m;do x>=_.x&&_.x>=L&&x!==_.x&&Yc(b<B?x:S,b,L,B,b<B?S:x,b,_.x,_.y)&&(k=Math.abs(b-_.y)/(x-_.x),id(_,c)&&(k<$||k===$&&(_.x>m.x||_.x===m.x&&XA(m,_)))&&(m=_,$=k)),_=_.next;while(_!==D);return m}(n,e);if(!r)return e;var s=Z1(r,n);return Bl(s,s.next),Bl(r,r.next)}function XA(n,e){return qn(n.prev,n,e.prev)<0&&qn(e.next,n,n.next)<0}function J_(n,e,r,s,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function HA(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Yc(n,e,r,s,c,d,m,_){return(c-m)*(e-_)>=(n-m)*(d-_)&&(n-m)*(s-_)>=(r-m)*(e-_)&&(r-m)*(d-_)>=(c-m)*(s-_)}function YA(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&q1(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(n,e)&&(id(n,e)&&id(e,n)&&function(r,s){var c=r,d=!1,m=(r.x+s.x)/2,_=(r.y+s.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&m<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==r);return d}(n,e)&&(qn(n.prev,n,e.prev)||qn(n,e.prev,e))||Rp(n,e)&&qn(n.prev,n,n.next)>0&&qn(e.prev,e,e.next)>0)}function qn(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Rp(n,e){return n.x===e.x&&n.y===e.y}function q1(n,e,r,s){var c=Bp(qn(n,e,r)),d=Bp(qn(n,e,s)),m=Bp(qn(r,s,n)),_=Bp(qn(r,s,e));return c!==d&&m!==_||!(c!==0||!Op(n,r,e))||!(d!==0||!Op(n,s,e))||!(m!==0||!Op(r,n,s))||!(_!==0||!Op(r,e,s))}function Op(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Bp(n){return n>0?1:n<0?-1:0}function id(n,e){return qn(n.prev,n,n.next)<0?qn(n,e,n.next)>=0&&qn(n,n.prev,e)>=0:qn(n,e,n.prev)<0||qn(n,n.next,e)<0}function Z1(n,e){var r=new Q_(n.i,n.x,n.y),s=new Q_(e.i,e.x,e.y),c=n.next,d=e.prev;return n.next=e,e.prev=n,r.next=c,c.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function W1(n,e,r,s){var c=new Q_(n,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function od(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Q_(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ey(n,e,r,s){for(var c=0,d=e,m=r-s;d<r;d+=s)c+=(n[m]-n[d])*(n[d+1]+n[m+1]),m=d;return c}K_.exports=Lp,K_.exports.default=Lp,Lp.deviation=function(n,e,r,s){var c=e&&e.length,d=Math.abs(ey(n,0,c?e[0]*r:n.length,r));if(c)for(var m=0,_=e.length;m<_;m++)d-=Math.abs(ey(n,e[m]*r,m<_-1?e[m+1]*r:n.length,r));var x=0;for(m=0;m<s.length;m+=3){var b=s[m]*r,S=s[m+1]*r,M=s[m+2]*r;x+=Math.abs((n[b]-n[M])*(n[S+1]-n[b+1])-(n[b]-n[S])*(n[M+1]-n[b+1]))}return d===0&&x===0?0:Math.abs((x-d)/d)},Lp.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<n.length;c++){for(var d=0;d<n[c].length;d++)for(var m=0;m<e;m++)r.vertices.push(n[c][d][m]);c>0&&r.holes.push(s+=n[c-1].length)}return r};var ty=ue(K_.exports);function KA(n,e,r,s,c){X1(n,e,r||0,s||n.length-1,c||JA)}function X1(n,e,r,s,c){for(;s>r;){if(s-r>600){var d=s-r+1,m=e-r+1,_=Math.log(d),x=.5*Math.exp(2*_/3),b=.5*Math.sqrt(_*x*(d-x)/d)*(m-d/2<0?-1:1);X1(n,e,Math.max(r,Math.floor(e-m*x/d+b)),Math.min(s,Math.floor(e+(d-m)*x/d+b)),c)}var S=n[e],M=r,k=s;for(sd(n,r,e),c(n[s],S)>0&&sd(n,r,s);M<k;){for(sd(n,M,k),M++,k--;c(n[M],S)<0;)M++;for(;c(n[k],S)>0;)k--}c(n[r],S)===0?sd(n,r,k):sd(n,++k,s),k<=e&&(r=k+1),e<=k&&(s=k-1)}}function sd(n,e,r){var s=n[e];n[e]=n[r],n[r]=s}function JA(n,e){return n<e?-1:n>e?1:0}function ny(n,e){const r=n.length;if(r<=1)return[n];const s=[];let c,d;for(let m=0;m<r;m++){const _=cc(n[m]);_!==0&&(n[m].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(c&&s.push(c),c=[n[m]]):c.push(n[m]))}if(c&&s.push(c),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(KA(s[m],e,1,s[m].length-1,QA),s[m]=s[m].slice(0,e));return s}function QA(n,e){return e.area-n.area}function ry(n,e,r){const s=r.patternDependencies;let c=!1;for(const d of e){const m=d.paint.get(`${n}-pattern`);m.isConstant()||(c=!0);const _=m.constantOr(null);_&&(c=!0,s[_]=!0)}return c}function iy(n,e,r,s,c){const d=c.patternDependencies;for(const m of e){const _=m.paint.get(`${n}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:s},r,{},c.availableImages);x=x&&x.name?x.name:x,d[x]=!0,r.patterns[m.id]=x}}return r}class Fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new gt,this.indexArray2=new lr,this.programConfigurations=new kl(e.layers,e.zoom),this.segments=new Gn,this.segments2=new Gn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,s,c){this.hasPattern=ry("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:_,id:x,index:b,sourceLayerIndex:S}of e){const M=this.layers[0]._featureFilter.needGeometry,k=Rl(_,M);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),k,s))continue;const D=d?d.evaluate(k,{},s,r.availableImages):void 0,L={id:x,properties:_.properties,type:_.type,sourceLayerIndex:S,index:b,geometry:M?k.geometry:xs(_,s,c),patterns:{},sortKey:D};m.push(L)}d&&m.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of m){const{geometry:x,index:b,sourceLayerIndex:S}=_;if(this.hasPattern){const M=iy("fill",this.layers,_,this.zoom,r);this.patternFeatures.push(M)}else this.addFeature(_,x,b,s,{},r.availableImages);r.featureIndex.insert(e[b].feature,x,b,S,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,UA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,d,m=[]){for(const _ of ny(r,500)){let x=0;for(const L of _)x+=L.length;const b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),S=b.vertexLength,M=[],k=[];for(const L of _){if(L.length===0)continue;L!==_[0]&&k.push(M.length/2);const B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),$=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack($+L.length-1,$),M.push(L[0].x),M.push(L[0].y);for(let J=1;J<L.length;J++)this.layoutVertexArray.emplaceBack(L[J].x,L[J].y),this.indexArray2.emplaceBack($+J-1,$+J),M.push(L[J].x),M.push(L[J].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}const D=ty(M,k);for(let L=0;L<D.length;L+=3)this.indexArray.emplaceBack(S+D[L],S+D[L+1],S+D[L+2]);b.vertexLength+=x,b.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}}ft(Fp,"FillBucket",{omit:["layers","patternFeatures"]});const eM=new ne({"fill-sort-key":new G(Re.layout_fill["fill-sort-key"])});var tM={paint:new ne({"fill-antialias":new O(Re.paint_fill["fill-antialias"]),"fill-opacity":new G(Re.paint_fill["fill-opacity"]),"fill-color":new G(Re.paint_fill["fill-color"]),"fill-outline-color":new G(Re.paint_fill["fill-outline-color"]),"fill-translate":new O(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new O(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new G(Re.paint_fill["fill-pattern"])}),layout:eM};const nM=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),rM=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iM=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oM}=nM;var Np={},sM=rt,H1=Kc;function Kc(n,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=s,this._values=c,n.readFields(aM,this,e)}function aM(n,e,r){n==1?e.id=r.readVarint():n==2?function(s,c){for(var d=s.readVarint()+s.pos;s.pos<d;){var m=c._keys[s.readVarint()],_=c._values[s.readVarint()];c.properties[m]=_}}(r,e):n==3?e.type=r.readVarint():n==4&&(e._geometry=r.pos)}function lM(n){for(var e,r,s=0,c=0,d=n.length,m=d-1;c<d;m=c++)s+=((r=n[m]).x-(e=n[c]).x)*(e.y+r.y);return s}Kc.types=["Unknown","Point","LineString","Polygon"],Kc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,s=1,c=0,d=0,m=0,_=[];n.pos<r;){if(c<=0){var x=n.readVarint();s=7&x,c=x>>3}if(c--,s===1||s===2)d+=n.readSVarint(),m+=n.readSVarint(),s===1&&(e&&_.push(e),e=[]),e.push(new sM(d,m));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Kc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,s=0,c=0,d=0,m=1/0,_=-1/0,x=1/0,b=-1/0;n.pos<e;){if(s<=0){var S=n.readVarint();r=7&S,s=S>>3}if(s--,r===1||r===2)(c+=n.readSVarint())<m&&(m=c),c>_&&(_=c),(d+=n.readSVarint())<x&&(x=d),d>b&&(b=d);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,_,b]},Kc.prototype.toGeoJSON=function(n,e,r){var s,c,d=this.extent*Math.pow(2,r),m=this.extent*n,_=this.extent*e,x=this.loadGeometry(),b=Kc.types[this.type];function S(D){for(var L=0;L<D.length;L++){var B=D[L];D[L]=[360*(B.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(s=0;s<x.length;s++)M[s]=x[s][0];S(x=M);break;case 2:for(s=0;s<x.length;s++)S(x[s]);break;case 3:for(x=function(D){var L=D.length;if(L<=1)return[D];for(var B,$,J=[],ae=0;ae<L;ae++){var Q=lM(D[ae]);Q!==0&&($===void 0&&($=Q<0),$===Q<0?(B&&J.push(B),B=[D[ae]]):B.push(D[ae]))}return B&&J.push(B),J}(x),s=0;s<x.length;s++)for(c=0;c<x[s].length;c++)S(x[s][c])}x.length===1?x=x[0]:b="Multi"+b;var k={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(k.id=this.id),k};var cM=H1,Y1=K1;function K1(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(uM,this,e),this.length=this._features.length}function uM(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(s){for(var c=null,d=s.readVarint()+s.pos;s.pos<d;){var m=s.readVarint()>>3;c=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}return c}(r))}K1.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new cM(this._pbf,e,this.extent,this._keys,this._values)};var hM=Y1;function dM(n,e,r){if(n===3){var s=new hM(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}var oy=Np.VectorTile=function(n,e){this.layers=n.readFields(dM,{},e)},jp=Np.VectorTileFeature=H1;function Up(n,e,r,s){const c=[],d=s===0?(m,_,x,b,S,M)=>{m.push(new De(M,x+(M-_)/(b-_)*(S-x)))}:(m,_,x,b,S,M)=>{m.push(new De(_+(M-x)/(S-x)*(b-_),M))};for(const m of n){const _=[];for(const x of m){if(x.length<=2)continue;const b=[];for(let k=0;k<x.length-1;k++){const D=x[k].x,L=x[k].y,B=x[k+1].x,$=x[k+1].y,J=s===0?D:L,ae=s===0?B:$;J<e?ae>e&&d(b,D,L,B,$,e):J>r?ae<r&&d(b,D,L,B,$,r):b.push(x[k]),ae<e&&J>=e&&d(b,D,L,B,$,e),ae>r&&J<=r&&d(b,D,L,B,$,r)}let S=x[x.length-1];const M=s===0?S.x:S.y;M>=e&&M<=r&&b.push(S),b.length&&(S=b[b.length-1],b[0].x===S.x&&b[0].y===S.y||b.push(b[0]),_.push(b))}_.length&&c.push(_)}return c}Np.VectorTileLayer=Y1;const fM=jp.types,pM=Math.pow(2,13);function ad(n,e,r,s,c,d,m,_){n.emplaceBack((e<<1)+m,(r<<1)+d,(Math.floor(s*pM)<<1)+c,Math.round(_))}function ld(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class J1{constructor(){this.acc=new De(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new De(e.x,e.y),this.max=new De(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,c=this.max;e.x<s.x?s.x=e.x:e.x>c.x&&(c.x=e.x),e.y<s.y?s.y=e.y:e.y>c.y&&(c.y=e.y),((e.x===0||e.x===bt)&&e.x===r.x)!=((e.y===0||e.y===bt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Xt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>bt!=e.x>bt&&this.addBorderIntersection(1,Xt(r.y,e.y,(bt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Xt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>bt!=e.y>bt&&this.addBorderIntersection(3,Xt(r.x,e.x,(bt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return e!==0?this.acc.div(e)._round():new De(0,0)}span(){return new De(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class cd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Ne,this.centroidVertexArray=new fo,this.indexArray=new gt,this.programConfigurations=new kl(e.layers,e.zoom),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,c){this.features=[],this.hasPattern=ry("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/bt/(1<<d.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:m,index:_,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,S=Rl(d,b);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),S,s))continue;const M={id:m,sourceLayerIndex:x,index:_,geometry:b?S.geometry:xs(d,s,c),properties:d.properties,type:d.type,patterns:{}},k=this.layoutVertexArray.length;this.hasPattern?this.features.push(iy("fill-extrusion",this.layers,M,this.zoom,r)):this.addFeature(M,M.geometry,_,s,{},r.availableImages,c),r.featureIndex.insert(d,M.geometry,_,x,this.index,k)}this.sortBorders()}addFeatures(e,r,s,c,d){for(const m of this.features){const{geometry:_}=m;this.addFeature(m,_,m.index,r,s,c,d)}this.sortBorders()}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,iM.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rM.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,d,m,_){const x=[new De(0,0),new De(bt,bt)],b=_.projection,S=b.name==="globe",M=this.enableTerrain&&!S?new J1:null,k=fM[e.type]==="Polygon";S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ye);const D=ny(r,500);for(let J=D.length-1;J>=0;J--){const ae=D[J];(ae.length===0||(L=ae[0]).every(Q=>Q.x<=0)||L.every(Q=>Q.x>=bt)||L.every(Q=>Q.y<=0)||L.every(Q=>Q.y>=bt))&&D.splice(J,1)}var L;let B;if(S)B=ow(D,x,c);else{B=[];for(const J of D)B.push({polygon:J,bounds:x})}const $=k?this.edgeRadius:0;for(const{polygon:J,bounds:ae}of B){let Q=0,oe=0;for(const he of J)k&&!he[0].equals(he[he.length-1])&&he.push(he[0]),oe+=k?he.length-1:he.length;const de=this.segments.prepareSegment((k?5:4)*oe,this.layoutVertexArray,this.indexArray);if(k){const he=[],Me=[];Q=de.vertexLength;for(const Oe of J){let He,Ie;Oe.length&&Oe!==J[0]&&Me.push(he.length/2),He=Oe[1].sub(Oe[0])._perp()._unit();for(let je=1;je<Oe.length;je++){const Ue=Oe[je],qe=Oe[je===Oe.length-1?1:je+1];let{x:tt,y:Le}=Ue;if($){Ie=qe.sub(Ue)._perp()._unit();const lt=He.add(Ie)._unit(),mt=$*Math.min(4,1/(He.x*lt.x+He.y*lt.y));tt+=mt*lt.x,Le+=mt*lt.y,He=Ie}ad(this.layoutVertexArray,tt,Le,0,0,1,1,0),de.vertexLength++,he.push(Ue.x,Ue.y),S&&ld(this.layoutVertexExtArray,b.projectTilePoint(tt,Le,c),b.upVector(c,tt,Le))}}const Se=ty(he,Me);for(let Oe=0;Oe<Se.length;Oe+=3)this.indexArray.emplaceBack(Q+Se[Oe],Q+Se[Oe+2],Q+Se[Oe+1]),de.primitiveLength++}for(const he of J){M&&he.length&&M.startRing(he[0]);let Me,Se,Oe,He=he.length>4&&nw(he[he.length-2],he[0],he[1]),Ie=$?mM(he[he.length-2],he[0],he[1],$):0;Se=he[1].sub(he[0])._perp()._unit();let je=!0;for(let Ue=1,qe=0;Ue<he.length;Ue++){let tt=he[Ue-1],Le=he[Ue];const lt=he[Ue===he.length-1?1:Ue+1];if(M&&k&&M.currentPolyCount.top++,tw(Le,tt,ae)){$&&(Se=lt.sub(Le)._perp()._unit(),je=!je);continue}M&&M.append(Le,tt);const mt=Le.sub(tt)._perp(),ct=mt.x/(Math.abs(mt.x)+Math.abs(mt.y)),It=mt.y>0?1:0,nt=tt.dist(Le);if(qe+nt>32768&&(qe=0),$){Oe=lt.sub(Le)._perp()._unit();let zt=ew(tt,Le,lt,Q1(Se,Oe),$);isNaN(zt)&&(zt=0);const St=Le.sub(tt)._unit();tt=tt.add(St.mult(Ie))._round(),Le=Le.add(St.mult(-zt))._round(),Ie=zt,Se=Oe}const vt=de.vertexLength,Pt=he.length>4&&nw(tt,Le,lt);let Yt=rw(qe,He,je);if(ad(this.layoutVertexArray,tt.x,tt.y,ct,It,0,0,Yt),ad(this.layoutVertexArray,tt.x,tt.y,ct,It,0,1,Yt),qe+=nt,Yt=rw(qe,Pt,!je),He=Pt,ad(this.layoutVertexArray,Le.x,Le.y,ct,It,0,0,Yt),ad(this.layoutVertexArray,Le.x,Le.y,ct,It,0,1,Yt),de.vertexLength+=4,this.indexArray.emplaceBack(vt+0,vt+1,vt+2),this.indexArray.emplaceBack(vt+1,vt+3,vt+2),de.primitiveLength+=2,$){const zt=Q+(Ue===1?he.length-2:Ue-2),St=Ue===1?Q:zt+1;if(this.indexArray.emplaceBack(vt+1,zt,vt+3),this.indexArray.emplaceBack(zt,St,vt+3),de.primitiveLength+=2,Me===void 0&&(Me=vt),!tw(lt,he[Ue],ae)){const bn=Ue===he.length-1?Me:de.vertexLength;this.indexArray.emplaceBack(vt+2,vt+3,bn),this.indexArray.emplaceBack(vt+3,bn+1,bn),this.indexArray.emplaceBack(vt+3,St,bn+1),de.primitiveLength+=3}je=!je}if(S){const zt=this.layoutVertexExtArray,St=b.projectTilePoint(tt.x,tt.y,c),bn=b.projectTilePoint(Le.x,Le.y,c),Rt=b.upVector(c,tt.x,tt.y),Ot=b.upVector(c,Le.x,Le.y);ld(zt,St,Rt),ld(zt,St,Rt),ld(zt,bn,Ot),ld(zt,bn,Ot)}}k&&(Q+=he.length-1)}}if(M&&M.polyCount.length>0){if(M.borders){M.vertexArrayOffset=this.centroidVertexArray.length;const J=M.borders,ae=this.featuresOnBorder.push(M)-1;for(let Q=0;Q<4;Q++)J[Q][0]!==Number.MAX_VALUE&&this.borders[Q].push(ae)}this.encodeCentroid(M.borders?void 0:M.centroid(),M)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let c,d;if(e)if(e.y!==0){const _=r.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(_.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(_.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+s;let m=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const _ of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*_.edges+_.top);for(let x=0;x<_.top;x++)this.centroidVertexArray.emplace(m++,c,d);for(let x=0;x<2*_.edges;x++)this.centroidVertexArray.emplace(m++,0,d),this.centroidVertexArray.emplace(m++,c,d)}}}function Q1(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function mM(n,e,r,s){const c=e.sub(n)._perp()._unit(),d=r.sub(e)._perp()._unit();return ew(n,e,r,Q1(c,d),s)}function ew(n,e,r,s,c){const d=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(r)/3,c*d/s)}function tw(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function nw(n,e,r){if(n.x<0||n.x>=bt||e.x<0||e.x>=bt||r.x<0||r.x>=bt)return!1;const s=r.sub(e),c=s.perp(),d=n.sub(e);return(s.x*d.x+s.y*d.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(d.x*d.x+d.y*d.y))>-.866&&c.x*d.x+c.y*d.y<0}function rw(n,e,r){const s=e?2|n:-3&n;return r?1|s:-2&s}function iw(){const n=Math.PI/32,e=Math.tan(n),r=nd;return r*Math.sqrt(1+2*e*e)-r}function ow(n,e,r){const s=1<<r.z,c=Ci(r.x/s),d=Ci((r.x+1)/s),m=Sr(r.y/s),_=Sr((r.y+1)/s);return function(x,b,S,M,k=0,D){const L=[];if(!x.length||!S||!M)return L;const B=(he,Me)=>{for(const Se of he)L.push({polygon:Se,bounds:Me})},$=Math.ceil(Math.log2(S)),J=Math.ceil(Math.log2(M)),ae=$-J,Q=[];for(let he=0;he<Math.abs(ae);he++)Q.push(ae>0?0:1);for(let he=0;he<Math.min($,J);he++)Q.push(0),Q.push(1);let oe=x;if(oe=Up(oe,b[0].y-k,b[1].y+k,1),oe=Up(oe,b[0].x-k,b[1].x+k,0),!oe.length)return L;const de=[];for(Q.length?de.push({polygons:oe,bounds:b,depth:0}):B(oe,b);de.length;){const he=de.pop(),Me=he.depth,Se=Q[Me],Oe=he.bounds[0],He=he.bounds[1],Ie=Se===0?Oe.x:Oe.y,je=Se===0?He.x:He.y,Ue=D?D(Se,Ie,je):.5*(Ie+je),qe=Up(he.polygons,Ie-k,Ue+k,Se),tt=Up(he.polygons,Ue-k,je+k,Se);if(qe.length){const Le=[Oe,new De(Se===0?Ue:He.x,Se===1?Ue:He.y)];Q.length>Me+1?de.push({polygons:qe,bounds:Le,depth:Me+1}):B(qe,Le)}if(tt.length){const Le=[new De(Se===0?Ue:Oe.x,Se===1?Ue:Oe.y),He];Q.length>Me+1?de.push({polygons:tt,bounds:Le,depth:Me+1}):B(tt,Le)}}return L}(n,e,Math.ceil((d-c)/11.25),Math.ceil((m-_)/11.25),1,(x,b,S)=>{if(x===0)return .5*(b+S);{const M=Sr((r.y+b/bt)/s);return(Uo(.5*(Sr((r.y+S/bt)/s)+M))*s-r.y)*bt}})}ft(cd,"FillExtrusionBucket",{omit:["layers","features"]}),ft(J1,"PartMetadata");const gM=new ne({"fill-extrusion-edge-radius":new O(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var _M={paint:new ne({"fill-extrusion-opacity":new O(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new G(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new O(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new O(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new G(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new G(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new G(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new O(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new O(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new O(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new O(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:gM};function sw(n,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Vp{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=ud(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=function(d,m,_){var x=sw(256*d,256*(m=Math.pow(2,_)-m-1),_),b=sw(256*(d+1),256*(m+1),_);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),c=function(d,m,_){let x,b="";for(let S=d;S>0;S--)x=1<<S-1,b+=(m&x?1:0)+(_&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class aw{constructor(e,r){this.wrap=e,this.canonical=r,this.key=ud(e,r.z,r.z,r.x,r.y)}}class Ur{constructor(e,r,s,c,d){this.overscaledZ=e,this.wrap=r,this.canonical=new Vp(s,+c,+d),this.key=r===0&&e===s?this.canonical.key:ud(r,e,s,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Ur(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ur(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return ud(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return ud(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Ur(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Ur(r,this.wrap,r,s,c),new Ur(r,this.wrap,r,s+1,c),new Ur(r,this.wrap,r,s,c+1),new Ur(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ur(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ur(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new aw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ud(n,e,r,s,c){const d=1<<Math.min(r,22);let m=d*(c%d)+s%d;return n&&r<22&&(m+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}ft(Vp,"CanonicalTileID"),ft(Ur,"OverscaledTileID",{omit:["projMatrix"]});class Jc extends De{constructor(e,r,s){super(e,r),this.z=s}}function hd(n,e){return n.x*e.x+n.y*e.y}function lw(n,e){if(n.length===1){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const d=e[r],m=n[0],_=c.sub(s),x=d.sub(s),b=m.sub(s),S=hd(_,_),M=hd(_,x),k=hd(x,x),D=hd(b,_),L=hd(b,x),B=S*k-M*M,$=(k*D-M*L)/B,J=(S*L-M*D)/B,ae=s.z*(1-$-J)+c.z*$+d.z*J;if(isFinite(ae))return ae}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function cw(n,e,r,s,c,d,m,_){const x=m*c.getElevationAt(n,e,!0,!0),b=d[0]!==0,S=b?d[1]===0?m*(d[0]/7-450):m*function(M,k,D){const L=Math.floor(k[0]/8),B=Math.floor(k[1]/8),$=10*(k[0]-8*L),J=10*(k[1]-8*B),ae=M.getElevationAt(L,B,!0,!0),Q=M.getMeterToDEM(D),oe=Math.floor(.5*($*Q-1)),de=Math.floor(.5*(J*Q-1)),he=M.tileCoordToPixel(L,B),Me=2*oe+1,Se=2*de+1,Oe=function(tt,Le,lt,mt,ct){return[tt.getElevationAtPixel(Le,lt,!0),tt.getElevationAtPixel(Le+ct,lt,!0),tt.getElevationAtPixel(Le,lt+ct,!0),tt.getElevationAtPixel(Le+mt,lt+ct,!0)]}(M,he.x-oe,he.y-de,Me,Se),He=Math.abs(Oe[0]-Oe[1]),Ie=Math.abs(Oe[2]-Oe[3]),je=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),Ue=Math.min(.25,.5*Q*(He+Ie)/Me),qe=Math.min(.25,.5*Q*je/Se);return ae+Math.max(Ue*$,qe*J)}(c,d,_):x;return{base:x+(r===0)?-1:r,top:b?Math.max(S+s,x+r+2):x+s}}const yM=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vM}=yM,xM=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:wM}=xM,bM=jp.types,EM=Math.cos(Math.PI/180*37.5);class $p{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new ke,this.layoutVertexArray2=new We,this.indexArray=new gt,this.programConfigurations=new kl(e.layers,e.zoom),this.segments=new Gn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){this.hasPattern=ry("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:S,id:M,index:k,sourceLayerIndex:D}of e){const L=this.layers[0]._featureFilter.needGeometry,B=Rl(S,L);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),B,s))continue;const $=d?d.evaluate(B,{},s):void 0,J={id:M,properties:S.properties,type:S.type,sourceLayerIndex:D,index:k,geometry:L?B.geometry:xs(S,s,c),patterns:{},sortKey:$};m.push(J)}d&&m.sort((S,M)=>S.sortKey-M.sortKey);const{lineAtlas:_,featureIndex:x}=r,b=this.addConstantDashes(_);for(const S of m){const{geometry:M,index:k,sourceLayerIndex:D}=S;if(b&&this.addFeatureDashes(S,_),this.hasPattern){const L=iy("line",this.layers,S,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(S,M,k,s,_.positions,r.availableImages);x.insert(e[k].feature,M,k,D,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")r=!0;else{const m=d.value,_=c.value;if(!_)continue;e.addDash(_,m)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if(d.kind==="constant"&&m.kind==="constant")continue;let _,x;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:s},e);x=m.kind==="constant"?m.value:m.evaluate({zoom:s},e),r.addDash(_,x),e.patterns[c.id]=r.getKey(_,x)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,s,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wM)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vM),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,d,m){const _=this.layers[0].layout,x=_.get("line-join").evaluate(e,{}),b=_.get("line-cap").evaluate(e,{}),S=_.get("line-miter-limit"),M=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of r)this.addLine(k,e,x,b,S,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}addLine(e,r,s,c,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<e.length-1;J++)this.totalDistance+=e[J].dist(e[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=bM[r.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(_?3:2))return;s==="bevel"&&(d=1.05);const S=this.overscaling<=16?15*bt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let k,D,L,B,$;this.e1=this.e2=-1,_&&(k=e[x-2],$=e[b].sub(k)._unit()._perp());for(let J=b;J<x;J++){if(L=J===x-1?_?e[b+1]:void 0:e[J+1],L&&e[J].equals(L))continue;$&&(B=$),k&&(D=k),k=e[J],$=L?L.sub(k)._unit()._perp():B,B=B||$;let ae=B.add($);ae.x===0&&ae.y===0||ae._unit();const Q=B.x*$.x+B.y*$.y,oe=ae.x*$.x+ae.y*$.y,de=oe!==0?1/oe:1/0,he=2*Math.sqrt(2-2*oe),Me=oe<EM&&D&&L,Se=B.x*$.y-B.y*$.x>0;if(Me&&J>b){const Ie=k.dist(D);if(Ie>2*S){const je=k.sub(k.sub(D)._mult(S/Ie)._round());this.updateDistance(D,je),this.addCurrentVertex(je,B,0,0,M),D=je}}const Oe=D&&L;let He=Oe?s:_?"butt":c;if(Oe&&He==="round"&&(de<m?He="miter":de<=2&&(He="fakeround")),He==="miter"&&de>d&&(He="bevel"),He==="bevel"&&(de>2&&(He="flipbevel"),de<d&&(He="miter")),D&&this.updateDistance(D,k),He==="miter")ae._mult(de),this.addCurrentVertex(k,ae,0,0,M);else if(He==="flipbevel"){if(de>100)ae=$.mult(-1);else{const Ie=de*B.add($).mag()/B.sub($).mag();ae._perp()._mult(Ie*(Se?-1:1))}this.addCurrentVertex(k,ae,0,0,M),this.addCurrentVertex(k,ae.mult(-1),0,0,M)}else if(He==="bevel"||He==="fakeround"){const Ie=-Math.sqrt(de*de-1),je=Se?Ie:0,Ue=Se?0:Ie;if(D&&this.addCurrentVertex(k,B,je,Ue,M),He==="fakeround"){const qe=Math.round(180*he/Math.PI/20);for(let tt=1;tt<qe;tt++){let Le=tt/qe;if(Le!==.5){const mt=Le-.5;Le+=Le*mt*(Le-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*mt*mt+(.848013+Q*(.215638*Q-1.06021)))}const lt=$.sub(B)._mult(Le)._add(B)._unit()._mult(Se?-1:1);this.addHalfVertex(k,lt.x,lt.y,!1,Se,0,M)}}L&&this.addCurrentVertex(k,$,-je,-Ue,M)}else if(He==="butt")this.addCurrentVertex(k,ae,0,0,M);else if(He==="square"){const Ie=D?1:-1;D||this.addCurrentVertex(k,ae,Ie,Ie,M),this.addCurrentVertex(k,ae,0,0,M),D&&this.addCurrentVertex(k,ae,Ie,Ie,M)}else He==="round"&&(D&&(this.addCurrentVertex(k,B,0,0,M),this.addCurrentVertex(k,B,1,1,M,!0)),L&&(this.addCurrentVertex(k,$,-1,-1,M,!0),this.addCurrentVertex(k,$,0,0,M)));if(Me&&J<x-1){const Ie=k.dist(L);if(Ie>2*S){const je=k.add(L.sub(k)._mult(S/Ie)._round());this.updateDistance(k,je),this.addCurrentVertex(je,$,0,0,M),k=je}}}}addCurrentVertex(e,r,s,c,d,m=!1){const _=r.y*c-r.x,x=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,m,!1,s,d),this.addHalfVertex(e,_,x,m,!0,-c,d)}addHalfVertex({x:e,y:r},s,c,d,m,_,x){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),m?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}ft($p,"LineBucket",{omit:["layers","patternFeatures"]});const TM=new ne({"line-cap":new G(Re.layout_line["line-cap"]),"line-join":new G(Re.layout_line["line-join"]),"line-miter-limit":new O(Re.layout_line["line-miter-limit"]),"line-round-limit":new O(Re.layout_line["line-round-limit"]),"line-sort-key":new G(Re.layout_line["line-sort-key"])});var uw={paint:new ne({"line-opacity":new G(Re.paint_line["line-opacity"]),"line-color":new G(Re.paint_line["line-color"]),"line-translate":new O(Re.paint_line["line-translate"]),"line-translate-anchor":new O(Re.paint_line["line-translate-anchor"]),"line-width":new G(Re.paint_line["line-width"]),"line-gap-width":new G(Re.paint_line["line-gap-width"]),"line-offset":new G(Re.paint_line["line-offset"]),"line-blur":new G(Re.paint_line["line-blur"]),"line-dasharray":new G(Re.paint_line["line-dasharray"]),"line-pattern":new G(Re.paint_line["line-pattern"]),"line-gradient":new te(Re.paint_line["line-gradient"]),"line-trim-offset":new O(Re.paint_line["line-trim-offset"])}),layout:TM};const hw=new class extends G{possiblyEvaluate(n,e){return e=new A(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,s){return e=Bt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,s)}}(uw.paint.properties["line-width"].specification);function dw(n,e){return e>0?e+2*n:n}hw.useIntegerZoom=!0;const SM=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),CM=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),AM=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const MM=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),kM=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fw=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),IM=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var pr=24;const vo=128;function sy(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new A(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let d=0;for(;d<s.length&&s[d]<=n;)d++;d=Math.max(0,d-1);let m=d;for(;m<s.length&&s[m]<n+1;)m++;m=Math.min(s.length-1,m);const _=s[d],x=s[m];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:r.evaluate(new A(_)),maxSize:r.evaluate(new A(x)),interpolationType:c}}}function Gp(n,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return n.kind==="source"?s/vo:n.kind==="composite"?Xt(s/vo,c/vo,r):e}function Qc(n,e){let r=0,s=0;if(n.kind==="constant")s=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:m}=n,_=c?Ke(Ui.interpolationFactor(c,e,d,m),0,1):0;n.kind==="camera"?s=Xt(n.minSize,n.maxSize,_):r=_}return{uSizeT:r,uSize:s}}var PM=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:vo,evaluateSizeForFeature:Gp,evaluateSizeForZoom:Qc,getSizeData:sy});function zM(n,e,r){return n.sections.forEach(s=>{s.text=function(c,d,m){const _=d.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),T.applyArabicShaping&&(c=T.applyArabicShaping(c)),c}(s.text,e,r)}),n}const dd={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function DM(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function LM(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var pw=yn,mw=function(n,e,r,s,c){var d,m,_=8*c-s-1,x=(1<<_)-1,b=x>>1,S=-7,M=r?c-1:0,k=r?-1:1,D=n[e+M];for(M+=k,d=D&(1<<-S)-1,D>>=-S,S+=_;S>0;d=256*d+n[e+M],M+=k,S-=8);for(m=d&(1<<-S)-1,d>>=-S,S+=s;S>0;m=256*m+n[e+M],M+=k,S-=8);if(d===0)d=1-b;else{if(d===x)return m?NaN:1/0*(D?-1:1);m+=Math.pow(2,s),d-=b}return(D?-1:1)*m*Math.pow(2,d-s)},gw=function(n,e,r,s,c,d){var m,_,x,b=8*d-c-1,S=(1<<b)-1,M=S>>1,k=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,D=s?0:d-1,L=s?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,m=S):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+M>=1?k/x:k*Math.pow(2,1-M))*x>=2&&(m++,x/=2),m+M>=S?(_=0,m=S):m+M>=1?(_=(e*x-1)*Math.pow(2,c),m+=M):(_=e*Math.pow(2,M-1)*Math.pow(2,c),m=0));c>=8;n[r+D]=255&_,D+=L,_/=256,c-=8);for(m=m<<c|_,b+=c;b>0;n[r+D]=255&m,D+=L,m/=256,b-=8);n[r+D-L]|=128*B};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function yn(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}yn.Varint=0,yn.Fixed64=1,yn.Bytes=2,yn.Fixed32=5;var ay=4294967296,_w=1/ay,yw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bs(n){return n.type===yn.Bytes?n.readVarint()+n.pos:n.pos+1}function eu(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function vw(n,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=n;c--)r.buf[c+s]=r.buf[c]}function RM(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function OM(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function BM(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function FM(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function NM(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function jM(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function UM(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function VM(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function $M(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function qp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function tu(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function xw(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}yn.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,d=this.pos;this.type=7&s,n(c,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=qp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=xw(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=qp(this.buf,this.pos)+qp(this.buf,this.pos+4)*ay;return this.pos+=8,n},readSFixed64:function(){var n=qp(this.buf,this.pos)+xw(this.buf,this.pos+4)*ay;return this.pos+=8,n},readFloat:function(){var n=mw(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=mw(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,d,m){var _,x,b=m.buf;if(_=(112&(x=b[m.pos++]))>>4,x<128||(_|=(127&(x=b[m.pos++]))<<3,x<128)||(_|=(127&(x=b[m.pos++]))<<10,x<128)||(_|=(127&(x=b[m.pos++]))<<17,x<128)||(_|=(127&(x=b[m.pos++]))<<24,x<128)||(_|=(1&(x=b[m.pos++]))<<31,x<128))return eu(c,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&yw?function(r,s,c){return yw.decode(r.subarray(s,c))}(this.buf,e,n):function(r,s,c){for(var d="",m=s;m<c;){var _,x,b,S=r[m],M=null,k=S>239?4:S>223?3:S>191?2:1;if(m+k>c)break;k===1?S<128&&(M=S):k===2?(192&(_=r[m+1]))==128&&(M=(31&S)<<6|63&_)<=127&&(M=null):k===3?(x=r[m+2],(192&(_=r[m+1]))==128&&(192&x)==128&&((M=(15&S)<<12|(63&_)<<6|63&x)<=2047||M>=55296&&M<=57343)&&(M=null)):k===4&&(x=r[m+2],b=r[m+3],(192&(_=r[m+1]))==128&&(192&x)==128&&(192&b)==128&&((M=(15&S)<<18|(63&_)<<12|(63&x)<<6|63&b)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,k=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),m+=k}return d}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==yn.Bytes)return n.push(this.readVarint(e));var r=bs(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==yn.Bytes)return n.push(this.readSVarint());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==yn.Bytes)return n.push(this.readBoolean());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==yn.Bytes)return n.push(this.readFloat());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==yn.Bytes)return n.push(this.readDouble());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==yn.Bytes)return n.push(this.readFixed32());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==yn.Bytes)return n.push(this.readSFixed32());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==yn.Bytes)return n.push(this.readFixed64());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==yn.Bytes)return n.push(this.readSFixed64());var e=bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===yn.Varint)for(;this.buf[this.pos++]>127;);else if(e===yn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===yn.Fixed32)this.pos+=4;else{if(e!==yn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),tu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),tu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),tu(this.buf,-1&n,this.pos),tu(this.buf,Math.floor(n*_w),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),tu(this.buf,-1&n,this.pos),tu(this.buf,Math.floor(n*_w),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var s,c;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(d,m,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(s,0,r),function(d,m){var _=(7&d)<<4;m.buf[m.pos++]|=_|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(c,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(s,c,d){for(var m,_,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!_){m>56319||x+1===c.length?(s[d++]=239,s[d++]=191,s[d++]=189):_=m;continue}if(m<56320){s[d++]=239,s[d++]=191,s[d++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(s[d++]=239,s[d++]=191,s[d++]=189,_=null);m<128?s[d++]=m:(m<2048?s[d++]=m>>6|192:(m<65536?s[d++]=m>>12|224:(s[d++]=m>>18|240,s[d++]=m>>12&63|128),s[d++]=m>>6&63|128),s[d++]=63&m|128)}return d}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&vw(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),gw(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),gw(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var s=this.pos-r;s>=128&&vw(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(n,e,r){this.writeTag(n,yn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,RM,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,OM,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,NM,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,BM,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,FM,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,jM,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,UM,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,VM,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,$M,e)},writeBytesField:function(n,e){this.writeTag(n,yn.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,yn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,yn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,yn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,yn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,yn.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,yn.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,yn.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,yn.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,yn.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Zp=ue(pw);const ly=3;function GM(n,e,r){e.glyphs=[],n===1&&r.readMessage(qM,e)}function qM(n,e,r){if(n===3){const{id:s,bitmap:c,width:d,height:m,left:_,top:x,advance:b}=r.readMessage(ZM,{});e.glyphs.push({id:s,bitmap:new ws({width:d+2*ly,height:m+2*ly},c),metrics:{width:d,height:m,left:_,top:x,advance:b}})}else n===4?e.ascender=r.readSVarint():n===5&&(e.descender=r.readSVarint())}function ZM(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const ww=ly;function cy(n){let e=0,r=0;for(const m of n)e+=m.w*m.h,r=Math.max(r,m.w);n.sort((m,_)=>_.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,d=0;for(const m of n)for(let _=s.length-1;_>=0;_--){const x=s[_];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,d=Math.max(d,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){const b=s.pop();_<s.length&&(s[_]=b)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(s.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}const Qr=1;class uy{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=d,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+Qr,this.paddedRect.y+Qr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qr,this.paddedRect.y+this.paddedRect.h-Qr]}get displaySize(){return[(this.paddedRect.w-2*Qr)/this.pixelRatio,(this.paddedRect.h-2*Qr)/this.pixelRatio]}}class bw{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,c,d);const{w:m,h:_}=cy(d),x=new fi({width:m||1,height:_||1});for(const b in e){const S=e[b],M=s[b].paddedRect;fi.copy(S.data,x,{x:0,y:0},{x:M.x+Qr,y:M.y+Qr},S.data)}for(const b in r){const S=r[b],M=c[b].paddedRect,k=M.x+Qr,D=M.y+Qr,L=S.data.width,B=S.data.height;fi.copy(S.data,x,{x:0,y:0},{x:k,y:D},S.data),fi.copy(S.data,x,{x:0,y:B-1},{x:k,y:D-1},{width:L,height:1}),fi.copy(S.data,x,{x:0,y:0},{x:k,y:D+B},{width:L,height:1}),fi.copy(S.data,x,{x:L-1,y:0},{x:k-1,y:D},{width:1,height:B}),fi.copy(S.data,x,{x:0,y:0},{x:k+L,y:D},{width:1,height:B})}this.image=x,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const d=e[c],m={x:0,y:0,w:d.data.width+2*Qr,h:d.data.height+2*Qr};s.push(m),r[c]=new uy(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,d]=e.tl;s.update(r.data,void 0,{x:c,y:d})}}ft(uy,"ImagePosition"),ft(bw,"ImageAtlas");const Ai={horizontal:1,vertical:2,horizontalOnly:3},Ew=-17;class fd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new fd;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new fd;return r.imageName=e,r}}class nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new nu;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let c="";for(let d=0;d<r.length;d++){const m=r.charCodeAt(d+1)||null,_=r.charCodeAt(d-1)||null;c+=!s&&(m&&wp(m)&&!dd[r[d+1]]||_&&wp(_)&&!dd[r[d-1]])||!dd[r[d]]?r[d]:dd[r[d]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Wp[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Wp[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new nu;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(fd.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void An("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(fd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):An("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function hy(n,e,r,s,c,d,m,_,x,b,S,M,k,D,L){const B=nu.fromFeature(n,c);M===Ai.vertical&&B.verticalizePunctuation(k);let $=[];const J=function(he,Me,Se,Oe,He,Ie){if(!he)return[];const je=[],Ue=function(lt,mt,ct,It,nt,vt){let Pt=0;for(let Yt=0;Yt<lt.length();Yt++){const zt=lt.getSection(Yt);Pt+=Tw(lt.getCharCode(Yt),zt,It,nt,mt,vt)}return Pt/Math.max(1,Math.ceil(Pt/ct))}(he,Me,Se,Oe,He,Ie),qe=he.text.indexOf("")>=0;let tt=0;for(let lt=0;lt<he.length();lt++){const mt=he.getSection(lt),ct=he.getCharCode(lt);if(Wp[ct]||(tt+=Tw(ct,mt,Oe,He,Me,Ie)),lt<he.length()-1){const It=!((Le=ct)<11904||!(ut["Bopomofo Extended"](Le)||ut.Bopomofo(Le)||ut["CJK Compatibility Forms"](Le)||ut["CJK Compatibility Ideographs"](Le)||ut["CJK Compatibility"](Le)||ut["CJK Radicals Supplement"](Le)||ut["CJK Strokes"](Le)||ut["CJK Symbols and Punctuation"](Le)||ut["CJK Unified Ideographs Extension A"](Le)||ut["CJK Unified Ideographs"](Le)||ut["Enclosed CJK Letters and Months"](Le)||ut["Halfwidth and Fullwidth Forms"](Le)||ut.Hiragana(Le)||ut["Ideographic Description Characters"](Le)||ut["Kangxi Radicals"](Le)||ut["Katakana Phonetic Extensions"](Le)||ut.Katakana(Le)||ut["Vertical Forms"](Le)||ut["Yi Radicals"](Le)||ut["Yi Syllables"](Le)));(WM[ct]||It||mt.imageName)&&je.push(Cw(lt+1,tt,Ue,je,XM(ct,he.getCharCode(lt+1),It&&qe),!1))}}var Le;return Aw(Cw(he.length(),tt,Ue,je,0,!0))}(B,b,d,e,s,D),{processBidirectionalText:ae,processStyledBidirectionalText:Q}=T;if(ae&&B.sections.length===1){const he=ae(B.toString(),J);for(const Me of he){const Se=new nu;Se.text=Me,Se.sections=B.sections;for(let Oe=0;Oe<Me.length;Oe++)Se.sectionIndex.push(0);$.push(Se)}}else if(Q){const he=Q(B.text,B.sectionIndex,J);for(const Me of he){const Se=new nu;Se.text=Me[0],Se.sectionIndex=Me[1],Se.sections=B.sections,$.push(Se)}}else $=function(he,Me){const Se=[],Oe=he.text;let He=0;for(const Ie of Me)Se.push(he.substring(He,Ie)),He=Ie;return He<Oe.length&&Se.push(he.substring(He,Oe.length)),Se}(B,J);const oe=[],de={positionedLines:oe,text:B.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(he,Me,Se,Oe,He,Ie,je,Ue,qe,tt,Le,lt){let mt=0,ct=0,It=0;const nt=Ue==="right"?1:Ue==="left"?0:.5;let vt=!1;for(const Rt of He){const Ot=Rt.getSections();for(const pn of Ot){if(pn.imageName)continue;const vn=Me[pn.fontStack];if(vn&&(vt=vn.ascender!==void 0&&vn.descender!==void 0,!vt))break}if(!vt)break}let Pt=0;for(const Rt of He){Rt.trim();const Ot=Rt.getMaxScale(),pn=(Ot-1)*pr,vn={positionedGlyphs:[],lineOffset:0};he.positionedLines[Pt]=vn;const xn=vn.positionedGlyphs;let mn=0;if(!Rt.length()){ct+=Ie,++Pt;continue}let kn=0,Dn=0;for(let gn=0;gn<Rt.length();gn++){const er=Rt.getSection(gn),Wn=Rt.getSectionIndex(gn),In=Rt.getCharCode(gn);let Jt=er.scale,Xn=null,wn=null,Vr=null,Hn=pr,mr=0;const cr=!(qe===Ai.horizontal||!Le&&!jh(In)||Le&&(Wp[In]||(Yt=In,ut.Arabic(Yt)||ut["Arabic Supplement"](Yt)||ut["Arabic Extended-A"](Yt)||ut["Arabic Presentation Forms-A"](Yt)||ut["Arabic Presentation Forms-B"](Yt))));if(er.imageName){const $r=Oe[er.imageName];if(!$r)continue;Vr=er.imageName,he.iconsInText=he.iconsInText||!0,wn=$r.paddedRect;const ur=$r.displaySize;Jt=Jt*pr/lt,Xn={width:ur[0],height:ur[1],left:Qr,top:-ww,advance:cr?ur[1]:ur[0],localGlyph:!1},mr=vt?-Xn.height*Jt:Ew+Ot*pr-ur[1]*Jt,Hn=Xn.advance;const bo=(cr?ur[0]:ur[1])*Jt-pr*Ot;bo>0&&bo>mn&&(mn=bo)}else{const $r=Se[er.fontStack];if(!$r)continue;$r[In]&&(wn=$r[In]);const ur=Me[er.fontStack];if(!ur)continue;const bo=ur.glyphs[In];if(!bo)continue;if(Xn=bo.metrics,Hn=In!==8203?pr:0,vt){const cu=ur.ascender!==void 0?Math.abs(ur.ascender):0,Ed=ur.descender!==void 0?Math.abs(ur.descender):0,Td=(cu+Ed)*Jt;kn<Td&&(kn=Td,Dn=(cu-Ed)/2*Jt),mr=-cu*Jt}else mr=Ew+(Ot-Jt)*pr}cr?(he.verticalizable=!0,xn.push({glyph:In,imageName:Vr,x:mt,y:ct+mr,vertical:cr,scale:Jt,localGlyph:Xn.localGlyph,fontStack:er.fontStack,sectionIndex:Wn,metrics:Xn,rect:wn}),mt+=Hn*Jt+tt):(xn.push({glyph:In,imageName:Vr,x:mt,y:ct+mr,vertical:cr,scale:Jt,localGlyph:Xn.localGlyph,fontStack:er.fontStack,sectionIndex:Wn,metrics:Xn,rect:wn}),mt+=Xn.advance*Jt+tt)}xn.length!==0&&(It=Math.max(mt-tt,It),vt?Mw(xn,nt,mn,Dn,Ie*Ot/2):Mw(xn,nt,mn,0,Ie/2)),mt=0;const Zn=Ie*Ot+mn;vn.lineOffset=Math.max(mn,pn),ct+=Zn,++Pt}var Yt;const zt=ct,{horizontalAlign:St,verticalAlign:bn}=dy(je);(function(Rt,Ot,pn,vn,xn,mn){const kn=(Ot-pn)*xn,Dn=-mn*vn;for(const Zn of Rt)for(const gn of Zn.positionedGlyphs)gn.x+=kn,gn.y+=Dn})(he.positionedLines,nt,St,bn,It,zt),he.top+=-bn*zt,he.bottom=he.top+zt,he.left+=-St*It,he.right=he.left+It,he.hasBaseline=vt}(de,e,r,s,$,m,_,x,M,b,k,L),!function(he){for(const Me of he)if(Me.positionedGlyphs.length!==0)return!1;return!0}(oe)&&de}const Wp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},WM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Tw(n,e,r,s,c,d){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*pr/d+c:0}{const m=r[e.fontStack],_=m&&m.glyphs[n];return _?_.metrics.advance*e.scale+c:0}}function Sw(n,e,r,s){const c=Math.pow(n-e,2);return s?n<e?c/2:2*c:c+Math.abs(r)*r}function XM(n,e,r){let s=0;return n===10&&(s-=1e4),r&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Cw(n,e,r,s,c,d){let m=null,_=Sw(e,r,c,d);for(const x of s){const b=Sw(e-x.x,r,c,d)+x.badness;b<=_&&(m=x,_=b)}return{index:n,x:e,priorBreak:m,badness:_}}function Aw(n){return n?Aw(n.priorBreak).concat(n.index):[]}function dy(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Mw(n,e,r,s,c){if(!(e||r||s||c))return;const d=n.length-1,m=n[d],_=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=d;x++)n[x].x-=_,n[x].y+=r+s+c}function HM(n,e,r){const{horizontalAlign:s,verticalAlign:c}=dy(r),d=e[0]-n.displaySize[0]*s,m=e[1]-n.displaySize[1]*c;return{image:n,top:m,bottom:m+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function kw(n,e,r,s,c,d){const m=n.image;let _;if(m.content){const $=m.content,J=m.pixelRatio||1;_=[$[0]/J,$[1]/J,m.displaySize[0]-$[2]/J,m.displaySize[1]-$[3]/J]}const x=e.left*d,b=e.right*d;let S,M,k,D;r==="width"||r==="both"?(D=c[0]+x-s[3],M=c[0]+b+s[1]):(D=c[0]+(x+b-m.displaySize[0])/2,M=D+m.displaySize[0]);const L=e.top*d,B=e.bottom*d;return r==="height"||r==="both"?(S=c[1]+L-s[0],k=c[1]+B+s[2]):(S=c[1]+(L+B-m.displaySize[1])/2,k=S+m.displaySize[1]),{image:m,top:S,right:M,bottom:k,left:D,collisionPadding:_}}class Es extends De{constructor(e,r,s,c,d){super(e,r),this.angle=c,this.z=s,d!==void 0&&(this.segment=d)}clone(){return new Es(this.x,this.y,this.z,this.angle,this.segment)}}function Iw(n,e,r,s,c){if(e.segment===void 0)return!0;let d=e,m=e.segment+1,_=0;for(;_>-r/2;){if(m--,m<0)return!1;_-=n[m].dist(d),d=n[m]}_+=n[m].dist(n[m+1]),m++;const x=[];let b=0;for(;_<r/2;){const S=n[m],M=n[m+1];if(!M)return!1;let k=n[m-1].angleTo(S)-S.angleTo(M);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:k}),b+=k;_-x[0].distance>s;)b-=x.shift().angleDelta;if(b>c)return!1;m++,_+=S.dist(M)}return!0}function Pw(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function zw(n,e,r){return n?.6*e*r:0}function Dw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function YM(n,e,r,s,c,d){const m=zw(r,c,d),_=Dw(r,s)*d;let x=0;const b=Pw(n)/2;for(let S=0;S<n.length-1;S++){const M=n[S],k=n[S+1],D=M.dist(k);if(x+D>b){const L=(b-x)/D,B=Xt(M.x,k.x,L),$=Xt(M.y,k.y,L),J=new Es(B,$,0,k.angleTo(M),S);return!m||Iw(n,J,_,m,e)?J:void 0}x+=D}}function KM(n,e,r,s,c,d,m,_,x){const b=zw(s,d,m),S=Dw(s,c),M=S*m,k=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-M<e/4&&(e=M+e/4),Lw(n,k?e/2*_%e:(S/2+2*d)*m*_%e,e,b,r,M,k,!1,x)}function Lw(n,e,r,s,c,d,m,_,x){const b=d/2,S=Pw(n);let M=0,k=e-r,D=[];for(let L=0;L<n.length-1;L++){const B=n[L],$=n[L+1],J=B.dist($),ae=$.angleTo(B);for(;k+r<M+J;){k+=r;const Q=(k-M)/J,oe=Xt(B.x,$.x,Q),de=Xt(B.y,$.y,Q);if(oe>=0&&oe<x&&de>=0&&de<x&&k-b>=0&&k+b<=S){const he=new Es(oe,de,0,ae,L);he._round(),s&&!Iw(n,he,d,s,c)||D.push(he)}}M+=J}return _||D.length||m||(D=Lw(n,M/2,r,s,c,d,m,!0,x)),D}function Rw(n,e,r,s,c){const d=[];for(let m=0;m<n.length;m++){const _=n[m];let x;for(let b=0;b<_.length-1;b++){let S=_[b],M=_[b+1];S.x<e&&M.x<e||(S.x<e?S=new De(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x<e&&(M=new De(e,S.y+(e-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y<r&&M.y<r||(S.y<r?S=new De(S.x+(r-S.y)/(M.y-S.y)*(M.x-S.x),r)._round():M.y<r&&(M=new De(S.x+(r-S.y)/(M.y-S.y)*(M.x-S.x),r)._round()),S.x>=s&&M.x>=s||(S.x>=s?S=new De(s,S.y+(s-S.x)/(M.x-S.x)*(M.y-S.y))._round():M.x>=s&&(M=new De(s,S.y+(s-S.x)/(M.x-S.x)*(M.y-S.y))._round()),S.y>=c&&M.y>=c||(S.y>=c?S=new De(S.x+(c-S.y)/(M.y-S.y)*(M.x-S.x),c)._round():M.y>=c&&(M=new De(S.x+(c-S.y)/(M.y-S.y)*(M.x-S.x),c)._round()),x&&S.equals(x[x.length-1])||(x=[S],d.push(x)),x.push(M)))))}}return d}ft(Es,"Anchor");const pd=1e20;function Ow(n,e,r,s,c,d,m,_,x){for(let b=e;b<e+s;b++)Bw(n,r*d+b,d,c,m,_,x);for(let b=r;b<r+c;b++)Bw(n,b*d+e,1,s,m,_,x)}function Bw(n,e,r,s,c,d,m){d[0]=0,m[0]=-pd,m[1]=pd,c[0]=n[e];for(let _=1,x=0,b=0;_<s;_++){c[_]=n[e+_*r];const S=_*_;do{const M=d[x];b=(c[_]-c[M]+S-M*M)/(_-M)/2}while(b<=m[x]&&--x>-1);x++,d[x]=_,m[x]=b,m[x+1]=pd}for(let _=0,x=0;_<s;_++){for(;m[x+1]<_;)x++;const b=d[x],S=_-b;n[e+_*r]=c[b]+S*S}}const xo=2,fy={none:0,ideographs:1,all:2};class ru{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const c in e)for(const d of e[c])s.push({stack:c,id:d});Gt(s,({stack:c,id:d},m)=>{let _=this.entries[c];_||(_=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=_.glyphs[d];if(x!==void 0)return void m(null,{stack:c,id:d,glyph:x});if(x=this._tinySDF(_,c,d),x)return _.glyphs[d]=x,void m(null,{stack:c,id:d,glyph:x});const b=Math.floor(d/256);if(256*b>65535)return void m(new Error("glyphs > 65535 not supported"));if(_.ranges[b])return void m(null,{stack:c,id:d,glyph:x});let S=_.requests[b];S||(S=_.requests[b]=[],ru.loadGlyphRange(c,b,this.url,this.requestManager,(M,k)=>{if(k){_.ascender=k.ascender,_.descender=k.descender;for(const D in k.glyphs)this._doesCharSupportLocalGlyph(+D)||(_.glyphs[+D]=k.glyphs[+D]);_.ranges[b]=!0}for(const D of S)D(M,k);delete _.requests[b]})),S.push((M,k)=>{M?m(M):k&&m(null,{stack:c,id:d,glyph:k.glyphs[d]||null})})},(c,d)=>{if(c)r(c);else if(d){const m={};for(const{stack:_,id:x,glyph:b}of d)m[_]===void 0&&(m[_]={}),m[_].glyphs===void 0&&(m[_].glyphs={}),m[_].glyphs[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},m[_].ascender=this.entries[_].ascender,m[_].descender=this.entries[_].descender;r(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==fy.none&&(this.localGlyphMode===fy.all?!!this.localFontFamily:!!this.localFontFamily&&(ut["CJK Unified Ideographs"](e)||ut["Hangul Syllables"](e)||ut.Hiragana(e)||ut.Katakana(e)||ut["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let B="400";/bold/i.test(r)?B="900":/medium/i.test(r)?B="500":/light/i.test(r)&&(B="200"),d=e.tinySDF=new ru.TinySDF({fontFamily:c,fontWeight:B,fontSize:24*xo,buffer:3*xo,radius:8*xo}),d.fontWeight=B}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const m=String.fromCharCode(s),{data:_,width:x,height:b,glyphWidth:S,glyphHeight:M,glyphLeft:k,glyphTop:D,glyphAdvance:L}=d.draw(m);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new ws({width:x,height:b},_),metrics:{width:S/xo,height:M/xo,left:k/xo,top:D/xo-27,advance:L/xo,localGlyph:!0}}}}ru.loadGlyphRange=function(n,e,r,s,c){const d=256*e,m=d+255,_=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${d}-${m}`),rs.Glyphs);Gs(_,(x,b)=>{if(x)c(x);else if(b){const S={},M=function(k){return new Zp(k).readFields(GM,{})}(b);for(const k of M.glyphs)S[k.id]=k;c(null,{glyphs:S,ascender:M.ascender,descender:M.descender})}})},ru.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const _=this.size=n+4*e,x=this._createCanvas(_),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${m} ${d} ${n}px ${c}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(n),m=Math.ceil(r),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(s)),b=_+2*this.buffer,S=x+2*this.buffer,M=Math.max(b*S,0),k=new Uint8ClampedArray(M),D={data:k,width:b,height:S,glyphWidth:_,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(_===0||x===0)return D;const{ctx:L,buffer:B,gridInner:$,gridOuter:J}=this;L.clearRect(B,B,_,x),L.fillText(n,B,B+m);const ae=L.getImageData(B,B,_,x);J.fill(pd,0,M),$.fill(0,0,M);for(let Q=0;Q<x;Q++)for(let oe=0;oe<_;oe++){const de=ae.data[4*(Q*_+oe)+3]/255;if(de===0)continue;const he=(Q+B)*b+oe+B;if(de===1)J[he]=0,$[he]=pd;else{const Me=.5-de;J[he]=Me>0?Me*Me:0,$[he]=Me<0?Me*Me:0}}Ow(J,0,0,b,S,b,this.f,this.v,this.z),Ow($,B,B,_,x,b,this.f,this.v,this.z);for(let Q=0;Q<M;Q++){const oe=Math.sqrt(J[Q])-Math.sqrt($[Q]);k[Q]=Math.round(255-255*(oe/this.radius+this.cutoff))}return D}};const iu=Qr;function Fw(n,e,r,s){const c=[],d=n.image,m=d.pixelRatio,_=d.paddedRect.w-2*iu,x=d.paddedRect.h-2*iu,b=n.right-n.left,S=n.bottom-n.top,M=d.stretchX||[[0,_]],k=d.stretchY||[[0,x]],D=(Ie,je)=>Ie+je[1]-je[0],L=M.reduce(D,0),B=k.reduce(D,0),$=_-L,J=x-B;let ae=0,Q=L,oe=0,de=B,he=0,Me=$,Se=0,Oe=J;if(d.content&&s){const Ie=d.content;ae=Xp(M,0,Ie[0]),oe=Xp(k,0,Ie[1]),Q=Xp(M,Ie[0],Ie[2]),de=Xp(k,Ie[1],Ie[3]),he=Ie[0]-ae,Se=Ie[1]-oe,Me=Ie[2]-Ie[0]-Q,Oe=Ie[3]-Ie[1]-de}const He=(Ie,je,Ue,qe)=>{const tt=Hp(Ie.stretch-ae,Q,b,n.left),Le=Yp(Ie.fixed-he,Me,Ie.stretch,L),lt=Hp(je.stretch-oe,de,S,n.top),mt=Yp(je.fixed-Se,Oe,je.stretch,B),ct=Hp(Ue.stretch-ae,Q,b,n.left),It=Yp(Ue.fixed-he,Me,Ue.stretch,L),nt=Hp(qe.stretch-oe,de,S,n.top),vt=Yp(qe.fixed-Se,Oe,qe.stretch,B),Pt=new De(tt,lt),Yt=new De(ct,lt),zt=new De(ct,nt),St=new De(tt,nt),bn=new De(Le/m,mt/m),Rt=new De(It/m,vt/m),Ot=e*Math.PI/180;if(Ot){const xn=Math.sin(Ot),mn=Math.cos(Ot),kn=[mn,-xn,xn,mn];Pt._matMult(kn),Yt._matMult(kn),St._matMult(kn),zt._matMult(kn)}const pn=Ie.stretch+Ie.fixed,vn=je.stretch+je.fixed;return{tl:Pt,tr:Yt,bl:St,br:zt,tex:{x:d.paddedRect.x+iu+pn,y:d.paddedRect.y+iu+vn,w:Ue.stretch+Ue.fixed-pn,h:qe.stretch+qe.fixed-vn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bn,pixelOffsetBR:Rt,minFontScaleX:Me/m/b,minFontScaleY:Oe/m/S,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const Ie=Nw(M,$,L),je=Nw(k,J,B);for(let Ue=0;Ue<Ie.length-1;Ue++){const qe=Ie[Ue],tt=Ie[Ue+1];for(let Le=0;Le<je.length-1;Le++)c.push(He(qe,je[Le],tt,je[Le+1]))}}else c.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Xp(n,e,r){let s=0;for(const c of n)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Nw(n,e,r){const s=[{fixed:-iu,stretch:0}];for(const[c,d]of n){const m=s[s.length-1];s.push({fixed:c-m.stretch,stretch:m.stretch}),s.push({fixed:c-m.stretch,stretch:m.stretch+(d-c)})}return s.push({fixed:e+iu,stretch:r}),s}function Hp(n,e,r,s){return n/e*r+s}function Yp(n,e,r,s){return n-e*r/s}function JM(n,e,r,s){const c=e+n.positionedLines[s].lineOffset;return s===0?r+c/2:r+(c+(e+n.positionedLines[s-1].lineOffset))/2}class QM{constructor(e=[],r=ek){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const d=e-1>>1,m=r[d];if(s(c,m)>=0)break;r[e]=m,e=d}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,d=r[e];for(;e<c;){let m=1+(e<<1),_=r[m];const x=m+1;if(x<this.length&&s(r[x],_)<0&&(m=x,_=r[x]),s(_,d)>=0)break;r[e]=_,e=m}r[e]=d}}function ek(n,e){return n<e?-1:n>e?1:0}function tk(n,e=1,r=!1){let s=1/0,c=1/0,d=-1/0,m=-1/0;const _=n[0];for(let D=0;D<_.length;D++){const L=_[D];(!D||L.x<s)&&(s=L.x),(!D||L.y<c)&&(c=L.y),(!D||L.x>d)&&(d=L.x),(!D||L.y>m)&&(m=L.y)}const x=Math.min(d-s,m-c);let b=x/2;const S=new QM([],nk);if(x===0)return new De(s,c);for(let D=s;D<d;D+=x)for(let L=c;L<m;L+=x)S.push(new ou(D+b,L+b,b,n));let M=function(D){let L=0,B=0,$=0;const J=D[0];for(let ae=0,Q=J.length,oe=Q-1;ae<Q;oe=ae++){const de=J[ae],he=J[oe],Me=de.x*he.y-he.x*de.y;B+=(de.x+he.x)*Me,$+=(de.y+he.y)*Me,L+=3*Me}return new ou(B/L,$/L,0,D)}(n),k=S.length;for(;S.length;){const D=S.pop();(D.d>M.d||!M.d)&&(M=D,r&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,k)),D.max-M.d<=e||(b=D.h/2,S.push(new ou(D.p.x-b,D.p.y-b,b,n)),S.push(new ou(D.p.x+b,D.p.y-b,b,n)),S.push(new ou(D.p.x-b,D.p.y+b,b,n)),S.push(new ou(D.p.x+b,D.p.y+b,b,n)),k+=4)}return r&&(console.log(`num probes: ${k}`),console.log(`best distance: ${M.d}`)),M.p}function nk(n,e){return e.max-n.max}class ou{constructor(e,r,s,c){this.p=new De(e,r),this.h=s,this.d=function(d,m){let _=!1,x=1/0;for(let b=0;b<m.length;b++){const S=m[b];for(let M=0,k=S.length,D=k-1;M<k;D=M++){const L=S[M],B=S[D];L.y>d.y!=B.y>d.y&&d.x<(B.x-L.x)*(d.y-L.y)/(B.y-L.y)+L.x&&(_=!_),x=Math.min(x,L1(d,L,B))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const su=7,py=Number.POSITIVE_INFINITY,rk=Math.sqrt(2);function jw(n,[e,r]){let s=0,c=0;if(r===py){e<0&&(e=0);const d=e/rk;switch(n){case"top-right":case"top-left":c=d-su;break;case"bottom-right":case"bottom-left":c=-d+su;break;case"bottom":c=-e+su;break;case"top":c=e-su}switch(n){case"top-right":case"bottom-right":s=-d;break;case"top-left":case"bottom-left":s=d;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),n){case"top-right":case"top-left":case"top":c=r-su;break;case"bottom-right":case"bottom-left":case"bottom":c=-r+su}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,c]}function ik(n,e,r,s,c,d,m,_,x,b){n.createArrays(),n.tilePixelRatio=bt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const S=n.layers[0].layout,M=n.layers[0]._unevaluatedLayout._values,k={};if(n.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:$}=n.textSizeData;k.compositeTextSizes=[M["text-size"].possiblyEvaluate(new A(B),_),M["text-size"].possiblyEvaluate(new A($),_)]}if(n.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:$}=n.iconSizeData;k.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new A(B),_),M["icon-size"].possiblyEvaluate(new A($),_)]}k.layoutTextSize=M["text-size"].possiblyEvaluate(new A(x+1),_),k.layoutIconSize=M["icon-size"].possiblyEvaluate(new A(x+1),_),k.textMaxSize=M["text-size"].possiblyEvaluate(new A(18),_);const D=S.get("text-rotation-alignment")==="map"&&S.get("symbol-placement")!=="point",L=S.get("text-size");for(const B of n.features){const $=S.get("text-font").evaluate(B,{},_).join(","),J=L.evaluate(B,{},_),ae=k.layoutTextSize.evaluate(B,{},_),Q=(k.layoutIconSize.evaluate(B,{},_),{horizontal:{},vertical:void 0}),oe=B.text;let de,he=[0,0];if(oe){const Oe=oe.toString(),He=S.get("text-letter-spacing").evaluate(B,{},_)*pr,Ie=S.get("text-line-height").evaluate(B,{},_)*pr,je=E_(Oe)?He:0,Ue=S.get("text-anchor").evaluate(B,{},_),qe=S.get("text-variable-anchor");if(!qe){const ct=S.get("text-radial-offset").evaluate(B,{},_);he=ct?jw(Ue,[ct*pr,py]):S.get("text-offset").evaluate(B,{},_).map(It=>It*pr)}let tt=D?"center":S.get("text-justify").evaluate(B,{},_);const Le=S.get("symbol-placement")==="point",lt=Le?S.get("text-max-width").evaluate(B,{},_)*pr:1/0,mt=ct=>{n.allowVerticalPlacement&&Nh(Oe)&&(Q.vertical=hy(oe,e,r,c,$,lt,Ie,Ue,ct,je,he,Ai.vertical,!0,ae,J))};if(!D&&qe){const ct=tt==="auto"?qe.map(nt=>my(nt)):[tt];let It=!1;for(let nt=0;nt<ct.length;nt++){const vt=ct[nt];if(!Q.horizontal[vt])if(It)Q.horizontal[vt]=Q.horizontal[0];else{const Pt=hy(oe,e,r,c,$,lt,Ie,"center",vt,je,he,Ai.horizontal,!1,ae,J);Pt&&(Q.horizontal[vt]=Pt,It=Pt.positionedLines.length===1)}}mt("left")}else{if(tt==="auto"&&(tt=my(Ue)),Le||S.get("text-writing-mode").indexOf("horizontal")>=0||!Nh(Oe)){const ct=hy(oe,e,r,c,$,lt,Ie,Ue,tt,je,he,Ai.horizontal,!1,ae,J);ct&&(Q.horizontal[tt]=ct)}mt(Le?"left":tt)}}let Me=!1;if(B.icon&&B.icon.name){const Oe=s[B.icon.name];Oe&&(de=HM(c[B.icon.name],S.get("icon-offset").evaluate(B,{},_),S.get("icon-anchor").evaluate(B,{},_)),Me=Oe.sdf,n.sdfIcons===void 0?n.sdfIcons=Oe.sdf:n.sdfIcons!==Oe.sdf&&An("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==n.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Se=Vw(Q.horizontal)||Q.vertical;n.iconsInText||(n.iconsInText=!!Se&&Se.iconsInText),(Se||de)&&ok(n,B,Q,de,s,k,ae,0,he,Me,m,_,b)}d&&n.generateCollisionDebugBuffers(x,n.collisionBoxArray)}function my(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ok(n,e,r,s,c,d,m,_,x,b,S,M,k){let D=d.textMaxSize.evaluate(e,{},M);D===void 0&&(D=m);const L=n.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},M),$=Vw(r.horizontal)||r.vertical,J=k.name==="globe",ae=pr,Q=m/ae,oe=n.tilePixelRatio*D/ae,de=(Ue=n.overscaling,n.zoom>18&&Ue>2&&(Ue>>=1),Math.max(bt/(512*Ue),1)*L.get("symbol-spacing")),he=L.get("text-padding")*n.tilePixelRatio,Me=L.get("icon-padding")*n.tilePixelRatio,Se=At(L.get("text-max-angle")),Oe=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",He=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ie=L.get("symbol-placement"),je=de/2;var Ue;const qe=L.get("icon-text-fit");let tt;s&&qe!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(tt=kw(s,r.vertical,qe,L.get("icon-text-fit-padding"),B,Q)),$&&(s=kw(s,$,qe,L.get("icon-text-fit-padding"),B,Q)));const Le=(lt,mt,ct)=>{if(mt.x<0||mt.x>=bt||mt.y<0||mt.y>=bt)return;let It=null;if(J){const{x:nt,y:vt,z:Pt}=k.projectTilePoint(mt.x,mt.y,ct);It={anchor:new Es(nt,vt,Pt,0,void 0),up:k.upVector(ct,mt.x,mt.y)}}(function(nt,vt,Pt,Yt,zt,St,bn,Rt,Ot,pn,vn,xn,mn,kn,Dn,Zn,gn,er,Wn,In,Jt,Xn,wn,Vr,Hn){const mr=nt.addToLineVertexArray(vt,Yt);let cr,$r,ur,bo,cu,Ed,Td,wb=0,bb=0,Eb=0,Tb=0,Iy=-1,Py=-1;const qo={};let Sb=C_("");const jl=Pt?Pt.anchor:vt;let zy=0,Dy=0;if(Ot._unevaluatedLayout.getValue("text-radial-offset")===void 0?[zy,Dy]=Ot.layout.get("text-offset").evaluate(Jt,{},Hn).map(pi=>pi*pr):(zy=Ot.layout.get("text-radial-offset").evaluate(Jt,{},Hn)*pr,Dy=py),nt.allowVerticalPlacement&&zt.vertical){const pi=zt.vertical;if(Dn)Ed=gy(pi),Rt&&(Td=gy(Rt));else{const mi=Ot.layout.get("text-rotate").evaluate(Jt,{},Hn)+90;ur=Kp(pn,jl,vt,vn,xn,mn,pi,kn,mi,Zn),Rt&&(bo=Kp(pn,jl,vt,vn,xn,mn,Rt,er,mi))}}if(St){const pi=Ot.layout.get("icon-rotate").evaluate(Jt,{},Hn),mi=Ot.layout.get("icon-text-fit")!=="none",Sd=Fw(St,pi,wn,mi),Ry=Rt?Fw(Rt,pi,wn,mi):void 0;$r=Kp(pn,jl,vt,vn,xn,mn,St,er,pi),wb=4*Sd.length;const Cb=nt.iconSizeData;let Ul=null;Cb.kind==="source"?(Ul=[vo*Ot.layout.get("icon-size").evaluate(Jt,{},Hn)],Ul[0]>pa&&An(`${nt.layerIds[0]}: Value for "icon-size" is >= ${md}. Reduce your "icon-size".`)):Cb.kind==="composite"&&(Ul=[vo*Xn.compositeIconSizes[0].evaluate(Jt,{},Hn),vo*Xn.compositeIconSizes[1].evaluate(Jt,{},Hn)],(Ul[0]>pa||Ul[1]>pa)&&An(`${nt.layerIds[0]}: Value for "icon-size" is >= ${md}. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,Sd,Ul,In,Wn,Jt,!1,Pt,vt,mr.lineStartIndex,mr.lineLength,-1,Vr,Hn),Iy=nt.icon.placedSymbolArray.length-1,Ry&&(bb=4*Ry.length,nt.addSymbols(nt.icon,Ry,Ul,In,Wn,Jt,Ai.vertical,Pt,vt,mr.lineStartIndex,mr.lineLength,-1,Vr,Hn),Py=nt.icon.placedSymbolArray.length-1)}for(const pi in zt.horizontal){const mi=zt.horizontal[pi];cr||(Sb=C_(mi.text),Dn?cu=gy(mi):cr=Kp(pn,jl,vt,vn,xn,mn,mi,kn,Ot.layout.get("text-rotate").evaluate(Jt,{},Hn),Zn));const Sd=mi.positionedLines.length===1;if(Eb+=Uw(nt,Pt,vt,mi,bn,Ot,Dn,Jt,Zn,mr,zt.vertical?Ai.horizontal:Ai.horizontalOnly,Sd?Object.keys(zt.horizontal):[pi],qo,Iy,Xn,Vr,Hn),Sd)break}zt.vertical&&(Tb+=Uw(nt,Pt,vt,zt.vertical,bn,Ot,Dn,Jt,Zn,mr,Ai.vertical,["vertical"],qo,Py,Xn,Vr,Hn));let xa=-1;const Ly=(pi,mi)=>pi?Math.max(pi,mi):mi;xa=Ly(cu,xa),xa=Ly(Ed,xa),xa=Ly(Td,xa);const Dk=xa>-1?1:0;nt.glyphOffsetArray.length>=ga.MAX_GLYPHS&&An("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,Jt.sortKey),nt.symbolInstances.emplaceBack(jl.x,jl.y,jl.z,vt.x,vt.y,qo.right>=0?qo.right:-1,qo.center>=0?qo.center:-1,qo.left>=0?qo.left:-1,qo.vertical>=0?qo.vertical:-1,Iy,Py,Sb,cr!==void 0?cr:nt.collisionBoxArray.length,cr!==void 0?cr+1:nt.collisionBoxArray.length,ur!==void 0?ur:nt.collisionBoxArray.length,ur!==void 0?ur+1:nt.collisionBoxArray.length,$r!==void 0?$r:nt.collisionBoxArray.length,$r!==void 0?$r+1:nt.collisionBoxArray.length,bo||nt.collisionBoxArray.length,bo?bo+1:nt.collisionBoxArray.length,vn,Eb,Tb,wb,bb,Dk,0,zy,Dy,xa)})(n,mt,It,lt,r,s,c,tt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,he,Oe,x,0,Me,He,B,e,d,b,S,M)};if(Ie==="line")for(const lt of Rw(e.geometry,0,0,bt,bt)){const mt=KM(lt,de,Se,r.vertical||$,s,ae,oe,n.overscaling,bt);for(const ct of mt)$&&sk(n,$.text,je,ct)||Le(lt,ct,M)}else if(Ie==="line-center"){for(const lt of e.geometry)if(lt.length>1){const mt=YM(lt,Se,r.vertical||$,s,ae,oe);mt&&Le(lt,mt,M)}}else if(e.type==="Polygon")for(const lt of ny(e.geometry,0)){const mt=tk(lt,16);Le(lt[0],new Es(mt.x,mt.y,0,0,void 0),M)}else if(e.type==="LineString")for(const lt of e.geometry)Le(lt,new Es(lt[0].x,lt[0].y,0,0,void 0),M);else if(e.type==="Point")for(const lt of e.geometry)for(const mt of lt)Le([mt],new Es(mt.x,mt.y,0,0,void 0),M)}const md=255,pa=md*vo;function Uw(n,e,r,s,c,d,m,_,x,b,S,M,k,D,L,B,$){const J=function(oe,de,he,Me,Se,Oe,He,Ie){const je=[];if(de.positionedLines.length===0)return je;const Ue=Me.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,qe=function(ct){const It=ct[0],nt=ct[1],vt=It*nt;return vt>0?[It,-nt]:vt<0?[-It,nt]:It===0?[nt,It]:[nt,-It]}(he);let tt=Math.abs(de.top-de.bottom);for(const ct of de.positionedLines)tt-=ct.lineOffset;const Le=de.positionedLines.length,lt=tt/Le;let mt=de.top-he[1];for(let ct=0;ct<Le;++ct){const It=de.positionedLines[ct];mt=JM(de,lt,mt,ct);for(const nt of It.positionedGlyphs){if(!nt.rect)continue;const vt=nt.rect||{};let Pt=ww+1,Yt=!0,zt=1,St=0;if(nt.imageName){const wn=He[nt.imageName];if(!wn)continue;if(wn.sdf){An("SDF images are not supported in formatted text and will be ignored.");continue}Yt=!1,zt=wn.pixelRatio,Pt=Qr/zt}const bn=(Se||Ie)&&nt.vertical,Rt=nt.metrics.advance*nt.scale/2,Ot=nt.metrics,pn=nt.rect;if(pn===null)continue;Ie&&de.verticalizable&&(St=nt.imageName?Rt-nt.metrics.width*nt.scale/2:0);const vn=Se?[nt.x+Rt,nt.y]:[0,0];let xn=[0,0],mn=[0,0],kn=!1;Se||(bn?(mn=[nt.x+Rt+qe[0],nt.y+qe[1]-St],kn=!0):xn=[nt.x+Rt+he[0],nt.y+he[1]-St]);const Dn=pn.w*nt.scale/(zt*(nt.localGlyph?xo:1)),Zn=pn.h*nt.scale/(zt*(nt.localGlyph?xo:1));let gn,er,Wn,In;if(bn){const wn=nt.y-mt,Vr=new De(-Rt,Rt-wn),Hn=-Math.PI/2,mr=new De(...mn);gn=new De(-Rt+xn[0],xn[1]),gn._rotateAround(Hn,Vr)._add(mr),gn.x+=-wn+Rt,gn.y-=(Ot.left-Pt)*nt.scale;const cr=nt.imageName?Ot.advance*nt.scale:pr*nt.scale,$r=String.fromCharCode(nt.glyph);DM($r)?gn.x+=(1-Pt)*nt.scale:LM($r)?gn.x+=cr-Ot.height*nt.scale+(-Pt-1)*nt.scale:gn.x+=nt.imageName||Ot.width+2*Pt===pn.w&&Ot.height+2*Pt===pn.h?(cr-Zn)/2:(cr-(Ot.height+2*Pt)*nt.scale)/2,er=new De(gn.x,gn.y-Dn),Wn=new De(gn.x+Zn,gn.y),In=new De(gn.x+Zn,gn.y-Dn)}else{const wn=(Ot.left-Pt)*nt.scale-Rt+xn[0],Vr=(-Ot.top-Pt)*nt.scale+xn[1],Hn=wn+Dn,mr=Vr+Zn;gn=new De(wn,Vr),er=new De(Hn,Vr),Wn=new De(wn,mr),In=new De(Hn,mr)}if(Ue){let wn;wn=Se?new De(0,0):kn?new De(qe[0],qe[1]):new De(he[0],he[1]),gn._rotateAround(Ue,wn),er._rotateAround(Ue,wn),Wn._rotateAround(Ue,wn),In._rotateAround(Ue,wn)}const Jt=new De(0,0),Xn=new De(0,0);je.push({tl:gn,tr:er,bl:Wn,br:In,tex:vt,writingMode:de.writingMode,glyphOffset:vn,sectionIndex:nt.sectionIndex,isSDF:Yt,pixelOffsetTL:Jt,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}}return je}(0,s,x,d,m,_,c,n.allowVerticalPlacement),ae=n.textSizeData;let Q=null;ae.kind==="source"?(Q=[vo*d.layout.get("text-size").evaluate(_,{},$)],Q[0]>pa&&An(`${n.layerIds[0]}: Value for "text-size" is >= ${md}. Reduce your "text-size".`)):ae.kind==="composite"&&(Q=[vo*L.compositeTextSizes[0].evaluate(_,{},$),vo*L.compositeTextSizes[1].evaluate(_,{},$)],(Q[0]>pa||Q[1]>pa)&&An(`${n.layerIds[0]}: Value for "text-size" is >= ${md}. Reduce your "text-size".`)),n.addSymbols(n.text,J,Q,x,m,_,S,e,r,b.lineStartIndex,b.lineLength,D,B,$);for(const oe of M)k[oe]=n.text.placedSymbolArray.length-1;return 4*J.length}function Vw(n){for(const e in n)return n[e];return null}function Kp(n,e,r,s,c,d,m,_,x,b){let S=m.top,M=m.bottom,k=m.left,D=m.right;const L=m.collisionPadding;if(L&&(k-=L[0],S-=L[1],D+=L[2],M+=L[3]),x){const B=new De(k,S),$=new De(D,S),J=new De(k,M),ae=new De(D,M),Q=At(x);let oe=new De(0,0);b&&(oe=new De(b[0],b[1])),B._rotateAround(Q,oe),$._rotateAround(Q,oe),J._rotateAround(Q,oe),ae._rotateAround(Q,oe),k=Math.min(B.x,$.x,J.x,ae.x),D=Math.max(B.x,$.x,J.x,ae.x),S=Math.min(B.y,$.y,J.y,ae.y),M=Math.max(B.y,$.y,J.y,ae.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,k,S,D,M,_,s,c,d),n.length-1}function gy(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function sk(n,e,r,s){const c=n.compareText;if(e in c){const d=c[e];for(let m=d.length-1;m>=0;m--)if(s.dist(d[m])<r)return!0}else c[e]=[];return c[e].push(s),!1}function $w(n,e){const r=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),d=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),m=Math.sin(n._pitch)*d+c;return Math.min(1.01*m,c*(1/n._horizonShift))}function Fl(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),s=n.x*r,c=(n.x+1)*r,d=n.y*r,m=(n.y+1)*r,_=Ci(s),x=Ci(c),b=Sr(d),S=Sr(m),M=e.project(_,b),k=e.project(x,b),D=e.project(x,S),L=e.project(_,S);let B=Math.min(M.x,k.x,D.x,L.x),$=Math.min(M.y,k.y,D.y,L.y),J=Math.max(M.x,k.x,D.x,L.x),ae=Math.max(M.y,k.y,D.y,L.y);const Q=r/16;function oe(he,Me,Se,Oe,He,Ie){const je=(Se+He)/2,Ue=(Oe+Ie)/2,qe=e.project(Ci(je),Sr(Ue)),tt=Math.max(0,B-qe.x,$-qe.y,qe.x-J,qe.y-ae);B=Math.min(B,qe.x),J=Math.max(J,qe.x),$=Math.min($,qe.y),ae=Math.max(ae,qe.y),tt>Q&&(oe(he,qe,Se,Oe,je,Ue),oe(qe,Me,je,Ue,He,Ie))}oe(M,k,s,d,c,d),oe(k,D,c,d,c,m),oe(D,L,c,m,s,m),oe(L,M,s,m,s,d),B-=Q,$-=Q,J+=Q,ae+=Q;const de=1/Math.max(J-B,ae-$);return{scale:de,x:B*de,y:$*de,x2:J*de,y2:ae*de,projection:e}}const ak=go(new Float32Array(16));class ma{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new fn(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return yo(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return $w(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,c){const d=e.horizonLineFromTop(!1),m=new De(r,Math.max(d,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,c))}pointCoordinate3D(e,r,s){const c=new De(r,s);if(e.elevation)return e.elevation.pointCoordinate(c);{const d=this.pointCoordinate(e,c.x,c.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return ak}createTileMatrix(e,r,s){let c,d,m;const _=s.canonical,x=go(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Fl(_,this);c=1,d=b.x+s.wrap*b.scale,m=b.y,Pl(x,x,[c/b.scale,c/b.scale,e.pixelsPerMeter/r])}else c=r/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*s.wrap)*c,m=_.y*c;return Zh(x,x,[d,m,0]),Pl(x,x,[c/bt,c/bt,1]),x}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class lk extends ma{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(At(r));this.n=(c+Math.sin(At(s)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c,r0:d}=this,m=At(e-this.center[0]),_=At(r),x=Math.sqrt(c-2*s*Math.sin(_))/s;return{x:x*Math.sin(m*s),y:x*Math.cos(m*s)-d,z:0}}unproject(e,r){const{n:s,c,r0:d}=this,m=d+r;let _=Math.atan2(e,Math.abs(m))*Math.sign(m);m*s<0&&(_-=Math.PI*Math.sign(e)*Math.sign(m));const x=At(this.center[0])*s;_=Tt(_,-Math.PI-x,Math.PI-x);const b=Ke(rn(_/s)+this.center[0],-180,180),S=Math.asin(Ke((c-(e*e+m*m)*s*s)/(2*s),-1,1)),M=Ke(rn(S),-Cr,Cr);return new fn(b,M)}}const gd=1.340264,_d=-.081106,yd=893e-6,vd=.003796,Jp=Math.sqrt(3)/2;class ck extends ma{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Jp*Math.sin(r)),c=s*s,d=c*c*c;return{x:.5*(e*Math.cos(s)/(Jp*(gd+3*_d*c+d*(7*yd+9*vd*c)))/Math.PI+.5),y:1-.5*(s*(gd+_d*c+d*(yd+vd*c))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=s*s,d=c*c*c;for(let S,M,k,D=0;D<12&&(M=s*(gd+_d*c+d*(yd+vd*c))-r,k=gd+3*_d*c+d*(7*yd+9*vd*c),S=M/k,s=Ke(s-S,-Math.PI/3,Math.PI/3),c=s*s,d=c*c*c,!(Math.abs(S)<1e-12));++D);const m=Jp*e*(gd+3*_d*c+d*(7*yd+9*vd*c))/Math.cos(s),_=Math.asin(Math.sin(s)/Jp),x=Ke(180*m/Math.PI,-180,180),b=Ke(180*_/Math.PI,-Cr,Cr);return new fn(x,b)}}class uk extends ma{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),c=Ke(360*(.5-r),-Cr,Cr);return new fn(s,c)}}const au=Math.PI/2;function Qp(n){return Math.tan((au+n)/2)}class hk extends ma{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30];let c=At(r),d=At(s);this.southernCenter=c+d<0,this.southernCenter&&(c=-c,d=-d);const m=Math.cos(c),_=Qp(c);this.n=c===d?Math.sin(c):Math.log(m/Math.cos(d))/Math.log(Qp(d)/_),this.f=m*Math.pow(Qp(c),this.n)/this.n}project(e,r){r=At(r),this.southernCenter&&(r=-r),e=At(e-this.center[0]);const s=1e-6,{n:c,f:d}=this;d>0?r<-au+s&&(r=-au+s):r>au-s&&(r=au-s);const m=d/Math.pow(Qp(r),c);let _=m*Math.sin(c*e),x=d-m*Math.cos(c*e);return _=.5*(_/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:_,y:this.southernCenter?x:1-x,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:c}=this,d=c-r,m=Math.sign(d),_=Math.sign(s)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*m;d*s<0&&(x-=Math.PI*Math.sign(e)*m);const b=Ke(rn(x/s)+this.center[0],-180,180),S=Ke(rn(2*Math.atan(Math.pow(c/_,1/s))-au),-Cr,Cr);return new fn(b,this.southernCenter?-S:S)}}class Gw extends ma{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:jo(e),y:Uo(r),z:0}}unproject(e,r){const s=Ci(e),c=Sr(r);return new fn(s,c)}}const qw=At(Cr);class dk extends ma{project(e,r){const s=(r=At(r))*r,c=s*s;return{x:.5*((e=At(e))*(.8707-.131979*s+c*(c*(.003971*s-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+c*(.028874*s-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,c=25,d=0,m=s*s;do{m=s*s;const b=m*m;d=(s*(1.007226+m*(.015085+b*(.028874*m-.044475-.005916*b)))-r)/(1.007226+m*(.045255+b*(.259866*m-.311325-.005916*11*b))),s=Ke(s-d,-qw,qw)}while(Math.abs(d)>1e-6&&--c>0);m=s*s;const _=Ke(rn(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=rn(s);return new fn(_,x)}}const Zw=At(Cr);class fk extends ma{project(e,r){r=At(r),e=At(e);const s=Math.cos(r),c=2/Math.PI,d=Math.acos(s*Math.cos(e/2)),m=Math.sin(d)/d,_=.5*(e*c+2*s*Math.sin(e/2)/m)||0,x=.5*(r+Math.sin(r)/m)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,c=r=(2*(1-r)-1)*Math.PI,d=25;const m=1e-6;let _=0,x=0;do{const b=Math.cos(c),S=Math.sin(c),M=2*S*b,k=S*S,D=b*b,L=Math.cos(s/2),B=Math.sin(s/2),$=2*L*B,J=B*B,ae=1-D*L*L,Q=ae?1/ae:0,oe=ae?Math.acos(b*L)*Math.sqrt(1/ae):0,de=.5*(2*oe*b*B+2*s/Math.PI)-e,he=.5*(oe*S+c)-r,Me=.5*Q*(D*J+oe*b*L*k)+1/Math.PI,Se=Q*($*M/4-oe*S*B),Oe=.125*Q*(M*B-oe*S*D*$),He=.5*Q*(k*L+oe*J*b)+.5,Ie=Se*Oe-He*Me;_=(he*Se-de*He)/Ie,x=(de*Oe-he*Me)/Ie,s=Ke(s-_,-Math.PI,Math.PI),c=Ke(c-x,-Zw,Zw)}while((Math.abs(_)>m||Math.abs(x)>m)&&--d>0);return new fn(rn(s),rn(c))}}class Ww extends ma{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(At(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:c}=this;return{x:At(e)*c*s+.5,y:-Math.sin(At(r))/c*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:c}=this,d=-(r-.5)/s,m=Ke(rn((e-.5)/s)/c,-180,180),_=Math.asin(Ke(d*c,-1,1)),x=Ke(rn(_),-Cr,Cr);return new fn(m,x)}}class pk extends Gw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,s){const c=ed(e,r,s);return Nn(c,c,td(No(s))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,r){const s=Zc(r.lat,r.lng),c=Nr([],s),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Yh(s,s,c,yo(1,0)*bt*d);const m=go(new Float64Array(16));return Il(m,e.pixelMatrix,e.globeMatrix),Nn(s,s,m),new De(s[0],s[1])}pixelsPerMeter(e,r){return yo(1,0)*r}pixelSpaceConversion(e,r,s){const c=yo(1,e)*r,d=Xt(yo(1,45)*r,c,s);return this.pixelsPerMeter(e,r)/d}createTileMatrix(e,r,s){const c=j_(No(s.canonical));return Il(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,r){const{center:s}=e,c=td(No(r));return Ap(c,c,At(s.lng)),I_(c,c,At(s.lat)),Pl(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,r,s,c){return x1(e,r,s,!0)||new Xc(0,0)}pointCoordinate3D(e,r,s){const c=this.pointCoordinate(e,r,s,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,r){return!x1(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(c,d){const m=c.cameraToCenterDistance,_=c._centerAltitude*d,x=c._camera,b=c._camera.forward(),S=vs([],Si([],b,-m),[0,0,_]),M=c.worldSize/(2*Math.PI),k=[0,0,-M],D=c.width/c.height,L=Math.tan(c.fovAboveCenter),B=Si([],x.up(),L),$=Si([],x.right(),L*D),J=Nr([],vs([],vs([],b,B),$)),ae=[];let Q;if(new L_(S,J).closestPointOnSphere(k,M,ae)){const oe=vs([],ae,k),de=_o([],oe,S);Q=Math.cos(c.fovAboveCenter)*Wh(de)}else{const oe=_o([],S,k),de=_o([],k,S);Nr(de,de);const he=Wh(oe)-M;Q=Math.sqrt(he*(he+2*M));const Me=Math.acos(Q/(M+he))-Math.acos(Gi(b,de));Q*=Math.cos(Me)}return 1.01*Q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Wc(e.zoom);if(s>0){const c=$w(e,yo(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Xt(r,c+d*(1-Math.cos(m)),Math.pow(s,10))}return r}upVector(e,r,s){return ed(r,s,e,1)}upVectorScale(e){return{metersToTile:Mp(Ip(No(e)))}}}function Xw(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Gw(n);case"equirectangular":return new uk(n);case"naturalEarth":return new dk(n);case"equalEarth":return new ck(n);case"winkelTripel":return new fk(n);case"albers":return r?new Ww(n):new lk(n);case"lambertConformalConic":return r?new Ww(n):new hk(n);case"globe":return new pk(n)}throw new Error(`Invalid projection name: ${n.name}`)}const mk=jp.types,gk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function em(n,e,r,s,c,d,m,_,x,b,S,M,k){const D=_?Math.min(pa,Math.round(_[0])):0,L=_?Math.min(pa,Math.round(_[1])):0;n.emplaceBack(e,r,Math.round(32*s),Math.round(32*c),d,m,(D<<1)+(x?1:0),L,16*b,16*S,256*M,256*k)}function tm(n,e,r,s,c,d,m){n.emplaceBack(e,r,s,c,d,m)}function nm(n,e,r,s,c){n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c),n.emplaceBack(e,r,s,c)}function _k(n){for(const e of n.sections)if(S_(e.text))return!0;return!1}class _y{constructor(e){this.layoutVertexArray=new Ge,this.indexArray=new gt,this.programConfigurations=e,this.segments=new Gn,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new yt,this.placedSymbolArray=new $n,this.globeExtVertexArray=new Qe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,AM.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,gk,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,CM.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ft(_y,"SymbolBuffers");class yy{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Gn,this.collisionVertexArray=new $t,this.collisionVertexArrayExt=new jt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,MM.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,kM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ft(yy,"CollisionBuffers");class ga{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=go([]),this.placementViewportMatrix=go([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sy(this.zoom,r["text-size"]),this.iconSizeData=sy(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>Ai[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new _y(new kl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new _y(new kl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Fr,this.lineVertexArray=new Uc,this.symbolInstances=new En}calculateGlyphDependencies(e,r,s,c,d){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,c&&d){const _=dd[e.charAt(m)];_&&(r[_.charCodeAt(0)]=!0)}}populate(e,r,s,c){const d=this.layers[0],m=d.layout,_=this.projection.name==="globe",x=m.get("text-font"),b=m.get("text-field"),S=m.get("icon-image"),M=(b.value.kind!=="constant"||b.value.value instanceof Br&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),k=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],!M&&!k)return;const L=r.iconDependencies,B=r.glyphDependencies,$=r.availableImages,J=new A(this.zoom);for(const{feature:ae,id:Q,index:oe,sourceLayerIndex:de}of e){const he=d._featureFilter.needGeometry,Me=Rl(ae,he);if(!d._featureFilter.filter(J,Me,s))continue;if(he||(Me.geometry=xs(ae,s,c)),_&&ae.type!==1&&s.z<=5){const Ie=Me.geometry,je=.98078528056,Ue=(qe,tt)=>Gi(ed(qe.x,qe.y,s,1),ed(tt.x,tt.y,s,1))<je;for(let qe=0;qe<Ie.length;qe++)Ie[qe]=AA(Ie[qe],Ue)}let Se,Oe;if(M){const Ie=d.getValueAndResolveTokens("text-field",Me,s,$),je=Br.factory(Ie);_k(je)&&(this.hasRTLText=!0),(!this.hasRTLText||v()==="unavailable"||this.hasRTLText&&T.isParsed())&&(Se=zM(je,d,Me))}if(k){const Ie=d.getValueAndResolveTokens("icon-image",Me,s,$);Oe=Ie instanceof li?Ie:li.fromString(Ie)}if(!Se&&!Oe)continue;const He=this.sortFeaturesByKey?D.evaluate(Me,{},s):void 0;if(this.features.push({id:Q,text:Se,icon:Oe,index:oe,sourceLayerIndex:de,geometry:Me.geometry,properties:ae.properties,type:mk[ae.type],sortKey:He}),Oe&&(L[Oe.name]=!0),Se){const Ie=x.evaluate(Me,{},s).join(","),je=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ai.vertical)>=0;for(const Ue of Se.sections)if(Ue.image)L[Ue.image.name]=!0;else{const qe=Nh(Se.toString()),tt=Ue.fontStack||Ie,Le=B[tt]=B[tt]||{};this.calculateGlyphDependencies(Ue.text,Le,je,this.allowVerticalPlacement,qe)}}}m.get("symbol-placement")==="line"&&(this.features=function(ae){const Q={},oe={},de=[];let he=0;function Me(Ie){de.push(ae[Ie]),he++}function Se(Ie,je,Ue){const qe=oe[Ie];return delete oe[Ie],oe[je]=qe,de[qe].geometry[0].pop(),de[qe].geometry[0]=de[qe].geometry[0].concat(Ue[0]),qe}function Oe(Ie,je,Ue){const qe=Q[je];return delete Q[je],Q[Ie]=qe,de[qe].geometry[0].shift(),de[qe].geometry[0]=Ue[0].concat(de[qe].geometry[0]),qe}function He(Ie,je,Ue){const qe=Ue?je[0][je[0].length-1]:je[0][0];return`${Ie}:${qe.x}:${qe.y}`}for(let Ie=0;Ie<ae.length;Ie++){const je=ae[Ie],Ue=je.geometry,qe=je.text?je.text.toString():null;if(!qe){Me(Ie);continue}const tt=He(qe,Ue),Le=He(qe,Ue,!0);if(tt in oe&&Le in Q&&oe[tt]!==Q[Le]){const lt=Oe(tt,Le,Ue),mt=Se(tt,Le,de[lt].geometry);delete Q[tt],delete oe[Le],oe[He(qe,de[mt].geometry,!0)]=mt,de[lt].geometry=null}else tt in oe?Se(tt,Le,Ue):Le in Q?Oe(tt,Le,Ue):(Me(Ie),Q[tt]=he-1,oe[Le]=he-1)}return de.filter(Ie=>Ie.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,Q)=>ae.sortKey-Q.sortKey)}update(e,r,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:d}of r)this.lineVertexArray.emplaceBack(c,d);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,d,m,_,x,b,S,M,k,D,L){const B=e.indexArray,$=e.layoutVertexArray,J=e.globeExtVertexArray,ae=e.segments.prepareSegment(4*r.length,$,B,this.canOverlap?m.sortKey:void 0),Q=this.glyphOffsetArray.length,oe=ae.vertexLength,de=this.allowVerticalPlacement&&_===Ai.vertical?Math.PI/2:0,he=m.text&&m.text.sections;for(let Se=0;Se<r.length;Se++){const{tl:Oe,tr:He,bl:Ie,br:je,tex:Ue,pixelOffsetTL:qe,pixelOffsetBR:tt,minFontScaleX:Le,minFontScaleY:lt,glyphOffset:mt,isSDF:ct,sectionIndex:It}=r[Se],nt=ae.vertexLength,vt=mt[1];if(em($,b.x,b.y,Oe.x,vt+Oe.y,Ue.x,Ue.y,s,ct,qe.x,qe.y,Le,lt),em($,b.x,b.y,He.x,vt+He.y,Ue.x+Ue.w,Ue.y,s,ct,tt.x,qe.y,Le,lt),em($,b.x,b.y,Ie.x,vt+Ie.y,Ue.x,Ue.y+Ue.h,s,ct,qe.x,tt.y,Le,lt),em($,b.x,b.y,je.x,vt+je.y,Ue.x+Ue.w,Ue.y+Ue.h,s,ct,tt.x,tt.y,Le,lt),x){const{x:Pt,y:Yt,z:zt}=x.anchor,[St,bn,Rt]=x.up;tm(J,Pt,Yt,zt,St,bn,Rt),tm(J,Pt,Yt,zt,St,bn,Rt),tm(J,Pt,Yt,zt,St,bn,Rt),tm(J,Pt,Yt,zt,St,bn,Rt),nm(e.dynamicLayoutVertexArray,Pt,Yt,zt,de)}else nm(e.dynamicLayoutVertexArray,b.x,b.y,b.z,de);B.emplaceBack(nt,nt+1,nt+2),B.emplaceBack(nt+1,nt+2,nt+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),Se!==r.length-1&&It===r[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,m,m.index,{},D,L,he&&he[It])}const Me=x?x.anchor:b;e.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,b.x,b.y,Q,this.glyphOffsetArray.length-Q,oe,S,M,b.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],_,0,!1,0,k,0)}_commitLayoutVertex(e,r,s,c,d,m,_){e.emplaceBack(r,s,c,d,m,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,r,s,c,d,m,_){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),b=x.vertexLength,S=_.tileAnchorX,M=_.tileAnchorY;for(let D=0;D<4;D++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,S,M,new De(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,S,M,new De(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,S,M,new De(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,S,M,new De(e.x1,e.y2)),x.vertexLength+=4;const k=s.indexArray;k.emplaceBack(b,b+1),k.emplaceBack(b+1,b+2),k.emplaceBack(b+2,b+3),k.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,c,d,m){for(let _=c;_<d;_++){const x=s.get(_),b=this.getSymbolInstanceTextSize(e,m,r,_);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,s,c,d,m){for(let _=c;_<d;_++){const x=s.get(_),b=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new yy(pt,fw.members,lr),this.iconCollisionBox=new yy(pt,fw.members,lr);const s=Qc(this.iconSizeData,e),c=Qc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,s,c){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),m=Gp(this.textSizeData,e,d)/pr;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,s){const c=this.icon.placedSymbolArray.get(s),d=Gp(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,c,d,m){for(let _=c;_<d;_++){const x=s.get(_),b=this.getSymbolInstanceTextSize(e,m,r,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding)}}_updateIconDebugCollisionBoxes(e,r,s,c,d,m){for(let _=c;_<d;_++){const x=s.get(_),b=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Qc(this.iconSizeData,e),c=Qc(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,c,d,m,_,x,b){const S={};if(r<s){const{x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe,featureIndex:de}=e.get(r);S.textBox={x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe},S.textFeatureIndex=de}if(c<d){const{x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe,featureIndex:de}=e.get(c);S.verticalTextBox={x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe},S.verticalTextFeatureIndex=de}if(m<_){const{x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe,featureIndex:de}=e.get(m);S.iconBox={x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe},S.iconFeatureIndex=de}if(x<b){const{x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe,featureIndex:de}=e.get(x);S.verticalIconBox={x1:M,y1:k,x2:D,y2:L,padding:B,projectedAnchorX:$,projectedAnchorY:J,projectedAnchorZ:ae,tileAnchorX:Q,tileAnchorY:oe},S.verticalIconFeatureIndex=de}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],d=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(r*x.tileAnchorX+s*x.tileAnchorY)),d.push(x.featureIndex)}return m.sort((_,x)=>c[_]-c[x]||d[x]-d[_]),m}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=s;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ft(ga,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ga.MAX_GLYPHS=65535,ga.addDynamicAttributes=nm;const yk=new ne({"symbol-placement":new O(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new O(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new O(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new G(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new O(Re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new O(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new O(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new O(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new O(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new G(Re.layout_symbol["icon-size"]),"icon-text-fit":new O(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new O(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new G(Re.layout_symbol["icon-image"]),"icon-rotate":new G(Re.layout_symbol["icon-rotate"]),"icon-padding":new O(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new O(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new G(Re.layout_symbol["icon-offset"]),"icon-anchor":new G(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new O(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new O(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new O(Re.layout_symbol["text-rotation-alignment"]),"text-field":new G(Re.layout_symbol["text-field"]),"text-font":new G(Re.layout_symbol["text-font"]),"text-size":new G(Re.layout_symbol["text-size"]),"text-max-width":new G(Re.layout_symbol["text-max-width"]),"text-line-height":new G(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new G(Re.layout_symbol["text-letter-spacing"]),"text-justify":new G(Re.layout_symbol["text-justify"]),"text-radial-offset":new G(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new O(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new G(Re.layout_symbol["text-anchor"]),"text-max-angle":new O(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new O(Re.layout_symbol["text-writing-mode"]),"text-rotate":new G(Re.layout_symbol["text-rotate"]),"text-padding":new O(Re.layout_symbol["text-padding"]),"text-keep-upright":new O(Re.layout_symbol["text-keep-upright"]),"text-transform":new G(Re.layout_symbol["text-transform"]),"text-offset":new G(Re.layout_symbol["text-offset"]),"text-allow-overlap":new O(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new O(Re.layout_symbol["text-ignore-placement"]),"text-optional":new O(Re.layout_symbol["text-optional"])});var vy={paint:new ne({"icon-opacity":new G(Re.paint_symbol["icon-opacity"]),"icon-color":new G(Re.paint_symbol["icon-color"]),"icon-halo-color":new G(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new G(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new G(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new O(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new O(Re.paint_symbol["icon-translate-anchor"]),"text-opacity":new G(Re.paint_symbol["text-opacity"]),"text-color":new G(Re.paint_symbol["text-color"],{runtimeType:Kr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new G(Re.paint_symbol["text-halo-color"]),"text-halo-width":new G(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new G(Re.paint_symbol["text-halo-blur"]),"text-translate":new O(Re.paint_symbol["text-translate"]),"text-translate-anchor":new O(Re.paint_symbol["text-translate-anchor"])}),layout:yk};class Hw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft(Hw,"FormatSectionOverride",{omit:["defaultValue"]});class rm extends mo{constructor(e){super(e,vy)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const d=this.layout.get(e).evaluate(r,{},s,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||ia(m.value)||!d?d:function(_,x){return x.replace(/{([^{}]+)}/g,(b,S)=>S in _?String(_[S]):"")}(r.properties,d)}createBucket(e){return new ga(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of vy.paint.overridableProperties){if(!rm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Hw(r),c=new Dc(s,r.property.specification);let d=null;d=r.value.kind==="constant"||r.value.kind==="source"?new Mh("source",c):new xl("composite",c,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new W(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&rm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=vy.paint.properties[r];let d=!1;const m=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Br)m(s.value.value.sections);else if(s.value.kind==="source"){const _=b=>{d||(b instanceof ls&&zn(b.value)===rl?m(b.value.sections):b instanceof Ro?m(b.sections):b.eachChild(_))},x=s.value;x._styleExpression&&_(x._styleExpression.expression)}return d}getProgramConfiguration(e){return new ha(this,e)}}var vk={paint:new ne({"background-color":new O(Re.paint_background["background-color"]),"background-pattern":new O(Re.paint_background["background-pattern"]),"background-opacity":new O(Re.paint_background["background-opacity"])})},xk={paint:new ne({"raster-opacity":new O(Re.paint_raster["raster-opacity"]),"raster-hue-rotate":new O(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new O(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new O(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new O(Re.paint_raster["raster-saturation"]),"raster-contrast":new O(Re.paint_raster["raster-contrast"]),"raster-resampling":new O(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new O(Re.paint_raster["raster-fade-duration"])})};class wk extends mo{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var bk={paint:new ne({"sky-type":new O(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new O(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new O(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new O(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new O(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new te(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new O(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new O(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new O(Re.paint_sky["sky-opacity"])})};function xy(n,e,r){const s=[0,0,1],c=p1([]);return g1(c,c,r?-At(n)+Math.PI:At(n)),m1(c,c,-At(e)),u1(s,s,c),Nr(s,s)}const Ek={circle:class extends mo{constructor(n){super(n,LA)}createBucket(n){return new Z_(n)}queryRadius(n){const e=n;return Hc("circle-radius",this,e)+Hc("circle-stroke-width",this,e)+Dp(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,s,c,d,m,_){const x=F1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return N1(n,s,d,m,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new ha(this,n)}},heatmap:class extends mo{createBucket(n){return new U1(n)}constructor(n){super(n,FA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Y_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Hc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,s,c,d,m,_){const x=this.paint.get("heatmap-radius").evaluate(e,r);return N1(n,s,d,m,_,!0,!0,new De(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new ha(this,n)}},hillshade:class extends mo{constructor(n){super(n,NA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends mo{constructor(n){super(n,tM)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new ha(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Fp(n)}queryRadius(){return Dp(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,s,c,d){return!n.queryGeometry.isAboveHorizon&&D1(B1(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends mo{constructor(n){super(n,_M)}createBucket(n){return new cd(n)}queryRadius(){return Dp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new ha(this,n)}queryIntersectsFeature(n,e,r,s,c,d,m,_,x){const b=F1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,r),M=this.paint.get("fill-extrusion-base").evaluate(e,r),k=[0,0],D=_&&d.elevation,L=d.elevation?d.elevation.exaggeration():1,B=n.tile.getBucket(this);if(D&&B instanceof cd){const oe=B.centroidVertexArray,de=x+1;de<oe.length&&(k[0]=oe.geta_centroid_pos0(de),k[1]=oe.geta_centroid_pos1(de))}if(k[0]===0&&k[1]===1)return!1;d.projection.name==="globe"&&(s=ow([s],[new De(0,0),new De(bt,bt)],n.tileID.canonical).map(oe=>oe.polygon).flat());const $=D?_:null,[J,ae]=function(oe,de,he,Me,Se,Oe,He,Ie,je,Ue,qe){return oe.projection.name==="globe"?function(tt,Le,lt,mt,ct,It,nt,vt,Pt,Yt,zt){const St=[],bn=[],Rt=tt.projection.upVectorScale(zt,tt.center.lat,tt.worldSize).metersToTile,Ot=[0,0,0,1],pn=[0,0,0,1],vn=(mn,kn,Dn,Zn)=>{mn[0]=kn,mn[1]=Dn,mn[2]=Zn,mn[3]=1},xn=iw();lt>0&&(lt+=xn),mt+=xn;for(const mn of Le){const kn=[],Dn=[];for(const Zn of mn){const gn=Zn.x+ct.x,er=Zn.y+ct.y,Wn=tt.projection.projectTilePoint(gn,er,zt),In=tt.projection.upVector(zt,Zn.x,Zn.y);let Jt=lt,Xn=mt;if(nt){const wn=cw(gn,er,lt,mt,nt,vt,Pt,Yt);Jt+=wn.base,Xn+=wn.top}lt!==0?vn(Ot,Wn.x+In[0]*Rt*Jt,Wn.y+In[1]*Rt*Jt,Wn.z+In[2]*Rt*Jt):vn(Ot,Wn.x,Wn.y,Wn.z),vn(pn,Wn.x+In[0]*Rt*Xn,Wn.y+In[1]*Rt*Xn,Wn.z+In[2]*Rt*Xn),Nn(Ot,Ot,It),Nn(pn,pn,It),kn.push(new Jc(Ot[0],Ot[1],Ot[2])),Dn.push(new Jc(pn[0],pn[1],pn[2]))}St.push(kn),bn.push(Dn)}return[St,bn]}(oe,de,he,Me,Se,Oe,He,Ie,je,Ue,qe):He?function(tt,Le,lt,mt,ct,It,nt,vt,Pt){const Yt=[],zt=[],St=[0,0,0,1];for(const bn of tt){const Rt=[],Ot=[];for(const pn of bn){const vn=pn.x+mt.x,xn=pn.y+mt.y,mn=cw(vn,xn,Le,lt,It,nt,vt,Pt);St[0]=vn,St[1]=xn,St[2]=mn.base,St[3]=1,zl(St,St,ct),St[3]=Math.max(St[3],1e-5);const kn=new Jc(St[0]/St[3],St[1]/St[3],St[2]/St[3]);St[0]=vn,St[1]=xn,St[2]=mn.top,St[3]=1,zl(St,St,ct),St[3]=Math.max(St[3],1e-5);const Dn=new Jc(St[0]/St[3],St[1]/St[3],St[2]/St[3]);Rt.push(kn),Ot.push(Dn)}Yt.push(Rt),zt.push(Ot)}return[Yt,zt]}(de,he,Me,Se,Oe,He,Ie,je,Ue):function(tt,Le,lt,mt,ct){const It=[],nt=[],vt=ct[8]*Le,Pt=ct[9]*Le,Yt=ct[10]*Le,zt=ct[11]*Le,St=ct[8]*lt,bn=ct[9]*lt,Rt=ct[10]*lt,Ot=ct[11]*lt;for(const pn of tt){const vn=[],xn=[];for(const mn of pn){const kn=mn.x+mt.x,Dn=mn.y+mt.y,Zn=ct[0]*kn+ct[4]*Dn+ct[12],gn=ct[1]*kn+ct[5]*Dn+ct[13],er=ct[2]*kn+ct[6]*Dn+ct[14],Wn=ct[3]*kn+ct[7]*Dn+ct[15],In=Zn+vt,Jt=gn+Pt,Xn=er+Yt,wn=Math.max(Wn+zt,1e-5),Vr=Zn+St,Hn=gn+bn,mr=er+Rt,cr=Math.max(Wn+Ot,1e-5);vn.push(new Jc(In/wn,Jt/wn,Xn/wn)),xn.push(new Jc(Vr/cr,Hn/cr,mr/cr))}It.push(vn),nt.push(xn)}return[It,nt]}(de,he,Me,Se,Oe)}(d,s,M,S,b,m,$,k,L,d.center.lat,n.tileID.canonical),Q=n.queryGeometry;return function(oe,de,he){let Me=1/0;D1(he,de)&&(Me=lw(he,de[0]));for(let Se=0;Se<de.length;Se++){const Oe=de[Se],He=oe[Se];for(let Ie=0;Ie<Oe.length-1;Ie++){const je=Oe[Ie],Ue=[je,Oe[Ie+1],He[Ie+1],He[Ie],je];z1(he,Ue)&&(Me=Math.min(Me,lw(he,Ue)))}}return Me!==1/0&&Me}(J,ae,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends mo{constructor(n){super(n,uw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof mh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=hw.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new $p(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new ha(this,n)}queryRadius(n){const e=n,r=dw(Hc("line-width",this,e),Hc("line-gap-width",this,e)),s=Hc("line-offset",this,e);return r/2+Math.abs(s)+Dp(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,s,c,d){if(n.queryGeometry.isAboveHorizon)return!1;const m=B1(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),_=n.pixelToTileUnitsFactor/2*dw(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(s=function(b,S){const M=[],k=new De(0,0);for(let D=0;D<b.length;D++){const L=b[D],B=[];for(let $=0;$<L.length;$++){const J=L[$],ae=L[$+1],Q=$===0?k:J.sub(L[$-1])._unit()._perp(),oe=$===L.length-1?k:ae.sub(J)._unit()._perp(),de=Q._add(oe)._unit();de._mult(1/(de.x*oe.x+de.y*oe.y)),B.push(de._mult(S)._add(J))}M.push(B)}return M}(s,x*n.pixelToTileUnitsFactor)),function(b,S,M){for(let k=0;k<S.length;k++){const D=S[k];if(b.length>=3){for(let L=0;L<D.length;L++)if(Ol(b,D[L]))return!0}if(IA(b,D,M))return!0}return!1}(m,s,_)}isTileClipped(){return!0}},symbol:rm,background:class extends mo{constructor(n){super(n,vk)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends mo{constructor(n){super(n,xk)}getProgramIds(){return["raster"]}},sky:class extends mo{constructor(n){super(n,bk),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Y_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),c=!s,d=n.style.light,m=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&An("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?xy(m.azimuthal,90-m.polar,e):xy(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return xy(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class xd{constructor(e,r,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,s){const{width:c,height:d}=e,{context:m}=this,{gl:_}=m,{HTMLImageElement:x,HTMLCanvasElement:b,HTMLVideoElement:S,ImageData:M,ImageBitmap:k}=z;if(_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!r||r.premultiply!==!1)),s||this.size&&this.size[0]===c&&this.size[1]===d){const{x:D,y:L}=s||{x:0,y:0};e instanceof x||e instanceof b||e instanceof S||e instanceof M||k&&e instanceof k?_.texSubImage2D(_.TEXTURE_2D,0,D,L,_.RGBA,_.UNSIGNED_BYTE,e):_.texSubImage2D(_.TEXTURE_2D,0,D,L,c,d,_.RGBA,_.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof x||e instanceof b||e instanceof S||e instanceof M||k&&e instanceof k?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,e):_.texImage2D(_.TEXTURE_2D,0,this.format,c,d,0,this.format,_.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Tk{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Sk{constructor(){this.tasks={},this.taskQueue=[],ts(["process"],this),this.invoker=new Tk(this.process),this.nextId=0}add(e,r){const s=this.nextId++,c=function({type:d,isSymbolTile:m,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||m?d!=="parseTile"||m?d==="parseTile"&&m?300-_:d==="maybePrepare"&&m?400-_:500:200-_:100-_}(r);if(c===0){to();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){to();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<r&&(r=d.priority,e=c)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Yw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Ck=["tile","layer","source","sourceLayer","state"];class Kw{constructor(e,r,s,c,d){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of Ck)this[r]!==void 0&&(e[r]=this[r]);return e}}const Wi=32,Vo=33,_a=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,s=0,c=0,d=0,m=0,_=0;for(1&e?c=d=m=Wi:r=s=_=Wi;(e>>=1)>1;){const b=r+c>>1,S=s+d>>1;1&e?(c=r,d=s,r=m,s=_):(r=c,s=d,c=m,d=_),m=b,_=S}const x=4*n;_a[x+0]=r,_a[x+1]=s,_a[x+2]=c,_a[x+3]=d}const $o=new Uint16Array(2178),ya=new Uint8Array(1089),im=new Uint16Array(1089);function Jw(n){return n===0?-.03125:n===32?.03125:0}var Qw=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const eb={type:2,extent:bt,loadGeometry:()=>[[new De(0,0),new De(bt+1,0),new De(bt+1,bt+1),new De(0,bt+1),new De(0,0)]]};class wy{constructor(e,r,s,c,d){this.tileID=e,this.uid=xr(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<no.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Fl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const m={};if(!d)return m;for(const _ of c){const x=_.layerIds.map(b=>d.getLayer(b)).filter(Boolean);if(x.length!==0){_.layers=x,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(b=>x.filter(S=>S.id===b)[0]));for(const b of x)m[b.id]=_}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof ga){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof ga&&d.hasRTLText){this.hasRTLText=!0,T.isLoading()||T.isLoaded()||v()!=="deferred"||E();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new dn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xd(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xd(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xd(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,d,m,_,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:_,transform:m,params:d,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=r?r.sourceLayer:"",m=c._geojsonTileLayer||c[d];if(!m)return;const _=Bc(r&&r.filter),{z:x,x:b,y:S}=this.tileID.canonical,M={z:x,x:b,y:S};for(let k=0;k<m.length;k++){const D=m.feature(k);if(_.needGeometry){const $=Rl(D,!0);if(!_.filter(new A(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!_.filter(new A(this.tileID.overscaledZ),D))continue;const L=s.getId(D,d),B=new Kw(D,x,b,S,L);B.tile=M,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=Yr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const d=this.expirationTime-r;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),c=r.style.listImages();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const m=this.buckets[d],_=m.layers[0].sourceLayer||"_geojsonTileLayer",x=s[_],b=e[_];if(!x||!b||Object.keys(b).length===0)continue;if(m.update(b,x,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof $p||m instanceof Fp){const M=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&M&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(M.id,this.tileID)}const S=r&&r.style&&r.style.getLayer(d);S&&(this.queryPadding=Math.max(this.queryPadding,S.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<no.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=no.now()+e}setTexture(e,r){const s=r.context,c=s.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new xd(s,e,c.RGBA,{useMipmap:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE))}setDependencies(e,r){const s={};for(const c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const c=this.dependencies[s];if(c){for(const d of r)if(c[d])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const s=xs(eb,this.tileID.canonical,this.tileTransform)[0],c=new Xe,d=new hi;for(let m=0;m<s.length;m++){const{x:_,y:x}=s[m];c.emplaceBack(_,x),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Jh.members),this._tileDebugSegments=Gn.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const s=xs(eb,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const m=function(_,x){const b=Fl(_,x),S=Math.pow(2,_.z);for(let $=0;$<Vo;$++)for(let J=0;J<Vo;J++){const ae=Ci((_.x+(J+Jw(J))/Wi)/S),Q=Sr((_.y+($+Jw($))/Wi)/S),oe=x.project(ae,Q),de=$*Vo+J;$o[2*de+0]=Math.round((oe.x*b.scale-b.x)*bt),$o[2*de+1]=Math.round((oe.y*b.scale-b.y)*bt)}ya.fill(0),im.fill(0);for(let $=2045;$>=0;$--){const J=4*$,ae=_a[J+0],Q=_a[J+1],oe=_a[J+2],de=_a[J+3],he=ae+oe>>1,Me=Q+de>>1,Se=he+Me-Q,Oe=Me+ae-he,He=Q*Vo+ae,Ie=de*Vo+oe,je=Me*Vo+he,Ue=Math.hypot(($o[2*He+0]+$o[2*Ie+0])/2-$o[2*je+0],($o[2*He+1]+$o[2*Ie+1])/2-$o[2*je+1])>=16;ya[je]=ya[je]||(Ue?1:0),$<1022&&(ya[je]=ya[je]||ya[(Q+Oe>>1)*Vo+(ae+Se>>1)]||ya[(de+Oe>>1)*Vo+(oe+Se>>1)])}const M=new Ne,k=new gt;let D=0;function L($,J){const ae=J*Vo+$;return im[ae]===0&&(M.emplaceBack($o[2*ae+0],$o[2*ae+1],$*bt/Wi,J*bt/Wi),im[ae]=++D),im[ae]-1}function B($,J,ae,Q,oe,de){const he=$+ae>>1,Me=J+Q>>1;if(Math.abs($-oe)+Math.abs(J-de)>1&&ya[Me*Vo+he])B(oe,de,$,J,he,Me),B(ae,Q,oe,de,he,Me);else{const Se=L($,J),Oe=L(ae,Q),He=L(oe,de);k.emplaceBack(Se,Oe,He)}}return B(0,0,Wi,Wi,Wi,0),B(Wi,Wi,0,0,0,Wi),{vertices:M,indices:k}}(this.tileID.canonical,r);c=m.vertices,d=m.indices}else{c=new Ne,d=new gt;for(const{x:_,y:x}of s)c.emplaceBack(_,x,0,0);const m=ty(c.int16,void 0,4);for(let _=0;_<m.length;_+=3)d.emplaceBack(m[_],m[_+1],m[_+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Qw.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Gn.simpleSegment(0,0,c.length,d.length)}_makeGlobeTileDebugBuffers(e,r){const s=r.projection;if(!s||s.name!=="globe"||r.freezeTileCoverage)return;const c=this.tileID.canonical,d=td(w1(c,r)),m=Wc(r.zoom);let _;m>0&&(_=k_(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,c,r,d,_,m),this._makeGlobeTileDebugTextBuffer(e,c,r,d,_,m)}_globePoint(e,r,s,c,d,m,_){let x=ed(e,r,s);if(m){const b=1<<s.z,S=jo(c.center.lng),M=Uo(c.center.lat),k=(s.x+.5)/b-S;let D=0;k>.5?D=-1:k<-.5&&(D=1);let L=(e/bt+s.x)/b+D,B=(r/bt+s.y)/b;L=(L-S)*c._pixelsPerMercatorPixel+S,B=(B-M)*c._pixelsPerMercatorPixel+M;const $=[L*c.worldSize,B*c.worldSize,0];Nn($,$,m),x=Ll(x,$,_)}return Nn(x,x,d)}_makeGlobeTileDebugBorderBuffer(e,r,s,c,d,m){const _=new Xe,x=new hi,b=new Te,S=(k,D,L,B,$)=>{const J=(L-k)/($-1),ae=(B-D)/($-1),Q=_.length;for(let oe=0;oe<$;oe++){const de=k+oe*J,he=D+oe*ae;_.emplaceBack(de,he);const Me=this._globePoint(de,he,r,s,c,d,m);b.emplaceBack(Me[0],Me[1],Me[2]),x.emplaceBack(Q+oe)}},M=bt;S(0,0,M,0,16),S(M,0,M,M,16),S(M,M,0,M,16),S(0,M,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(_,Jh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,y1.members),this._tileDebugSegments=Gn.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugTextBuffer(e,r,s,c,d,m){const _=bt/4,x=new Xe,b=new gt,S=new Te,M=25;b.reserve(32),x.reserve(M),S.reserve(M);const k=(D,L)=>M*D+L;for(let D=0;D<M;D++){const L=D*_;for(let B=0;B<M;B++){const $=B*_;x.emplaceBack($,L);const J=this._globePoint($,L,r,s,c,d,m);S.emplaceBack(J[0],J[1],J[2])}}for(let D=0;D<4;D++)for(let L=0;L<4;L++){const B=k(D,L),$=k(D,L+1),J=k(D+1,L),ae=k(D+1,L+1);b.emplaceBack(B,$,J),b.emplaceBack(J,$,ae)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(x,Jh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(S,y1.members),this._tileDebugTextSegments=Gn.simpleSegment(0,0,M,32)}}class Ak{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},Bt(this.stateChanges[e][c],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),c=Bt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(d===null)return{};for(const m in d)delete c[m]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),Bt(this.state[c][m],this.stateChanges[c][m]),d[m]=this.state[c][m];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const m in this.state[c])d[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else if(this.state[c][m])for(const _ of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][_];d[m]=this.state[c][m]}s[c]=s[c]||{},Bt(s[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const c in e)e[c].setFeatureState(s,r)}}class tb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function nb(n,e,r,s){let c=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(r[m]<n[m]||r[m]>e[m])return null}else{const _=1/s[m];let x=(n[m]-r[m])*_,b=(e[m]-r[m])*_;if(x>b){const S=x;x=b,b=S}if(x>c&&(c=x),b<d&&(d=b),c>d)return null}return c}function rb(n,e,r,s,c,d,m,_,x,b,S){const M=s-n,k=c-e,D=d-r,L=m-n,B=_-e,$=x-r,J=S[1]*$-S[2]*B,ae=S[2]*L-S[0]*$,Q=S[0]*B-S[1]*L,oe=M*J+k*ae+D*Q;if(Math.abs(oe)<1e-15)return null;const de=1/oe,he=b[0]-n,Me=b[1]-e,Se=b[2]-r,Oe=(he*J+Me*ae+Se*Q)*de;if(Oe<0||Oe>1)return null;const He=Me*D-Se*k,Ie=Se*M-he*D,je=he*k-Me*M,Ue=(S[0]*He+S[1]*Ie+S[2]*je)*de;return Ue<0||Oe+Ue>1?null:(L*He+B*Ie+$*je)*de}function ib(n,e,r){return(n-e)/(r-e)}function ob(n,e,r,s,c,d,m,_,x){const b=1<<r,S=d-s,M=m-c,k=(n+1)/b*S+s,D=(e+0)/b*M+c,L=(e+1)/b*M+c;_[0]=(n+0)/b*S+s,_[1]=D,x[0]=k,x[1]=L}class sb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const m=Math.ceil(Math.log2(d.dim/8)),_=[];let x=Math.ceil(Math.pow(2,m));const b=1/x,S=(D,L,B,$,J)=>{const ae=$?1:0,Q=(D+1)*B-ae,oe=L*B,de=(L+1)*B-ae;J[0]=D*B,J[1]=oe,J[2]=Q,J[3]=de};let M=new tb(x);const k=[];for(let D=0;D<x*x;D++){S(D%x,Math.floor(D/x),b,!1,k);const L=va(k[0],k[1],d),B=va(k[2],k[1],d),$=va(k[2],k[3],d),J=va(k[0],k[3],d);M.minimums.push(Math.min(L,B,$,J)),M.maximums.push(Math.max(L,B,$,J)),M.leaves.push(1)}for(_.push(M),x/=2;x>=1;x/=2){const D=_[_.length-1];M=new tb(x);for(let L=0;L<x*x;L++){S(L%x,Math.floor(L/x),2,!0,k);const B=D.getElevation(k[0],k[1]),$=D.getElevation(k[2],k[1]),J=D.getElevation(k[2],k[3]),ae=D.getElevation(k[0],k[3]),Q=D.isLeaf(k[0],k[1]),oe=D.isLeaf(k[2],k[1]),de=D.isLeaf(k[2],k[3]),he=D.isLeaf(k[0],k[3]),Me=Math.min(B.min,$.min,J.min,ae.min),Se=Math.max(B.max,$.max,J.max,ae.max),Oe=Q&&oe&&de&&he;M.maximums.push(Se),M.minimums.push(Me),M.leaves.push(Se-Me<=5&&Oe?1:0)}_.push(M)}return _}(this.dem),s=r.length-1,c=r[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,c,d,m,_=1){return nb([e,r,-100],[s,c,this.maximums[0]*_],d,m)}raycast(e,r,s,c,d,m,_=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,r,s,c,d,m,_);if(x==null)return null;const b=[],S=[],M=[],k=[],D=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:L,t:B,nodex:$,nodey:J,depth:ae}=D.pop();if(this.leaves[L]){ob($,J,ae,e,r,s,c,M,k);const oe=1<<ae,de=($+0)/oe,he=($+1)/oe,Me=(J+0)/oe,Se=(J+1)/oe,Oe=va(de,Me,this.dem)*_,He=va(he,Me,this.dem)*_,Ie=va(he,Se,this.dem)*_,je=va(de,Se,this.dem)*_,Ue=rb(M[0],M[1],Oe,k[0],M[1],He,k[0],k[1],Ie,d,m),qe=rb(k[0],k[1],Ie,M[0],k[1],je,M[0],M[1],Oe,d,m),tt=Math.min(Ue!==null?Ue:Number.MAX_VALUE,qe!==null?qe:Number.MAX_VALUE);if(tt!==Number.MAX_VALUE)return tt;{const Le=Yh([],d,m,B);if(ab(Oe,He,je,Ie,ib(Le[0],M[0],k[0]),ib(Le[1],M[1],k[1]))>=Le[2])return B}continue}let Q=0;for(let oe=0;oe<this._siblingOffset.length;oe++){ob(($<<1)+this._siblingOffset[oe][0],(J<<1)+this._siblingOffset[oe][1],ae+1,e,r,s,c,M,k),M[2]=-100,k[2]=this.maximums[this.childOffsets[L]+oe]*_;const de=nb(M,k,d,m);if(de!=null){const he=de;b[oe]=he;let Me=!1;for(let Se=0;Se<Q&&!Me;Se++)he>=b[S[Se]]&&(S.splice(Se,0,oe),Me=!0);Me||(S[Q]=oe),Q++}}for(let oe=0;oe<Q;oe++){const de=S[oe];D.push({idx:this.childOffsets[L]+de,t:b[de],nodex:($<<1)+this._siblingOffset[de][0],nodey:(J<<1)+this._siblingOffset[de][1],depth:ae+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,c,d){if(e[c].isLeaf(r,s)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=c-1,_=e[m];let x=0,b=0;for(let S=0;S<this._siblingOffset.length;S++){const M=2*r+this._siblingOffset[S][0],k=2*s+this._siblingOffset[S][1],D=_.getElevation(M,k),L=_.isLeaf(M,k),B=this._addNode(D.min,D.max,L);L&&(x|=1<<S),b||(b=B)}for(let S=0;S<this._siblingOffset.length;S++)x&1<<S||this._construct(e,2*r+this._siblingOffset[S][0],2*s+this._siblingOffset[S][1],m,b+S)}}function ab(n,e,r,s,c,d){return Xt(Xt(n,r,d),Xt(e,s,d),c)}function va(n,e,r){const s=r.dim,c=Ke(n*s-.5,0,s-1),d=Ke(e*s-.5,0,s-1),m=Math.floor(c),_=Math.floor(d),x=Math.min(m+1,s-1),b=Math.min(_+1,s-1);return ab(r.get(m,_),r.get(x,_),r.get(m,b),r.get(x,b),c-m,d-_)}const lb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Mk(n,e,r){return(256*n*256+256*e+r)/10-1e4}function kk(n,e,r){return 256*n+e+r/256-32768}class om{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,c=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return An(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,_=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let x=0;x<m;x++)_[this._idx(-1,x)]=_[this._idx(0,x)],_[this._idx(m,x)]=_[this._idx(m-1,x)],_[this._idx(x,-1)]=_[this._idx(x,0)],_[this._idx(x,m)]=_[this._idx(x,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new sb(this)}get(e,r,s=!1){s&&(e=Ke(e,-1,this.dim),r=Ke(r,-1,this.dim));const c=4*this._idx(e,r);return(this.encoding==="terrarium"?kk:Mk)(this.pixels[c],this.pixels[c+1],this.pixels[c+2])}static getUnpackVector(e){return lb[e]}get unpackVector(){return lb[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const s=[0,0,0,0],c=om.getUnpackVector(r);let d=Math.floor((e+c[3])/c[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new fi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,d=r*this.dim+this.dim,m=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:m=_-1;break;case 1:_=m+1}const x=-r*this.dim,b=-s*this.dim;for(let S=m;S<_;S++)for(let M=c;M<d;M++){const k=4*this._idx(M,S),D=4*this._idx(M+x,S+b);this.pixels[k+0]=e.pixels[D+0],this.pixels[k+1]=e.pixels[D+1],this.pixels[k+2]=e.pixels[D+2],this.pixels[k+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ft(om,"DEMData"),ft(sb,"DemMinMaxQuadTree",{omit:["dem"]});class Ik{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:r,timeout:void 0};if(s!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,c=r===void 0?0:this.data[s].indexOf(r),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||r.push(c);for(const s of r)this.remove(s.value.tileID,s)}}class lu{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}lu.ReadOnly=!1,lu.ReadWrite=!0,lu.disabled=new lu(519,lu.ReadOnly,[0,1]);const by=7680;class Ey{constructor(e,r,s,c,d,m){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=d,this.pass=m}}Ey.disabled=new Ey({func:519,mask:0},0,0,by,by,by);class Go{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}Go.Replace=[1,0],Go.disabled=new Go(Go.Replace,Fn.transparent,[!1,!1,!1,!1]),Go.unblended=new Go(Go.Replace,Fn.transparent,[!0,!0,!0,!0]),Go.alphaBlended=new Go([1,771],Fn.transparent,[!0,!0,!0,!0]);const Ty=1029,Sy=2305;class wo{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}wo.disabled=new wo(!1,Ty,Sy),wo.backCCW=new wo(!0,Ty,Sy),wo.backCW=new wo(!0,Ty,2304),wo.frontCW=new wo(!0,1028,2304),wo.frontCCW=new wo(!0,1028,Sy);class Nl extends nl{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Ik(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ak,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return _n(this._tiles).map(e=>e.tileID).sort(cb).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{const d=s.tileID,m=c.tileID,_=new De(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),x=new De(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||x.y-_.y||x.x-_.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(cb).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,c){if(c)if(e.state="errored",c.status!==404)this._source.fire(new ro(c,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=no.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new ss("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const d=r[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);s(e,m),s(m,e)}}function s(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-c.tileID.canonical.x;const _=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),b=d.tileID.key;m===0&&_===0||Math.abs(_)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,m,_),c.neighboringTiles&&c.neighboringTiles[b]&&(c.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(const d in this._tiles){let m=this._tiles[d];if(c[d]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>s)continue;let _=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const b=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[b.key],m&&m.hasData()&&(_=b)}let x=_;for(;x.overscaledZ>r;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){c[_.key]=_;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,c=Math.ceil(e.height/r)+1,d=Math.floor(s*c*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,d):d,_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(_=>new Ur(_.canonical.z,_.wrap,_.canonical.z,_.canonical.x,_.canonical.y)):(c=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(_=>this._source.hasTile(_)))):c=[];const d=this._updateRetainedTiles(c);if(ub(this._source.type)&&c.length!==0){const _={},x={},b=Object.keys(d);for(const M of b){const k=d[M],D=this._tiles[M];if(!D||D.fadeEndTime&&D.fadeEndTime<=no.now())continue;const L=this.findLoadedParent(k,Math.max(k.overscaledZ-Nl.maxOverzooming,this._source.minzoom));L&&(this._addTile(L.tileID),_[L.tileID.key]=L.tileID),x[M]=k}const S=c[c.length-1].overscaledZ;for(const M in this._tiles){const k=this._tiles[M];if(d[M]||!k.hasData())continue;let D=k.tileID;for(;D.overscaledZ>S;){D=D.scaledTo(D.overscaledZ-1);const L=this._tiles[D.key];if(L&&L.hasData()&&x[D.key]){d[M]=k.tileID;break}}}for(const M in _)d[M]||(this._coveredTiles[M]=!0,d[M]=_[M])}for(const _ in d)this._tiles[_].clearFadeHold();const m=function(_,x){const b=[];for(const S in _)S in x||b.push(S);return b}(this._tiles,d);for(const _ of m){const x=this._tiles[_];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+_)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const s={},c=e.reduce((b,S)=>Math.min(b,S.overscaledZ),1/0),d=e[0].overscaledZ,m=Math.max(d-Nl.maxOverzooming,this._source.minzoom),_=Math.max(d+Nl.maxUnderzooming,this._source.minzoom),x={};for(const b of e){const S=this._addTile(b);r[b.key]=b,S.hasData()||c<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,c,_,r);for(const b of e){let S=this._tiles[b.key];if(S.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const k=b.children(this._source.maxzoom)[0],D=this.getTile(k);if(D&&D.hasData()){r[k.key]=k;continue}}else{const k=b.children(this._source.maxzoom);if(r[k[0].key]&&r[k[1].key]&&r[k[2].key]&&r[k[3].key])continue}let M=S.wasRequested();for(let k=b.overscaledZ-1;k>=m;--k){const D=b.scaledTo(k);if(s[D.key]||(s[D.key]=!0,S=this.getTile(D),!S&&M&&(S=this._addTile(D)),S&&(r[D.key]=D,M=S.wasRequested(),S.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of r)this._loadedParentTiles[d]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=!!r;if(!s){const c=this.map?this.map.painter:null;r=new wy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new ss("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const c=[],d=this.transform;if(!d)return c;const m=d.projection.name==="globe",_=jo(d.center.lng);for(const x in this._tiles){const b=this._tiles[x];if(s&&b.clearQueryDebugViz(),b.holdingForFade())continue;let S;if(m){const M=b.tileID.canonical;if(M.z===0){const k=[Math.abs(Ke(_,...wd(M,-1))-_),Math.abs(Ke(_,...wd(M,1))-_)];S=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(Ke(_,...wd(M,-1))-_),Math.abs(Ke(_,...wd(M,0))-_),Math.abs(Ke(_,...wd(M,1))-_)];S=[k.indexOf(Math.min(...k))-1]}}else S=[0];for(const M of S){const k=e.containsTile(b,d,r,M);k&&c.push(k)}}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(ub(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=no.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const _=()=>{this._sourceLoaded&&(this._source.off("data",_),this._preloadTiles(e,r))};return void this._source.on("data",_)}const s=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const _ of c){const x=_.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of x)s.set(b.key,b);this.usedForTerrain&&_.updateElevation(!1)}Gt(Array.from(s.values()),(_,x)=>{const b=new wy(_,this._source.tileSize*_.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,S=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),x(S,b)})},r)}}function cb(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||s-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function ub(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function wd(n,e){const r=1<<n.z;return[n.x/r+e,(n.x+1)/r+e]}Nl.maxOverzooming=10,Nl.maxUnderzooming=3;class sm{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const c=s||e.findDEMTileFor(r);if(!c||!c.dem)return;const d=c.dem,m=c.tileID,_=1<<r.canonical.z-m.canonical.z;return new sm(c,c.tileSize/bt/_,[(r.canonical.x/_-m.canonical.x)*d.dim,(r.canonical.y/_-m.canonical.y)*d.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new De(c,d)}getElevationAt(e,r,s,c){const d=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],_=Math.floor(d),x=Math.floor(m),b=this._dem;return c=!!c,s?Xt(Xt(b.get(_,x,c),b.get(_,x+1,c),m-x),Xt(b.get(_+1,x,c),b.get(_+1,x+1,c),m-x),d-_):b.get(_,x,c)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*yo(1,e)*this._dem.stride}}class hb{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fs(bt,16,0),this.featureIndexArray=new Al,this.promoteId=r}insert(e,r,s,c,d,m=0){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d,m);const x=this.grid;for(let b=0;b<r.length;b++){const S=r[b],M=[1/0,1/0,-1/0,-1/0];for(let k=0;k<S.length;k++){const D=S[k];M[0]=Math.min(M[0],D.x),M[1]=Math.min(M[1],D.y),M[2]=Math.max(M[2],D.x),M[3]=Math.max(M[3],D.y)}M[0]<bt&&M[1]<bt&&M[2]>=0&&M[3]>=0&&x.insert(_,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new oy(new Zp(this.rawTileData)).layers,this.sourceLayerCoder=new Yw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,c){this.loadVTLayers();const d=e.params||{},m=Bc(d.filter),_=e.tileResult,x=e.transform,b=_.bufferedTilespaceBounds,S=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(L,B,$,J)=>O1(_.bufferedTilespaceGeometry,L,B,$,J));S.sort(Pk);let M=null;x.elevation&&S.length>0&&(M=sm.create(x.elevation,this.tileID));const k={};let D;for(let L=0;L<S.length;L++){const B=S[L];if(B===D)continue;D=B;const $=this.featureIndexArray.get(B);let J=null;this.loadMatchingFeature(k,$,m,d.layers,d.availableImages,r,s,c,(ae,Q,oe,de=0)=>(J||(J=xs(ae,this.tileID.canonical,e.tileTransform)),Q.queryIntersectsFeature(_,ae,oe,J,this.z,e.transform,e.pixelPosMatrix,M,de)))}return k}loadMatchingFeature(e,r,s,c,d,m,_,x,b){const{featureIndex:S,bucketIndex:M,sourceLayerIndex:k,layoutVertexArrayOffset:D}=r,L=this.bucketLayerIDs[M];if(c&&!function(ae,Q){for(let oe=0;oe<ae.length;oe++)if(Q.indexOf(ae[oe])>=0)return!0;return!1}(c,L))return;const B=this.sourceLayerCoder.decode(k),$=this.vtLayers[B].feature(S);if(s.needGeometry){const ae=Rl($,!0);if(!s.filter(new A(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!s.filter(new A(this.tileID.overscaledZ),$))return;const J=this.getId($,B);for(let ae=0;ae<L.length;ae++){const Q=L[ae];if(c&&c.indexOf(Q)<0)continue;const oe=m[Q];if(!oe)continue;let de={};J!==void 0&&x&&(de=x.getState(oe.sourceLayer||"_geojsonTileLayer",J));const he=Bt({},_[Q]);he.paint=db(he.paint,oe.paint,$,de,d),he.layout=db(he.layout,oe.layout,$,de,d);const Me=!b||b($,oe,de,D);if(!Me)continue;const Se=new Kw($,this.z,this.x,this.y,J);Se.layer=he;let Oe=e[Q];Oe===void 0&&(Oe=e[Q]=[]),Oe.push({featureIndex:S,feature:Se,intersectionZ:Me})}}lookupSymbolFeatures(e,r,s,c,d,m,_,x){const b={};this.loadVTLayers();const S=Bc(d);for(const M of e)this.loadMatchingFeature(b,{bucketIndex:s,sourceLayerIndex:c,featureIndex:M,layoutVertexArrayOffset:0},S,m,_,x,r);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),d=this.vtFeatures[c];if(d[r])return d[r];const m=this.vtLayers[c].feature(r);return d[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;if(this.promoteId){const c=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];c!=null&&(s=e.properties[c]),typeof s=="boolean"&&(s=Number(s))}return s}}function db(n,e,r,s,c){return Zt(n,(d,m)=>{const _=e instanceof K?e.get(m):null;return _&&_.evaluate?_.evaluate(r,s,c):_})}function Pk(n,e){return e-n}ft(hb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class fb{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new ws({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=Rr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,_=!0;c.push({left:d,right:m,isDash:_,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){_=!_;const S=e[b];d=x*s,x+=S,m=x*s,c.push({left:d,right:m,isDash:_,zeroLength:S===0})}return c}addRoundDash(e,r,s){const c=r/2;for(let d=-s;d<=s;d++){const m=this.width*(this.nextRow+s+d);let _=0,x=e[_];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++_]);const S=Math.abs(b-x.left),M=Math.abs(b-x.right),k=Math.min(S,M);let D;const L=d/s*(c+1);if(x.isDash){const B=c-Math.abs(L);D=Math.sqrt(k*k+B*B)}else D=c-Math.sqrt(k*k+L*L);this.image.data[m+b]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,r){for(let x=e.length-1;x>=0;--x){const b=e[x],S=e[x+1];b.zeroLength?e.splice(x,1):S&&S.isDash===b.isDash&&(S.left=b.left,e.splice(x,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let m=0,_=e[m];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++m]);const b=Math.abs(x-_.left),S=Math.abs(x-_.right),M=Math.min(b,S);this.image.data[d+x]=Math.max(0,Math.min(255,(_.isDash?M:-M)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const c=r==="round",d=c?7:0,m=2*d+1;if(this.nextRow+m>this.height)return An("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let S=0;S<e.length;S++)e[S]<0&&(An("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),_+=e[S];if(_!==0){const S=this.width/_,M=this.getDashRanges(e,this.width,S);c?this.addRoundDash(M,S,d):this.addRegularDash(M,r==="square"?.5*S:0)}const x=this.nextRow+d;this.nextRow+=m;const b={tl:[x,d],br:[_,0]};return this.positions[s]=b,b}}ft(fb,"LineAtlas");const pb=1*xo;class mb{constructor(e){const r={},s=[];for(const _ in e){const x=e[_],b=r[_]={};for(const S in x.glyphs){const M=x.glyphs[+S];if(!M||M.bitmap.width===0||M.bitmap.height===0)continue;const k=M.metrics.localGlyph?pb:1,D={x:0,y:0,w:M.bitmap.width+2*k,h:M.bitmap.height+2*k};s.push(D),b[S]=D}}const{w:c,h:d}=cy(s),m=new ws({width:c||1,height:d||1});for(const _ in e){const x=e[_];for(const b in x.glyphs){const S=x.glyphs[+b];if(!S||S.bitmap.width===0||S.bitmap.height===0)continue;const M=r[_][b],k=S.metrics.localGlyph?pb:1;ws.copy(S.bitmap,m,{x:0,y:0},{x:M.x+k,y:M.y+k},S.bitmap)}}this.image=m,this.positions=r}}ft(mb,"GlyphAtlas");class zk{constructor(e){this.tileID=new Ur(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Fl(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new dn;const m=new Yw(Object.keys(e.layers).sort()),_=new hb(this.tileID,this.promoteId);_.bucketLayerIDs=[];const x={},b=new fb(256,256),S={featureIndex:_,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:s},M=r.familiesBySource[this.source];for(const de in M){const he=e.layers[de];if(!he)continue;let Me=!1,Se=!1;for(const Ie of M[de])Ie[0].type==="symbol"?Me=!0:Se=!0;if(this.isSymbolTile===!0&&!Me||this.isSymbolTile===!1&&!Se)continue;he.version===1&&An(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=m.encode(de),He=[];for(let Ie=0;Ie<he.length;Ie++){const je=he.feature(Ie),Ue=_.getId(je,de);He.push({feature:je,id:Ue,index:Ie,sourceLayerIndex:Oe})}for(const Ie of M[de]){const je=Ie[0];this.isSymbolTile!==void 0&&je.type==="symbol"!==this.isSymbolTile||je.minzoom&&this.zoom<Math.floor(je.minzoom)||je.maxzoom&&this.zoom>=je.maxzoom||je.visibility!=="none"&&(Cy(Ie,this.zoom,s),(x[je.id]=je.createBucket({index:_.bucketLayerIDs.length,layers:Ie,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(He,S,this.tileID.canonical,this.tileTransform),_.bucketLayerIDs.push(Ie.map(Ue=>Ue.id)))}}let k,D,L,B;b.trim();const $={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=()=>{if(k)return d(k);if(D&&L&&B){const de=new mb(D),he=new bw(L,B);for(const Me in x){const Se=x[Me];Se instanceof ga?(Cy(Se.layers,this.zoom,s),ik(Se,D,de.positions,L,he.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof $p||Se instanceof Fp||Se instanceof cd)&&(Cy(Se.layers,this.zoom,s),Se.addFeatures(S,this.tileID.canonical,he.patternPositions,s,this.tileTransform))}this.status="done",d(null,{buckets:_n(x).filter(Me=>!Me.isEmpty()),featureIndex:_,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:b,imageAtlas:he,glyphMap:this.returnDependencies?D:null,iconMap:this.returnDependencies?L:null,glyphPositions:this.returnDependencies?de.positions:null})}},ae=Zt(S.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(ae).length?c.send("getGlyphs",{uid:this.uid,stacks:ae},(de,he)=>{k||(k=de,D=he,J())},void 0,!1,$):D={};const Q=Object.keys(S.iconDependencies);Q.length?c.send("getImages",{icons:Q,source:this.source,tileID:this.tileID,type:"icons"},(de,he)=>{k||(k=de,L=he,J())},void 0,!1,$):L={};const oe=Object.keys(S.patternDependencies);oe.length?c.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"patterns"},(de,he)=>{k||(k=de,B=he,J())},void 0,!1,$):B={},J()}}function Cy(n,e,r){const s=new A(e);for(const c of n)c.recalculate(s,r)}class gb{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,_]=d.result;return this.scheduler?this.scheduler.add(()=>{c(m,_)},r):c(m,_),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=s((m,_)=>{d.result=[m,_];for(const x of d.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,_)},r):x(m,_);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function _b(n,e,r){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const d=Gs(n.request,(m,_,x,b)=>{m?c(m):_&&c(null,{vectorTile:r?void 0:new oy(new Zp(_)),rawData:_,cacheControl:x,expires:b})});return()=>{d.cancel(),c()}},e)}const yb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ay{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=s>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const d=yb[15&s];if(!d)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new Ay(_,m,d,e)}constructor(e,r=64,s=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=yb.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return My(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:_}=this,x=[0,d.length-1,0],b=[];for(;x.length;){const S=x.pop()||0,M=x.pop()||0,k=x.pop()||0;if(M-k<=_){for(let $=k;$<=M;$++){const J=m[2*$],ae=m[2*$+1];J>=e&&J<=s&&ae>=r&&ae<=c&&b.push(d[$])}continue}const D=k+M>>1,L=m[2*D],B=m[2*D+1];L>=e&&L<=s&&B>=r&&B<=c&&b.push(d[D]),(S===0?e<=L:r<=B)&&(x.push(k),x.push(D-1),x.push(1-S)),(S===0?s>=L:c>=B)&&(x.push(D+1),x.push(M),x.push(1-S))}return b}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:m}=this,_=[0,c.length-1,0],x=[],b=s*s;for(;_.length;){const S=_.pop()||0,M=_.pop()||0,k=_.pop()||0;if(M-k<=m){for(let $=k;$<=M;$++)xb(d[2*$],d[2*$+1],e,r)<=b&&x.push(c[$]);continue}const D=k+M>>1,L=d[2*D],B=d[2*D+1];xb(L,B,e,r)<=b&&x.push(c[D]),(S===0?e-s<=L:r-s<=B)&&(_.push(k),_.push(D-1),_.push(1-S)),(S===0?e+s>=L:r+s>=B)&&(_.push(D+1),_.push(M),_.push(1-S))}return x}}function My(n,e,r,s,c,d){if(c-s<=r)return;const m=s+c>>1;vb(n,e,m,s,c,d),My(n,e,r,s,m-1,1-d),My(n,e,r,m+1,c,1-d)}function vb(n,e,r,s,c,d){for(;c>s;){if(c-s>600){const b=c-s+1,S=r-s+1,M=Math.log(b),k=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*k*(b-k)/b)*(S-b/2<0?-1:1);vb(n,e,r,Math.max(s,Math.floor(r-S*k/b+D)),Math.min(c,Math.floor(r+(b-S)*k/b+D)),d)}const m=e[2*r+d];let _=s,x=c;for(bd(n,e,s,r),e[2*c+d]>m&&bd(n,e,s,c);_<x;){for(bd(n,e,_,x),_++,x--;e[2*_+d]<m;)_++;for(;e[2*x+d]>m;)x--}e[2*s+d]===m?bd(n,e,s,x):(x++,bd(n,e,x,c)),x<=r&&(s=x+1),r<=x&&(c=x-1)}}function bd(n,e,r,s){ky(n,r,s),ky(e,2*r,2*s),ky(e,2*r+1,2*s+1)}function ky(n,e,r){const s=n[e];n[e]=n[r],n[r]=s}function xb(n,e,r,s){const c=n-r,d=e-s;return c*c+d*d}a.ARRAY_TYPE=di,a.AUTH_ERR_MSG=fe,a.Aabb=jr,a.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},ts(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=to()?n:z,this.scheduler=new Sk}send(n,e,r,s,c=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[m]=r);const _=Us(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:la(e,_)},_),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||to()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if(e.type==="<response>"){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(ps(e.error)):r(null,ps(e.data)))}else{const r=Us(this.globalScope)?void 0:[],s=e.hasCallback?(d,m)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:d?la(d):null,data:la(m,r)},r)}:d=>{},c=ps(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Vp,a.Color=Fn,a.ColorMode=Go,a.CullFaceMode=wo,a.DEMData=om,a.DataConstantProperty=O,a.DedupedRequest=gb,a.DepthMode=lu,a.EXTENT=bt,a.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,c=Math.floor(n.x),d=Math.floor((n.x-c)*s),m=Math.floor(n.y*s),_=this.findDEMTileFor(new Ur(r,c,r,d,m));return!(!_||!_.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const c=s.getSource().maxzoom,d=1<<c,m=Math.floor(n.x),_=n.x-m,x=new Ur(c,m,c,Math.floor(_*d),Math.floor(n.y*d)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const S=b.dem,M=1<<b.tileID.canonical.z,k=(_*M-b.tileID.canonical.x)*S.dim,D=(n.y*M-b.tileID.canonical.y)*S.dim,L=Math.floor(k),B=Math.floor(D);return(r?this.exaggeration():1)*Xt(Xt(S.get(L,B),S.get(L,B+1),D-B),Xt(S.get(L+1,B),S.get(L+1,B+1),D-B),k-L)}getAtTileOffset(n,e,r){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Xc(n.wrap+(n.canonical.x+e/bt)/s,(n.canonical.y+r/bt)/s))}getAtTileOffsetFunc(n,e,r,s){return c=>{const d=this.getAtTileOffset(n,c.x,c.y),m=s.upVector(n.canonical,c.x,c.y);return Si(m,m,d*s.upVectorScale(n.canonical,e,r).metersToTile),m}}getForTilePoints(n,e,r,s){if(this.isUsingMockSource())return!1;const c=sm.create(this,n,s);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,c=1<<n.canonical.z-s.canonical.z;let d=n.canonical.x/c-s.canonical.x,m=n.canonical.y/c-s.canonical.y,_=0;for(let x=0;x<n.canonical.z-s.canonical.z&&!r.leaves[_];x++){d*=2,m*=2;const b=2*Math.floor(m)+Math.floor(d);_=r.childOffsets[_]+b,d%=1,m%=1}return{min:this.exaggeration()*r.minimums[_],max:this.exaggeration()*r.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ro,a.EvaluationParameters=A,a.Event=ss,a.Evented=nl,a.FillExtrusionBucket=cd,a.Frustum=O_,a.FrustumCorners=R_,a.GLOBE_RADIUS=Fo,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=v1,a.GLOBE_ZOOM_THRESHOLD_MIN=B_,a.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const r=new Xe,s=new gt,c=[],d=n+1+2,m=e[0]+1,_=e[0]+1+(1+e.length),x=(b,S,M)=>{let k=b===d-1?b-2:b===0?b:b-1;return k+=M?24575:0,[k,S]};for(let b=0;b<d;++b)r.emplaceBack(...x(b,0,!0));for(let b=0;b<m;++b)for(let S=0;S<d;++S)r.emplaceBack(...x(S,b,(S===0||S===d-1)&&!0));for(let b=0;b<e.length;++b){const S=e[b];for(let M=0;M<d;++M)r.emplaceBack(...x(M,S,!0))}for(let b=0;b<e.length;++b){const S=s.length,M=e[b]+1+2,k=new gt;for(let B=0;B<M-1;B++){const $=B===M-2,J=$?d*(_-e.length+b-B):d;for(let ae=0;ae<d-1;ae++){const Q=B*d+ae;B===0||$||ae===0||ae===d-2?(k.emplaceBack(Q+1,Q,Q+J),k.emplaceBack(Q+J,Q+J+1,Q+1)):(s.emplaceBack(Q+1,Q,Q+J),s.emplaceBack(Q+J,Q+J+1,Q+1))}}const D=Gn.simpleSegment(0,S,r.length,s.length-S);for(let B=0;B<k.uint16.length;B+=3)s.emplaceBack(k.uint16[B],k.uint16[B+1],k.uint16[B+2]);const L=Gn.simpleSegment(0,S,r.length,s.length-S);c.push({withoutSkirts:D,withSkirts:L})}return{vertices:r,indices:s,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(Dl,Qh);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Jh.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new gt;for(let c=0;c<=Dl;c++)e.emplaceBack(0,c+1,c+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new hn,s=new hn;this._poleSegments=[];for(let c=0,d=0;c<B_;c++){const m=360/(1<<c);r.emplaceBack(0,-Fo,0,.5,0),s.emplaceBack(0,-Fo,0,.5,1);for(let _=0;_<=Dl;_++){const x=_/Dl,b=Xt(0,m,x),[S,M,k]=qc(SA,CA,b,Fo);r.emplaceBack(S,M,k,x,0),s.emplaceBack(S,M,k,x,1)}this._poleSegments.push(Gn.simpleSegment(d,0,66,64)),d+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,_1,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,_1,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const r=new lr,s=Dl,c=s+1+2,d=1;this._wireframeSegments=[];for(let m=0,_=0;m<Qh.length;m++){const x=Qh[m];for(let S=d;S<x+d;S++)for(let M=d;M<s+d;M++){const k=S*c+M;r.emplaceBack(k,k+1),r.emplaceBack(k,k+c),r.emplaceBack(k,k+c+1)}const b=x*s*3;this._wireframeSegments.push(Gn.simpleSegment(0,_,(x+1)*c,b)),_+=b}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},a.GlyphManager=ru,a.ImagePosition=uy,a.KDBush=Ay,a.LivePerformanceUtils=r_,a.LngLat=fn,a.LngLatBounds=da,a.LocalGlyphMode=fy,a.MAX_MERCATOR_LATITUDE=Cr,a.MercatorCoordinate=Xc,a.ONE_EM=pr,a.OverscaledTileID=Ur,a.PerformanceMarkers=qs,a.Point=De,a.Properties=ne,a.RGBAImage=fi,a.Ray=L_,a.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ee,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!ve(n))return n;const r=st(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!ve(n))return n;const r=st(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e,r,s){if(!ve(n))return n;const c=st(n);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),r&&c.params.push(`language=${r}`),s&&c.params.push(`worldview=${s}`),this._makeAPIURL(c,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,s){const c=st(n);return ve(n)?(c.path=`/styles/v1${c.path}/sprite${e}${r}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${r}`,et(c))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!ve(n))return n;const s=st(n);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${Y.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${Z.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Z.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const m of d){const _=m.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(s.params)||Z.ACCESS_TOKEN;return Z.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(n,e){const r=st(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${Z.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${Z.TILE_URL_VERSION}/`,"")}`;let c=r.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(n,e){const r=!!e&&ve(e),s=[];for(const c of n.tiles||[])Ee(c)?s.push(this.canonicalizeTileURL(c,r)):s.push(c);return s}_makeAPIURL(n,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=st(Z.API_URL);if(n.protocol=s.protocol,n.authority=s.authority,n.protocol==="http"){const c=n.params.indexOf("secure");c>=0&&n.params.splice(c,1)}if(s.path!=="/"&&(n.path=`${s.path}${n.path}`),!Z.REQUIRE_ACCESS_TOKEN)return et(n);if(e=e||Z.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(c=>c.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),et(n)}},a.ResourceType=rs,a.SegmentVector=Gn,a.SourceCache=Nl,a.StencilMode=Ey,a.StructArrayLayout1ui2=hi,a.StructArrayLayout2f1f2i16=Et,a.StructArrayLayout2i4=Xe,a.StructArrayLayout2ui4=lr,a.StructArrayLayout3f12=jt,a.StructArrayLayout3ui6=gt,a.StructArrayLayout4i8=Ne,a.StructArrayLayout5f20=hn,a.Texture=xd,a.Tile=wy,a.Transitionable=R,a.Uniform1f=Sp,a.Uniform1i=class extends _s{constructor(n){super(n),this.current=0}set(n,e,r){this.fetchUniformLocation(n,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},a.Uniform2f=class extends _s{constructor(n){super(n),this.current=[0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},a.Uniform3f=class extends _s{constructor(n){super(n),this.current=[0,0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},a.Uniform4f=e1,a.UniformColor=t1,a.UniformMatrix2f=class extends _s{constructor(n){super(n),this.current=cA}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let s=0;s<4;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},a.UniformMatrix3f=class extends _s{constructor(n){super(n),this.current=lA}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let s=0;s<9;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},a.UniformMatrix4f=class extends _s{constructor(n){super(n),this.current=aA}set(n,e,r){if(this.fetchUniformLocation(n,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let s=1;s<16;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},a.UnwrappedTileID=aw,a.ValidationError=dt,a.VectorTileFeature=jp,a.VectorTileWorkerSource=class extends nl{constructor(n,e,r,s,c){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=c||_b,this.loading={},this.loaded={},this.deduped=new gb(n.scheduler),this.isSpriteLoaded=s,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,s=n&&n.request,c=s&&s.collectResourceTiming,d=this.loading[r]=new zk(n);d.abort=this.loadVectorData(n,(m,_)=>{const x=!this.loading[r];if(delete this.loading[r],x||m||!_)return d.status="done",x||(this.loaded[r]=d),e(m);const b=_.rawData,S={};_.expires&&(S.expires=_.expires),_.cacheControl&&(S.cacheControl=_.cacheControl),d.vectorTile=_.vectorTile||new oy(new Zp(b));const M=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,D)=>{if(k||!D)return e(k);const L={};if(c){const B=Hu(s);B.length>0&&(L.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,Bt({rawTileData:b.slice(0)},D,S,L))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(n,e){const r=this.loaded,s=n.uid,c=this;if(r&&r[s]){const d=r[s];d.showCollisionBoxes=n.showCollisionBoxes,d.enableTerrain=!!n.enableTerrain,d.projection=n.projection,d.tileTransform=Fl(n.tileID.canonical,n.projection);const m=(_,x)=>{const b=d.reloadCallback;b&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,b)),e(_,x)};d.status==="parsing"?d.reloadCallback=m:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(n,e){const r=n.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,s=n.uid;r&&r[s]&&delete r[s],e()}},a.WritingMode=Ai,a.ZoomDependentExpression=xl,a.add=vs,a.addDynamicAttributes=nm,a.adjoint=function(n,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=e[4],_=e[5],x=e[6],b=e[7],S=e[8];return n[0]=m*S-_*b,n[1]=c*b-s*S,n[2]=s*_-c*m,n[3]=_*x-d*S,n[4]=r*S-c*x,n[5]=c*d-r*_,n[6]=d*b-m*x,n[7]=s*x-r*b,n[8]=r*m-s*d,n},a.asyncAll=Gt,a.bezier=Oi,a.bindAll=ts,a.boundsAttributes=Qw,a.bufferConvexPolygon=function(n,e){const r=[];for(let s=0;s<n.length;s++){const c=Tt(s-1,-1,n.length-1),d=Tt(s+1,-1,n.length-1),m=n[s],_=n[d],x=n[c].sub(m).unit(),b=_.sub(m).unit(),S=b.angleWithSep(x.x,x.y),M=x.add(b).unit().mult(-1*e/Math.sin(S/2));r.push(m.add(M))}return r},a.cacheEntryPossiblyAdded=function(n){el++,el>hc&&(n.getActor().send("enforceCacheSizeLimit",uc),el=0)},a.calculateGlobeLabelMatrix=function(n,e){const{x:r,y:s}=n.point,c=T1(r,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Il(c,c,j_(No(e)))},a.calculateGlobeMatrix=function(n){const{x:e,y:r}=n.point,{lng:s,lat:c}=n._center;return T1(e,r,n.worldSize,s,c)},a.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,r=e/yo(1,n.center.lat),s=go(new Float64Array(16));return Zh(s,s,[n.point.x,n.point.y,0]),Pl(s,s,[r,r,e]),Float32Array.from(s)},a.circumferenceAtLatitude=V_,a.clamp=Ke,a.clearTileCache=function(n){if(!Qa())return;const e=z.caches.delete(Vs);n&&e.catch(n).then(()=>n())},a.clipLine=Rw,a.clone=function(n){var e=new di(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},a.clone$1=Hr,a.collisionCircleLayout=IM,a.config=Z,a.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},a.create=function(){var n=new di(16);return di!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},a.create$1=i1,a.createExpression=oa,a.createLayout=xe,a.createStyleLayer=function(n){return n.type==="custom"?new wk(n):new Ek[n.type](n)},a.cross=D_,a.degToRad=At,a.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},a.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},a.dot=Gi,a.earthRadius=nd,a.ease=wi,a.easeCubicInOut=Po,a.ecefToLatLng=function([n,e,r]){const s=Math.hypot(n,e,r),c=Math.atan2(n,r),d=.5*Math.PI-Math.acos(-e/s);return new fn(rn(c),rn(d))},a.emitValidationErrors=vp,a.endsWith=Ns,a.enforceCacheSizeLimit=function(n){ns(),si&&si.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-n;s++)e.delete(r[s])})})},a.evaluateSizeForFeature=Gp,a.evaluateSizeForZoom=Qc,a.evaluateVariableOffset=jw,a.evented=g,a.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},a.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},a.exported=no,a.exported$1=Y,a.extend=Bt,a.extend$1=io,a.fillExtrusionHeightLift=iw,a.filterObject=js,a.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},a.fromQuat=function(n,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=r+r,_=s+s,x=c+c,b=r*m,S=s*m,M=s*_,k=c*m,D=c*_,L=c*x,B=d*m,$=d*_,J=d*x;return n[0]=1-M-L,n[1]=S+J,n[2]=k-$,n[3]=0,n[4]=S-J,n[5]=1-b-L,n[6]=D+B,n[7]=0,n[8]=k+$,n[9]=D-B,n[10]=1-b-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},a.fromRotation=function(n,e){var r=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=r,n[2]=0,n[3]=-r,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},a.fromScaling=s1,a.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return kr[e]},a.getAABBPointSquareDist=function(n,e,r){let s=0;for(let c=0;c<2;++c){const d=r?r[c]:0;n[c]>d&&(s+=(n[c]-d)*(n[c]-d)),e[c]<d&&(s+=(d-e[c])*(d-e[c]))}return s},a.getAnchorAlignment=dy,a.getAnchorJustification=my,a.getBounds=function(n){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const d of n)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{min:new De(e,r),max:new De(s,c)}},a.getColumn=zo,a.getDefaultExportFromCjs=ue,a.getGridMatrix=function(n,e,r,s){const c=e.getNorth(),d=e.getSouth(),m=e.getWest(),_=e.getEast(),x=1<<n.z,b=_-m,S=c-d,M=b/Dl,k=-S/Qh[r],D=[0,M,0,k,0,0,c,m,0];if(n.z>0){const L=180/s;o1(D,D,[L/b+1,0,0,0,L/S+1,0,-.5*L/M,.5*L/k,1])}return D[2]=x,D[5]=n.x,D[8]=n.y,D},a.getImage=re,a.getJSON=function(n,e){return os(Bt(n,{type:"json"}),e)},a.getLatitudinalLod=function(n){const e=Cr-5;n=Ke(n,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(At(n))),3);return Math.round(r*(Qh.length-1))},a.getMapSessionAPI=or,a.getPerformanceMeasurement=Hu,a.getProjection=Xw,a.getRTLTextPluginStatus=v,a.getReferrer=is,a.getTilePoint=function(n,{x:e,y:r},s=0){return new De(((e-s)*n.scale-n.x)*bt,(r*n.scale-n.y)*bt)},a.getTileVec3=function(n,e,r=0){return Gc(((e.x-r)*n.scale-n.x)*bt,(e.y*n.scale-n.y)*bt,M1(e.z,e.y))},a.getVideo=function(n,e){const r=z.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<n.length;s++){const c=z.document.createElement("source");dc(n[s])||(r.crossOrigin="Anonymous"),c.src=n[s],r.appendChild(c)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(n){const e=[0,0,0],r=go(new Float64Array(16));return Il(r,n.pixelMatrix,n.globeMatrix),Nn(e,e,r),new De(e[0],e[1])},a.globeDenormalizeECEF=j_,a.globeECEFOrigin=function(n,e){const r=[0,0,0];return Nn(r,r,td(No(e.canonical))),Nn(r,r,n),r},a.globeMetersToEcef=Mp,a.globeNormalizeECEF=td,a.globePixelsToTileUnits=function(n,e){return bt/(512*Math.pow(2,n))*Ip(No(e))},a.globePoleMatrixForTile=function(n,e,r){const s=go(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return Ap(s,r.globeMatrix,c),Float32Array.from(s)},a.globeTileBounds=No,a.globeTiltAtLngLat=S1,a.globeToMercatorTransition=Wc,a.globeUseCustomAntiAliasing=function(n,e,r){const s=Wc(r.zoom),c=n.style.map._antialias,d=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return s===0&&!c&&!m&&d},a.identity=go,a.identity$1=p1,a.invert=k_,a.isFullscreen=function(){return!!z.document.fullscreenElement||!!z.document.webkitFullscreenElement},a.isLngLatBehindGlobe=U_,a.isMapAuthenticated=function(n){return Ir.has(n)},a.isMapboxURL=ve,a.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!Us(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Sr,a.latLngToECEF=Zc,a.len=yA,a.length=Wh,a.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},a.lngFromMercatorX=Ci,a.loadVectorTile=_b,a.makeRequest=os,a.mapValue=function(n,e,r,s,c){return Ke((n-e)/(r-e)*(c-s)+s,s,c)},a.mercatorScale=k1,a.mercatorXfromLng=jo,a.mercatorYfromLat=Uo,a.mercatorZfromAltitude=yo,a.mul=gA,a.mul$1=_A,a.multiply=Il,a.multiply$1=o1,a.multiply$2=c1,a.nextPowerOfTwo=Rr,a.normalize=Nr,a.normalize$1=vA,a.normalize$2=d1,a.number=Xt,a.ortho=function(n,e,r,s,c,d,m){var _=1/(e-r),x=1/(s-c),b=1/(d-m);return n[0]=-2*_,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+r)*_,n[13]=(c+s)*x,n[14]=(m+d)*b,n[15]=1,n},a.pbf=pw,a.perspective=function(n,e,r,s,c){var d,m=1/Math.tan(e/2);return n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0?(n[10]=(c+s)*(d=1/(s-c)),n[14]=2*c*s*d):(n[10]=-1,n[14]=-2*s),n},a.pick=function(n,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in n&&(r[c]=n[c])}return r},a.plugin=T,a.pointGeometry=rt,a.polesInViewport=function(n){const e=go(new Float64Array(16));Il(e,n.pixelMatrix,n.globeMatrix);const r=[0,qi,0],s=[0,Zi,0];return Nn(r,r,e),Nn(s,s,e),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!U_(n,new fn(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!U_(n,new fn(n.center.lat,-90))]},a.polygonContainsPoint=Ol,a.polygonIntersectsBox=O1,a.polygonIntersectsPolygon=z1,a.polygonizeBounds=function(n,e,r=0,s=!0){const c=new De(r,r),d=n.sub(c),m=e.add(c),_=[d,new De(m.x,d.y),m,new De(d.x,m.y)];return s&&_.push(d.clone()),_},a.posAttributes=Jh,a.postMapLoadEvent=Un,a.postPerformanceEvent=Qn,a.postTurnstileEvent=Wt,a.potpack=cy,a.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},a.radToDeg=rn,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(n){return n({pluginStatus:h,pluginURL:i}),g.on("pluginStateChange",n),n},a.removeAuthState=function(n){Ir.delete(n)},a.renderColorRamp=Y_,a.resample=I1,a.rotateX=I_,a.rotateX$1=m1,a.rotateY=Ap,a.rotateY$1=g1,a.rotateZ=function(n,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],m=e[1],_=e[2],x=e[3],b=e[4],S=e[5],M=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*c+b*s,n[1]=m*c+S*s,n[2]=_*c+M*s,n[3]=x*c+k*s,n[4]=b*c-d*s,n[5]=S*c-m*s,n[6]=M*c-_*s,n[7]=k*c-x*s,n},a.rotateZ$1=function(n,e,r){r*=.5;var s=e[0],c=e[1],d=e[2],m=e[3],_=Math.sin(r),x=Math.cos(r);return n[0]=s*x+c*_,n[1]=c*x-s*_,n[2]=d*x+m*_,n[3]=m*x-d*_,n},a.scale=Pl,a.scale$1=h1,a.scale$2=Si,a.scaleAndAdd=Yh,a.set=function(n,e,r,s){return n[0]=e,n[1]=r,n[2]=s,n},a.setCacheLimits=function(n,e){uc=n,hc=e},a.setColumn=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},a.setRTLTextPlugin=function(n,e,r=!1){if(h===Uh||h===Vh||h===$h)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=no.resolveURL(n),h=Uh,ca=e,f(),r||E()},a.smoothstep=Mt,a.spec=Re,a.squaredLength=function(n){var e=n[0],r=n[1],s=n[2];return e*e+r*r+s*s},a.storeAuthState=function(n,e){e?Ir.add(n):Ir.delete(n)},a.sub=_o,a.subtract=z_,a.symbolSize=PM,a.tileAABB=function(n,e,r,s,c,d,m,_,x){if(x.name==="globe")return TA(n,e,new Vp(r,s,c));const b=Fl({z:r,x:s,y:c},x);return new jr([(d+b.x/b.scale)*e,e*(b.y/b.scale),m],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),_])},a.tileCornersToBounds=kp,a.tileTransform=Fl,a.transformMat3=function(n,e,r){var s=e[0],c=e[1],d=e[2];return n[0]=s*r[0]+c*r[3]+d*r[6],n[1]=s*r[1]+c*r[4]+d*r[7],n[2]=s*r[2]+c*r[5]+d*r[8],n},a.transformMat4=Nn,a.transformMat4$1=zl,a.transformQuat=u1,a.transitionTileAABBinECEF=w1,a.translate=Zh,a.transpose=function(n,e){if(n===e){var r=e[1],s=e[2],c=e[5];n[1]=e[3],n[2]=e[6],n[3]=r,n[5]=e[7],n[6]=s,n[7]=c}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},a.triggerPluginCompletionEvent=l,a.uniqueId=xr,a.updateGlobeVertexNormal=function(n,e,r,s,c){const d=5*e+2;n.float32[d+0]=r,n.float32[d+1]=s,n.float32[d+2]=c},a.validateCustomStyleLayer=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFilter=n=>ui(Sl(n)),a.validateFog=n=>ui(gp(n)),a.validateLayer=n=>ui(dp(n)),a.validateLight=n=>ui(mp(n)),a.validateSource=n=>ui(pp(n)),a.validateStyle=yp,a.validateTerrain=n=>ui(Oh(n)),a.values=_n,a.vectorTile=Np,a.version=F,a.warnOnce=An,a.window=z,a.wrap=Tt}),w(["./shared"],function(a){function z(se){if(typeof se=="number"||typeof se=="boolean"||typeof se=="string"||se==null)return JSON.stringify(se);if(Array.isArray(se)){let j="[";for(const re of se)j+=`${z(re)},`;return`${j}]`}let N="{";for(const j of Object.keys(se).sort())N+=`${j}:${z(se[j])},`;return`${N}}`}function F(se){let N="";for(const j of a.refProperties)N+=`/${z(se[j])}`;return N}class H{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const fe of N)this._layerConfigs[fe.id]=fe,(this._layers[fe.id]=a.createStyleLayer(fe)).compileFilter(),this.keyCache[fe.id]&&delete this.keyCache[fe.id];for(const fe of j)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const re=function(fe,ve){const Ee={};for(let ye=0;ye<fe.length;ye++){const Pe=ve&&ve[fe[ye].id]||F(fe[ye]);ve&&(ve[fe[ye].id]=Pe);let it=Ee[Pe];it||(it=Ee[Pe]=[]),it.push(fe[ye])}const be=[];for(const ye in Ee)be.push(Ee[ye]);return be}(a.values(this._layerConfigs),this.keyCache);for(const fe of re){const ve=fe.map(st=>this._layers[st.id]),Ee=ve[0];if(Ee.visibility==="none")continue;const be=Ee.source||"";let ye=this.familiesBySource[be];ye||(ye=this.familiesBySource[be]={});const Pe=Ee.sourceLayer||"_geojsonTileLayer";let it=ye[Pe];it||(it=ye[Pe]=[]),it.push(ve)}}}class Z{loadTile(N,j){const{uid:re,encoding:fe,rawImageData:ve,padding:Ee,buildQuadTree:be}=N,ye=a.window.ImageBitmap&&ve instanceof a.window.ImageBitmap?this.getImageData(ve,Ee):ve;j(null,new a.DEMData(re,ye,fe,Ee<1,be))}getImageData(N,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const re=this.offscreenCanvasContext.getImageData(-j,-j,N.width+2*j,N.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}function Y(se,N){if(se.length!==0){ie(se[0],N);for(var j=1;j<se.length;j++)ie(se[j],!N)}}function ie(se,N){for(var j=0,re=0,fe=0,ve=se.length,Ee=ve-1;fe<ve;Ee=fe++){var be=(se[fe][0]-se[Ee][0])*(se[Ee][1]+se[fe][1]),ye=j+be;re+=Math.abs(j)>=Math.abs(be)?j-ye+be:be-ye+j,j=ye}j+re>=0!=!!N&&se.reverse()}var ce=a.getDefaultExportFromCjs(function se(N,j){var re,fe=N&&N.type;if(fe==="FeatureCollection")for(re=0;re<N.features.length;re++)se(N.features[re],j);else if(fe==="GeometryCollection")for(re=0;re<N.geometries.length;re++)se(N.geometries[re],j);else if(fe==="Feature")se(N.geometry,j);else if(fe==="Polygon")Y(N.coordinates,j);else if(fe==="MultiPolygon")for(re=0;re<N.coordinates.length;re++)Y(N.coordinates[re],j);return N});const _e=a.VectorTileFeature.prototype.toGeoJSON;var ze={exports:{}},le=a.pointGeometry,ee=a.vectorTile.VectorTileFeature,ue=Be;function Be(se,N){this.options=N||{},this.features=se,this.length=se.length}function $e(se,N){this.id=typeof se.id=="number"?se.id:void 0,this.type=se.type,this.rawGeometry=se.type===1?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=N||4096}Be.prototype.feature=function(se){return new $e(this.features[se],this.options.extent)},$e.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var N=0;N<se.length;N++){for(var j=se[N],re=[],fe=0;fe<j.length;fe++)re.push(new le(j[fe][0],j[fe][1]));this.geometry.push(re)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,N=1/0,j=-1/0,re=1/0,fe=-1/0,ve=0;ve<se.length;ve++)for(var Ee=se[ve],be=0;be<Ee.length;be++){var ye=Ee[be];N=Math.min(N,ye.x),j=Math.max(j,ye.x),re=Math.min(re,ye.y),fe=Math.max(fe,ye.y)}return[N,re,j,fe]},$e.prototype.toGeoJSON=ee.prototype.toGeoJSON;var ot=a.pbf,rt=ue;function Je(se){var N=new ot;return function(j,re){for(var fe in j.layers)re.writeMessage(3,De,j.layers[fe])}(se,N),N.finish()}function De(se,N){var j;N.writeVarintField(15,se.version||1),N.writeStringField(1,se.name||""),N.writeVarintField(5,se.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<se.length;j++)re.feature=se.feature(j),N.writeMessage(2,_t,re);var fe=re.keys;for(j=0;j<fe.length;j++)N.writeStringField(3,fe[j]);var ve=re.values;for(j=0;j<ve.length;j++)N.writeMessage(4,Po,ve[j])}function _t(se,N){var j=se.feature;j.id!==void 0&&N.writeVarintField(1,j.id),N.writeMessage(2,sn,se),N.writeVarintField(3,j.type),N.writeMessage(4,kr,j)}function sn(se,N){var j=se.feature,re=se.keys,fe=se.values,ve=se.keycache,Ee=se.valuecache;for(var be in j.properties){var ye=j.properties[be],Pe=ve[be];if(ye!==null){Pe===void 0&&(re.push(be),ve[be]=Pe=re.length-1),N.writeVarint(Pe);var it=typeof ye;it!=="string"&&it!=="boolean"&&it!=="number"&&(ye=JSON.stringify(ye));var st=it+":"+ye,et=Ee[st];et===void 0&&(fe.push(ye),Ee[st]=et=fe.length-1),N.writeVarint(et)}}}function At(se,N){return(N<<3)+(7&se)}function rn(se){return se<<1^se>>31}function kr(se,N){for(var j=se.loadGeometry(),re=se.type,fe=0,ve=0,Ee=j.length,be=0;be<Ee;be++){var ye=j[be],Pe=1;re===1&&(Pe=ye.length),N.writeVarint(At(1,Pe));for(var it=re===3?ye.length-1:ye.length,st=0;st<it;st++){st===1&&re!==1&&N.writeVarint(At(2,it-1));var et=ye[st].x-fe,Dt=ye[st].y-ve;N.writeVarint(rn(et)),N.writeVarint(rn(Dt)),fe+=et,ve+=Dt}re===3&&N.writeVarint(At(7,1))}}function Po(se,N){var j=typeof se;j==="string"?N.writeStringField(1,se):j==="boolean"?N.writeBooleanField(7,se):j==="number"&&(se%1!=0?N.writeDoubleField(3,se):se<0?N.writeSVarintField(6,se):N.writeVarintField(5,se))}ze.exports=Je,ze.exports.fromVectorTileJs=Je,ze.exports.fromGeojsonVt=function(se,N){N=N||{};var j={};for(var re in se)j[re]=new rt(se[re].features,N),j[re].name=re,j[re].version=N.version,j[re].extent=N.extent;return Je({layers:j})},ze.exports.GeoJSONWrapper=rt;var Oi=a.getDefaultExportFromCjs(ze.exports);const wi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},Ke=Math.fround||(Mt=new Float32Array(1),se=>(Mt[0]=+se,Mt[0]));var Mt;const Tt=3,Gt=5,_n=6;class Bt{constructor(N){this.options=Object.assign(Object.create(wi),N),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(N){const{log:j,minZoom:re,maxZoom:fe}=this.options;j&&console.time("total time");const ve=`prepare ${N.length} points`;j&&console.time(ve),this.points=N;const Ee=[];for(let ye=0;ye<N.length;ye++){const Pe=N[ye];if(!Pe.geometry)continue;const[it,st]=Pe.geometry.coordinates,et=Ke(wr(it)),Dt=Ke(Rr(st));Ee.push(et,Dt,1/0,ye,-1,1),this.options.reduce&&Ee.push(0)}let be=this.trees[fe+1]=this._createTree(Ee);j&&console.timeEnd(ve);for(let ye=fe;ye>=re;ye--){const Pe=+Date.now();be=this.trees[ye]=this._createTree(this._cluster(be,ye)),j&&console.log("z%d: %d clusters in %dms",ye,be.numItems,+Date.now()-Pe)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let re=((N[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,N[1]));let ve=N[2]===180?180:((N[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)re=-180,ve=180;else if(re>ve){const st=this.getClusters([re,fe,180,Ee],j),et=this.getClusters([-180,fe,ve,Ee],j);return st.concat(et)}const be=this.trees[this._limitZoom(j)],ye=be.range(wr(re),Rr(Ee),wr(ve),Rr(fe)),Pe=be.data,it=[];for(const st of ye){const et=this.stride*st;it.push(Pe[et+Gt]>1?ir(Pe,et,this.clusterProps):this.points[Pe[et+Tt]])}return it}getChildren(N){const j=this._getOriginId(N),re=this._getOriginZoom(N),fe="No cluster with the specified id.",ve=this.trees[re];if(!ve)throw new Error(fe);const Ee=ve.data;if(j*this.stride>=Ee.length)throw new Error(fe);const be=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ye=ve.within(Ee[j*this.stride],Ee[j*this.stride+1],be),Pe=[];for(const it of ye){const st=it*this.stride;Ee[st+4]===N&&Pe.push(Ee[st+Gt]>1?ir(Ee,st,this.clusterProps):this.points[Ee[st+Tt]])}if(Pe.length===0)throw new Error(fe);return Pe}getLeaves(N,j,re){const fe=[];return this._appendLeaves(fe,N,j=j||10,re=re||0,0),fe}getTile(N,j,re){const fe=this.trees[this._limitZoom(N)],ve=Math.pow(2,N),{extent:Ee,radius:be}=this.options,ye=be/Ee,Pe=(re-ye)/ve,it=(re+1+ye)/ve,st={features:[]};return this._addTileFeatures(fe.range((j-ye)/ve,Pe,(j+1+ye)/ve,it),fe.data,j,re,ve,st),j===0&&this._addTileFeatures(fe.range(1-ye/ve,Pe,1,it),fe.data,ve,re,ve,st),j===ve-1&&this._addTileFeatures(fe.range(0,Pe,ye/ve,it),fe.data,-1,re,ve,st),st.features.length?st:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const re=this.getChildren(N);if(j++,re.length!==1)break;N=re[0].properties.cluster_id}return j}_appendLeaves(N,j,re,fe,ve){const Ee=this.getChildren(j);for(const be of Ee){const ye=be.properties;if(ye&&ye.cluster?ve+ye.point_count<=fe?ve+=ye.point_count:ve=this._appendLeaves(N,ye.cluster_id,re,fe,ve):ve<fe?ve++:N.push(be),N.length===re)break}return ve}_createTree(N){const j=new a.KDBush(N.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<N.length;re+=this.stride)j.add(N[re],N[re+1]);return j.finish(),j.data=N,j}_addTileFeatures(N,j,re,fe,ve,Ee){for(const be of N){const ye=be*this.stride,Pe=j[ye+Gt]>1;let it,st,et;if(Pe)it=xr(j,ye,this.clusterProps),st=j[ye],et=j[ye+1];else{const Lt=this.points[j[ye+Tt]];it=Lt.properties;const[Nt,Wt]=Lt.geometry.coordinates;st=wr(Nt),et=Rr(Wt)}const Dt={type:1,geometry:[[Math.round(this.options.extent*(st*ve-re)),Math.round(this.options.extent*(et*ve-fe))]],tags:it};let Ft;Ft=Pe||this.options.generateId?j[ye+Tt]:this.points[j[ye+Tt]].id,Ft!==void 0&&(Dt.id=Ft),Ee.features.push(Dt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(Math.floor(+N),this.options.maxZoom+1))}_cluster(N,j){const{radius:re,extent:fe,reduce:ve,minPoints:Ee}=this.options,be=re/(fe*Math.pow(2,j)),ye=N.data,Pe=[],it=this.stride;for(let st=0;st<ye.length;st+=it){if(ye[st+2]<=j)continue;ye[st+2]=j;const et=ye[st],Dt=ye[st+1],Ft=N.within(ye[st],ye[st+1],be),Lt=ye[st+Gt];let Nt=Lt;for(const Wt of Ft){const Mn=Wt*it;ye[Mn+2]>j&&(Nt+=ye[Mn+Gt])}if(Nt>Lt&&Nt>=Ee){let Wt,Mn=et*Lt,Un=Dt*Lt,br=-1;const Qn=((st/it|0)<<5)+(j+1)+this.points.length;for(const Bi of Ft){const or=Bi*it;if(ye[or+2]<=j)continue;ye[or+2]=j;const Ir=ye[or+Gt];Mn+=ye[or]*Ir,Un+=ye[or+1]*Ir,ye[or+4]=Qn,ve&&(Wt||(Wt=this._map(ye,st,!0),br=this.clusterProps.length,this.clusterProps.push(Wt)),ve(Wt,this._map(ye,or)))}ye[st+4]=Qn,Pe.push(Mn/Nt,Un/Nt,1/0,Qn,-1,Nt),ve&&Pe.push(br)}else{for(let Wt=0;Wt<it;Wt++)Pe.push(ye[st+Wt]);if(Nt>1)for(const Wt of Ft){const Mn=Wt*it;if(!(ye[Mn+2]<=j)){ye[Mn+2]=j;for(let Un=0;Un<it;Un++)Pe.push(ye[Mn+Un])}}}}return Pe}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j,re){if(N[j+Gt]>1){const Ee=this.clusterProps[N[j+_n]];return re?Object.assign({},Ee):Ee}const fe=this.points[N[j+Tt]].properties,ve=this.options.map(fe);return re&&ve===fe?Object.assign({},ve):ve}}function ir(se,N,j){return{type:"Feature",id:se[N+Tt],properties:xr(se,N,j),geometry:{type:"Point",coordinates:[(re=se[N],360*(re-.5)),lc(se[N+1])]}};var re}function xr(se,N,j){const re=se[N+Gt],fe=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,ve=se[N+_n],Ee=ve===-1?{}:Object.assign({},j[ve]);return Object.assign(Ee,{cluster:!0,cluster_id:se[N+Tt],point_count:re,point_count_abbreviated:fe})}function wr(se){return se/360+.5}function Rr(se){const N=Math.sin(se*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function lc(se){const N=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function ts(se,N,j,re){for(var fe,ve=re,Ee=j-N>>1,be=j-N,ye=se[N],Pe=se[N+1],it=se[j],st=se[j+1],et=N+3;et<j;et+=3){var Dt=Ns(se[et],se[et+1],ye,Pe,it,st);if(Dt>ve)fe=et,ve=Dt;else if(Dt===ve){var Ft=Math.abs(et-Ee);Ft<be&&(fe=et,be=Ft)}}ve>re&&(fe-N>3&&ts(se,N,fe,re),se[fe+2]=ve,j-fe>3&&ts(se,fe,j,re))}function Ns(se,N,j,re,fe,ve){var Ee=fe-j,be=ve-re;if(Ee!==0||be!==0){var ye=((se-j)*Ee+(N-re)*be)/(Ee*Ee+be*be);ye>1?(j=fe,re=ve):ye>0&&(j+=Ee*ye,re+=be*ye)}return(Ee=se-j)*Ee+(be=N-re)*be}function Zt(se,N,j,re){var fe={id:se===void 0?null:se,type:N,geometry:j,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ve){var Ee=ve.geometry,be=ve.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")js(ve,Ee);else if(be==="Polygon"||be==="MultiLineString")for(var ye=0;ye<Ee.length;ye++)js(ve,Ee[ye]);else if(be==="MultiPolygon")for(ye=0;ye<Ee.length;ye++)for(var Pe=0;Pe<Ee[ye].length;Pe++)js(ve,Ee[ye][Pe])}(fe),fe}function js(se,N){for(var j=0;j<N.length;j+=3)se.minX=Math.min(se.minX,N[j]),se.minY=Math.min(se.minY,N[j+1]),se.maxX=Math.max(se.maxX,N[j]),se.maxY=Math.max(se.maxY,N[j+1])}function Hr(se,N,j,re){if(N.geometry){var fe=N.geometry.coordinates,ve=N.geometry.type,Ee=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),be=[],ye=N.id;if(j.promoteId?ye=N.properties[j.promoteId]:j.generateId&&(ye=re||0),ve==="Point")Ya(fe,be);else if(ve==="MultiPoint")for(var Pe=0;Pe<fe.length;Pe++)Ya(fe[Pe],be);else if(ve==="LineString")An(fe,be,Ee,!1);else if(ve==="MultiLineString"){if(j.lineMetrics){for(Pe=0;Pe<fe.length;Pe++)An(fe[Pe],be=[],Ee,!1),se.push(Zt(ye,"LineString",be,N.properties));return}oi(fe,be,Ee,!1)}else if(ve==="Polygon")oi(fe,be,Ee,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(Pe=0;Pe<N.geometry.geometries.length;Pe++)Hr(se,{id:ye,geometry:N.geometry.geometries[Pe],properties:N.properties},j,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<fe.length;Pe++){var it=[];oi(fe[Pe],it,Ee,!0),be.push(it)}}se.push(Zt(ye,ve,be,N.properties))}}function Ya(se,N){N.push(cc(se[0])),N.push(to(se[1])),N.push(0)}function An(se,N,j,re){for(var fe,ve,Ee=0,be=0;be<se.length;be++){var ye=cc(se[be][0]),Pe=to(se[be][1]);N.push(ye),N.push(Pe),N.push(0),be>0&&(Ee+=re?(fe*Pe-ye*ve)/2:Math.sqrt(Math.pow(ye-fe,2)+Math.pow(Pe-ve,2))),fe=ye,ve=Pe}var it=N.length-3;N[2]=1,ts(N,0,it,j),N[it+2]=1,N.size=Math.abs(Ee),N.start=0,N.end=N.size}function oi(se,N,j,re){for(var fe=0;fe<se.length;fe++){var ve=[];An(se[fe],ve,j,re),N.push(ve)}}function cc(se){return se/360+.5}function to(se){var N=Math.sin(se*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Yr(se,N,j,re,fe,ve,Ee,be){if(re/=N,ve>=(j/=N)&&Ee<re)return se;if(Ee<j||ve>=re)return null;for(var ye=[],Pe=0;Pe<se.length;Pe++){var it=se[Pe],st=it.geometry,et=it.type,Dt=fe===0?it.minX:it.minY,Ft=fe===0?it.maxX:it.maxY;if(Dt>=j&&Ft<re)ye.push(it);else if(!(Ft<j||Dt>=re)){var Lt=[];if(et==="Point"||et==="MultiPoint")Ka(st,Lt,j,re,fe);else if(et==="LineString")Us(st,Lt,j,re,fe,!1,be.lineMetrics);else if(et==="MultiLineString")zo(st,Lt,j,re,fe,!1);else if(et==="Polygon")zo(st,Lt,j,re,fe,!0);else if(et==="MultiPolygon")for(var Nt=0;Nt<st.length;Nt++){var Wt=[];zo(st[Nt],Wt,j,re,fe,!0),Wt.length&&Lt.push(Wt)}if(Lt.length){if(be.lineMetrics&&et==="LineString"){for(Nt=0;Nt<Lt.length;Nt++)ye.push(Zt(it.id,et,Lt[Nt],it.tags));continue}et!=="LineString"&&et!=="MultiLineString"||(Lt.length===1?(et="LineString",Lt=Lt[0]):et="MultiLineString"),et!=="Point"&&et!=="MultiPoint"||(et=Lt.length===3?"Point":"MultiPoint"),ye.push(Zt(it.id,et,Lt,it.tags))}}}return ye.length?ye:null}function Ka(se,N,j,re,fe){for(var ve=0;ve<se.length;ve+=3){var Ee=se[ve+fe];Ee>=j&&Ee<=re&&(N.push(se[ve]),N.push(se[ve+1]),N.push(se[ve+2]))}}function Us(se,N,j,re,fe,ve,Ee){for(var be,ye,Pe=Ja(se),it=fe===0?uc:hc,st=se.start,et=0;et<se.length-3;et+=3){var Dt=se[et],Ft=se[et+1],Lt=se[et+2],Nt=se[et+3],Wt=se[et+4],Mn=fe===0?Dt:Ft,Un=fe===0?Nt:Wt,br=!1;Ee&&(be=Math.sqrt(Math.pow(Dt-Nt,2)+Math.pow(Ft-Wt,2))),Mn<j?Un>j&&(ye=it(Pe,Dt,Ft,Nt,Wt,j),Ee&&(Pe.start=st+be*ye)):Mn>re?Un<re&&(ye=it(Pe,Dt,Ft,Nt,Wt,re),Ee&&(Pe.start=st+be*ye)):Vs(Pe,Dt,Ft,Lt),Un<j&&Mn>=j&&(ye=it(Pe,Dt,Ft,Nt,Wt,j),br=!0),Un>re&&Mn<=re&&(ye=it(Pe,Dt,Ft,Nt,Wt,re),br=!0),!ve&&br&&(Ee&&(Pe.end=st+be*ye),N.push(Pe),Pe=Ja(se)),Ee&&(st+=be)}var Qn=se.length-3;Dt=se[Qn],Ft=se[Qn+1],Lt=se[Qn+2],(Mn=fe===0?Dt:Ft)>=j&&Mn<=re&&Vs(Pe,Dt,Ft,Lt),Qn=Pe.length-3,ve&&Qn>=3&&(Pe[Qn]!==Pe[0]||Pe[Qn+1]!==Pe[1])&&Vs(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&N.push(Pe)}function Ja(se){var N=[];return N.size=se.size,N.start=se.start,N.end=se.end,N}function zo(se,N,j,re,fe,ve){for(var Ee=0;Ee<se.length;Ee++)Us(se[Ee],N,j,re,fe,ve,!1)}function Vs(se,N,j,re){se.push(N),se.push(j),se.push(re)}function uc(se,N,j,re,fe,ve){var Ee=(ve-N)/(re-N);return se.push(ve),se.push(j+(fe-j)*Ee),se.push(1),Ee}function hc(se,N,j,re,fe,ve){var Ee=(ve-j)/(fe-j);return se.push(N+(re-N)*Ee),se.push(ve),se.push(1),Ee}function si(se,N){for(var j=[],re=0;re<se.length;re++){var fe,ve=se[re],Ee=ve.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")fe=Do(ve.geometry,N);else if(Ee==="MultiLineString"||Ee==="Polygon"){fe=[];for(var be=0;be<ve.geometry.length;be++)fe.push(Do(ve.geometry[be],N))}else if(Ee==="MultiPolygon")for(fe=[],be=0;be<ve.geometry.length;be++){for(var ye=[],Pe=0;Pe<ve.geometry[be].length;Pe++)ye.push(Do(ve.geometry[be][Pe],N));fe.push(ye)}j.push(Zt(ve.id,Ee,fe,ve.tags))}return j}function Do(se,N){var j=[];j.size=se.size,se.start!==void 0&&(j.start=se.start,j.end=se.end);for(var re=0;re<se.length;re+=3)j.push(se[re]+N,se[re+1],se[re+2]);return j}function Qa(se,N){if(se.transformed)return se;var j,re,fe,ve=1<<se.z,Ee=se.x,be=se.y;for(j=0;j<se.features.length;j++){var ye=se.features[j],Pe=ye.geometry,it=ye.type;if(ye.geometry=[],it===1)for(re=0;re<Pe.length;re+=2)ye.geometry.push(ns(Pe[re],Pe[re+1],N,ve,Ee,be));else for(re=0;re<Pe.length;re++){var st=[];for(fe=0;fe<Pe[re].length;fe+=2)st.push(ns(Pe[re][fe],Pe[re][fe+1],N,ve,Ee,be));ye.geometry.push(st)}}return se.transformed=!0,se}function ns(se,N,j,re,fe,ve){return[Math.round(j*(se*re-fe)),Math.round(j*(N*re-ve))]}function $s(se,N,j,re,fe){for(var ve=N===fe.maxZoom?0:fe.tolerance/((1<<N)*fe.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:re,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<se.length;be++){Ee.numFeatures++,el(Ee,se[be],ve,fe);var ye=se[be].minX,Pe=se[be].minY,it=se[be].maxX,st=se[be].maxY;ye<Ee.minX&&(Ee.minX=ye),Pe<Ee.minY&&(Ee.minY=Pe),it>Ee.maxX&&(Ee.maxX=it),st>Ee.maxY&&(Ee.maxY=st)}return Ee}function el(se,N,j,re){var fe=N.geometry,ve=N.type,Ee=[];if(ve==="Point"||ve==="MultiPoint")for(var be=0;be<fe.length;be+=3)Ee.push(fe[be]),Ee.push(fe[be+1]),se.numPoints++,se.numSimplified++;else if(ve==="LineString")rs(Ee,fe,se,j,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(be=0;be<fe.length;be++)rs(Ee,fe[be],se,j,ve==="Polygon",be===0);else if(ve==="MultiPolygon")for(var ye=0;ye<fe.length;ye++){var Pe=fe[ye];for(be=0;be<Pe.length;be++)rs(Ee,Pe[be],se,j,!0,be===0)}if(Ee.length){var it=N.tags||null;if(ve==="LineString"&&re.lineMetrics){for(var st in it={},N.tags)it[st]=N.tags[st];it.mapbox_clip_start=fe.start/fe.size,it.mapbox_clip_end=fe.end/fe.size}var et={geometry:Ee,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:it};N.id!==null&&(et.id=N.id),se.features.push(et)}}function rs(se,N,j,re,fe,ve){var Ee=re*re;if(re>0&&N.size<(fe?Ee:re))j.numPoints+=N.length/3;else{for(var be=[],ye=0;ye<N.length;ye+=3)(re===0||N[ye+2]>Ee)&&(j.numSimplified++,be.push(N[ye]),be.push(N[ye+1])),j.numPoints++;fe&&function(Pe,it){for(var st=0,et=0,Dt=Pe.length,Ft=Dt-2;et<Dt;Ft=et,et+=2)st+=(Pe[et]-Pe[Ft])*(Pe[et+1]+Pe[Ft+1]);if(st>0===it)for(et=0,Dt=Pe.length;et<Dt/2;et+=2){var Lt=Pe[et],Nt=Pe[et+1];Pe[et]=Pe[Dt-2-et],Pe[et+1]=Pe[Dt-1-et],Pe[Dt-2-et]=Lt,Pe[Dt-1-et]=Nt}}(be,ve),se.push(be)}}function Lo(se,N){var j=(N=this.options=function(fe,ve){for(var Ee in ve)fe[Ee]=ve[Ee];return fe}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(fe,ve){var Ee=[];if(fe.type==="FeatureCollection")for(var be=0;be<fe.features.length;be++)Hr(Ee,fe.features[be],ve,be);else Hr(Ee,fe.type==="Feature"?fe:{geometry:fe},ve);return Ee}(se,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=function(fe,ve){var Ee=ve.buffer/ve.extent,be=fe,ye=Yr(fe,1,-1-Ee,Ee,0,-1,2,ve),Pe=Yr(fe,1,1-Ee,2+Ee,0,-1,2,ve);return(ye||Pe)&&(be=Yr(fe,1,-Ee,1+Ee,0,-1,2,ve)||[],ye&&(be=si(ye,1).concat(be)),Pe&&(be=be.concat(si(Pe,-1)))),be}(re,N),re.length&&this.splitTile(re,0,0,0),j&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function is(se,N,j){return 32*((1<<se)*j+N)+se}function os(se,N){const j=se.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const re=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!re)return N(null,null);const fe=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(be){this._feature=be,this.extent=a.EXTENT,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(this._feature.type===1){const be=[];for(const ye of this._feature.geometry)be.push([new a.Point(ye[0],ye[1])]);return be}{const be=[];for(const ye of this._feature.geometry){const Pe=[];for(const it of ye)Pe.push(new a.Point(it[0],it[1]));be.push(Pe)}return be}}toGeoJSON(be,ye,Pe){return _e.call(this,be,ye,Pe)}}(this._features[Ee])}}(re.features);let ve=Oi(fe);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),N(null,{vectorTile:fe,rawData:ve.buffer})}Lo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Lo.prototype.splitTile=function(se,N,j,re,fe,ve,Ee){for(var be=[se,N,j,re],ye=this.options,Pe=ye.debug;be.length;){re=be.pop(),j=be.pop(),N=be.pop(),se=be.pop();var it=1<<N,st=is(N,j,re),et=this.tiles[st];if(!et&&(Pe>1&&console.time("creation"),et=this.tiles[st]=$s(se,N,j,re,ye),this.tileCoords.push({z:N,x:j,y:re}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,re,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));var Dt="z"+N;this.stats[Dt]=(this.stats[Dt]||0)+1,this.total++}if(et.source=se,fe){if(N===ye.maxZoom||N===fe)continue;var Ft=1<<fe-N;if(j!==Math.floor(ve/Ft)||re!==Math.floor(Ee/Ft))continue}else if(N===ye.indexMaxZoom||et.numPoints<=ye.indexMaxPoints)continue;if(et.source=null,se.length!==0){Pe>1&&console.time("clipping");var Lt,Nt,Wt,Mn,Un,br,Qn=.5*ye.buffer/ye.extent,Bi=.5-Qn,or=.5+Qn,Ir=1+Qn;Lt=Nt=Wt=Mn=null,Un=Yr(se,it,j-Qn,j+or,0,et.minX,et.maxX,ye),br=Yr(se,it,j+Bi,j+Ir,0,et.minX,et.maxX,ye),se=null,Un&&(Lt=Yr(Un,it,re-Qn,re+or,1,et.minY,et.maxY,ye),Nt=Yr(Un,it,re+Bi,re+Ir,1,et.minY,et.maxY,ye),Un=null),br&&(Wt=Yr(br,it,re-Qn,re+or,1,et.minY,et.maxY,ye),Mn=Yr(br,it,re+Bi,re+Ir,1,et.minY,et.maxY,ye),br=null),Pe>1&&console.timeEnd("clipping"),be.push(Lt||[],N+1,2*j,2*re),be.push(Nt||[],N+1,2*j,2*re+1),be.push(Wt||[],N+1,2*j+1,2*re),be.push(Mn||[],N+1,2*j+1,2*re+1)}}},Lo.prototype.getTile=function(se,N,j){var re=this.options,fe=re.extent,ve=re.debug;if(se<0||se>24)return null;var Ee=1<<se,be=is(se,N=(N%Ee+Ee)%Ee,j);if(this.tiles[be])return Qa(this.tiles[be],fe);ve>1&&console.log("drilling down to z%d-%d-%d",se,N,j);for(var ye,Pe=se,it=N,st=j;!ye&&Pe>0;)Pe--,it=Math.floor(it/2),st=Math.floor(st/2),ye=this.tiles[is(Pe,it,st)];return ye&&ye.source?(ve>1&&console.log("found parent tile z%d-%d-%d",Pe,it,st),ve>1&&console.time("drilling down"),this.splitTile(ye.source,Pe,it,st,se,N,j),ve>1&&console.timeEnd("drilling down"),this.tiles[be]?Qa(this.tiles[be],fe):null):null};class Gs extends a.VectorTileWorkerSource{constructor(N,j,re,fe,ve){super(N,j,re,fe,os),ve&&(this.loadGeoJSON=ve)}loadData(N,j){const re=N&&N.request,fe=re&&re.collectResourceTiming;this.loadGeoJSON(N,(ve,Ee)=>{if(ve||!Ee)return j(ve);if(typeof Ee!="object")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));{ce(Ee,!0);try{if(N.filter){const ye=a.createExpression(N.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(it=>`${it.key}: ${it.message}`).join(", "));Ee={type:"FeatureCollection",features:Ee.features.filter(it=>ye.value.evaluate({zoom:0},it))}}this._geoJSONIndex=N.cluster?new Bt(function({superclusterOptions:ye,clusterProperties:Pe}){if(!Pe||!ye)return ye;const it={},st={},et={accumulated:null,zoom:0},Dt={properties:null},Ft=Object.keys(Pe);for(const Lt of Ft){const[Nt,Wt]=Pe[Lt],Mn=a.createExpression(Wt),Un=a.createExpression(typeof Nt=="string"?[Nt,["accumulated"],["get",Lt]]:Nt);it[Lt]=Mn.value,st[Lt]=Un.value}return ye.map=Lt=>{Dt.properties=Lt;const Nt={};for(const Wt of Ft)Nt[Wt]=it[Wt].evaluate(et,Dt);return Nt},ye.reduce=(Lt,Nt)=>{Dt.properties=Nt;for(const Wt of Ft)et.accumulated=Lt[Wt],Lt[Wt]=st[Wt].evaluate(et,Dt)},ye}(N)).load(Ee.features):function(ye,Pe){return new Lo(ye,Pe)}(Ee,N.geojsonVtOptions)}catch(ye){return j(ye)}this.loaded={};const be={};if(fe){const ye=a.getPerformanceMeasurement(re);ye&&(be.resourceTiming={},be.resourceTiming[N.source]=JSON.parse(JSON.stringify(ye)))}j(null,be)}})}reloadTile(N,j){const re=this.loaded;return re&&re[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)a.getJSON(N.request,j);else{if(typeof N.data!="string")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch{return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(re){j(re)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(re){j(re)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(re){j(re)}}}class dc{constructor(N){this.self=N,this.actor=new a.Actor(N,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Gs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,re)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=re},this.self.registerRTLTextPlugin=j=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=j.applyArabicShaping,a.plugin.processBidirectionalText=j.processBidirectionalText,a.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(N,j,re){delete this.layerIndexes[N],delete this.availableImages[N],delete this.workerSources[N],delete this.demWorkerSources[N],re()}checkIfReady(N,j,re){re()}setReferrer(N,j){this.referrer=j}spriteLoaded(N,j){this.isSpriteLoaded[N]=j;for(const re in this.workerSources[N]){const fe=this.workerSources[N][re];for(const ve in fe)fe[ve]instanceof a.VectorTileWorkerSource&&(fe[ve].isSpriteLoaded=j,fe[ve].fire(new a.Event("isSpriteLoaded")))}}setImages(N,j,re){this.availableImages[N]=j;for(const fe in this.workerSources[N]){const ve=this.workerSources[N][fe];for(const Ee in ve)ve[Ee].availableImages=j}re()}enableTerrain(N,j,re){this.terrain=j,re()}setProjection(N,j){this.projections[N]=a.getProjection(j)}setLayers(N,j,re){this.getLayerIndex(N).replace(j),re()}updateLayers(N,j,re){this.getLayerIndex(N).update(j.layers,j.removedIds),re()}loadTile(N,j,re){const fe=this.enableTerrain?a.extend({enableTerrain:this.terrain},j):j;fe.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).loadTile(fe,re)}loadDEMTile(N,j,re){const fe=this.enableTerrain?a.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(N,j.source).loadTile(fe,re)}reloadTile(N,j,re){const fe=this.enableTerrain?a.extend({enableTerrain:this.terrain},j):j;fe.projection=this.projections[N]||this.defaultProjection,this.getWorkerSource(N,j.type,j.source).reloadTile(fe,re)}abortTile(N,j,re){this.getWorkerSource(N,j.type,j.source).abortTile(j,re)}removeTile(N,j,re){this.getWorkerSource(N,j.type,j.source).removeTile(j,re)}removeSource(N,j,re){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const fe=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],fe.removeSource!==void 0?fe.removeSource(j,re):re()}loadWorkerSource(N,j,re){try{this.self.importScripts(j.url),re()}catch(fe){re(fe.toString())}}syncRTLPluginState(N,j,re){try{a.plugin.setState(j);const fe=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&fe!=null){this.self.importScripts(fe);const ve=a.plugin.isParsed();re(ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${fe}`),ve)}}catch(fe){re(fe.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new H),j}getWorkerSource(N,j,re){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),!this.workerSources[N][j][re]){const fe={send:(ve,Ee,be,ye,Pe,it)=>{this.actor.send(ve,Ee,be,N,Pe,it)},scheduler:this.actor.scheduler};this.workerSources[N][j][re]=new this.workerSourceTypes[j](fe,this.getLayerIndex(N),this.getAvailableImages(N),this.isSpriteLoaded[N])}return this.workerSources[N][j][re]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new Z),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){a.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(N,j,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new dc(self)),dc}),w(["./shared"],function(a){function z(h,i){if(Array.isArray(h)){if(!Array.isArray(i)||h.length!==i.length)return!1;for(let l=0;l<h.length;l++)if(!z(h[l],i[l]))return!1;return!0}if(typeof h=="object"&&h!==null&&i!==null){if(typeof i!="object"||Object.keys(h).length!==Object.keys(i).length)return!1;for(const l in h)if(!z(h[l],i[l]))return!1;return!0}return h===i}var F=H;function H(h){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var f,g,v=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(v);try{g=new Worker(E),f=!0}catch{f=!1}return g&&g.terminate(),URL.revokeObjectURL(E),f}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var f=document.createElement("canvas");f.width=f.height=1;var g=f.getContext("2d");if(!g)return!1;var v=g.getImageData(0,0,1,1);return v&&v.width===f.width}()?(Z[l=i&&i.failIfMajorPerformanceCaveat]===void 0&&(Z[l]=function(f){var g,v=function(E){var T=document.createElement("canvas"),A=Object.create(H.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=E,T.getContext("webgl",A)||T.getContext("experimental-webgl",A)}(f);if(!v)return!1;try{g=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!g||v.isContextLost())&&(v.shaderSource(g,"void main() {}"),v.compileShader(g),v.getShaderParameter(g,v.COMPILE_STATUS)===!0)}(l)),Z[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var l}(h)}var Z={};function Y(h,i,l){const f=a.window.document.createElement(h);return i!==void 0&&(f.className=i),l&&l.appendChild(f),f}function ie(h,i,l){const f=a.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(i))f.setAttributeNS(null,g,i[g]);return l&&l.appendChild(f),f}H.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ce=a.window.document&&a.window.document.documentElement.style,_e=ce&&ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ze;function le(){ce&&_e&&(ze=ce[_e],ce[_e]="none")}function ee(){ce&&_e&&(ce[_e]=ze)}function ue(h){h.preventDefault(),h.stopPropagation(),a.window.removeEventListener("click",ue,!0)}function Be(){a.window.addEventListener("click",ue,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",ue,!0)},0)}function $e(h,i){const l=h.getBoundingClientRect();return Je(h,l,i)}function ot(h,i){const l=h.getBoundingClientRect(),f=[];for(let g=0;g<i.length;g++)f.push(Je(h,l,i[g]));return f}function rt(h){return a.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Je(h,i,l){const f=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new a.Point((l.clientX-i.left)*f,(l.clientY-i.top)*f)}function De(h,i){var l=i[0],f=i[1],g=i[2],v=i[3],E=l*v-g*f;return E?(h[0]=v*(E=1/E),h[1]=-f*E,h[2]=-g*E,h[3]=l*E,h):null}function _t(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}class sn extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:f}of this.requestors)this._notify(l,f);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,l){this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new a.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,l){if(!i)return!0;let f=0;for(const g of i){if(g[0]<f||g[1]<g[0]||l<g[1])return!1;f=g[1]}return!0}_validateContent(i,l){return!(i&&(i.length!==4||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){l.version=this.images[i].version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let f=!0;if(!this.isLoaded())for(const g of i)this.images[g]||(f=!1);this.isLoaded()||f?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const f={};for(const g of i){this.images[g]||this.fire(new a.Event("styleimagemissing",{id:g}));const v=this.images[g];v?f[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:a.warnOnce(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,f)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],f=this.getImage(i);if(!f)return null;if(l&&l.position.version===f.version)return l.position;if(l)l.position.version=f.version;else{const g={w:f.data.width+2,h:f.data.height+2,x:0,y:0},v=new a.ImagePosition(g,f);this.patterns[i]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(i,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:l,h:f}=a.potpack(i),g=this.atlasImage;g.resize({width:l||1,height:f||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],T=E.x+1,A=E.y+1,P=this.images[v].data,I=P.width,R=P.height;a.RGBAImage.copy(P,g,{x:0,y:0},{x:T,y:A},{width:I,height:R}),a.RGBAImage.copy(P,g,{x:0,y:R-1},{x:T,y:A-1},{width:I,height:1}),a.RGBAImage.copy(P,g,{x:0,y:0},{x:T,y:A+R},{width:I,height:1}),a.RGBAImage.copy(P,g,{x:I-1,y:0},{x:T-1,y:A},{width:1,height:R}),a.RGBAImage.copy(P,g,{x:0,y:0},{x:T+I,y:A},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const f=this.images[l];_t(f)&&this.updateImage(l,f)}}}const At=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(h,i){return function([l,f,g]){const v=a.degToRad(f+90),E=a.degToRad(g);return{x:l*Math.cos(v)*Math.sin(E),y:l*Math.sin(v)*Math.sin(E),z:l*Math.cos(E),azimuthal:f,polar:g}}(h.expression.evaluate(i))}interpolate(h,i,l){return{x:a.number(h.x,i.x,l),y:a.number(h.y,i.y,l),z:a.number(h.z,i.z,l),azimuthal:a.number(h.azimuthal,i.azimuthal,l),polar:a.number(h.polar,i.polar,l)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class rn extends a.Evented{constructor(i){super(),this._transitionable=new a.Transitionable(At),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(a.validateLight,i,l))for(const f in i){const g=i[f];a.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,f){return(!f||f.validate!==!1)&&a.emitValidationErrors(this,i.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const kr=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let Po=class extends a.Evented{constructor(h,i){super(),this._transitionable=new a.Transitionable(kr),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(h){for(const i in h){const l=h[i];a.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),l):this._transitionable.setValue(i,l)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function Oi(h,i,l,f){const g=a.smoothstep(45,65,l),[v,E]=wi(h,f),T=a.length(i);let A=1-Math.min(1,Math.exp((T-v)/(E-v)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*g*h.alpha}function wi(h,i){const l=.5/Math.tan(.5*i);return[h.range[0]+l,h.range[1]+l]}const Ke=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class Mt extends a.Evented{constructor(i,l){super(),this._transitionable=new a.Transitionable(Ke),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const i=this._transform,l=i.projection.name==="globe",f=a.globeToMercatorTransition(i.zoom),g=this.properties.get("range"),v=[.5,3];return{range:l?[a.number(v[0],g[0],f),a.number(v[1],g[1],f)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l={}){if(!this._validate(a.validateFog,i,l)){for(const f of Object.keys(a.spec.fog))i&&i[f]===void 0&&(i[f]=a.spec.fog[f].default);for(const f in i){const g=i[f];a.endsWith(f,"-transition")?this._transitionable.setTransition(f.slice(0,-11),g):this._transitionable.setValue(f,g)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(f,g,v){const E=a.MercatorCoordinate.fromLngLat(g),T=v.elevation?v.elevation.getAtPointOrZero(E):0,A=[E.x,E.y,T];return a.transformMat4(A,A,v.mercatorFogMatrix),Oi(f,A,v.pitch,v._fov)}(this.state,i,l):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?wi(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,f){return(!f||f.validate!==!1)&&a.emitValidationErrors(this,i.call(a.validateStyle,a.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Tt{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const f=this.workerPool.acquire(this.id);for(let g=0;g<f.length;g++){const v=new Tt.Actor(f[g],l,this.id);v.name=`Worker ${g}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,f){a.asyncAll(this.actors,(g,v)=>{g.send(i,l,v)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Gt(h,i,l){return i*(a.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}Tt.Actor=a.Actor;class _n{constructor(i,l,f,g){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=f,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(i,l){let f,g;if(i instanceof a.Point||typeof i[0]=="number"){const v=a.Point.convert(i);f=[v],g=l.isPointAboveHorizon(v)}else{const v=a.Point.convert(i[0]),E=a.Point.convert(i[1]);f=[v,E],g=a.polygonizeBounds(v,E).every(T=>l.isPointAboveHorizon(T))}return new _n(f,l.getCameraPoint(),g,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<f.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?g[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(g[3]=this.cameraPoint)),a.bufferConvexPolygon(g,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],g=a.polygonizeBounds(l,f,i),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>f.y))+((v.x>l.x)+(v.x>f.x))){case 0:g[0]=v,g[4]=v.clone();break;case 1:g.splice(1,0,v);break;case 2:g[1]=v;break;case 3:g.splice(4,0,v);break;case 5:g.splice(2,0,v);break;case 6:g[3]=v;break;case 7:g.splice(3,0,v);break;case 8:g[2]=v}return g}containsTile(i,l,f,g=0){const v=i.queryPadding/l._pixelsPerMercatorPixel+1,E=f?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l);let T=i.tileID.wrap+(E.unwrapped?g:0);const A=E.polygon.map(K=>a.getTilePoint(i.tileTransform,K,T));if(!a.polygonIntersectsBox(A,0,0,a.EXTENT,a.EXTENT))return;T=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const P=this.screenGeometryMercator.polygon.map(K=>a.getTileVec3(i.tileTransform,K,T)),I=P.map(K=>new a.Point(K[0],K[1])),R=l.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),U=a.getTileVec3(i.tileTransform,R,T),q=P.map(K=>{const O=a.sub(K,K,U);return a.normalize(O,O),new a.Ray(U,O)}),X=Gt(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:q,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(W=a.getBounds(A),W.min.x=a.clamp(W.min.x,0,a.EXTENT),W.min.y=a.clamp(W.min.y,0,a.EXTENT),W.max.x=a.clamp(W.max.x,0,a.EXTENT),W.max.y=a.clamp(W.max.y,0,a.EXTENT),W),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:X};var W}_bufferedScreenMercator(i,l){const f=xr(i);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=g,g}}_bufferedCameraMercator(i,l){const f=xr(i);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=g,g}}_projectAndResample(i,l){const f=function(v,E){const T=a.multiply([],E.pixelMatrix,E.globeMatrix),A=[0,-a.GLOBE_RADIUS,0,1],P=[0,a.GLOBE_RADIUS,0,1],I=[0,0,0,1];a.transformMat4$1(A,A,T),a.transformMat4$1(P,P,T),a.transformMat4$1(I,I,T);const R=new a.Point(A[0]/A[3],A[1]/A[3]),U=new a.Point(P[0]/P[3],P[1]/P[3]),q=a.polygonContainsPoint(v,R)&&A[3]<I[3],X=a.polygonContainsPoint(v,U)&&P[3]<I[3];if(!q&&!X)return null;const W=function(me,we,xe){for(let Ae=1;Ae<me.length;Ae++){const Xe=ir(we.pointCoordinate3D(me[Ae-1]).x),Te=ir(we.pointCoordinate3D(me[Ae]).x);if(xe<0){if(Xe<Te)return{idx:Ae,t:-Xe/(Te-1-Xe)}}else if(Te<Xe)return{idx:Ae,t:(1-Xe)/(Te+1-Xe)}}return null}(v,E,q?-1:1);if(!W)return null;const{idx:K,t:O}=W;let G=K>1?Bt(v.slice(0,K),E):[],te=K<v.length?Bt(v.slice(K),E):[];G=G.map(me=>new a.Point(ir(me.x),me.y)),te=te.map(me=>new a.Point(ir(me.x),me.y));const ne=[...G];ne.length===0&&ne.push(te[te.length-1]);const pe=a.number(ne[ne.length-1].y,(te.length===0?G[0]:te[0]).y,O);let ge;return ge=q?[new a.Point(0,pe),new a.Point(0,0),new a.Point(1,0),new a.Point(1,pe)]:[new a.Point(1,pe),new a.Point(1,1),new a.Point(0,1),new a.Point(0,pe)],ne.push(...ge),te.length===0?ne.push(G[0]):ne.push(...te),{polygon:ne.map(me=>new a.MercatorCoordinate(me.x,me.y)),unwrapped:!1}}(i,l);if(f)return f;const g=function(v,E){let T=!1,A=-1/0,P=0;for(let R=0;R<v.length-1;R++)v[R].x>A&&(A=v[R].x,P=R);for(let R=0;R<v.length-1;R++){const U=(P+R)%(v.length-1),q=v[U],X=v[U+1];Math.abs(q.x-X.x)>.5&&(q.x<X.x?(q.x+=1,U===0&&(v[v.length-1].x+=1)):(X.x+=1,U+1===v.length-1&&(v[0].x+=1)),T=!0)}const I=a.mercatorXfromLng(E.center.lng);return T&&I<Math.abs(I-1)&&v.forEach(R=>{R.x-=1}),{polygon:v,unwrapped:T}}(Bt(i,l).map(v=>new a.Point(ir(v.x),v.y)),l);return{polygon:g.polygon.map(v=>new a.MercatorCoordinate(v.x,v.y)),unwrapped:g.unwrapped}}}function Bt(h,i){return a.resample(h,l=>{const f=i.pointCoordinate3D(l);l.x=f.x,l.y=f.y},1/256)}function ir(h){return h<0?1+h%1:h%1}function xr(h){return 100*h|0}function wr(h,i,l,f,g){const v=function(E,T){if(E)return g(E);if(T){h.url&&T.tiles&&h.tiles&&delete h.tiles;const A=a.pick(a.extend(T,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(A.vectorLayers=T.vector_layers,A.vectorLayerIds=A.vectorLayers.map(P=>P.id)),A.tiles=i.canonicalizeTileset(A,h.url),g(null,A)}};return h.url?a.getJSON(i.transformRequest(i.normalizeSourceURL(h.url,null,l,f),a.ResourceType.Source),v):a.exported.frame(()=>v(null,h))}class Rr{constructor(i,l,f){this.bounds=a.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),f=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*l),g=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*l),v=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*l),E=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=f&&i.x<v&&i.y>=g&&i.y<E}}class lc{constructor(i,l,f){this.context=i;const g=i.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ts={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ns{constructor(i,l,f,g){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let f=0;f<this.attributes.length;f++){const g=l.attributes[this.attributes[f].name];g!==void 0&&i.enableVertexAttribArray(g)}}setVertexAttribPointers(i,l,f){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],E=l.attributes[v.name];E!==void 0&&i.vertexAttribPointer(E,v.components,i[ts[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zt{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class js extends Zt{getDefault(){return a.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Hr extends Zt{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Ya extends Zt{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class An extends Zt{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class oi extends Zt{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class cc extends Zt{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class to extends Zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Yr extends Zt{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ka extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class Us extends Zt{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ja extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class zo extends Zt{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Vs extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class uc extends Zt{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class hc extends Zt{getDefault(){return a.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class si extends Zt{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Do extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class Qa extends Zt{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class ns extends Zt{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let $s,el=class extends Zt{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class rs extends Zt{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Lo extends Zt{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class is extends Zt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class os extends Zt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Gs extends Zt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class dc extends Zt{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class se extends Zt{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class N extends Zt{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class j extends Zt{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class re extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class fe extends Zt{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ve extends Zt{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class Ee extends ve{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class be extends ve{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ye extends be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pe{constructor(i,l,f,g){this.context=i,this.width=l,this.height=f;const v=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Ee(i,v),g&&(this.depthAttachment=new be(i,v))}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const f=this.depthAttachment.get();f&&i.deleteRenderbuffer(f)}i.deleteFramebuffer(this.framebuffer)}}class it{constructor(i,l=!1){if(this.gl=i,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const f=i;this.extVertexArrayObject={createVertexArrayOES:f.createVertexArray.bind(i),deleteVertexArrayOES:f.deleteVertexArray.bind(i),bindVertexArrayOES:f.bindVertexArray.bind(i)}}this.clearColor=new js(this),this.clearDepth=new Hr(this),this.clearStencil=new Ya(this),this.colorMask=new An(this),this.depthMask=new oi(this),this.stencilMask=new cc(this),this.stencilFunc=new to(this),this.stencilOp=new Yr(this),this.stencilTest=new Ka(this),this.depthRange=new Us(this),this.depthTest=new Ja(this),this.depthFunc=new zo(this),this.blend=new Vs(this),this.blendFunc=new uc(this),this.blendColor=new hc(this),this.blendEquation=new si(this),this.cullFace=new Do(this),this.cullFaceSide=new Qa(this),this.frontFace=new ns(this),this.program=new el(this),this.activeTexture=new rs(this),this.viewport=new Lo(this),this.bindFramebuffer=new is(this),this.bindRenderbuffer=new os(this),this.bindTexture=new Gs(this),this.bindVertexBuffer=new dc(this),this.bindElementBuffer=new se(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new N(this),this.pixelStoreUnpack=new j(this),this.pixelStoreUnpackPremultiplyAlpha=new re(this),this.pixelStoreUnpackFlipY=new fe(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new lc(this,i,l)}createVertexBuffer(i,l,f){return new Ns(this,i,l,f)}createRenderbuffer(i,l,f){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,i,l,f),this.bindRenderbuffer.set(null),v}createFramebuffer(i,l,f){return new Pe(this,i,l,f)}clear({color:i,depth:l,stencil:f}){const g=this.gl;let v=0;i&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),g.clear(v)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){z(i.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st extends a.Evented{constructor(i,l,f,g){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(l,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(i){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=wr(this._options,this.map._requestManager,l,f,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new a.ErrorEvent(g))):v&&(a.extend(this,v),v.bounds&&(this.tileBounds=new Rr(v.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(g)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(i,l){const f=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(f,a.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",g,v.bind(this));else if(i.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const E=a.loadVectorTile.call({deduped:this._deduped},g,(T,A)=>{T||!A?v.call(this,T):(g.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},i.actor&&i.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);i.request={cancel:E}}function v(E,T){return delete i.request,i.aborted?l(null):E&&E.status!==404?l(E):(T&&T.resourceTiming&&(i.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&i.setExpiryData(T),i.loadVectorData(T,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class et extends a.Evented{constructor(i,l,f,g){super(),this.id=i,this.dispatcher=f,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},l),a.extend(this,a.pick(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=wr(this._options,this.map._requestManager,null,null,(l,f)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new a.ErrorEvent(l)):f&&(a.extend(this,f),f.bounds&&(this.tileBounds=new Rr(f.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(f.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(l)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const f=a.exported.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);i.request=a.getImage(this.map._requestManager.transformRequest(g,a.ResourceType.Tile),(v,E,T,A)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):v?(i.state="errored",l(v)):E?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:T,expires:A}),i.setTexture(E,this.map.painter),i.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(i,l,f){i.setTexture(l,f)}static unloadTileData(i,l){i.texture&&l.saveTileTexture(i.texture)}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Dt(h,i,l,f,g,v,E,T){const A=[h,l,g,i,f,v,1,1,1],P=[E,T,1],I=a.adjoint([],A),[R,U,q]=a.transformMat3(P,P,a.transpose(I,I));return a.multiply$1(A,[R,0,0,0,U,0,0,0,q],A)}class Ft extends a.Evented{constructor(i,l,f,g){super(),this.id=i,this.dispatcher=f,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=l,this._dirty=!1}load(i,l){this._loaded=l||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(f,g)=>{if(this._imageRequest=null,this._loaded=!0,f)this.fire(new a.ErrorEvent(f));else if(g){const{HTMLImageElement:v}=a.window;this.image=g instanceof v?a.exported.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const l=i.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(f){let g=1/0,v=1/0,E=-1/0,T=-1/0;for(const R of f)g=Math.min(g,R.x),v=Math.min(v,R.y),E=Math.max(E,R.x),T=Math.max(T,R.y);const A=Math.max(E-g,T-v),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),I=Math.pow(2,P);return new a.CanonicalTileID(P,Math.floor((g+E)/2*I),Math.floor((v+T)/2*I))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}if(this._boundsArray)return;const l=a.tileTransform(this.tileID,this.map.transform.projection),[f,g,v,E]=this.coordinates.map(A=>{const P=l.projection.project(A[0],A[1]);return a.getTilePoint(l,P)._round()});this.perspectiveTransform=function(A,P,I,R,U,q,X,W,K,O){const G=Dt(0,0,A,0,0,P,A,P),te=Dt(I,R,U,q,X,W,K,O);return a.multiply$1(te,a.adjoint(G,G),te),[te[6]/te[8]*A/a.EXTENT,te[7]/te[8]*P/a.EXTENT]}(this.width,this.height,f.x,f.y,g.x,g.y,E.x,E.y,v.x,v.y);const T=this._boundsArray=new a.StructArrayLayout4i8;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(g.x,g.y,a.EXTENT,0),T.emplaceBack(E.x,E.y,0,a.EXTENT),T.emplaceBack(v.x,v.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(T,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,l=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Lt={vector:st,raster:et,"raster-dem":class extends et{constructor(h,i,l,f){super(h,i,l,f),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(g,v){g&&(h.state="errored",i(g)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=a.getImage(this.map._requestManager.transformRequest(l,a.ResourceType.Tile),function(g,v,E,T){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(g)h.state="errored",i(g);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:E,expires:T});const A=a.window.ImageBitmap&&v instanceof a.window.ImageBitmap&&($s==null&&($s=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),$s),P=1-(v.width-a.prevPowerOfTwo(v.width))/2;P<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const I=A?v:a.exported.getImageData(v,P),R={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:P};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",R,f.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const i=h.canonical,l=Math.pow(2,i.z),f=(i.x-1+l)%l,g=i.x===0?h.wrap-1:h.wrap,v=(i.x+1+l)%l,E=i.x+1===l?h.wrap+1:h.wrap,T={};return T[new a.OverscaledTileID(h.overscaledZ,g,i.z,f,i.y).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,E,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(T[new a.OverscaledTileID(h.overscaledZ,g,i.z,f,i.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,E,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<l&&(T[new a.OverscaledTileID(h.overscaledZ,g,i.z,f,i.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},T[new a.OverscaledTileID(h.overscaledZ,E,i.z,v,i.y+1).key]={backfilled:!1}),T}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends a.Evented{constructor(h,i,l,f){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(f),this._data=i.data,this._options=a.extend({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const g=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*g,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*g,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:a.EXTENT,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*g,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},i),this}getClusterLeaves(h,i,l,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:i,offset:l},f),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=a.extend({},this.workerOptions),i=this._data;typeof i=="string"?(h.request=this.map._requestManager.transformRequest(a.exported.resolveURL(i),a.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,f)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new a.ErrorEvent(l));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(g.resourceTiming=f.resourceTiming[this.id]),this.fire(new a.Event("data",g)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(f,g)=>(delete h.request,h.unloadVectorData(),h.aborted?i(null):f?i(f):(h.loadVectorData(g,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ft{constructor(h,i,l,f){super(h,i,l,f),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,a.ResourceType.Source).url);a.getVideo(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new a.ErrorEvent(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(h,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ft,canvas:class extends Ft{constructor(h,i,l,f){super(h,i,l,f),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends a.Evented{constructor(h,i,l,f){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Rr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:i,y:l,z:f}=h.canonical;return this._implementation.hasTile({x:i,y:l,z:f})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,i){const{x:l,y:f,z:g}=h.tileID.canonical,v=new a.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:f,z:g},{signal:v.signal})).then(function(E){return delete h.request,h.aborted?(h.state="unloaded",i(null)):E===void 0?(h.state="errored",i(null)):E===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",i(null)):function(T){return T instanceof a.window.ImageData||T instanceof a.window.HTMLCanvasElement||T instanceof a.window.ImageBitmap||T instanceof a.window.HTMLImageElement}(E)?(this.loadTileData(h,E),h.state="loaded",void i(null)):(h.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(E=>{E.code!==20&&(h.state="errored",i(E))}),h.request.cancel=()=>v.abort()}loadTileData(h,i){et.loadTileData(h,i,this._map.painter)}unloadTileData(h){et.unloadTileData(h,this._map.painter)}unloadTile(h,i){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:f,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:f,z:g})}i()}abortTile(h,i){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Nt=function(h,i,l,f){const g=new Lt[i.type](h,i,l,f);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],g),g};function Wt(h,i){const l=a.identity([]);return a.scale(l,l,[.5*h.width,.5*-h.height,1]),a.translate(l,l,[1,-1,0]),a.multiply(l,l,h.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(l)}function Mn(h,i,l,f,g,v,E,T=!1){const A=h.tilesIn(f,E,T);A.sort(br);const P=[];for(const R of A)P.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(i,l,h._state,R,g,v,Wt(h.transform,R.tile.tileID),T)});const I=function(R){const U={},q={};for(const X of R){const W=X.queryResults,K=X.wrappedTileID,O=q[K]=q[K]||{};for(const G in W){const te=W[G],ne=O[G]=O[G]||{},pe=U[G]=U[G]||[];for(const ge of te)ne[ge.featureIndex]||(ne[ge.featureIndex]=!0,pe.push(ge))}}return U}(P);for(const R in I)I[R].forEach(U=>{const q=U.feature,X=q.layer;X&&X.type!=="background"&&X.type!=="sky"&&(q.source=X.source,X["source-layer"]&&(q.sourceLayer=X["source-layer"]),q.state=q.id!==void 0?h.getFeatureState(X["source-layer"],q.id):{})});return I}function Un(h,i){const l=h.getRenderableIds().map(v=>h.getTileByID(v)),f=[],g={};for(let v=0;v<l.length;v++){const E=l[v],T=E.tileID.canonical.key;g[T]||(g[T]=!0,E.querySourceFeatures(f,i))}return f}function br(h,i){const l=h.tileID,f=i.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function Qn(){return ca.workerClass!=null?new ca.workerClass:new a.window.Worker(ca.workerUrl)}const Bi="mapboxgl_preloaded_worker_pool";class or{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<or.workerCount;)this.workers.push(new Qn);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Bi]}numActive(){return Object.keys(this.active).length}}let Ir;function qs(){return Ir||(Ir=new or),Ir}function r_(h,i){const l={};for(const f in h)f!=="ref"&&(l[f]=h[f]);return a.refProperties.forEach(f=>{f in i&&(l[f]=i[f])}),l}function Of(h){h=h.slice();const i=Object.create(null);for(let l=0;l<h.length;l++)i[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=r_(h[l],i[h[l].ref]));return h}or.workerCount=2;const en={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Hu(h,i,l){l.push({command:en.addSource,args:[h,i[h]]})}function tl(h,i,l){i.push({command:en.removeSource,args:[h]}),l[h]=!0}function Yu(h,i,l,f){tl(h,l,f),Hu(h,i,l)}function fc(h,i,l){let f;for(f in h[l])if(h[l].hasOwnProperty(f)&&f!=="data"&&!z(h[l][f],i[l][f]))return!1;for(f in i[l])if(i[l].hasOwnProperty(f)&&f!=="data"&&!z(h[l][f],i[l][f]))return!1;return!0}function Fi(h,i,l,f,g,v){let E;for(E in i=i||{},h=h||{})h.hasOwnProperty(E)&&(z(h[E],i[E])||l.push({command:v,args:[f,E,i[E],g]}));for(E in i)i.hasOwnProperty(E)&&!h.hasOwnProperty(E)&&(z(h[E],i[E])||l.push({command:v,args:[f,E,i[E],g]}))}function no(h){return h.id}function Ku(h,i){return h[i.id]=i,h}class Ju{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=a.clamp(i,0,1);let l=1,f=this._distances[l];const g=i*this.paddedLength+this.padding;for(;f<g&&l<this._distances.length;)f=this._distances[++l];const v=l-1,E=this._distances[v],T=f-E,A=T>0?(g-E)/T:0;return this.points[v].mult(1-A).add(this.points[l].mult(A))}}class ss{constructor(i,l,f){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(l/f);for(let E=0;E<this.xCellCount*this.yCellCount;E++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,f,g,v){this._forEachCell(l,f,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(i,l,f,g){this._forEachCell(l-g,f-g,l+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(f),this.circles.push(g)}_insertBoxCell(i,l,f,g,v,E){this.boxCells[v].push(E)}_insertCircleCell(i,l,f,g,v,E){this.circleCells[v].push(E)}_query(i,l,f,g,v,E){if(f<0||i>this.width||g<0||l>this.height)return!v&&[];const T=[];if(i<=0&&l<=0&&this.width<=f&&this.height<=g){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)T.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],I=this.circles[3*A+1],R=this.circles[3*A+2];T.push({key:this.circleKeys[A],x1:P-R,y1:I-R,x2:P+R,y2:I+R})}return E?T.filter(E):T}return this._forEachCell(i,l,f,g,this._queryCell,T,{hitTest:v,seenUids:{box:{},circle:{}}},E),v?T.length>0:T}_queryCircle(i,l,f,g,v){const E=i-f,T=i+f,A=l-f,P=l+f;if(T<0||E>this.width||P<0||A>this.height)return!g&&[];const I=[];return this._forEachCell(E,A,T,P,this._queryCellCircle,I,{hitTest:g,circle:{x:i,y:l,radius:f},seenUids:{box:{},circle:{}}},v),g?I.length>0:I}query(i,l,f,g,v){return this._query(i,l,f,g,!1,v)}hitTest(i,l,f,g,v){return this._query(i,l,f,g,!0,v)}hitTestCircle(i,l,f,g){return this._queryCircle(i,l,f,!0,g)}_queryCell(i,l,f,g,v,E,T,A){const P=T.seenUids,I=this.boxCells[v];if(I!==null){const U=this.bboxes;for(const q of I)if(!P.box[q]){P.box[q]=!0;const X=4*q;if(i<=U[X+2]&&l<=U[X+3]&&f>=U[X+0]&&g>=U[X+1]&&(!A||A(this.boxKeys[q]))){if(T.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[q],x1:U[X],y1:U[X+1],x2:U[X+2],y2:U[X+3]})}}}const R=this.circleCells[v];if(R!==null){const U=this.circles;for(const q of R)if(!P.circle[q]){P.circle[q]=!0;const X=3*q;if(this._circleAndRectCollide(U[X],U[X+1],U[X+2],i,l,f,g)&&(!A||A(this.circleKeys[q]))){if(T.hitTest)return E.push(!0),!0;{const W=U[X],K=U[X+1],O=U[X+2];E.push({key:this.circleKeys[q],x1:W-O,y1:K-O,x2:W+O,y2:K+O})}}}}}_queryCellCircle(i,l,f,g,v,E,T,A){const P=T.circle,I=T.seenUids,R=this.boxCells[v];if(R!==null){const q=this.bboxes;for(const X of R)if(!I.box[X]){I.box[X]=!0;const W=4*X;if(this._circleAndRectCollide(P.x,P.y,P.radius,q[W+0],q[W+1],q[W+2],q[W+3])&&(!A||A(this.boxKeys[X])))return E.push(!0),!0}}const U=this.circleCells[v];if(U!==null){const q=this.circles;for(const X of U)if(!I.circle[X]){I.circle[X]=!0;const W=3*X;if(this._circlesCollide(q[W],q[W+1],q[W+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[X])))return E.push(!0),!0}}}_forEachCell(i,l,f,g,v,E,T,A){const P=this._convertToXCellCoord(i),I=this._convertToYCellCoord(l),R=this._convertToXCellCoord(f),U=this._convertToYCellCoord(g);for(let q=P;q<=R;q++)for(let X=I;X<=U;X++)if(v.call(this,i,l,f,g,this.xCellCount*X+q,E,T,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,f,g,v,E){const T=g-i,A=v-l,P=f+E;return P*P>T*T+A*A}_circleAndRectCollide(i,l,f,g,v,E,T){const A=(E-g)/2,P=Math.abs(i-(g+A));if(P>A+f)return!1;const I=(T-v)/2,R=Math.abs(l-(v+I));if(R>I+f)return!1;if(P<=A||R<=I)return!0;const U=P-A,q=R-I;return U*U+q*q<=f*f}}const ro={unknown:0,flipRequired:1,flipNotRequired:2},nl=Math.tan(85*Math.PI/180);function Re(h,i,l,f,g,v,E){const T=a.create();if(l)if(v.name==="globe"){const A=a.calculateGlobeLabelMatrix(g,i);a.multiply(T,T,A)}else{const A=De([],E);T[0]=A[0],T[1]=A[1],T[4]=A[2],T[5]=A[3],f||a.rotateZ(T,T,g.angle)}else a.multiply(T,g.labelPlaneMatrix,h);return T}function io(h,i,l,f,g,v,E){const T=Re(h,i,l,f,g,v,E);return v.name==="globe"&&l||(T[2]=T[6]=T[10]=T[14]=0),T}function Vn(h,i,l,f,g,v,E){if(l){if(v.name==="globe"){const T=Re(h,i,l,f,g,v,E);return a.invert(T,T),a.multiply(T,h,T),T}{const T=a.clone(h),A=a.identity([]);return A[0]=E[0],A[1]=E[1],A[4]=E[2],A[5]=E[3],a.multiply(T,T,A),f||a.rotateZ(T,T,-g.angle),T}}return g.glCoordMatrix}function sr(h,i,l,f){const g=[h,i,l,1];l?a.transformMat4$1(g,g,f):Vt(g,g,f);const v=g[3];return g[0]/=v,g[1]/=v,g[2]/=v,g}function Bf(h,i){return Math.min(.5+h/i*.5,1.5)}function Ni(h,i){const l=h[0]/h[3],f=h[1]/h[3];return l>=-i[0]&&l<=i[0]&&f>=-i[1]&&f<=i[1]}function Qu(h,i,l,f,g,v,E,T,A,P){const I=l.transform,R=f?h.textSizeData:h.iconSizeData,U=a.evaluateSizeForZoom(R,l.transform.zoom),q=I.projection.name==="globe",X=[256/l.width*2+1,256/l.height*2+1],W=f?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();let K=null;q&&(K=f?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const O=h.lineVertexArray,G=f?h.text.placedSymbolArray:h.icon.placedSymbolArray,te=l.transform.width/l.transform.height;let ne,pe=!1;for(let ge=0;ge<G.length;ge++){const me=G.get(ge),{numGlyphs:we,writingMode:xe}=me;if(xe!==a.WritingMode.vertical||pe||ne===a.WritingMode.horizontal||(pe=!0),ne=xe,(me.hidden||xe===a.WritingMode.vertical)&&!pe){bi(we,W);continue}pe=!1;const Ae=new a.Point(me.tileAnchorX,me.tileAnchorY);let{x:Xe,y:Te,z:Ne}=I.projection.projectTilePoint(Ae.x,Ae.y,P.canonical);if(A){const[kt,pt,Et]=A(Ae);Xe+=kt,Te+=pt,Ne+=Et}const ke=[Xe,Te,Ne,1];if(a.transformMat4$1(ke,ke,i),!Ni(ke,X)){bi(we,W);continue}const We=Bf(l.transform.cameraToCenterDistance,ke[3]),Ce=a.evaluateSizeForFeature(R,U,me),Fe=E?Ce/We:Ce*We,Ye=sr(Xe,Te,Ne,g);if(Ye[3]<=0){bi(we,W);continue}let Ge={};const Qe=E?null:A,yt=ht(me,Fe,!1,T,i,g,v,h.glyphOffsetArray,O,W,K,Ye,Ae,Ge,te,Qe,I.projection,P,E);pe=yt.useVertical,Qe&&yt.needsFlipping&&(Ge={}),(yt.notEnoughRoom||pe||yt.needsFlipping&&ht(me,Fe,!0,T,i,g,v,h.glyphOffsetArray,O,W,K,Ye,Ae,Ge,te,Qe,I.projection,P,E).notEnoughRoom)&&bi(we,W)}f?(h.text.dynamicLayoutVertexBuffer.updateData(W),K&&h.text.globeExtVertexBuffer.updateData(K)):(h.icon.dynamicLayoutVertexBuffer.updateData(W),K&&h.icon.globeExtVertexBuffer.updateData(K))}function Ff(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W){const{lineStartIndex:K,glyphStartIndex:O,segment:G}=T,te=O+T.numGlyphs,ne=K+T.lineLength,pe=i.getoffsetX(O),ge=i.getoffsetX(te-1),me=Kr(h*pe,l,f,g,v,E,G,K,ne,A,P,I,R,U,!0,q,X,W);if(!me)return null;const we=Kr(h*ge,l,f,g,v,E,G,K,ne,A,P,I,R,U,!0,q,X,W);return we?{first:me,last:we}:null}function Zs(h,i,l,f){return h===a.WritingMode.horizontal&&Math.abs(f)>Math.abs(l)?{useVertical:!0}:h===a.WritingMode.vertical?f>0?{needsFlipping:!0}:null:i!==ro.unknown&&function(g,v){return g===0||Math.abs(v/g)>nl}(l,f)?i===ro.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function ht(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W,K,O,G){const te=i/24,ne=h.lineOffsetX*te,pe=h.lineOffsetY*te,{lineStartIndex:ge,glyphStartIndex:me,numGlyphs:we,segment:xe,writingMode:Ae,flipState:Xe}=h,Te=ge+h.lineLength,Ne=ke=>{if(I){const[Ye,Ge,Qe]=ke.up,yt=P.length;a.updateGlobeVertexNormal(I,yt+0,Ye,Ge,Qe),a.updateGlobeVertexNormal(I,yt+1,Ye,Ge,Qe),a.updateGlobeVertexNormal(I,yt+2,Ye,Ge,Qe),a.updateGlobeVertexNormal(I,yt+3,Ye,Ge,Qe)}const[We,Ce,Fe]=ke.point;a.addDynamicAttributes(P,We,Ce,Fe,ke.angle)};if(we>1){const ke=Ff(te,T,ne,pe,l,R,U,h,A,v,q,W,!1,K,O,G);if(!ke)return{notEnoughRoom:!0};if(f&&!l){let[We,Ce,Fe]=ke.first.point,[Ye,Ge,Qe]=ke.last.point;[We,Ce]=sr(We,Ce,Fe,E),[Ye,Ge]=sr(Ye,Ge,Qe,E);const yt=Zs(Ae,Xe,(Ye-We)*X,Ge-Ce);if(h.flipState=yt&&yt.needsFlipping?ro.flipRequired:ro.flipNotRequired,yt)return yt}Ne(ke.first);for(let We=me+1;We<me+we-1;We++){const Ce=Kr(te*T.getoffsetX(We),ne,pe,l,R,U,xe,ge,Te,A,v,q,W,!1,!1,K,O,G);if(!Ce)return P.length-=4*(We-me),{notEnoughRoom:!0};Ne(Ce)}Ne(ke.last)}else{if(f&&!l){const We=sr(U.x,U.y,0,g),Ce=ge+xe+1,Fe=new a.Point(A.getx(Ce),A.gety(Ce)),Ye=sr(Fe.x,Fe.y,0,g),Ge=Ye[3]>0?Ye:Ut(U,Fe,We,1,g,void 0,K,O.canonical),Qe=Zs(Ae,Xe,(Ge[0]-We[0])*X,Ge[1]-We[1]);if(h.flipState=Qe&&Qe.needsFlipping?ro.flipRequired:ro.flipNotRequired,Qe)return Qe}const ke=Kr(te*T.getoffsetX(me),ne,pe,l,R,U,xe,ge,Te,A,v,q,W,!1,!1,K,O,G);if(!ke)return{notEnoughRoom:!0};Ne(ke)}return{}}function qt(h,i,l,f,g){const{x:v,y:E,z:T}=f.projectTilePoint(h.x,h.y,i);if(!g)return sr(v,E,T,l);const[A,P,I]=g(h);return sr(v+A,E+P,T+I,l)}function Ut(h,i,l,f,g,v,E,T){const A=qt(h.sub(i)._unit()._add(h),T,g,E,v);return a.sub(A,l,A),a.normalize(A,A),a.scaleAndAdd(A,l,A,f)}function Kr(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W,K,O){const G=f?h-i:h+i;let te=G>0?1:-1,ne=0;f&&(te*=-1,ne=Math.PI),te<0&&(ne+=Math.PI);let pe=T+E+(te>0?0:1)|0,ge=g,me=g,we=0,xe=0;const Ae=Math.abs(G),Xe=[],Te=[];let Ne=v,ke=Ne;const We=()=>Ut(ke,Ne,me,Ae-we+1,I,U,W,K.canonical);for(;we+xe<=Ae;){if(pe+=te,pe<T||pe>=A)return null;if(me=ge,ke=Ne,Xe.push(me),q&&Te.push(ke),Ne=new a.Point(P.getx(pe),P.gety(pe)),ge=R[pe],!ge){const Et=qt(Ne,K.canonical,I,W,U);ge=Et[3]>0?R[pe]=Et:We()}we+=xe,xe=a.distance(me,ge)}X&&U&&(R[pe]&&(ge=We(),xe=a.distance(me,ge)),R[pe]=ge);const Ce=(Ae-we)/xe,Fe=Ne.sub(ke)._mult(Ce)._add(ke),Ye=a.sub([],ge,me),Ge=a.scaleAndAdd([],me,Ye,Ce);let Qe=[0,0,1],yt=Ye[0],kt=Ye[1];if(O&&(Qe=W.upVector(K.canonical,Fe.x,Fe.y),Qe[0]!==0||Qe[1]!==0||Qe[2]!==1)){const Et=[Qe[2],0,-Qe[0]],$t=a.cross([],Qe,Et);a.normalize(Et,Et),a.normalize($t,$t),yt=a.dot(Ye,Et),kt=a.dot(Ye,$t)}if(l){const Et=a.cross([],Qe,Ye);a.normalize(Et,Et),a.scaleAndAdd(Ge,Ge,Et,l*te)}const pt=ne+Math.atan2(kt,yt);return Xe.push(Ge),q&&Te.push(Fe),{point:Ge,angle:pt,path:Xe,tilePath:Te,up:Qe}}function bi(h,i){const l=i.length,f=l+4*h;i.resize(f),i.float32.fill(-1/0,4*l,4*f)}function Vt(h,i,l){const f=i[0],g=i[1];return h[0]=l[0]*f+l[4]*g+l[12],h[1]=l[1]*f+l[5]*g+l[13],h[3]=l[3]*f+l[7]*g+l[15],h}const Jr=100;class rl{constructor(i,l,f=new ss(i.width+200,i.height+200,25),g=new ss(i.width+200,i.height+200,25)){this.transform=i,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Jr,this.screenBottomBoundary=i.height+Jr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,f,g,v,E,T,A){let P=f.projectedAnchorX,I=f.projectedAnchorY,R=f.projectedAnchorZ;const U=f.elevation,q=f.tileID,X=i.getProjection();if(U&&q){const[ge,me,we]=X.upVector(q.canonical,f.tileAnchorX,f.tileAnchorY),xe=X.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=ge*U*xe,I+=me*U*xe,R+=we*U*xe}const W=this.projectAndGetPerspectiveRatio(T,P,I,R,f.tileID,X.name==="globe"||!!U||this.transform.pitch>0,X),K=E*W.perspectiveRatio,O=(f.x1*l+g.x-f.padding)*K+W.point.x,G=(f.y1*l+g.y-f.padding)*K+W.point.y,te=(f.x2*l+g.x+f.padding)*K+W.point.x,ne=(f.y2*l+g.y+f.padding)*K+W.point.y,pe=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(O,G,te,ne)||!v&&this.grid.hitTest(O,G,te,ne,A)||pe?{box:[],offscreen:!1,occluded:W.occluded}:{box:[O,G,te,ne],offscreen:this.isOffscreen(O,G,te,ne),occluded:!1}}placeCollisionCircles(i,l,f,g,v,E,T,A,P,I,R,U,q,X,W){const K=[],O=this.transform.elevation,G=i.getProjection(),te=O?O.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,G):null,ne=new a.Point(f.tileAnchorX,f.tileAnchorY);let{x:pe,y:ge,z:me}=G.projectTilePoint(ne.x,ne.y,W.canonical);if(te){const[Fe,Ye,Ge]=te(ne);pe+=Fe,ge+=Ye,me+=Ge}const we=G.name==="globe",xe=this.projectAndGetPerspectiveRatio(T,pe,ge,me,W,we||!!O||this.transform.pitch>0,G),{perspectiveRatio:Ae}=xe,Xe=(R?E/Ae:E*Ae)/a.ONE_EM,Te=sr(pe,ge,me,A),Ne=xe.signedDistanceFromCamera>0?Ff(Xe,v,f.lineOffsetX*Xe,f.lineOffsetY*Xe,!1,Te,ne,f,g,A,{},O&&!R?te:null,R&&!!O,G,W,R):null;let ke=!1,We=!1,Ce=!0;if(Ne&&!xe.occluded){const Fe=.5*q*Ae+X,Ye=new a.Point(-100,-100),Ge=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),Qe=new Ju,{first:yt,last:kt}=Ne,pt=yt.path.length;let Et=[];for(let gt=pt-1;gt>=1;gt--)Et.push(yt.path[gt]);for(let gt=1;gt<kt.path.length;gt++)Et.push(kt.path[gt]);const $t=2.5*Fe;P&&(Et=Et.map(([gt,on,cn],un)=>(te&&!we&&(cn=te(un<pt-1?yt.tilePath[pt-1-un]:kt.tilePath[un-pt+2])[2]),sr(gt,on,cn,P))),Et.some(gt=>gt[3]<=0)&&(Et=[]));let jt=[];if(Et.length>0){let gt=1/0,on=-1/0,cn=1/0,un=-1/0;for(const hn of Et)gt=Math.min(gt,hn[0]),cn=Math.min(cn,hn[1]),on=Math.max(on,hn[0]),un=Math.max(un,hn[1]);on>=Ye.x&&gt<=Ge.x&&un>=Ye.y&&cn<=Ge.y&&(jt=[Et.map(hn=>new a.Point(hn[0],hn[1]))],(gt<Ye.x||on>Ge.x||cn<Ye.y||un>Ge.y)&&(jt=a.clipLine(jt,Ye.x,Ye.y,Ge.x,Ge.y)))}for(const gt of jt){Qe.reset(gt,.25*Fe);let on=0;on=Qe.length<=.5*Fe?1:Math.ceil(Qe.paddedLength/$t)+1;for(let cn=0;cn<on;cn++){const un=cn/Math.max(on-1,1),hn=Qe.lerp(un),Tr=hn.x+Jr,lr=hn.y+Jr;K.push(Tr,lr,Fe,0);const hi=Tr-Fe,$i=lr-Fe,Cn=Tr+Fe,dn=lr+Fe;if(Ce=Ce&&this.isOffscreen(hi,$i,Cn,dn),We=We||this.isInsideGrid(hi,$i,Cn,dn),!l&&this.grid.hitTestCircle(Tr,lr,Fe,U)&&(ke=!0,!I))return{circles:[],offscreen:!1,collisionDetected:ke,occluded:!1}}}}return{circles:!I&&ke||!We?[]:K,offscreen:Ce,collisionDetected:ke,occluded:xe.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,g=1/0,v=-1/0,E=-1/0;for(const I of i){const R=new a.Point(I.x+Jr,I.y+Jr);f=Math.min(f,R.x),g=Math.min(g,R.y),v=Math.max(v,R.x),E=Math.max(E,R.y),l.push(R)}const T=this.grid.query(f,g,v,E).concat(this.ignoredGrid.query(f,g,v,E)),A={},P={};for(const I of T){const R=I.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const U=[new a.Point(I.x1,I.y1),new a.Point(I.x2,I.y1),new a.Point(I.x2,I.y2),new a.Point(I.x1,I.y2)];a.polygonIntersectsPolygon(l,U)&&(A[R.bucketInstanceId][R.featureIndex]=!0,P[R.bucketInstanceId]===void 0&&(P[R.bucketInstanceId]=[]),P[R.bucketInstanceId].push(R.featureIndex))}return P}insertCollisionBox(i,l,f,g,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,f,g,v){const E=l?this.ignoredGrid:this.grid,T={bucketInstanceId:f,featureIndex:g,collisionGroupID:v};for(let A=0;A<i.length;A+=4)E.insertCircle(T,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,l,f,g,v,E,T){const A=[l,f,g,1];let P=!1;g||this.transform.pitch>0?(a.transformMat4$1(A,A,i),this.fogState&&v&&T.name!=="globe"&&(P=function(U,q,X,W,K,O){const G=O.calculateFogTileMatrix(K),te=[q,X,W];return a.transformMat4(te,te,G),Oi(U,te,O.pitch,O._fov)}(this.fogState,l,f,g,v.toUnwrapped(),this.transform)>.9)):Vt(A,A,i);const I=A[3];return{point:new a.Point((A[0]/I+1)/2*this.transform.width+Jr,(-A[1]/I+1)/2*this.transform.height+Jr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/I*.5,1.5),signedDistanceFromCamera:I,occluded:E&&A[2]>I||P}}isOffscreen(i,l,f,g){return f<Jr||i>=this.screenRightBoundary||g<Jr||l>this.screenBottomBoundary}isInsideGrid(i,l,f,g){return f>=0&&i<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=a.identity([]);return a.translate(i,i,[-100,-100,0]),i}}function as(h,i,l){const f=i.createTileMatrix(h,h.worldSize,l.toUnwrapped());return a.multiply(new Float32Array(16),h.projMatrix,f)}function ai(h,i,l){if(i.projection.name===l.projection.name)return h.projMatrix;const f=l.clone();return f.setProjection(i.projection),as(f,i.getProjection(),h)}function Sn(h,i,l){return i.name===l.projection.name?h.projMatrix:as(l,i,h)}class Nf{constructor(i,l,f,g){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):g&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class oo{constructor(i,l,f,g,v,E=!1){this.text=new Nf(i?i.text:null,l,f,v),this.icon=new Nf(i?i.icon:null,l,g,v),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class il{constructor(i,l,f,g=!1){this.text=i,this.icon=l,this.skipFade=f,this.clipped=g}}class ol{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class eh{constructor(i,l,f,g,v){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=v}}class jf{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[i]}}function sl(h,i,l,f,g){const{horizontalAlign:v,verticalAlign:E}=a.getAnchorAlignment(h),T=-(v-.5)*i,A=-(E-.5)*l,P=a.evaluateVariableOffset(h,f);return new a.Point(T+P[0]*g,A+P[1]*g)}function al(h,i,l,f,g){const v=new a.Point(h,i);return l&&v._rotate(f?g:-g),v}class pc{constructor(i,l,f,g,v){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new rl(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new jf(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,f,g){const v=f.getBucket(l),E=f.latestFeatureIndex;if(!v||!E||l.id!==v.layerIds[0])return;const T=v.layers[0].layout,A=f.collisionBoxArray,P=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),I=f.tileSize/a.EXTENT,R=f.tileID.toUnwrapped();this.transform.setProjection(v.projection);const U=(q=f.tileID,X=v.getProjection(),W=this.transform,X.name===this.projection?W.calculateProjMatrix(q.toUnwrapped()):as(W,X,q));var q,X,W;const K=T.get("text-pitch-alignment")==="map",O=T.get("text-rotation-alignment")==="map";l.compileFilter();const G=l.dynamicFilter(),te=l.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(f),pe=io(U,f.tileID.canonical,K,O,this.transform,v.getProjection(),ne);let ge=null;if(K){const xe=Vn(U,f.tileID.canonical,K,O,this.transform,v.getProjection(),ne);ge=a.multiply([],this.transform.labelPlaneMatrix,xe)}let me=null;G&&f.latestFeatureIndex&&(me={unwrappedTileID:R,dynamicFilter:G,dynamicFilterNeedsFeature:te,featureIndex:f.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new eh(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,f.tileID);const we={bucket:v,layout:T,posMatrix:U,textLabelPlaneMatrix:pe,labelToScreenMatrix:ge,clippingData:me,scale:P,textPixelRatio:I,holdingForFade:f.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const xe of v.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Xe,symbolInstanceEnd:Te}=xe;i.push({sortKey:Ae,symbolInstanceStart:Xe,symbolInstanceEnd:Te,parameters:we})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:we})}attemptAnchorPlacement(i,l,f,g,v,E,T,A,P,I,R,U,q,X,W,K,O,G){const{textOffset0:te,textOffset1:ne,crossTileID:pe}=U,ge=[te,ne],me=sl(i,f,g,ge,v),we=this.collisionIndex.placeCollisionBox(X,v,l,al(me.x,me.y,E,T,this.transform.angle),R,A,P,I.predicate);if(K){const xe=X.getSymbolInstanceIconSize(G,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,xe,K,al(me.x,me.y,E,T,this.transform.angle),R,A,P,I.predicate).box.length===0)return}if(we.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(xe=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:ge,width:f,height:g,anchor:i,textScale:v,prevAnchor:xe},this.markUsedJustification(X,i,U,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,U),this.placedOrientations[pe]=W),{shift:me,placedGlyphBoxes:we}}}placeLayerBucketPart(i,l,f,g){const{bucket:v,layout:E,posMatrix:T,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:I,textPixelRatio:R,holdingForFade:U,collisionBoxArray:q,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:W,collisionGroup:K}=i.parameters,O=E.get("text-optional"),G=E.get("icon-optional"),te=E.get("text-allow-overlap"),ne=E.get("icon-allow-overlap"),pe=E.get("text-rotation-alignment")==="map",ge=E.get("text-pitch-alignment")==="map",me=E.get("icon-text-fit")!=="none",we=E.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let xe=te&&(ne||!v.hasIconData()||G),Ae=ne&&(te||!v.hasTextData()||O);!v.collisionArrays&&q&&v.deserializeCollisionBoxes(q),f&&g&&v.updateCollisionDebugBuffers(this.transform.zoom,q);const Xe=(Te,Ne,ke)=>{const{crossTileID:We,numVerticalGlyphVertices:Ce}=Te;if(I){const Cn={zoom:this.transform.zoom,pitch:this.transform.pitch};let dn=null;if(I.dynamicFilterNeedsFeature){const Kt=this.retainedQueryData[v.bucketInstanceId];dn=I.featureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:Kt.bucketIndex,sourceLayerIndex:Kt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Cn,dn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new a.Point(Te.tileAnchorX,Te.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[We]=new il(!1,!1,!1,!0),void l.add(We)}if(l.has(We))return;if(U)return void(this.placements[We]=new il(!1,!1,!1));let Fe=!1,Ye=!1,Ge=!0,Qe=!1,yt=!1,kt=null,pt={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},$t=null,jt=null,gt=null,on=0,cn=0,un=0;ke.textFeatureIndex?on=ke.textFeatureIndex:Te.useRuntimeCollisionCircles&&(on=Te.featureIndex),ke.verticalTextFeatureIndex&&(cn=ke.verticalTextFeatureIndex);const hn=Cn=>{Cn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const dn=this.transform.elevation;(dn||Cn.elevation)&&(Cn.elevation=dn?dn.getAtTileOffset(Cn.tileID,Cn.tileAnchorX,Cn.tileAnchorY):0)},Tr=ke.textBox;if(Tr){hn(Tr);const Cn=Kt=>{let $n=a.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Kt&&this.prevPlacement){const Pr=this.prevPlacement.placedOrientations[We];Pr&&(this.placedOrientations[We]=Pr,$n=Pr,this.markUsedOrientation(v,$n,Te))}return $n},dn=(Kt,$n)=>{if(v.allowVerticalPlacement&&Ce>0&&ke.verticalTextBox){for(const Pr of v.writingModes)if(Pr===a.WritingMode.vertical?(pt=$n(),Et=pt):pt=Kt(),pt&&pt.box&&pt.box.length)break}else pt=Kt()};if(E.get("text-variable-anchor")){let Kt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We]){const En=this.prevPlacement.variableOffsets[We];Kt.indexOf(En.anchor)>0&&(Kt=Kt.filter(Fr=>Fr!==En.anchor),Kt.unshift(En.anchor))}const $n=(En,Fr,Uc)=>{const ms=v.getSymbolInstanceTextSize(X,Te,this.transform.zoom,Ne),Al=(En.x2-En.x1)*ms+2*En.padding,fo=(En.y2-En.y1)*ms+2*En.padding,Bo=me&&!ne?Fr:null;Bo&&hn(Bo);let gs={box:[],offscreen:!1,occluded:!1};const Vc=te?2*Kt.length:Kt.length;for(let Ml=0;Ml<Vc;++Ml){const Gh=this.attemptAnchorPlacement(Kt[Ml%Kt.length],En,Al,fo,ms,pe,ge,R,T,K,Ml>=Kt.length,Te,Ne,v,Uc,Bo,X,W);if(Gh&&(gs=Gh.placedGlyphBoxes,gs&&gs.box&&gs.box.length)){Fe=!0,kt=Gh.shift;break}}return gs};dn(()=>$n(Tr,ke.iconBox,a.WritingMode.horizontal),()=>{const En=ke.verticalTextBox;return En&&hn(En),v.allowVerticalPlacement&&!(pt&&pt.box&&pt.box.length)&&Ce>0&&En?$n(En,ke.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),pt&&(Fe=pt.box,Ge=pt.offscreen,Qe=pt.occluded);const Pr=Cn(!(!pt||!pt.box));if(!Fe&&this.prevPlacement){const En=this.prevPlacement.variableOffsets[We];En&&(this.variableOffsets[We]=En,this.markUsedJustification(v,En.anchor,Te,Pr))}}else{const Kt=($n,Pr)=>{const En=v.getSymbolInstanceTextSize(X,Te,this.transform.zoom,Ne),Fr=this.collisionIndex.placeCollisionBox(v,En,$n,new a.Point(0,0),te,R,T,K.predicate);return Fr&&Fr.box&&Fr.box.length&&(this.markUsedOrientation(v,Pr,Te),this.placedOrientations[We]=Pr),Fr};dn(()=>Kt(Tr,a.WritingMode.horizontal),()=>{const $n=ke.verticalTextBox;return v.allowVerticalPlacement&&Ce>0&&$n?(hn($n),Kt($n,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Cn(!!(pt&&pt.box&&pt.box.length))}}if($t=pt,Fe=$t&&$t.box&&$t.box.length>0,Ge=$t&&$t.offscreen,Qe=$t&&$t.occluded,Te.useRuntimeCollisionCircles){const Cn=v.text.placedSymbolArray.get(Te.centerJustifiedTextSymbolIndex>=0?Te.centerJustifiedTextSymbolIndex:Te.verticalPlacedTextSymbolIndex),dn=a.evaluateSizeForFeature(v.textSizeData,X,Cn),Kt=E.get("text-padding");jt=this.collisionIndex.placeCollisionCircles(v,te,Cn,v.lineVertexArray,v.glyphOffsetArray,dn,T,A,P,f,ge,K.predicate,Te.collisionCircleDiameter*dn/a.ONE_EM,Kt,this.retainedQueryData[v.bucketInstanceId].tileID),Fe=te||jt.circles.length>0&&!jt.collisionDetected,Ge=Ge&&jt.offscreen,Qe=jt.occluded}if(ke.iconFeatureIndex&&(un=ke.iconFeatureIndex),ke.iconBox){const Cn=dn=>{hn(dn);const Kt=me&&kt?al(kt.x,kt.y,pe,ge,this.transform.angle):new a.Point(0,0),$n=v.getSymbolInstanceIconSize(W,this.transform.zoom,Te.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,$n,dn,Kt,ne,R,T,K.predicate)};Et&&Et.box&&Et.box.length&&ke.verticalIconBox?(gt=Cn(ke.verticalIconBox),Ye=gt.box.length>0):(gt=Cn(ke.iconBox),Ye=gt.box.length>0),Ge=Ge&&gt.offscreen,yt=gt.occluded}const lr=O||Te.numHorizontalGlyphVertices===0&&Ce===0,hi=G||Te.numIconVertices===0;if(lr||hi?hi?lr||(Ye=Ye&&Fe):Fe=Ye&&Fe:Ye=Fe=Ye&&Fe,Fe&&$t&&$t.box&&this.collisionIndex.insertCollisionBox($t.box,E.get("text-ignore-placement"),v.bucketInstanceId,Et&&Et.box&&cn?cn:on,K.ID),Ye&&gt&&this.collisionIndex.insertCollisionBox(gt.box,E.get("icon-ignore-placement"),v.bucketInstanceId,un,K.ID),jt&&(Fe&&this.collisionIndex.insertCollisionCircles(jt.circles,E.get("text-ignore-placement"),v.bucketInstanceId,on,K.ID),f)){const Cn=v.bucketInstanceId;let dn=this.collisionCircleArrays[Cn];dn===void 0&&(dn=this.collisionCircleArrays[Cn]=new ol);for(let Kt=0;Kt<jt.circles.length;Kt+=4)dn.circles.push(jt.circles[Kt+0]),dn.circles.push(jt.circles[Kt+1]),dn.circles.push(jt.circles[Kt+2]),dn.circles.push(jt.collisionDetected?1:0)}const $i=v.projection.name!=="globe";xe=xe&&($i||!Qe),Ae=Ae&&($i||!yt),this.placements[We]=new il(Fe||xe,Ye||Ae,Ge||v.justReloaded),l.add(We)};if(we){const Te=v.getSortedSymbolIndexes(this.transform.angle);for(let Ne=Te.length-1;Ne>=0;--Ne){const ke=Te[Ne];Xe(v.symbolInstances.get(ke),ke,v.collisionArrays[ke])}}else for(let Te=i.symbolInstanceStart;Te<i.symbolInstanceEnd;Te++)Xe(v.symbolInstances.get(Te),Te,v.collisionArrays[Te]);if(f&&v.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[v.bucketInstanceId];a.invert(Te.invProjMatrix,T),Te.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,l,f,g){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:A,crossTileID:P}=f,I=a.getAnchorJustification(l),R=g===a.WritingMode.vertical?A:I==="left"?v:I==="center"?E:I==="right"?T:-1;v>=0&&(i.text.placedSymbolArray.get(v).crossTileID=R>=0&&v!==R?0:P),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=R>=0&&E!==R?0:P),T>=0&&(i.text.placedSymbolArray.get(T).crossTileID=R>=0&&T!==R?0:P),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=R>=0&&A!==R?0:P)}markUsedOrientation(i,l,f){const g=l===a.WritingMode.horizontal||l===a.WritingMode.horizontalOnly?l:0,v=l===a.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P}=f,I=i.text.placedSymbolArray;E>=0&&(I.get(E).placedOrientation=g),T>=0&&(I.get(T).placedOrientation=g),A>=0&&(I.get(A).placedOrientation=g),P>=0&&(I.get(P).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(i):1,v=l?l.opacities:{},E=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],I=v[A];I?(this.opacities[A]=new oo(I,g,P.text,P.icon,null,P.clipped),f=f||P.text!==I.text.placed||P.icon!==I.icon.placed):(this.opacities[A]=new oo(null,g,P.text,P.icon,P.skipFade,P.clipped),f=f||P.text||P.icon)}for(const A in v){const P=v[A];if(!this.opacities[A]){const I=new oo(P,g,!1,!1);I.isHidden()||(this.opacities[A]=I,f=f||P.text.placed||P.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in T)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=T[A]);f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const f=new Set;for(const g of l){const v=g.getBucket(i);v&&g.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,f,g.collisionBoxArray)}}updateBucketOpacities(i,l,f){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const g=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),E=new oo(null,0,!1,!1,!0),T=g.get("text-allow-overlap"),A=g.get("icon-allow-overlap"),P=g.get("text-variable-anchor"),I=g.get("text-rotation-alignment")==="map",R=g.get("text-pitch-alignment")==="map",U=g.get("icon-text-fit")!=="none",q=new oo(null,0,T&&(A||!i.hasIconData()||g.get("icon-optional")),A&&(T||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&f&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(f);const X=(K,O,G)=>{for(let te=0;te<O/4;te++)K.opacityVertexArray.emplaceBack(G)};let W=0;for(let K=0;K<i.symbolInstances.length;K++){const O=i.symbolInstances.get(K),{numHorizontalGlyphVertices:G,numVerticalGlyphVertices:te,crossTileID:ne,numIconVertices:pe}=O,ge=l.has(ne);let me=this.opacities[ne];ge?me=E:me||(me=q,this.opacities[ne]=me),l.add(ne);const we=G>0||te>0,xe=pe>0,Ae=this.placedOrientations[ne],Xe=Ae===a.WritingMode.vertical,Te=Ae===a.WritingMode.horizontal||Ae===a.WritingMode.horizontalOnly;if(!we&&!xe||me.isHidden()||W++,we){const Ne=ll(me.text);X(i.text,G,Xe?zn:Ne),X(i.text,te,Te?zn:Ne);const ke=me.text.isHidden(),{leftJustifiedTextSymbolIndex:We,centerJustifiedTextSymbolIndex:Ce,rightJustifiedTextSymbolIndex:Fe,verticalPlacedTextSymbolIndex:Ye}=O,Ge=i.text.placedSymbolArray,Qe=ke||Xe?1:0;We>=0&&(Ge.get(We).hidden=Qe),Ce>=0&&(Ge.get(Ce).hidden=Qe),Fe>=0&&(Ge.get(Fe).hidden=Qe),Ye>=0&&(Ge.get(Ye).hidden=ke||Te?1:0);const yt=this.variableOffsets[ne];yt&&this.markUsedJustification(i,yt.anchor,O,Ae);const kt=this.placedOrientations[ne];kt&&(this.markUsedJustification(i,"left",O,kt),this.markUsedOrientation(i,kt,O))}if(xe){const Ne=ll(me.icon),{placedIconSymbolIndex:ke,verticalPlacedIconSymbolIndex:We}=O,Ce=i.icon.placedSymbolArray,Fe=me.icon.isHidden()?1:0;ke>=0&&(X(i.icon,pe,Xe?zn:Ne),Ce.get(ke).hidden=Fe),We>=0&&(X(i.icon,O.numVerticalIconVertices,Te?zn:Ne),Ce.get(We).hidden=Fe)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ne=i.collisionArrays[K];if(Ne){let ke=new a.Point(0,0),We=!0;if(Ne.textBox||Ne.verticalTextBox){if(P){const Fe=this.variableOffsets[ne];Fe?(ke=sl(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textScale),I&&ke._rotate(R?this.transform.angle:-this.transform.angle)):We=!1}v&&(We=!me.clipped),Ne.textBox&&Ws(i.textCollisionBox.collisionVertexArray,me.text.placed,!We||Xe,ke.x,ke.y),Ne.verticalTextBox&&Ws(i.textCollisionBox.collisionVertexArray,me.text.placed,!We||Te,ke.x,ke.y)}const Ce=We&&!!(!Te&&Ne.verticalIconBox);Ne.iconBox&&Ws(i.iconCollisionBox.collisionVertexArray,me.icon.placed,Ce,U?ke.x:0,U?ke.y:0),Ne.verticalIconBox&&Ws(i.iconCollisionBox.collisionVertexArray,me.icon.placed,!Ce,U?ke.x:0,U?ke.y:0)}}}if(i.fullyClipped=W===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=K.invProjMatrix,i.placementViewportMatrix=K.viewportMatrix,i.collisionCircleArray=K.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function Ws(h,i,l,f,g){h.emplaceBack(i?1:0,l?1:0,f||0,g||0),h.emplaceBack(i?1:0,l?1:0,f||0,g||0),h.emplaceBack(i?1:0,l?1:0,f||0,g||0),h.emplaceBack(i?1:0,l?1:0,f||0,g||0)}const Or=Math.pow(2,25),Fn=Math.pow(2,24),th=Math.pow(2,17),nh=Math.pow(2,16),Br=Math.pow(2,9),li=Math.pow(2,8),Uf=Math.pow(2,1);function ll(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const i=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Or+i*Fn+l*th+i*nh+l*Br+i*li+l*Uf+i}const zn=0;class cl{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,f,g,v){const E=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(E,g,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((T,A)=>T.sortKey-A.sortKey));this._currentPartIndex<E.length;){const T=E[this._currentPartIndex];if(l.placeLayerBucketPart(T,this._seenCrossTileIDs,f,T.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class rh{constructor(i,l,f,g,v,E,T,A){this.placement=new pc(i,v,E,T,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(i,l,f){const g=a.exported.now(),v=()=>{const E=a.exported.now()-g;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[i[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=T)&&(!E.maxzoom||E.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new cl(E)),this._inProgressLayer.continuePlacement(f[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const ls=512/a.EXTENT/2;class fr{constructor(i,l,f){this.tileID=i,this.bucketInstanceId=f,this.index=new a.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=i.canonical.x*a.EXTENT,v=i.canonical.y*a.EXTENT;for(let E=0;E<l.length;E++){const{key:T,crossTileID:A,tileAnchorX:P,tileAnchorY:I}=l.get(E),R=Math.floor((g+P)*ls),U=Math.floor((v+I)*ls);this.index.add(R,U),this.keys.push(T),this.crossTileIDs.push(A)}this.index.finish()}findMatches(i,l,f){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=ls/Math.pow(2,l.canonical.z-this.tileID.canonical.z),E=l.canonical.x*a.EXTENT,T=l.canonical.y*a.EXTENT;for(let A=0;A<i.length;A++){const P=i.get(A);if(P.crossTileID)continue;const{key:I,tileAnchorX:R,tileAnchorY:U}=P,q=Math.floor((E+R)*v),X=Math.floor((T+U)*v),W=this.index.range(q-g,X-g,q+g,X+g);for(const K of W){const O=this.crossTileIDs[K];if(this.keys[K]===I&&!f.has(O)){f.add(O),P.crossTileID=O;break}}}}}class ih{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class oh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const f in this.indexes){const g=this.indexes[f],v={};for(const E in g){const T=g[E];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),v[T.tileID.key]=T}this.indexes[f]=v}this.lng=i}addBucket(i,l,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const g=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>i.overscaledZ)for(const T in E){const A=E[T];A.tileID.isChildOf(i)&&A.findMatches(l.symbolInstances,i,g)}else{const T=E[i.scaledTo(Number(v)).key];T&&T.findMatches(l.symbolInstances,i,g)}}for(let v=0;v<l.symbolInstances.length;v++){const E=l.symbolInstances.get(v);E.crossTileID||(E.crossTileID=f.generate(),g.add(E.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new fr(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const f of l.crossTileIDs)this.usedCrossTileIDs[i].delete(f)}removeStaleBuckets(i){let l=!1;for(const f in this.indexes){const g=this.indexes[f];for(const v in g)i[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[v]),delete g[v],l=!0)}return l}}class so{constructor(){this.layerIndexes={},this.crossTileIDs=new ih,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,f,g){let v=this.layerIndexes[i.id];v===void 0&&(v=this.layerIndexes[i.id]=new oh);let E=!1;const T={};g.name!=="globe"&&v.handleWrapJump(f);for(const A of l){const P=A.getBucket(i);P&&i.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,P,this.crossTileIDs)&&(E=!0),T[P.bucketInstanceId]=!0)}return v.removeStaleBuckets(T)&&(E=!0),E}pruneUnusedLayers(i){const l={};i.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const Ro=(h,i)=>a.emitValidationErrors(h,i&&i.filter(l=>l.identifier!=="source.canvas")),mc=a.pick(en,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),i_=a.pick(en,["setCenter","setZoom","setBearing","setPitch"]),sh={version:8,layers:[],sources:{}},Xs={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ji extends a.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new Tt(qs(),this),this.imageManager=new sn,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(i._requestManager,l.localFontFamily?a.LocalGlyphMode.all:l.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new so,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const f=this;this._rtlTextPluginCallback=ji.registerForPluginStateChange(g=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(v,E)=>{if(a.triggerPluginCompletionEvent(v),E&&E.every(T=>T))for(const T in f._sourceCaches){const A=f._sourceCaches[T],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const v=this.getSource(g.sourceId);if(v&&v.vectorLayerIds)for(const E in this._layers){const T=this._layers[E];T.source===v.id&&this._validateLayer(T)}})}loadURL(i,l={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const f=typeof l.validate=="boolean"?l.validate:!a.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,l.accessToken);const g=this.map._requestManager.transformRequest(i,a.ResourceType.Style);this._request=a.getJSON(g,(v,E)=>{this._request=null,v?this.fire(new a.ErrorEvent(v)):E&&this._load(E,f)})}loadJSON(i,l={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(sh,!1)}_updateLayerCount(i,l){const f=l?1:-1;i.is3D()&&(this._num3DLayers+=f),i.type==="circle"&&(this._numCircleLayers+=f),i.type==="symbol"&&(this._numSymbolLayers+=f)}_load(i,l){if(l&&Ro(this,a.validateStyle(i)))return;this._loaded=!0,this.stylesheet=a.clone$1(i),this._updateMapProjection();for(const g in i.sources)this.addSource(g,i.sources[g],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const f=Of(this.stylesheet.layers);this._order=f.map(g=>g.id),this._layers={},this._serializedLayers={};for(const g of f){const v=a.createStyleLayer(g);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new rn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(l,f,g){let v,E,T;const A=a.exported.devicePixelRatio>1?"@2x":"";let P=a.getJSON(f.transformRequest(f.normalizeSpriteURL(l,A,".json"),a.ResourceType.SpriteJSON),(U,q)=>{P=null,T||(T=U,v=q,R())}),I=a.getImage(f.transformRequest(f.normalizeSpriteURL(l,A,".png"),a.ResourceType.SpriteImage),(U,q)=>{I=null,T||(T=U,E=q,R())});function R(){if(T)g(T);else if(v&&E){const U=a.exported.getImageData(E),q={};for(const X in v){const{width:W,height:K,x:O,y:G,sdf:te,pixelRatio:ne,stretchX:pe,stretchY:ge,content:me}=v[X],we=new a.RGBAImage({width:W,height:K});a.RGBAImage.copy(U,we,{x:O,y:G},{x:0,y:0},{width:W,height:K}),q[X]={data:we,pixelRatio:ne,sdf:te,stretchX:pe,stretchY:ge,content:me}}g(null,q)}}return{cancel(){P&&(P.cancel(),P=null),I&&(I.cancel(),I=null)}}}(i,this.map._requestManager,(l,f)=>{if(this._spriteRequest=null,l)this.fire(new a.ErrorEvent(l));else if(f)for(const g in f)this.imageManager.addImage(g,f[g]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getSource(i.source);if(!l)return;const f=i.sourceLayer;f&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(f)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const f of i){const g=this._layers[f];g.type!=="custom"&&l.push(g.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&(typeof i.isLayerDraped=="function"?i.isLayerDraped():Xs[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const E in this._updatedSources){const T=this._updatedSources[E];T==="reload"?this._reloadSource(E):T==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const f={};for(const g in this._sourceCaches){const v=this._sourceCaches[g];f[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];if(v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)){const T=this._getLayerSourceCache(v);T&&(T.used=!0)}const E=this.map.painter;if(E){const T=v.getProgramIds();if(!T)continue;const A=v.getProgramConfiguration(i.zoom);for(const P of T)E.useProgram(P,A)}}for(const g in f){const v=this._sourceCaches[g];f[g]!==v.used&&v.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Ro(this,a.validateStyle(i)))return!1;(i=a.clone$1(i)).layers=Of(i.layers);const l=function(g,v){if(!g)return[{command:en.setStyle,args:[v]}];let E=[];try{if(!z(g.version,v.version))return[{command:en.setStyle,args:[v]}];z(g.center,v.center)||E.push({command:en.setCenter,args:[v.center]}),z(g.zoom,v.zoom)||E.push({command:en.setZoom,args:[v.zoom]}),z(g.bearing,v.bearing)||E.push({command:en.setBearing,args:[v.bearing]}),z(g.pitch,v.pitch)||E.push({command:en.setPitch,args:[v.pitch]}),z(g.sprite,v.sprite)||E.push({command:en.setSprite,args:[v.sprite]}),z(g.glyphs,v.glyphs)||E.push({command:en.setGlyphs,args:[v.glyphs]}),z(g.transition,v.transition)||E.push({command:en.setTransition,args:[v.transition]}),z(g.light,v.light)||E.push({command:en.setLight,args:[v.light]}),z(g.fog,v.fog)||E.push({command:en.setFog,args:[v.fog]}),z(g.projection,v.projection)||E.push({command:en.setProjection,args:[v.projection]});const T={},A=[];(function(R,U,q,X){let W;for(W in U=U||{},R=R||{})R.hasOwnProperty(W)&&(U.hasOwnProperty(W)||tl(W,q,X));for(W in U){if(!U.hasOwnProperty(W))continue;const K=U[W];R.hasOwnProperty(W)?z(R[W],K)||(R[W].type==="geojson"&&K.type==="geojson"&&fc(R,U,W)?q.push({command:en.setGeoJSONSourceData,args:[W,K.data]}):Yu(W,U,q,X)):Hu(W,U,q)}})(g.sources,v.sources,A,T);const P=[];g.layers&&g.layers.forEach(R=>{R.source&&T[R.source]?E.push({command:en.removeLayer,args:[R.id]}):P.push(R)});let I=g.terrain;I&&T[I.source]&&(E.push({command:en.setTerrain,args:[void 0]}),I=void 0),E=E.concat(A),z(I,v.terrain)||E.push({command:en.setTerrain,args:[v.terrain]}),function(R,U,q){U=U||[];const X=(R=R||[]).map(no),W=U.map(no),K=R.reduce(Ku,{}),O=U.reduce(Ku,{}),G=X.slice(),te=Object.create(null);let ne,pe,ge,me,we,xe,Ae;for(ne=0,pe=0;ne<X.length;ne++)ge=X[ne],O.hasOwnProperty(ge)?pe++:(q.push({command:en.removeLayer,args:[ge]}),G.splice(G.indexOf(ge,pe),1));for(ne=0,pe=0;ne<W.length;ne++)ge=W[W.length-1-ne],G[G.length-1-ne]!==ge&&(K.hasOwnProperty(ge)?(q.push({command:en.removeLayer,args:[ge]}),G.splice(G.lastIndexOf(ge,G.length-pe),1)):pe++,xe=G[G.length-ne],q.push({command:en.addLayer,args:[O[ge],xe]}),G.splice(G.length-ne,0,ge),te[ge]=!0);for(ne=0;ne<W.length;ne++)if(ge=W[ne],me=K[ge],we=O[ge],!te[ge]&&!z(me,we))if(z(me.source,we.source)&&z(me["source-layer"],we["source-layer"])&&z(me.type,we.type)){for(Ae in Fi(me.layout,we.layout,q,ge,null,en.setLayoutProperty),Fi(me.paint,we.paint,q,ge,null,en.setPaintProperty),z(me.filter,we.filter)||q.push({command:en.setFilter,args:[ge,we.filter]}),z(me.minzoom,we.minzoom)&&z(me.maxzoom,we.maxzoom)||q.push({command:en.setLayerZoomRange,args:[ge,we.minzoom,we.maxzoom]}),me)me.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Fi(me[Ae],we[Ae],q,ge,Ae.slice(6),en.setPaintProperty):z(me[Ae],we[Ae])||q.push({command:en.setLayerProperty,args:[ge,Ae,we[Ae]]}));for(Ae in we)we.hasOwnProperty(Ae)&&!me.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?Fi(me[Ae],we[Ae],q,ge,Ae.slice(6),en.setPaintProperty):z(me[Ae],we[Ae])||q.push({command:en.setLayerProperty,args:[ge,Ae,we[Ae]]}))}else q.push({command:en.removeLayer,args:[ge]}),xe=G[G.lastIndexOf(ge)+1],q.push({command:en.addLayer,args:[we,xe]})}(P,v.layers,E)}catch(T){console.warn("Unable to compute style diff:",T),E=[{command:en.setStyle,args:[v]}]}return E}(this.serialize(),i).filter(g=>!(g.command in i_));if(l.length===0)return!1;const f=l.filter(g=>!(g.command in mc));if(f.length>0)throw new Error(`Unimplemented: ${f.map(g=>g.command).join(", ")}.`);return l.forEach(g=>{g.command!=="setTransition"&&g.command!=="setProjection"&&this[g.command].apply(this,g.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,l){return this.getImage(i)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,l),this._afterImageUpdated(i),this)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,l,f={}){if(this._checkLoaded(),this.getSource(i)!==void 0)throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(a.validateSource,`sources.${i}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=Nt(i,l,this.dispatcher,this);g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:g.serialize(),sourceId:i}));const v=E=>{const T=(E?"symbol:":"other:")+i,A=this._sourceCaches[T]=new a.SourceCache(T,g,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[i]=A,A.style=this,A.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),g.onAdd&&g.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const l=this.getSource(i);if(!l)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===i)return this.fire(new a.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new a.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const f=this._getSourceCaches(i);for(const g of f)delete this._sourceCaches[g.id],delete this._updatedSources[g.id],g.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getSource(i).setData(l),this._changed=!0}getSource(i){const l=this._getSourceCache(i);return l&&l.getSource()}_getSources(){const i=[];for(const l in this._otherSourceCaches){const f=this._getSourceCache(l);f&&i.push(f.getSource())}return i}addLayer(i,l,f={}){this._checkLoaded();const g=i.id;if(this.getLayer(g))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${g}" already exists on this map`)));let v;if(i.type==="custom"){if(Ro(this,a.validateCustomStyleLayer(i)))return;v=a.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(g,i.source),i=a.clone$1(i),i=a.extend(i,{source:g})),this._validate(a.validateLayer,`layers.${g}`,i,{arrayIndex:-1},f))return;v=a.createStyleLayer(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const E=l?this._order.indexOf(l):this._order.length;if(l&&E===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(E,0,g),this._layerOrderChanged=!0,this._layers[g]=v;const T=this._getLayerSourceCache(v);if(this._removedLayers[g]&&v.source&&T&&v.type!=="custom"){const A=this._removedLayers[g];delete this._removedLayers[g],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",T.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const f=this._order.indexOf(i);this._order.splice(f,1);const g=l?this._order.indexOf(l):this._order.length;l&&g===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(g,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const f=this._order.indexOf(i);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,f){this._checkLoaded();const g=this.getLayer(i);g?g.minzoom===l&&g.maxzoom===f||(l!=null&&(g.minzoom=l),f!=null&&(g.maxzoom=f),this._updateLayer(g)):this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,l,f={}){this._checkLoaded();const g=this.getLayer(i);if(g){if(!z(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(a.validateFilter,`layers.${g.id}.filter`,l,{layerType:g.type},f)||(g.filter=a.clone$1(l),this._updateLayer(g)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const l=this.getLayer(i);return l&&a.clone$1(l.filter)}setLayoutProperty(i,l,f,g={}){this._checkLoaded();const v=this.getLayer(i);v?z(v.getLayoutProperty(l),f)||(v.setLayoutProperty(l,f,g),this._updateLayer(v)):this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,l){const f=this.getLayer(i);if(f)return f.getLayoutProperty(l);this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,l,f,g={}){this._checkLoaded();const v=this.getLayer(i);v?z(v.getPaintProperty(l),f)||(v.setPaintProperty(l,f,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,l){const f=this.getLayer(i);return f&&f.getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const f=i.source,g=i.sourceLayer,v=this.getSource(f);if(!v)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const E=v.type;if(E==="geojson"&&g)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!g)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(f);for(const A of T)A.setFeatureState(g,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const f=i.source,g=this.getSource(f);if(!g)return void this.fire(new a.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const v=g.type,E=v==="vector"?i.sourceLayer:void 0;if(v==="vector"&&!E)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(f);for(const A of T)A.removeFeatureState(E,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,f=i.sourceLayer,g=this.getSource(l);if(g){if(g.type!=="vector"||f)return i.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(f,i.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const l in this._sourceCaches){const f=this._sourceCaches[l].getSource();i[f.id]||(i[f.id]=f.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},l=>l!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0;const l=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&l&&l.getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",l.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=E=>this._layers[E].type==="fill-extrusion",f={},g=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(l(T)){f[T]=E;for(const A of i){const P=A[T];if(P)for(const I of P)g.push(I)}}}g.sort((E,T)=>T.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const T=this._order[E];if(l(T))for(let A=g.length-1;A>=0;A--){const P=g[A].feature;if(f[P.layer.id]<E)break;v.push(P),g.pop()}else for(const A of i){const P=A[T];if(P)for(const I of P)v.push(I.feature)}}return v}queryRenderedFeatures(i,l,f){l&&l.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const g={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of l.layers){const P=this._layers[A];if(!P)return this.fire(new a.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}const v=[];l.availableImages=this._availableImages;const E=l&&l.layers?l.layers.some(A=>{const P=this.getLayer(A);return P&&P.is3D()}):this.has3DLayers(),T=_n.createFromScreenPoints(i,f);for(const A in this._sourceCaches){const P=this._sourceCaches[A].getSource().id;l.layers&&!g[P]||v.push(Mn(this._sourceCaches[A],this._layers,this._serializedLayers,T,l,f,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(A,P,I,R,U,q,X){const W={},K=q.queryRenderedSymbols(R),O=[];for(const G of Object.keys(K).map(Number))O.push(X[G]);O.sort(br);for(const G of O){const te=G.featureIndex.lookupSymbolFeatures(K[G.bucketInstanceId],P,G.bucketIndex,G.sourceLayerIndex,U.filter,U.layers,U.availableImages,A);for(const ne in te){const pe=W[ne]=W[ne]||[],ge=te[ne];ge.sort((me,we)=>{const xe=G.featureSortOrder;if(xe){const Ae=xe.indexOf(me.featureIndex);return xe.indexOf(we.featureIndex)-Ae}return we.featureIndex-me.featureIndex});for(const me of ge)pe.push(me)}}for(const G in W)W[G].forEach(te=>{const ne=te.feature,pe=I(A[G]);if(!pe)return;const ge=pe.getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=ge});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,l){l&&l.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const f=this._getSourceCaches(i);let g=[];for(const v of f)g=g.concat(Un(v,l));return g}addSourceType(i,l,f){return ji.getSourceType(i)?f(new Error(`A source type called "${i}" already exists.`)):(ji.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const f=this.light.getLight();let g=!1;for(const E in i)if(!z(i[E],f[E])){g=!0;break}if(!g)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,l),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let f=i;if(l===1){if(typeof f.source=="object"){const g="terrain-dem-src";this.addSource(g,f.source),f=a.clone$1(f),f=a.extend(f,{source:g})}if(this._validate(a.validateTerrain,"terrain",f))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,l)}else{const g=this.terrain,v=g.get();for(const E of Object.keys(a.spec.terrain))!f.hasOwnProperty(E)&&a.spec.terrain[E].default&&(f[E]=a.spec.terrain[E].default);for(const E in f)if(!z(f[E],v[E])){g.set(f),this.stylesheet.terrain=f;const T=this._setTransitionParameters({duration:0});g.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Mt(i,this.map.transform);this.stylesheet.fog=i;const f=this._setTransitionParameters({duration:0});l.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,f=l.get();Object.keys(i).length===0&&l.set(i);for(const g in i)if(!z(i[g],f[g])){l.set(i),this.stylesheet.fog=i;const v=this._setTransitionParameters({duration:0});l.updateTransitions(v);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:a.exported.now(),transition:a.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(f=>this.isLayerDraped(this._layers[f])),l=this._order.filter(f=>!this.isLayerDraped(this._layers[f]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const f=this.terrain=new Po(i,l);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const g=this._setTransitionParameters({duration:0});f.updateTransitions(g)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,f,g,v={}){return(!v||v.validate!==!1)&&Ro(this,i.call(a.validateStyle,a.extend({key:l,style:this.serialize(),value:f,styleSpec:a.spec},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const l=this._getSourceCaches(i);for(const f of l)f.clearTiles()}_reloadSource(i){const l=this._getSourceCaches(i);for(const f of l)f.resume(),f.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const l in this._sourceCaches)this._sourceCaches[l].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,f,g,v=!1){let E=!1,T=!1;const A={};for(const P of this._order){const I=this._layers[P];if(I.type!=="symbol")continue;if(!A[I.source]){const U=this._getLayerSourceCache(I);if(!U)continue;A[I.source]=U.getRenderableIds(!0).map(q=>U.getTileByID(q)).sort((q,X)=>X.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(X.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(I,A[I.source],i.center.lng,i.projection);E=E||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),i.zoom))&&(this.pauseablePlacement=new rh(i,this._order,v,l,f,g,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),T=!0),E&&this.pauseablePlacement.placement.setStale()),T||E)for(const P of this._order){const I=this._layers[P];I.type==="symbol"&&this.placement.updateLayerOpacities(I,A[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,f){this.imageManager.getImages(l.icons,f),this._updateTilesForChangedImages();const g=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};g(this._otherSourceCaches[l.source]),g(this._symbolSourceCaches[l.source])}getGlyphs(i,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(i,l,f){return a.makeRequest(l,f)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this._getSourceCaches(i);return l.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):l.every(f=>f.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ji.getSourceType=function(h){return Lt[h]},ji.setSourceType=function(h,i){Lt[h]=i},ji.registerForPluginStateChange=a.registerForPluginStateChange;var ah=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,cs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ao=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,ul=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,lo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let gc={},Hs={};const hl=[];Ys(ah,hl),Ys(ao,hl),Ys(ul,hl),Ys(lo,hl),gc=tn("",ao),Hs=tn(lo,ul);const Vf=tn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),_c=ah,lh=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ch={background:tn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:tn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:tn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:tn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:tn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:tn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:tn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:tn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:tn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:tn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:tn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:tn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:tn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:tn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:tn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:tn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:tn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:tn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:tn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:tn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:tn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:tn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:tn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:tn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,cs),skyboxGradient:tn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,cs),skyboxCapture:tn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:tn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:tn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ys(h,i){const l=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of l)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const g=f.split(" ");for(const v of g)i.includes(v)||i.push(v)}}function tn(h,i){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),g={},v=[...hl];return Ys(h,v),Ys(i,v),{fragmentSource:h=h.replace(l,(E,T,A,P,I)=>(g[I]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${I}
varying ${A} ${P} ${I};
#else
uniform ${A} ${P} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${A} ${P} ${I} = u_${I};
#endif
`)),vertexSource:i=i.replace(l,(E,T,A,P,I)=>{const R=P==="float"?"vec2":"vec4",U=I.match(/color/)?"color":R;return g[I]?T==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${A} ${R} a_${I};
varying ${A} ${P} ${I};
#else
uniform ${A} ${P} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${A} ${P} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${A} ${P} ${I} = u_${I};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
attribute ${A} ${R} a_${I};
#else
uniform ${A} ${P} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${A} ${P} ${I} = a_${I};
#else
    ${A} ${P} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${A} ${P} ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${A} ${P} ${I} = u_${I};
#endif
`}),staticAttributes:f,usedDefines:v}}class o_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,f,g,v,E,T){this.context=i;let A=this.boundPaintVertexBuffers.length!==g.length;for(let I=0;!A&&I<g.length;I++)this.boundPaintVertexBuffers[I]!==g[I]&&(A=!0);let P=this.boundDynamicVertexBuffers.length!==T.length;for(let I=0;!P&&I<T.length;I++)this.boundDynamicVertexBuffers[I]!==T[I]&&(P=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||A||P||this.boundIndexBuffer!==v||this.boundVertexOffset!==E)this.freshBind(l,f,g,v,E,T);else{i.bindVertexArrayOES.set(this.vao);for(const I of T)I&&I.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(i,l,f,g,v,E){let T;const A=i.numAttributes,P=this.context,I=P.gl;if(P.extVertexArrayObject)this.vao&&this.destroy(),this.vao=P.extVertexArrayObject.createVertexArrayOES(),P.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=E;else{T=P.currentNumAttributes||0;for(let R=A;R<T;R++)I.disableVertexAttribArray(R)}l.enableAttributes(I,i),l.bind(),l.setVertexAttribPointers(I,i,v);for(const R of f)R.enableAttributes(I,i),R.bind(),R.setVertexAttribPointers(I,i,v);for(const R of E)R&&(R.enableAttributes(I,i),R.bind(),R.setVertexAttribPointers(I,i,v));g&&g.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function uh(h,i){const l=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new a.MercatorCoordinate(0,f/l).toLngLat().lat,new a.MercatorCoordinate(0,(f+1)/l).toLngLat().lat]}function $f(h,i,l,f,g,v,E){const T=h.context,A=T.gl,P=l.fbo;if(!P)return;h.prepareDrawTile();const I=h.useProgram("hillshade");T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const R=((W,K,O,G)=>{const te=O.paint.get("hillshade-shadow-color"),ne=O.paint.get("hillshade-highlight-color"),pe=O.paint.get("hillshade-accent-color");let ge=O.paint.get("hillshade-illumination-direction")*(Math.PI/180);O.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=W.transform.angle);const me=!W.options.moving;return{u_matrix:G||W.transform.calculateProjMatrix(K.tileID.toUnwrapped(),me),u_image:0,u_latrange:uh(0,K.tileID),u_light:[O.paint.get("hillshade-exaggeration"),ge],u_shadow:te,u_highlight:ne,u_accent:pe}})(h,l,f,h.terrain?i.projMatrix:null);h.prepareDrawProgram(T,I,i.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:q,tileBoundsSegments:X}=h.getTileBoundsBuffers(l);I.draw(T,A.TRIANGLES,g,v,E,a.CullFaceMode.disabled,R,f.id,U,q,X)}function hh(h,i,l){if(!i.needsDEMTextureUpload)return;const f=h.context,g=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(l.stride);const v=l.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new a.Texture(f,v,g.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Gf(h,i,l,f,g,v){const E=h.context,T=E.gl;if(!i.dem)return;const A=i.dem;if(E.activeTexture.set(T.TEXTURE1),hh(h,i,A),!i.demTexture)return;i.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const P=A.dim;E.activeTexture.set(T.TEXTURE0);let I=i.fbo;if(!I){const X=new a.Texture(E,{width:P,height:P,data:null},T.RGBA);X.bind(T.LINEAR,T.CLAMP_TO_EDGE),I=i.fbo=E.createFramebuffer(P,P,!0),I.colorAttachment.set(X.texture)}E.bindFramebuffer.set(I.framebuffer),E.viewport.set([0,0,P,P]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(E,T.TRIANGLES,f,g,v,a.CullFaceMode.disabled,((X,W)=>{const K=W.stride,O=a.create();return a.ortho(O,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(O,O,[0,-a.EXTENT,0]),{u_matrix:O,u_image:1,u_dimension:[K,K],u_zoom:X.overscaledZ,u_unpack:W.unpackVector}})(i.tileID,A),l.id,R,U,q),i.needsHillshadePrepare=!1}const dh=h=>({u_matrix:new a.UniformMatrix4f(h),u_image0:new a.Uniform1i(h),u_skirt_height:new a.Uniform1f(h)}),Ks=(h,i)=>({u_matrix:h,u_image0:0,u_skirt_height:i}),yc=(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:l,u_zoom_transition:g,u_merc_center:v,u_image0:0,u_frustum_tl:E,u_frustum_tr:T,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:I,u_globe_radius:R,u_viewport:U,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:q});function Js(h,i){return h!=null&&i!=null&&!(!h.hasData()||!i.hasData())&&h.demTexture!=null&&i.demTexture!=null&&h.tileID.key!==i.tileID.key}const co=new class{constructor(){this.operations={}}newMorphing(h,i,l,f,g){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[h]={startTime:f,phase:0,duration:g,from:i,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const l=this.operations[i];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},us={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function vc(h){return 6*Math.pow(1.5,22-h)}function qf(h,i){const l=1<<h.z;return!i&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}const dl=h=>({u_matrix:h});function fh(h,i,l,f,g){if(g>0){const v=a.exported.now(),E=(v-h.timeAdded)/g,T=i?(v-i.timeAdded)/g:-1,A=l.getSource(),P=f.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),I=!i||Math.abs(i.tileID.overscaledZ-P)>Math.abs(h.tileID.overscaledZ-P),R=I&&h.refreshedUponExpiration?1:a.clamp(I?E:1-T,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}class ph extends a.SourceCache{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},f=new Tt(qs(),null),g=Nt("mock-dem",l,f,i.style);super("mock-dem",g,!1),g.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class xc extends a.SourceCache{constructor(i){const l=Nt("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Tt(qs(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,f){if(i.freezeTileCoverage)return;this.transform=i;const g=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,E)=>{if(v[E.key]="",!this._tiles[E.key]){const T=new a.Tile(E,this._source.tileSize*E.overscaleFactor(),i.tileZoom);T.state="loaded",this._tiles[E.key]=T}return v},{});for(const v in this._tiles)v in g||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const l=this.proxyCachedFBO[i];if(l!==void 0){const f=Object.values(l);this.renderCachePool.push(...f),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wc extends a.OverscaledTileID{constructor(i,l,f){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=f}}class mh extends a.Elevation{constructor(i,l){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,g,v]=function(A){const P=new a.StructArrayLayout2i4,I=new a.StructArrayLayout3ui6,R=131;P.reserve(17161),I.reserve(33800);const U=a.EXTENT/128,q=a.EXTENT+U/2,X=q+U;for(let K=-U;K<X;K+=U)for(let O=-U;O<X;O+=U){const G=O<0||O>q||K<0||K>q?24575:0,te=a.clamp(Math.round(O),0,a.EXTENT),ne=a.clamp(Math.round(K),0,a.EXTENT);P.emplaceBack(te+G,ne)}const W=(K,O)=>{const G=O*R+K;I.emplaceBack(G+1,G,G+R),I.emplaceBack(G+R,G+R+1,G+1)};for(let K=1;K<129;K++)for(let O=1;O<129;O++)W(O,K);return[0,129].forEach(K=>{for(let O=0;O<130;O++)W(O,K),W(K,O)}),[P,I,32768]}(),E=i.context;this.gridBuffer=E.createVertexBuffer(f,a.posAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(g),this.gridSegments=a.SegmentVector.simpleSegment(0,0,f.length,g.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new xc(l.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const T=E.gl;this._overlapStencilMode=new a.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ph(l.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,f){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const g=i.terrain.properties;this.sourceCache=i.terrain.drapeRenderMode===0?this._mockSourceCache:i._getSourceCache(g.get("source")),this._exaggeration=g.get("exaggeration");const v=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(l,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),l.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||i.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=l.getIds().map(A=>{const P=l.getTileByID(A).tileID;return P.projMatrix=f.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const I=P.transform.pointCoordinate(P.transform.getCameraPoint()),R=new a.Point(I.x,I.y);A.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;const X=new a.Point(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),W=new a.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=R.mult(1<<U.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr(X)-K.distSqr(W)})})(g,this.painter),this._previousZoom=f.zoom;const v=this.proxyToSource||{};this.proxyToSource={},g.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const A in E){const P=E[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,i[A],v),P.usedForTerrain))continue;const I=i[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[l.id]=g.map(A=>new wc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const T={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const I=P.tileID.key;I in T||(this._visibleDemTiles.push(P),T[I]=I)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const f=this._findTileCoveringTileID(l,this.sourceCache);f&&(this.terrainTileForTile[l.key]=f)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const f in this.terrainTileForTile){const g=this.terrainTileForTile[f],v=g.dem;!v||g.demTexture&&!g.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),hh(this.painter,g,v))}}_prepareDemTileUniforms(i,l,f,g){if(!l||l.demTexture==null)return!1;const v=i.tileID.canonical,E=Math.pow(2,l.tileID.canonical.z-v.z),T=g||"";return f[`u_dem_tl${T}`]=[v.x*E%1,v.y*E%1],f[`u_dem_scale${T}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){const f=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(i,f,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const l=this._visibleDemTiles.reduce((f,g)=>{if(!g.dem)return f;const v=g.dem.tree.minimums[0];return v>0&&i++,f+v},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const f=this._getLoadedAreaMinimum(),g=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(f,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(g,{premultiply:!1}):v=this._emptyDEMTexture=new a.Texture(i,g,l.RGBA,{premultiply:!1}),v}setupElevationDraw(i,l,f){const g=this.painter.context,v=g.gl,E=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var T;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();let A=null,P=null,I=1;if(f&&f.morphing&&this._useVertexMorphing){const R=f.morphing.srcDemTile,U=f.morphing.dstDemTile;I=f.morphing.phase,R&&U&&(this._prepareDemTileUniforms(i,R,E,"_prev")&&(P=R),this._prepareDemTileUniforms(i,U,E)&&(A=U))}if(P&&A?(g.activeTexture.set(v.TEXTURE2),A.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),g.activeTexture.set(v.TEXTURE4),P.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),E.u_dem_lerp=I):(A=this.terrainTileForTile[i.tileID.key],g.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(i,A,E)?A.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),g.activeTexture.set(v.TEXTURE3),f&&f.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),f&&f.useMeterToDem&&A){const R=(1<<A.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=R}if(f&&f.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),l.setTerrainUniformValues(g,E),this.painter.transform.projection.name==="globe"){const R=this.globeUniformValues(this.painter.transform,i.tileID.canonical,f&&f.useDenormalizedUpVectorScale);l.setGlobeUniformValues(g,R)}}globeUniformValues(i,l,f){const g=i.projection;return{u_tile_tl_up:g.upVector(l,0,0),u_tile_tr_up:g.upVector(l,a.EXTENT,0),u_tile_br_up:g.upVector(l,a.EXTENT,a.EXTENT),u_tile_bl_up:g.upVector(l,0,a.EXTENT),u_tile_up_scale:f?a.globeMetersToEcef(1):g.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const l=this.painter,f=this.painter.context;i.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,v,E,T,A){if(g.transform.projection.name==="globe")(function(P,I,R,U,q){const X=P.context,W=X.gl;let K,O;const G=P.options.showTerrainWireframe?2:0,te=P.transform,ne=a.globeUseCustomAntiAliasing(P,X,te),pe=(We,Ce)=>{if(O===We)return;const Fe=[us[We],"PROJECTION_GLOBE_VIEW"];ne&&Fe.push("CUSTOM_ANTIALIASING"),Ce&&Fe.push(us[G]),K=P.useProgram("globeRaster",null,Fe),O=We},ge=P.colorModeForRenderPass(),me=new a.DepthMode(W.LEQUAL,a.DepthMode.ReadWrite,P.depthRangeFor3D);co.update(q);const we=a.calculateGlobeMercatorMatrix(te),xe=[a.mercatorXfromLng(te.center.lng),a.mercatorYfromLat(te.center.lat)],Ae=G?[!1,!0]:[!1],Xe=P.globeSharedBuffers,Te=[te.width*a.exported.devicePixelRatio,te.height*a.exported.devicePixelRatio],Ne=Float32Array.from(te.globeMatrix),ke={useDenormalizedUpVectorScale:!0};if(Ae.forEach(We=>{const Ce=P.transform,Fe=vc(Ce.zoom)*I.exaggeration();O=-1;const Ye=We?W.LINES:W.TRIANGLES;for(const Ge of U){const Qe=R.getTile(Ge),yt=a.StencilMode.disabled,kt=I.prevTerrainTileForTile[Ge.key],pt=I.terrainTileForTile[Ge.key];Js(kt,pt)&&co.newMorphing(Ge.key,kt,pt,q,250),X.activeTexture.set(W.TEXTURE0),Qe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Et=co.getMorphValuesForProxy(Ge.key),$t=Et?1:0;Et&&a.extend$1(ke,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:a.easeCubicInOut(Et.phase)}});const jt=a.tileCornersToBounds(Ge.canonical),gt=a.getLatitudinalLod(jt.getCenter().lat),on=a.getGridMatrix(Ge.canonical,jt,gt,Ce.worldSize/Ce._pixelsPerMercatorPixel),cn=a.globeNormalizeECEF(a.globeTileBounds(Ge.canonical)),un=yc(Ce.projMatrix,Ne,we,cn,a.globeToMercatorTransition(Ce.zoom),xe,Ce.frustumCorners.TL,Ce.frustumCorners.TR,Ce.frustumCorners.BR,Ce.frustumCorners.BL,Ce.globeCenterInViewSpace,Ce.globeRadius,Te,Fe,on);if(pe($t,We),I.setupElevationDraw(Qe,K,ke),P.prepareDrawProgram(X,K,Ge.toUnwrapped()),Xe){const[hn,Tr,lr]=We?Xe.getWirefameBuffers(P.context,gt):Xe.getGridBuffers(gt,Fe!==0);K.draw(X,Ye,me,yt,ge,a.CullFaceMode.backCCW,un,"globe_raster",hn,Tr,lr)}}}),Xe){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&We.push("CUSTOM_ANTIALIASING"),K=P.useProgram("globeRaster",null,We);for(const Ce of U){const{x:Fe,y:Ye,z:Ge}=Ce.canonical,Qe=Ye===0,yt=Ye===(1<<Ge)-1,[kt,pt,Et,$t]=Xe.getPoleBuffers(Ge);if($t&&(Qe||yt)){const jt=R.getTile(Ce);X.activeTexture.set(W.TEXTURE0),jt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let gt=a.globePoleMatrixForTile(Ge,Fe,te);const on=a.globeNormalizeECEF(a.globeTileBounds(Ce.canonical)),cn=(un,hn)=>un.draw(X,W.TRIANGLES,me,a.StencilMode.disabled,ge,a.CullFaceMode.disabled,yc(te.projMatrix,gt,gt,on,0,xe,te.frustumCorners.TL,te.frustumCorners.TR,te.frustumCorners.BR,te.frustumCorners.BL,te.globeCenterInViewSpace,te.globeRadius,Te,0),"globe_pole_raster",hn,Et,$t);I.setupElevationDraw(jt,K,ke),P.prepareDrawProgram(X,K,Ce.toUnwrapped()),Qe&&cn(K,kt),yt&&(gt=a.scale(a.create(),gt,[1,-1,1]),cn(K,pt))}}}})(g,v,E,T,A);else{const P=g.context,I=P.gl;let R,U;const q=g.options.showTerrainWireframe?2:0,X=(te,ne)=>{if(U===te)return;const pe=[us[te]];ne&&pe.push(us[q]),R=g.useProgram("terrainRaster",null,pe),U=te},W=g.colorModeForRenderPass(),K=new a.DepthMode(I.LEQUAL,a.DepthMode.ReadWrite,g.depthRangeFor3D);co.update(A);const O=g.transform,G=vc(O.zoom)*v.exaggeration();(q?[!1,!0]:[!1]).forEach(te=>{U=-1;const ne=te?I.LINES:I.TRIANGLES,[pe,ge]=te?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const me of T){const we=E.getTile(me),xe=a.StencilMode.disabled,Ae=v.prevTerrainTileForTile[me.key],Xe=v.terrainTileForTile[me.key];Js(Ae,Xe)&&co.newMorphing(me.key,Ae,Xe,A,250),P.activeTexture.set(I.TEXTURE0),we.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Te=co.getMorphValuesForProxy(me.key),Ne=Te?1:0;let ke;Te&&(ke={morphing:{srcDemTile:Te.from,dstDemTile:Te.to,phase:a.easeCubicInOut(Te.phase)}});const We=Ks(me.projMatrix,qf(me.canonical,O.renderWorldCopies)?G/10:G);X(Ne,te),v.setupElevationDraw(we,R,ke),g.prepareDrawProgram(P,R,me.toUnwrapped()),R.draw(P,ne,K,xe,W,a.CullFaceMode.backCCW,We,"terrain_raster",v.gridBuffer,pe,ge)}})}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const l=this.painter,f=this.painter.context,g=this.proxySourceCache,v=this.proxiedCoords[g.id],E=this._drapedRenderBatches.shift(),T=[],A=l.style.order;let P=0;for(const I of v){const R=g.getTileByID(I.proxyTileKey),U=g.proxyCachedFBO[I.key]?g.proxyCachedFBO[I.key][i]:void 0,q=U!==void 0?g.renderCache[U]:this.pool[P++],X=U!==void 0;if(R.texture=q.tex,X&&!q.dirty){T.push(R.tileID);continue}let W;f.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(f.clear({color:a.Color.transparent,stencil:0}),q.dirty=!1);for(let K=E.start;K<=E.end;++K){const O=l.style._layers[A[K]];if(O.isHidden(l.transform.zoom))continue;const G=l.style._getLayerSourceCache(O),te=G?this.proxyToSource[I.key][G.id]:[I];if(!te)continue;const ne=te;f.viewport.set([0,0,q.fb.width,q.fb.height]),W!==(G?G.id:null)&&(this._setupStencil(q,te,O,G),W=G?G.id:null),l.renderLayer(l,G,O,ne)}this.renderedToTile?(q.dirty=!0,T.push(R.tileID)):X||--P,P===5&&(P=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),E.end+1}postRender(){}renderCacheEfficiency(i){const l=i.order.length;if(l===0)return{efficiency:100};let f,g=0,v=0,E=!1;for(let T=0;T<l;++T){const A=i._layers[i.order[T]];this._style.isLayerDraped(A)?(E&&++g,++v):E||(E=!0,f=A.id)}return v===0?{efficiency:100}:{efficiency:100*(1-g/v),firstUndrapedLayer:f}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,f){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const E=v.tileID,T=1<<E.overscaledZ,{x:A,y:P}=E.canonical,I=A/T,R=(A+1)/T,U=P/T,q=(P+1)/T;return{minx:I,miny:U,maxx:R,maxy:q,t:v.dem.tree.raycastRoot(I,U,R,q,i,l,f),tile:v}});g.sort((v,E)=>(v.t!==null?v.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const v of g){if(v.t==null)return null;const E=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,l,f);if(E!=null)return E}return null}_createFBO(){const i=this.painter.context,l=i.gl,f=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const g=new a.Texture(i,{width:f[0],height:f[1],data:null},l.RGBA);g.bind(l.LINEAR,l.CLAMP_TO_EDGE);const v=i.createFramebuffer(f[0],f[1],!1);return v.colorAttachment.set(g.texture),v.depthAttachment=new ye(i,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:g,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._layers[i],f=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!f&&l.shouldRedrape():!f&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const f of this._style._getSources())if(f instanceof st){i=!0;break}if(!i)return;const l={};for(let f=0;f<this._style.order.length;++f){const g=this._style._layers[this._style.order[f]],v=this._style._getLayerSourceCache(g);if(v&&!l[v.id]&&!g.isHidden(this.painter.transform.zoom)&&g.type==="line"&&g.widthExpression()instanceof a.ZoomDependentExpression){l[v.id]=!0;for(const E of this.proxyCoords){const T=this.proxyToSource[E.key][v.id];if(T)for(const A of T)this._clearRenderCacheForTile(v.id,A)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof et){i=!0;break}if(!i)return;const l={};for(let f=0;f<this._style.order.length;++f){const g=this._style._layers[this._style.order[f]],v=this._style._getLayerSourceCache(g);if(!v||l[v.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const E=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const A=this.proxyToSource[T.key][v.id];if(A)for(const P of A){const I=fh(v.getTile(P),v.findLoadedParent(P,0),v,this.painter.transform,E);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(v.id,P)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(l===0)return;const f=[];let g,v=0,E=this._style._layers[i[v]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++v<l;)E=this._style._layers[i[v]];for(;v<l;++v){const T=this._style._layers[i[v]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=v):g!==void 0&&(f.push({start:g,end:v-1}),g=void 0))}g!==void 0&&f.push({start:g,end:v-1}),this._drapedRenderBatches=f}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const E=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let T=0;T<E.length;++T){const A=Object.values(E[T]);l.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,g=this._tilesDirty;for(let E=f.length-1;E>=0;E--){const T=f[E];if(l.getTileByID(T.key),l.proxyCachedFBO[T.key]!==void 0){const A=i[T.key],P=this.proxyToSource[T.key];let I=0;for(const R in P){const U=P[R],q=A[R];if(!q||q.length!==U.length||U.some((X,W)=>X!==q[W]||g[R]&&g[R].hasOwnProperty(X.key))){I=-1;break}++I}for(const R in l.proxyCachedFBO[T.key])l.renderCache[l.proxyCachedFBO[T.key][R]].dirty=I<0||I!==Object.values(A).length}}const v=[...this._drapedRenderBatches];v.sort((E,T)=>T.end-T.start-(E.end-E.start));for(const E of v)for(const T of f){if(l.proxyCachedFBO[T.key])continue;let A=l.renderCachePool.pop();A===void 0&&l.renderCache.length<50&&(A=l.renderCache.length,l.renderCache.push(this._createFBO())),A!==void 0&&(l.proxyCachedFBO[T.key]={},l.proxyCachedFBO[T.key][E.start]=A,l.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,f,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,E=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let T;if(f.isTileClipped())T=l.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(i,l){const f=this.painter,g=this.painter.context,v=g.gl;f._tileClippingMaskIDs={},g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const E=f.useProgram("clippingMask");for(const T of i){const A=f._tileClippingMaskIDs[T.key]=--l;E.draw(g,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,dl(T.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const f=[i.x,i.y,1,1];a.transformMat4$1(f,f,l.pixelMatrixInverse),a.scale$1(f,f,1/f[3]),f[0]/=l.worldSize,f[1]/=l.worldSize;const g=l._camera.position,v=a.mercatorZfromAltitude(1,l.center.lat),E=[g[0],g[1],g[2]/v,0],T=a.subtract([],f.slice(0,3),E);a.normalize(T,T);const A=this.raycast(E,T,this._exaggeration);return A!==null&&A?(a.scaleAndAdd(E,E,T,A),E[3]=E[2],E[2]*=v,E):null}drawDepth(){const i=this.painter,l=i.context,f=this.proxySourceCache,g=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===g&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const E=l.gl,T=l.createFramebuffer(g,v,!0);l.activeTexture.set(E.TEXTURE0);const A=new a.Texture(l,{width:g,height:v,data:null},E.RGBA);A.bind(E.NEAREST,E.CLAMP_TO_EDGE),T.colorAttachment.set(A.texture);const P=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,g,v);T.depthAttachment.set(P),this._depthFBO=T,this._depthTexture=A}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,g,v]),function(E,T,A,P){if(E.transform.projection.name==="globe")return;const I=E.context,R=I.gl;I.clear({depth:1});const U=E.useProgram("terrainDepth"),q=new a.DepthMode(R.LESS,a.DepthMode.ReadWrite,E.depthRangeFor3D);for(const X of P){const W=A.getTile(X),K=Ks(X.projMatrix,0);T.setupElevationDraw(W,U),U.draw(I,R.TRIANGLES,q,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,K,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(i,this,f,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,f){if(i.getSource()instanceof Ft)return this._setupProxiedCoordsForImageSource(i,l,f);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let T=0;T<v.length;T++){const A=v[T],P=this._findTileCoveringTileID(A,i);if(P){const I=this._createProxiedId(A,P,f[A.key]&&f[A.key][i.id]);g.push(I),this.proxyToSource[A.key][i.id]=[I]}}let E=!1;for(let T=0;T<l.length;T++){const A=i.getTile(l[T]);if(!A||!A.hasData())continue;const P=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==A.tileID.canonical.z){const I=this.proxyToSource[P.tileID.key][i.id],R=this._createProxiedId(P.tileID,A,f[P.tileID.key]&&f[P.tileID.key][i.id]);I?I.splice(I.length-1,0,R):this.proxyToSource[P.tileID.key][i.id]=[R],g.push(R),E=!0}}this._sourceTilesOverlap[i.id]=E}_setupProxiedCoordsForImageSource(i,l,f){if(!i.getSource().loaded())return;const g=this.proxiedCoords[i.id]=[],v=this.proxyCoords,E=i.getSource(),T=new a.Point(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),A=E.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((I,R)=>(I.min.x=Math.min(I.min.x,R.x-T.x),I.min.y=Math.min(I.min.y,R.y-T.y),I.max.x=Math.max(I.max.x,R.x-T.x),I.max.y=Math.max(I.max.y,R.y-T.y),I),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(I,R)=>{const U=I.wrap+I.canonical.x/(1<<I.canonical.z),q=I.canonical.y/(1<<I.canonical.z),X=a.EXTENT/(1<<I.canonical.z),W=R.wrap+R.canonical.x/(1<<R.canonical.z),K=R.canonical.y/(1<<R.canonical.z);return U+X<W+A.min.x||U>W+A.max.x||q+X<K+A.min.y||q>K+A.max.y};for(let I=0;I<v.length;I++){const R=v[I];for(let U=0;U<l.length;U++){const q=i.getTile(l[U]);if(!q||!q.hasData()||P(R,q.tileID))continue;const X=this._createProxiedId(R,q,f[R.key]&&f[R.key][i.id]),W=this.proxyToSource[R.key][i.id];W?W.push(X):this.proxyToSource[R.key][i.id]=[X],g.push(X)}}}_createProxiedId(i,l,f){let g=this.orthoMatrix;if(f){const v=f.find(E=>E.key===l.tileID.key);if(v)return v}if(l.tileID.key!==i.key){const v=i.canonical.z-l.tileID.canonical.z;let E,T,A;g=a.create();const P=l.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(E=a.EXTENT>>v,T=E*((l.tileID.canonical.x<<v)-i.canonical.x+P),A=E*((l.tileID.canonical.y<<v)-i.canonical.y)):(E=a.EXTENT<<-v,T=a.EXTENT*(l.tileID.canonical.x-(i.canonical.x+P<<-v)),A=a.EXTENT*(l.tileID.canonical.y-(i.canonical.y<<-v))),a.ortho(g,0,E,0,E,0,1),a.translate(g,g,[T,A,0])}return new wc(l.tileID,i.key,g)}_findTileCoveringTileID(i,l){let f=l.getTile(i);if(f&&f.hasData())return f;const g=this._findCoveringTileCache[l.id],v=g[i.key];if(f=v?l.getTileByID(v):null,f&&f.hasData()||v===null)return f;let E=f?f.tileID:i,T=E.overscaledZ;const A=l.getSource().minzoom,P=[];if(!v){const R=l.getSource().maxzoom;if(i.canonical.z>=R){const U=i.canonical.z-R;l.getSource().reparseOverscaled?(T=Math.max(i.canonical.z+2,l.transform.tileZoom),E=new a.OverscaledTileID(T,i.wrap,R,i.canonical.x>>U,i.canonical.y>>U)):U!==0&&(T=R,E=new a.OverscaledTileID(T,i.wrap,R,i.canonical.x>>U,i.canonical.y>>U))}E.key!==i.key&&(P.push(E.key),f=l.getTile(E))}const I=R=>{P.forEach(U=>{g[U]=R}),P.length=0};for(T-=1;T>=A&&(!f||!f.hasData());T--){f&&I(f.tileID.key);const R=E.calculateScaledKey(T);if(f=l.getTileByID(R),f&&f.hasData())break;const U=g[R];if(U===null)break;U===void 0?P.push(R):f=l.getTileByID(U)}return I(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let f=this._tilesDirty[i];f||(f=this._tilesDirty[i]={}),f[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(l){let f=0;const g=new a.StructArrayLayout2ui4,v=131;for(let E=1;E<129;E++){for(let T=1;T<129;T++)f=E*v+T,g.emplaceBack(f,f+1),g.emplaceBack(f,f+v),g.emplaceBack(f+1,f+v),E===128&&g.emplaceBack(f+v,f+v+1);g.emplaceBack(f+1,f+1+v)}return g}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xt{static cacheKey(i,l,f,g){let v=`${l}${g?g.cacheKey:""}`;for(const E of f)i.usedDefines.includes(E)&&(v+=`/${E}`);return v}constructor(i,l,f,g,v,E){const T=i.gl;this.program=T.createProgram();const A=function(O){const G=[];for(let te=0;te<O.length;te++){if(O[te]===null)continue;const ne=O[te].split(" ");G.push(ne.pop())}return G}(f.staticAttributes),P=g?g.getBinderAttributes():[],I=A.concat(P);let R=g?g.defines():[];R=R.concat(E.map(O=>`#define ${O}`));const U=i.isWebGL2?`#version 300 es
`:"",q=U+R.concat(i.extStandardDerivatives&&U.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(lh):lh,lh,_c,Vf.fragmentSource,Hs.fragmentSource,f.fragmentSource).join(`
`),X=U+R.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,_c,Vf.vertexSource,Hs.vertexSource,gc.vertexSource,f.vertexSource).join(`
`),W=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(W,q),T.compileShader(W),T.attachShader(this.program,W);const K=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(K,X),T.compileShader(K),T.attachShader(this.program,K),this.attributes={},this.numAttributes=I.length;for(let O=0;O<this.numAttributes;O++)I[O]&&(T.bindAttribLocation(this.program,O,I[O]),this.attributes[I[O]]=O);T.linkProgram(this.program),T.deleteShader(K),T.deleteShader(W),this.fixedUniforms=v(i),this.binderUniforms=g?g.getUniforms(i):[],E.includes("TERRAIN")&&(this.terrainUniforms=(O=>({u_dem:new a.Uniform1i(O),u_dem_prev:new a.Uniform1i(O),u_dem_unpack:new a.Uniform4f(O),u_dem_tl:new a.Uniform2f(O),u_dem_scale:new a.Uniform1f(O),u_dem_tl_prev:new a.Uniform2f(O),u_dem_scale_prev:new a.Uniform1f(O),u_dem_size:new a.Uniform1f(O),u_dem_lerp:new a.Uniform1f(O),u_exaggeration:new a.Uniform1f(O),u_depth:new a.Uniform1i(O),u_depth_size_inv:new a.Uniform2f(O),u_meter_to_dem:new a.Uniform1f(O),u_label_plane_matrix_inv:new a.UniformMatrix4f(O)}))(i)),E.includes("GLOBE")&&(this.globeUniforms=(O=>({u_tile_tl_up:new a.Uniform3f(O),u_tile_tr_up:new a.Uniform3f(O),u_tile_br_up:new a.Uniform3f(O),u_tile_bl_up:new a.Uniform3f(O),u_tile_up_scale:new a.Uniform1f(O)}))(i)),E.includes("FOG")&&(this.fogUniforms=(O=>({u_fog_matrix:new a.UniformMatrix4f(O),u_fog_range:new a.Uniform2f(O),u_fog_color:new a.Uniform4f(O),u_fog_horizon_blend:new a.Uniform1f(O),u_fog_temporal_offset:new a.Uniform1f(O),u_frustum_tl:new a.Uniform3f(O),u_frustum_tr:new a.Uniform3f(O),u_frustum_br:new a.Uniform3f(O),u_frustum_bl:new a.Uniform3f(O),u_globe_pos:new a.Uniform3f(O),u_globe_radius:new a.Uniform1f(O),u_globe_transition:new a.Uniform1f(O),u_is_globe:new a.Uniform1i(O),u_viewport:new a.Uniform2f(O)}))(i))}}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in l)f[g]&&f[g].set(this.program,g,l[g])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in l)f[g]&&f[g].set(this.program,g,l[g])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const g in l)f[g].set(this.program,g,l[g])}}draw(i,l,f,g,v,E,T,A,P,I,R,U,q,X,W){const K=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(f),i.setStencilMode(g),i.setColorMode(v),i.setCullFace(E);for(const G of Object.keys(this.fixedUniforms))this.fixedUniforms[G].set(this.program,G,T[G]);X&&X.setUniforms(this.program,i,this.binderUniforms,U,{zoom:q});const O={[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];for(const G of R.get()){const te=G.vaos||(G.vaos={});(te[A]||(te[A]=new o_)).bind(i,this,P,X?X.getPaintVertexBuffers():[],I,G.vertexOffset,W||[]),K.drawElements(l,G.primitiveLength*O,K.UNSIGNED_SHORT,G.primitiveOffset*O*2)}}}function fl(h,i){const l=Math.pow(2,i.tileID.overscaledZ),f=i.tileSize*Math.pow(2,h.transform.tileZoom)/l,g=f*(i.tileID.canonical.x+i.tileID.wrap*l),v=f*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Gt(i,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,v>>16],u_pixel_coord_lower:[65535&g,65535&v]}}const Zf=a.create(),gh=(h,i,l,f,g,v,E,T,A,P,I)=>{const R=i.style.light,U=R.properties.get("position"),q=[U.x,U.y,U.z],X=a.create$1();R.properties.get("anchor")==="viewport"&&(a.fromRotation(X,-i.transform.angle),a.transformMat3(q,q,X));const W=R.properties.get("color"),K=i.transform,O={u_matrix:h,u_lightpos:q,u_lightintensity:R.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+l,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:g,u_edge_radius:v};return K.projection.name==="globe"&&(O.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],O.u_zoom_transition=A,O.u_inv_rot_matrix=I,O.u_merc_center=P,O.u_up_dir=K.projection.upVector(new a.CanonicalTileID(0,0,0),P[0]*a.EXTENT,P[1]*a.EXTENT),O.u_height_lift=T),O},Wf=(h,i,l,f,g,v,E,T,A,P,I,R)=>{const U=gh(h,i,l,f,g,v,E,A,P,I,R),q={u_height_factor:-Math.pow(2,E.overscaledZ)/T.tileSize/8};return a.extend(U,fl(i,T),q)},hs=h=>({u_matrix:h}),_h=(h,i,l)=>a.extend(hs(h),fl(i,l)),s_=(h,i)=>({u_matrix:h,u_world:i}),a_=(h,i,l,f)=>a.extend(_h(h,i,l),{u_world:f}),l_=a.create(),yh=(h,i,l,f,g,v)=>{const E=h.transform,T=E.projection.name==="globe";let A;if(v.paint.get("circle-pitch-alignment")==="map")if(T){const I=a.globePixelsToTileUnits(E.zoom,i.canonical)*E._pixelsPerMercatorPixel;A=Float32Array.from([I,0,0,I])}else A=E.calculatePixelsToTileUnitsMatrix(l);else A=new Float32Array([E.pixelsToGLUnits[0],0,0,E.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:E.cameraToCenterDistance,u_matrix:h.translatePosMatrix(i.projMatrix,l,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:l_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){P.u_inv_rot_matrix=f,P.u_merc_center=g,P.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],P.u_zoom_transition=a.globeToMercatorTransition(E.zoom);const I=g[0]*a.EXTENT,R=g[1]*a.EXTENT;P.u_up_dir=E.projection.upVector(new a.CanonicalTileID(0,0,0),I,R)}return P},vh=h=>{const i=[];return h.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i},xh=(h,i,l,f)=>{const g=a.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.getCameraToCenterDistance(f),u_extrude_scale:[i.pixelsToGLUnits[0]/g,i.pixelsToGLUnits[1]/g]}},bc=(h,i,l=1)=>({u_matrix:h,u_color:i,u_overlay:0,u_overlay_scale:l}),Xf=a.create(),Hf=(h,i,l,f,g,v,E)=>{const T=h.transform,A=T.projection.name==="globe",P=A?a.globePixelsToTileUnits(T.zoom,i.canonical)*T._pixelsPerMercatorPixel:Gt(l,1,v),I={u_matrix:i.projMatrix,u_extrude_scale:P,u_intensity:E,u_inv_rot_matrix:Xf,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){I.u_inv_rot_matrix=f,I.u_merc_center=g,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=a.globeToMercatorTransition(T.zoom);const R=g[0]*a.EXTENT,U=g[1]*a.EXTENT;I.u_up_dir=T.projection.upVector(new a.CanonicalTileID(0,0,0),R,U)}return I},c_=(h,i,l,f,g,v,E)=>{const T=h.transform,A=T.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:wh(h,i,l,f),u_pixels_to_tile_units:A,u_device_pixel_ratio:v,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:ml(l)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Qs(i,h.transform),u_alpha_discard_threshold:0,u_trim_offset:E}},pl=(h,i,l,f,g)=>{const v=h.transform;return{u_matrix:wh(h,i,l,f),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:Qs(i,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Qs(h,i){return 1/Gt(h,1,i.tileZoom)}function wh(h,i,l,f){return h.translatePosMatrix(f||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function ml(h){const i=h.paint.get("line-dasharray").value;return i.value||i.kind!=="constant"}const bh=(h,i,l,f,g,v)=>{return{u_matrix:h,u_tl_parent:i,u_scale_parent:l,u_fade_t:f.mix,u_opacity:f.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(T=g.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(E=g.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:Ui(g.paint.get("raster-hue-rotate")),u_perspective_transform:v};var E,T};function Ui(h){h*=Math.PI/180;const i=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const Ec=a.create(),Eh=(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W)=>{const K=g.transform,O={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:K.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:K.width/K.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:T,u_is_text:+A,u_pitch_with_map:+f,u_texsize:P,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ec,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ec,u_up_vector:[0,-1,0]};return W.name==="globe"&&(O.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],O.u_zoom_transition=R,O.u_inv_rot_matrix=q,O.u_merc_center=U,O.u_camera_forward=K._camera.forward(),O.u_ecef_origin=a.globeECEFOrigin(K.globeMatrix,I.toUnwrapped()),O.u_tile_matrix=Float32Array.from(K.globeMatrix),O.u_up_vector=X),O},Tc=(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W,K)=>a.extend(Eh(h,i,l,f,g,v,E,T,A,P,R,U,q,X,W,K),{u_gamma_scale:f?g.transform.cameraToCenterDistance*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+I}),Yf=(h,i,l,f,g,v,E,T,A,P,I,R,U,q,X,W)=>a.extend(Tc(h,i,l,f,g,v,E,T,!0,A,!0,I,R,U,q,X,W),{u_texsize_icon:P,u_texture_icon:1}),Th=(h,i,l)=>({u_matrix:h,u_opacity:i,u_color:l}),u_=(h,i,l,f,g)=>a.extend(function(v,E,T){const A=E.imageManager.getPattern(v.toString()),{width:P,height:I}=E.imageManager.getPixelSize(),R=Math.pow(2,T.tileID.overscaledZ),U=T.tileSize*Math.pow(2,E.transform.tileZoom)/R,q=U*(T.tileID.canonical.x+T.tileID.wrap*R),X=U*T.tileID.canonical.y;return{u_image:0,u_pattern_tl:A.tl,u_pattern_br:A.br,u_texsize:[P,I],u_pattern_size:A.displaySize,u_tile_units_to_pixels:1/Gt(T,1,E.transform.tileZoom),u_pixel_coord_upper:[q>>16,X>>16],u_pixel_coord_lower:[65535&q,65535&X]}}(f,l,g),{u_matrix:h,u_opacity:i}),Sh={fillExtrusion:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_lightpos:new a.Uniform3f(h),u_lightintensity:new a.Uniform1f(h),u_lightcolor:new a.Uniform3f(h),u_vertical_gradient:new a.Uniform1f(h),u_height_factor:new a.Uniform1f(h),u_edge_radius:new a.Uniform1f(h),u_ao:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_up_dir:new a.Uniform3f(h),u_height_lift:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h)}),fill:h=>({u_matrix:new a.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),fillOutline:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_world:new a.Uniform2f(h),u_image:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),collisionBox:h=>({u_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_extrude_scale:new a.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new a.UniformMatrix4f(h),u_inv_matrix:new a.UniformMatrix4f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_viewport_size:new a.Uniform2f(h)}),debug:h=>({u_color:new a.UniformColor(h),u_matrix:new a.UniformMatrix4f(h),u_overlay:new a.Uniform1i(h),u_overlay_scale:new a.Uniform1f(h)}),clippingMask:h=>({u_matrix:new a.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new a.Uniform1f(h),u_intensity:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_up_dir:new a.Uniform3f(h)}),heatmapTexture:h=>({u_image:new a.Uniform1i(h),u_color_ramp:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h)}),hillshade:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_latrange:new a.Uniform2f(h),u_light:new a.Uniform2f(h),u_shadow:new a.UniformColor(h),u_highlight:new a.UniformColor(h),u_accent:new a.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new a.UniformMatrix4f(h),u_image:new a.Uniform1i(h),u_dimension:new a.Uniform2f(h),u_zoom:new a.Uniform1f(h),u_unpack:new a.Uniform4f(h)}),line:h=>({u_matrix:new a.UniformMatrix4f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_units_to_pixels:new a.Uniform2f(h),u_dash_image:new a.Uniform1i(h),u_gradient_image:new a.Uniform1i(h),u_image_height:new a.Uniform1f(h),u_texsize:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h),u_trim_offset:new a.Uniform2f(h)}),linePattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_texsize:new a.Uniform2f(h),u_pixels_to_tile_units:new a.UniformMatrix2f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_units_to_pixels:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h),u_alpha_discard_threshold:new a.Uniform1f(h)}),raster:h=>({u_matrix:new a.UniformMatrix4f(h),u_tl_parent:new a.Uniform2f(h),u_scale_parent:new a.Uniform1f(h),u_fade_t:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_image0:new a.Uniform1i(h),u_image1:new a.Uniform1i(h),u_brightness_low:new a.Uniform1f(h),u_brightness_high:new a.Uniform1f(h),u_saturation_factor:new a.Uniform1f(h),u_contrast_factor:new a.Uniform1f(h),u_spin_weights:new a.Uniform3f(h),u_perspective_transform:new a.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_texture:new a.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_tile_id:new a.Uniform3f(h),u_zoom_transition:new a.Uniform1f(h),u_inv_rot_matrix:new a.UniformMatrix4f(h),u_merc_center:new a.Uniform2f(h),u_camera_forward:new a.Uniform3f(h),u_tile_matrix:new a.UniformMatrix4f(h),u_up_vector:new a.Uniform3f(h),u_ecef_origin:new a.Uniform3f(h),u_is_halo:new a.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new a.Uniform1i(h),u_is_size_feature_constant:new a.Uniform1i(h),u_size_t:new a.Uniform1f(h),u_size:new a.Uniform1f(h),u_camera_to_center_distance:new a.Uniform1f(h),u_rotate_symbol:new a.Uniform1i(h),u_aspect_ratio:new a.Uniform1f(h),u_fade_change:new a.Uniform1f(h),u_matrix:new a.UniformMatrix4f(h),u_label_plane_matrix:new a.UniformMatrix4f(h),u_coord_matrix:new a.UniformMatrix4f(h),u_is_text:new a.Uniform1i(h),u_pitch_with_map:new a.Uniform1i(h),u_texsize:new a.Uniform2f(h),u_texsize_icon:new a.Uniform2f(h),u_texture:new a.Uniform1i(h),u_texture_icon:new a.Uniform1i(h),u_gamma_scale:new a.Uniform1f(h),u_device_pixel_ratio:new a.Uniform1f(h),u_is_halo:new a.Uniform1i(h)}),background:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_color:new a.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new a.UniformMatrix4f(h),u_opacity:new a.Uniform1f(h),u_image:new a.Uniform1i(h),u_pattern_tl:new a.Uniform2f(h),u_pattern_br:new a.Uniform2f(h),u_texsize:new a.Uniform2f(h),u_pattern_size:new a.Uniform2f(h),u_pixel_coord_upper:new a.Uniform2f(h),u_pixel_coord_lower:new a.Uniform2f(h),u_tile_units_to_pixels:new a.Uniform1f(h)}),terrainRaster:dh,terrainDepth:dh,skybox:h=>({u_matrix:new a.UniformMatrix4f(h),u_sun_direction:new a.Uniform3f(h),u_cubemap:new a.Uniform1i(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new a.UniformMatrix4f(h),u_color_ramp:new a.Uniform1i(h),u_center_direction:new a.Uniform3f(h),u_radius:new a.Uniform1f(h),u_opacity:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new a.UniformMatrix3f(h),u_sun_direction:new a.Uniform3f(h),u_sun_intensity:new a.Uniform1f(h),u_color_tint_r:new a.Uniform4f(h),u_color_tint_m:new a.Uniform4f(h),u_luminance:new a.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new a.UniformMatrix4f(h),u_globe_matrix:new a.UniformMatrix4f(h),u_normalize_matrix:new a.UniformMatrix4f(h),u_merc_matrix:new a.UniformMatrix4f(h),u_zoom_transition:new a.Uniform1f(h),u_merc_center:new a.Uniform2f(h),u_image0:new a.Uniform1i(h),u_grid_matrix:new a.UniformMatrix3f(h),u_skirt_height:new a.Uniform1f(h),u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_globe_pos:new a.Uniform3f(h),u_globe_radius:new a.Uniform1f(h),u_viewport:new a.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new a.Uniform3f(h),u_frustum_tr:new a.Uniform3f(h),u_frustum_br:new a.Uniform3f(h),u_frustum_bl:new a.Uniform3f(h),u_horizon:new a.Uniform1f(h),u_transition:new a.Uniform1f(h),u_fadeout_range:new a.Uniform1f(h),u_color:new a.Uniform4f(h),u_high_color:new a.Uniform4f(h),u_space_color:new a.Uniform4f(h),u_star_intensity:new a.Uniform1f(h),u_star_density:new a.Uniform1f(h),u_star_size:new a.Uniform1f(h),u_temporal_offset:new a.Uniform1f(h),u_horizon_angle:new a.Uniform1f(h),u_rotation_matrix:new a.UniformMatrix4f(h)})};let Sc;function gl(h,i,l,f,g,v,E){const T=h.context,A=T.gl,P=h.transform,I=h.useProgram("collisionBox"),R=[];let U=0,q=0;for(let ne=0;ne<f.length;ne++){const pe=f[ne],ge=i.getTile(pe),me=ge.getBucket(l);if(!me)continue;const we=ai(pe,me,P);let xe=we;g[0]===0&&g[1]===0||(xe=h.translatePosMatrix(we,ge,g,v));const Ae=E?me.textCollisionBox:me.iconCollisionBox,Xe=me.collisionCircleArray;if(Xe.length>0){const Te=a.create(),Ne=xe;a.mul(Te,me.placementInvProjMatrix,P.glCoordMatrix),a.mul(Te,Te,me.placementViewportMatrix),R.push({circleArray:Xe,circleOffset:q,transform:Ne,invTransform:Te,projection:me.getProjection()}),U+=Xe.length/4,q=U}Ae&&(h.terrain&&h.terrain.setupElevationDraw(ge,I),I.draw(T,A.LINES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,xh(xe,P,ge,me.getProjection()),l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,P.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!E||!R.length)return;const X=h.useProgram("collisionCircle"),W=new a.StructArrayLayout2f1f2i16;W.resize(4*U),W._trim();let K=0;for(const ne of R)for(let pe=0;pe<ne.circleArray.length/4;pe++){const ge=4*pe,me=ne.circleArray[ge+0],we=ne.circleArray[ge+1],xe=ne.circleArray[ge+2],Ae=ne.circleArray[ge+3];W.emplace(K++,me,we,xe,Ae,0),W.emplace(K++,me,we,xe,Ae,1),W.emplace(K++,me,we,xe,Ae,2),W.emplace(K++,me,we,xe,Ae,3)}(!Sc||Sc.length<2*U)&&(Sc=function(ne){const pe=2*ne,ge=new a.StructArrayLayout3ui6;ge.resize(pe),ge._trim();for(let me=0;me<pe;me++){const we=6*me;ge.uint16[we+0]=4*me+0,ge.uint16[we+1]=4*me+1,ge.uint16[we+2]=4*me+2,ge.uint16[we+3]=4*me+2,ge.uint16[we+4]=4*me+3,ge.uint16[we+5]=4*me+0}return ge}(U));const O=T.createIndexBuffer(Sc,!0),G=T.createVertexBuffer(W,a.collisionCircleLayout.members,!0);for(const ne of R){const pe={u_matrix:ne.transform,u_inv_matrix:ne.invTransform,u_camera_to_center_distance:(te=P).getCameraToCenterDistance(ne.projection),u_viewport_size:[te.width,te.height]};X.draw(T,A.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,h.colorModeForRenderPass(),a.CullFaceMode.disabled,pe,l.id,G,O,a.SegmentVector.simpleSegment(0,2*ne.circleOffset,ne.circleArray.length,ne.circleArray.length/2),null,P.zoom)}var te;G.destroy(),O.destroy()}const Kf=a.create();function Ch({width:h,height:i,anchor:l,textOffset:f,textScale:g},v){const{horizontalAlign:E,verticalAlign:T}=a.getAnchorAlignment(l),A=-(E-.5)*h,P=-(T-.5)*i,I=a.evaluateVariableOffset(l,f);return new a.Point((A/g+I[0])*v,(P/g+I[1])*v)}function h_(h,i,l,f,g,v,E,T,A,P,I){const R=h.text.placedSymbolArray,U=h.text.dynamicLayoutVertexArray,q=h.icon.dynamicLayoutVertexArray,X={},W=h.getProjection(),K=Sn(T,W,v),O=v.elevation,G=W.upVectorScale(T.canonical,v.center.lat,v.worldSize).metersToTile;U.clear();for(let te=0;te<R.length;te++){const ne=R.get(te),{tileAnchorX:pe,tileAnchorY:ge,numGlyphs:me}=ne,we=ne.hidden||!ne.crossTileID||h.allowVerticalPlacement&&!ne.placedOrientation?null:f[ne.crossTileID];if(we){let xe=0,Ae=0,Xe=0;if(O){const Qe=O?O.getAtTileOffset(T,pe,ge):0,[yt,kt,pt]=W.upVector(T.canonical,pe,ge);xe=Qe*yt*G,Ae=Qe*kt*G,Xe=Qe*pt*G}let[Te,Ne,ke,We]=sr(ne.projectedAnchorX+xe,ne.projectedAnchorY+Ae,ne.projectedAnchorZ+Xe,l?K:E);const Ce=Bf(v.getCameraToCenterDistance(W),We);let Fe=g.evaluateSizeForFeature(h.textSizeData,P,ne)*Ce/a.ONE_EM;l&&(Fe*=h.tilePixelRatio/A);const Ye=Ch(we,Fe);l?({x:Te,y:Ne,z:ke}=W.projectTilePoint(pe+Ye.x,ge+Ye.y,T.canonical),[Te,Ne,ke]=sr(Te+xe,Ne+Ae,ke+Xe,E)):(i&&Ye._rotate(-v.angle),Te+=Ye.x,Ne+=Ye.y,ke=0);const Ge=h.allowVerticalPlacement&&ne.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let Qe=0;Qe<me;Qe++)a.addDynamicAttributes(U,Te,Ne,ke,Ge);I&&ne.associatedIconIndex>=0&&(X[ne.associatedIconIndex]={x:Te,y:Ne,z:ke,angle:Ge})}else bi(me,U)}if(I){q.clear();const te=h.icon.placedSymbolArray;for(let ne=0;ne<te.length;ne++){const pe=te.get(ne),{numGlyphs:ge}=pe,me=X[ne];if(pe.hidden||!me)bi(ge,q);else{const{x:we,y:xe,z:Ae,angle:Xe}=me;for(let Te=0;Te<ge;Te++)a.addDynamicAttributes(q,we,xe,Ae,Xe)}}h.icon.dynamicLayoutVertexBuffer.updateData(q)}h.text.dynamicLayoutVertexBuffer.updateData(U)}function Ah(h,i,l){return l.iconsInText&&i?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Jf(h,i,l,f,g,v,E,T,A,P,I,R){const U=h.context,q=U.gl,X=h.transform,W=T==="map",K=A==="map",O=W&&l.layout.get("symbol-placement")!=="point",G=W&&!K&&!O,te=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ne=!1;const pe=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),ge=[a.mercatorXfromLng(X.center.lng),a.mercatorYfromLat(X.center.lat)],me=l.layout.get("text-variable-anchor"),we=X.projection.name==="globe",xe=[],Ae=[0,-1,0];let Xe=Ae;!we&&!X.mercatorFromTransition||W||(Xe=function(Te){const Ne=Te._camera.getWorldToCamera(Te.worldSize,1),ke=a.multiply([],Ne,Te.globeMatrix);a.invert(ke,ke);const We=[0,0,0],Ce=[0,1,0,0];return a.transformMat4$1(Ce,Ce,ke),We[0]=Ce[0],We[1]=Ce[1],We[2]=Ce[2],a.normalize(We,We),We}(X));for(const Te of f){const Ne=i.getTile(Te),ke=Ne.getBucket(l);if(!ke||ke.projection.name==="mercator"&&we)continue;const We=g?ke.text:ke.icon;if(!We||ke.fullyClipped||!We.segments.get().length)continue;const Ce=We.programConfigurations.get(l.id),Fe=g||ke.sdfIcons,Ye=g?ke.textSizeData:ke.iconSizeData,Ge=K||X.pitch!==0,Qe=a.evaluateSizeForZoom(Ye,X.zoom);let yt,kt,pt,Et,$t=[0,0],jt=null;if(g)kt=Ne.glyphAtlasTexture,pt=q.LINEAR,yt=Ne.glyphAtlasTexture.size,ke.iconsInText&&($t=Ne.imageAtlasTexture.size,jt=Ne.imageAtlasTexture,Et=Ge||h.options.rotating||h.options.zooming||Ye.kind==="composite"||Ye.kind==="camera"?q.LINEAR:q.NEAREST);else{const fo=l.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;kt=Ne.imageAtlasTexture,pt=Fe||h.options.rotating||h.options.zooming||fo||Ge?q.LINEAR:q.NEAREST,yt=Ne.imageAtlasTexture.size}const gt=ke.projection.name==="globe",on=gt?Xe:Ae,cn=gt?a.globeToMercatorTransition(X.zoom):0,un=Sn(Te,ke.getProjection(),X),hn=X.calculatePixelsToTileUnitsMatrix(Ne),Tr=Re(un,Ne.tileID.canonical,K,W,X,ke.getProjection(),hn),lr=h.terrain&&K&&O?a.invert(a.create(),Tr):Kf,hi=Vn(un,Ne.tileID.canonical,K,W,X,ke.getProjection(),hn),$i=me&&ke.hasTextData(),Cn=l.layout.get("icon-text-fit")!=="none"&&$i&&ke.hasIconData();if(O){const fo=X.elevation,Bo=fo?fo.getAtTileOffsetFunc(Te,X.center.lat,X.worldSize,ke.getProjection()):null,gs=io(un,Ne.tileID.canonical,K,W,X,ke.getProjection(),hn);Qu(ke,un,h,g,gs,hi,K,P,Bo,Te)}const dn=O||g&&me||Cn,Kt=h.translatePosMatrix(un,Ne,v,E),$n=dn?Kf:Tr,Pr=h.translatePosMatrix(hi,Ne,v,E,!0),En=ke.getProjection().createInversionMatrix(X,Te.canonical),Fr=[];h.terrainRenderModeElevated()&&K&&Fr.push("PITCH_WITH_MAP_TERRAIN"),gt&&Fr.push("PROJECTION_GLOBE_VIEW"),dn&&Fr.push("PROJECTED_POS_ON_VIEWPORT");const Uc=Fe&&l.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ms;ms=Fe?ke.iconsInText?Yf(Ye.kind,Qe,G,K,h,Kt,$n,Pr,yt,$t,Te,cn,ge,En,on,ke.getProjection()):Tc(Ye.kind,Qe,G,K,h,Kt,$n,Pr,g,yt,!0,Te,cn,ge,En,on,ke.getProjection()):Eh(Ye.kind,Qe,G,K,h,Kt,$n,Pr,g,yt,Te,cn,ge,En,on,ke.getProjection());const Al={program:h.useProgram(Ah(Fe,g,ke),Ce,Fr),buffers:We,uniformValues:ms,atlasTexture:kt,atlasTextureIcon:jt,atlasInterpolation:pt,atlasInterpolationIcon:Et,isSDF:Fe,hasHalo:Uc,tile:Ne,labelPlaneMatrixInv:lr};if(te&&ke.canOverlap){ne=!0;const fo=We.segments.get();for(const Bo of fo)xe.push({segments:new a.SegmentVector([Bo]),sortKey:Bo.sortKey,state:Al})}else xe.push({segments:We.segments,sortKey:0,state:Al})}ne&&xe.sort((Te,Ne)=>Te.sortKey-Ne.sortKey);for(const Te of xe){const Ne=Te.state;if(h.terrain&&h.terrain.setupElevationDraw(Ne.tile,Ne.program,{useDepthForOcclusion:!we,labelPlaneMatrixInv:Ne.labelPlaneMatrixInv}),U.activeTexture.set(q.TEXTURE0),Ne.atlasTexture.bind(Ne.atlasInterpolation,q.CLAMP_TO_EDGE),Ne.atlasTextureIcon&&(U.activeTexture.set(q.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),Ne.isSDF){const ke=Ne.uniformValues;Ne.hasHalo&&(ke.u_is_halo=1,_l(Ne.buffers,Te.segments,l,h,Ne.program,pe,I,R,ke)),ke.u_is_halo=0}_l(Ne.buffers,Te.segments,l,h,Ne.program,pe,I,R,Ne.uniformValues)}}function _l(h,i,l,f,g,v,E,T,A){const P=f.context,I=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];g.draw(P,P.gl.TRIANGLES,v,E,T,a.CullFaceMode.disabled,A,l.id,h.layoutVertexBuffer,h.indexBuffer,i,l.paint,f.transform.zoom,h.programConfigurations.get(l.id),I)}function Qf(h,i,l,f,g,v,E){const T=h.context.gl,A=l.paint.get("fill-pattern"),P=A&&A.constantOr(1);let I,R,U,q,X;E?(R=P&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",I=T.LINES):(R=P?"fillPattern":"fill",I=T.TRIANGLES);for(const W of f){const K=i.getTile(W);if(P&&!K.patternsLoaded())continue;const O=K.getBucket(l);if(!O)continue;h.prepareDrawTile();const G=O.programConfigurations.get(l.id),te=h.useProgram(R,G);P&&(h.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),G.updatePaintBuffers());const ne=A.constantOr(null);if(ne&&K.imageAtlas){const ge=K.imageAtlas.patternPositions[ne.toString()];ge&&G.setConstantPatternPositions(ge)}const pe=h.translatePosMatrix(W.projMatrix,K,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){q=O.indexBuffer2,X=O.segments2;const ge=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];U=R==="fillOutlinePattern"&&P?a_(pe,h,K,ge):s_(pe,ge)}else q=O.indexBuffer,X=O.segments,U=P?_h(pe,h,K):hs(pe);h.prepareDrawProgram(h.context,te,W.toUnwrapped()),te.draw(h.context,I,g,h.stencilModeForClipping(W),v,a.CullFaceMode.disabled,U,l.id,O.layoutVertexBuffer,q,X,l.paint,h.transform.zoom,G)}}function Cc(h,i,l,f,g,v,E){const T=h.context,A=T.gl,P=h.transform,I=l.paint.get("fill-extrusion-pattern"),R=I.constantOr(1),U=l.paint.get("fill-extrusion-opacity"),q=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],X=l.layout.get("fill-extrusion-edge-radius"),W=X>0&&!l.paint.get("fill-extrusion-rounded-roof"),K=W?0:X,O=P.projection.name==="globe"?a.fillExtrusionHeightLift():0,G=P.projection.name==="globe",te=G?a.globeToMercatorTransition(P.zoom):0,ne=[a.mercatorXfromLng(P.center.lng),a.mercatorYfromLat(P.center.lat)],pe=[];G&&pe.push("PROJECTION_GLOBE_VIEW"),q[0]>0&&pe.push("FAUX_AO"),W&&pe.push("ZERO_ROOF_RADIUS");for(const ge of f){const me=i.getTile(ge),we=me.getBucket(l);if(!we||we.projection.name!==P.projection.name)continue;const xe=we.programConfigurations.get(l.id),Ae=h.useProgram(R?"fillExtrusionPattern":"fillExtrusion",xe,pe);if(h.terrain){const Fe=h.terrain;if(h.style.terrainSetForDrapingOnly())Fe.setupElevationDraw(me,Ae,{useMeterToDem:!0});else{if(!we.enableTerrain)continue;if(Fe.setupElevationDraw(me,Ae,{useMeterToDem:!0}),ep(T,i,ge,we,l,Fe),!we.centroidVertexBuffer){const Ye=Ae.attributes.a_centroid_pos;Ye!==void 0&&A.vertexAttrib2f(Ye,0,0)}}}R&&(h.context.activeTexture.set(A.TEXTURE0),me.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Xe=I.constantOr(null);if(Xe&&me.imageAtlas){const Fe=me.imageAtlas.patternPositions[Xe.toString()];Fe&&xe.setConstantPatternPositions(Fe)}const Te=h.translatePosMatrix(ge.projMatrix,me,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ne=P.projection.createInversionMatrix(P,ge.canonical),ke=l.paint.get("fill-extrusion-vertical-gradient"),We=R?Wf(Te,h,ke,U,q,K,ge,me,O,te,ne,Ne):gh(Te,h,ke,U,q,K,ge,O,te,ne,Ne);h.prepareDrawProgram(T,Ae,ge.toUnwrapped());const Ce=[];h.terrain&&Ce.push(we.centroidVertexBuffer),G&&Ce.push(we.layoutVertexExtBuffer),Ae.draw(T,T.gl.TRIANGLES,g,v,E,a.CullFaceMode.backCCW,We,l.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,l.paint,h.transform.zoom,xe,Ce)}}function ep(h,i,l,f,g,v){const E=[O=>{let G=O.canonical.x-1,te=O.wrap;return G<0&&(G=(1<<O.canonical.z)-1,te--),new a.OverscaledTileID(O.overscaledZ,te,O.canonical.z,G,O.canonical.y)},O=>{let G=O.canonical.x+1,te=O.wrap;return G===1<<O.canonical.z&&(G=0,te++),new a.OverscaledTileID(O.overscaledZ,te,O.canonical.z,G,O.canonical.y)},O=>new a.OverscaledTileID(O.overscaledZ,O.wrap,O.canonical.z,O.canonical.x,(O.canonical.y===0?1<<O.canonical.z:O.canonical.y)-1),O=>new a.OverscaledTileID(O.overscaledZ,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y===(1<<O.canonical.z)-1?0:O.canonical.y+1)],T=O=>{const G=i.getSource().minzoom,te=pe=>{const ge=i.getTileByID(pe);if(ge&&ge.hasData())return ge.getBucket(g)},ne=[0,-1,1];for(const pe of ne){if(O.overscaledZ+pe<G)continue;const ge=te(O.calculateScaledKey(O.overscaledZ+pe));if(ge)return ge}},A=[0,0,0],P=(O,G)=>(A[0]=Math.min(O.min.y,G.min.y),A[1]=Math.max(O.max.y,G.max.y),A[2]=a.EXTENT-G.min.x>O.max.x?G.min.x-a.EXTENT:O.max.x,A),I=(O,G)=>(A[0]=Math.min(O.min.x,G.min.x),A[1]=Math.max(O.max.x,G.max.x),A[2]=a.EXTENT-G.min.y>O.max.y?G.min.y-a.EXTENT:O.max.y,A),R=[(O,G)=>P(O,G),(O,G)=>P(G,O),(O,G)=>I(O,G),(O,G)=>I(G,O)],U=new a.Point(0,0);let q,X,W;const K=(O,G,te,ne,pe)=>{const ge=[[ne?te:O,ne?O:te,0],[ne?te:G,ne?G:te,0]],me=pe<0?a.EXTENT+pe:pe,we=[ne?me:(O+G)/2,ne?(O+G)/2:me,0];return te===0&&pe<0||te!==0&&pe>0?v.getForTilePoints(W,[we],!0,X):ge.push(we),v.getForTilePoints(l,ge,!0,q),Math.max(ge[0][2],ge[1][2],we[2])/v.exaggeration()};for(let O=0;O<4;O++){const G=(O<2?1:5)-O,te=f.borders[O];if(te.length===0)continue;const ne=W=E[O](l),pe=T(ne);if(!(pe&&pe instanceof a.FillExtrusionBucket&&pe.enableTerrain)||f.borderDoneWithNeighborZ[O]===pe.canonical.z&&pe.borderDoneWithNeighborZ[G]===f.canonical.z||(X=v.findDEMTileFor(ne),!X||!X.dem))continue;if(!q){const xe=v.findDEMTileFor(l);if(!xe||!xe.dem)return;q=xe}const ge=pe.borders[G];let me=0;const we=pe.borderDoneWithNeighborZ[G]!==f.canonical.z;if(f.canonical.z===pe.canonical.z){for(let xe=0;xe<te.length;xe++){const Ae=f.featuresOnBorder[te[xe]],Xe=Ae.borders[O];let Te;for(;me<ge.length&&(Te=pe.featuresOnBorder[ge[me]],!(Te.borders[G][1]>Xe[0]+3));)we&&pe.encodeCentroid(void 0,Te,!1),me++;if(Te&&me<ge.length){const Ne=me;let ke=0;for(;!(Te.borders[G][0]>Xe[1]-3)&&(ke++,++me!==ge.length);)Te=pe.featuresOnBorder[ge[me]];if(Te=pe.featuresOnBorder[ge[Ne]],Ae.intersectsCount()>1||Te.intersectsCount()>1||ke!==1){ke!==1&&(me=Ne),f.encodeCentroid(void 0,Ae,!1),we&&pe.encodeCentroid(void 0,Te,!1);continue}const We=R[O](Ae,Te),Ce=O%2?a.EXTENT-1:0;U.x=K(We[0],Math.min(a.EXTENT-1,We[1]),Ce,O<2,We[2]),U.y=0,f.encodeCentroid(U,Ae,!1),we&&pe.encodeCentroid(U,Te,!1)}else f.encodeCentroid(void 0,Ae,!1)}f.borderDoneWithNeighborZ[O]=pe.canonical.z,f.needsCentroidUpdate=!0,we&&(pe.borderDoneWithNeighborZ[G]=f.canonical.z,pe.needsCentroidUpdate=!0)}else{for(const xe of te)f.encodeCentroid(void 0,f.featuresOnBorder[xe],!1);if(we){for(const xe of ge)pe.encodeCentroid(void 0,pe.featuresOnBorder[xe],!1);pe.borderDoneWithNeighborZ[G]=f.canonical.z,pe.needsCentroidUpdate=!0}f.borderDoneWithNeighborZ[O]=pe.canonical.z,f.needsCentroidUpdate=!0}}(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(h)}const ea=new a.Color(1,0,0,1),d_=new a.Color(0,1,0,1),f_=new a.Color(0,0,1,1),p_=new a.Color(1,0,1,1),m_=new a.Color(0,1,1,1);function g_(h,i,l){const f=h.context,g=h.transform,v=f.gl,E=g.projection.name==="globe",T=E?["PROJECTION_GLOBE_VIEW"]:null;let A=l.projMatrix;if(E&&a.globeToMercatorTransition(g.zoom)>0){const Ae=a.transitionTileAABBinECEF(l.canonical,g),Xe=a.globeDenormalizeECEF(Ae);A=a.multiply(new Float32Array(16),g.globeMatrix,Xe),a.multiply(A,g.projMatrix,A)}const P=h.useProgram("debug",null,T),I=i.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(I,P);const R=a.DepthMode.disabled,U=a.StencilMode.disabled,q=h.colorModeForRenderPass(),X="$debug";f.activeTexture.set(v.TEXTURE0),h.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),E?I._makeGlobeTileDebugBuffers(h.context,g):I._makeDebugTileBoundsBuffers(h.context,g.projection);const W=I._tileDebugBuffer||h.debugBuffer,K=I._tileDebugIndexBuffer||h.debugIndexBuffer,O=I._tileDebugSegments||h.debugSegments;P.draw(f,v.LINE_STRIP,R,U,q,a.CullFaceMode.disabled,bc(A,a.Color.red),X,W,K,O,null,null,null,[I._globeTileDebugBorderBuffer]);const G=I.latestRawTileData,te=Math.floor((G&&G.byteLength||0)/1024),ne=i.getTile(l).tileSize,pe=512/Math.min(ne,512)*(l.overscaledZ/g.zoom)*.5;let ge=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(ge+=` => ${l.overscaledZ}`),ge+=` ${te}kb`,function(Ae,Xe){Ae.initDebugOverlayCanvas();const Te=Ae.debugOverlayCanvas,Ne=Ae.context.gl,ke=Ae.debugOverlayCanvas.getContext("2d");ke.clearRect(0,0,Te.width,Te.height),ke.shadowColor="white",ke.shadowBlur=2,ke.lineWidth=1.5,ke.strokeStyle="white",ke.textBaseline="top",ke.font="bold 36px Open Sans, sans-serif",ke.fillText(Xe,5,5),ke.strokeText(Xe,5,5),Ae.debugOverlayTexture.update(Te),Ae.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(h,ge);const me=I._tileDebugTextBuffer||h.debugBuffer,we=I._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,xe=I._tileDebugTextSegments||h.debugSegments;P.draw(f,v.TRIANGLES,R,U,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,bc(A,a.Color.transparent,pe),X,me,we,xe,null,null,null,[I._globeTileDebugTextBuffer])}function tp(h,i,l,f){ta(h,0,i+l/2,h.transform.width,l,f)}function Ac(h,i,l,f){ta(h,i-l/2,0,l,h.transform.height,f)}function ta(h,i,l,f,g,v){const E=h.context,T=E.gl;T.enable(T.SCISSOR_TEST),T.scissor(i*a.exported.devicePixelRatio,l*a.exported.devicePixelRatio,f*a.exported.devicePixelRatio,g*a.exported.devicePixelRatio),E.clear({color:v}),T.disable(T.SCISSOR_TEST)}const np=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:rp}=np;function uo(h,i,l,f){h.emplaceBack(i,l,f)}class Mc{constructor(i){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,uo(this.vertexArray,-1,-1,1),uo(this.vertexArray,1,-1,1),uo(this.vertexArray,-1,1,1),uo(this.vertexArray,1,1,1),uo(this.vertexArray,-1,-1,-1),uo(this.vertexArray,1,-1,-1),uo(this.vertexArray,-1,1,-1),uo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,rp),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function ci(h,i,l,f,g,v){const E=h.gl,T=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),P=i.paint.get("sky-atmosphere-sun-intensity"),I=((R,U,q,X,W)=>({u_matrix_3f:R,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),f),g,P,T,A);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),l.draw(h,E.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,I,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const yl=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ip{constructor(i){const l=new a.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const f=new a.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,yl.members),this.indexBuffer=i.createIndexBuffer(f),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ds={symbol:function(h,i,l,f,g){if(h.renderPass!=="translucent")return;const v=a.StencilMode.disabled,E=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(T,A,P,I,R,U,q){const X=A.transform,W=R==="map",K=U==="map";for(const O of T){const G=I.getTile(O),te=G.getBucket(P);if(!te||!te.text||!te.text.segments.get().length)continue;const ne=a.evaluateSizeForZoom(te.textSizeData,X.zoom),pe=Sn(O,te.getProjection(),X),ge=X.calculatePixelsToTileUnitsMatrix(G),me=Re(pe,G.tileID.canonical,K,W,X,te.getProjection(),ge),we=P.layout.get("icon-text-fit")!=="none"&&te.hasIconData();if(ne){const xe=Math.pow(2,X.zoom-G.tileID.overscaledZ);h_(te,W,K,q,a.symbolSize,X,me,O,xe,ne,we)}}}(f,h,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g),l.paint.get("icon-opacity").constantOr(1)!==0&&Jf(h,i,l,f,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),v,E),l.paint.get("text-opacity").constantOr(1)!==0&&Jf(h,i,l,f,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),v,E),i.map.showCollisionBoxes&&(gl(h,i,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),gl(h,i,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,l,f){if(h.renderPass!=="translucent")return;const g=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),T=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)===0&&(v.constantOr(1)===0||E.constantOr(1)===0))return;const A=h.context,P=A.gl,I=h.transform,R=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),U=a.StencilMode.disabled,q=h.colorModeForRenderPass(),X=I.projection.name==="globe",W=[a.mercatorXfromLng(I.center.lng),a.mercatorYfromLat(I.center.lat)],K=[];for(let G=0;G<f.length;G++){const te=f[G],ne=i.getTile(te),pe=ne.getBucket(l);if(!pe||pe.projection.name!==I.projection.name)continue;const ge=pe.programConfigurations.get(l.id),me=vh(l);X&&me.push("PROJECTION_GLOBE_VIEW");const we=h.useProgram("circle",ge,me),xe=pe.layoutVertexBuffer,Ae=pe.globeExtVertexBuffer,Xe=pe.indexBuffer,Te=I.projection.createInversionMatrix(I,te.canonical),Ne={programConfiguration:ge,program:we,layoutVertexBuffer:xe,globeExtVertexBuffer:Ae,indexBuffer:Xe,uniformValues:yh(h,te,ne,Te,W,l),tile:ne};if(T){const ke=pe.segments.get();for(const We of ke)K.push({segments:new a.SegmentVector([We]),sortKey:We.sortKey,state:Ne})}else K.push({segments:pe.segments,sortKey:0,state:Ne})}T&&K.sort((G,te)=>G.sortKey-te.sortKey);const O={useDepthForOcclusion:!X};for(const G of K){const{programConfiguration:te,program:ne,layoutVertexBuffer:pe,globeExtVertexBuffer:ge,indexBuffer:me,uniformValues:we,tile:xe}=G.state,Ae=G.segments;h.terrain&&h.terrain.setupElevationDraw(xe,ne,O),h.prepareDrawProgram(A,ne,xe.tileID.toUnwrapped()),ne.draw(A,P.TRIANGLES,R,U,q,a.CullFaceMode.disabled,we,l.id,pe,me,Ae,l.paint,I.zoom,te,[ge])}},heatmap:function(h,i,l,f){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,v=g.gl,E=a.StencilMode.disabled,T=new a.ColorMode([v.ONE,v.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(q,X,W,K){const O=q.gl,G=X.width*K,te=X.height*K;q.activeTexture.set(O.TEXTURE1),q.viewport.set([0,0,G,te]);let ne=W.heatmapFbo;if(!ne||ne&&(ne.width!==G||ne.height!==te)){ne&&ne.destroy();const pe=O.createTexture();O.bindTexture(O.TEXTURE_2D,pe),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),ne=W.heatmapFbo=q.createFramebuffer(G,te,!1),function(ge,me,we,xe,Ae,Xe){const Te=ge.gl;Te.texImage2D(Te.TEXTURE_2D,0,ge.isWebGL2&&ge.extRenderToTextureHalfFloat?Te.RGBA16F:Te.RGBA,Ae,Xe,0,Te.RGBA,ge.extRenderToTextureHalfFloat?ge.isWebGL2?Te.HALF_FLOAT:ge.extTextureHalfFloat.HALF_FLOAT_OES:Te.UNSIGNED_BYTE,null),xe.colorAttachment.set(we)}(q,0,pe,ne,G,te)}else O.bindTexture(O.TEXTURE_2D,ne.colorAttachment.get()),q.bindFramebuffer.set(ne.framebuffer)})(g,h,l,h.transform.projection.name==="globe"?.5:.25),g.clear({color:a.Color.transparent});const A=h.transform,P=A.projection.name==="globe",I=P?["PROJECTION_GLOBE_VIEW"]:null,R=P?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,U=[a.mercatorXfromLng(A.center.lng),a.mercatorYfromLat(A.center.lat)];for(let q=0;q<f.length;q++){const X=f[q];if(i.hasRenderableParent(X))continue;const W=i.getTile(X),K=W.getBucket(l);if(!K||K.projection.name!==A.projection.name)continue;const O=K.programConfigurations.get(l.id),G=h.useProgram("heatmap",O,I),{zoom:te}=h.transform;h.terrain&&h.terrain.setupElevationDraw(W,G),h.prepareDrawProgram(g,G,X.toUnwrapped());const ne=A.projection.createInversionMatrix(A,X.canonical);G.draw(g,v.TRIANGLES,a.DepthMode.disabled,E,T,R,Hf(h,X,W,ne,U,te,l.paint.get("heatmap-intensity")),l.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,l.paint,h.transform.zoom,O,P?[K.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,v){const E=g.context,T=E.gl,A=v.heatmapFbo;if(!A)return;E.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(T.TEXTURE1);let P=v.colorRampTexture;P||(P=v.colorRampTexture=new a.Texture(E,v.colorRamp,T.RGBA)),P.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.useProgram("heatmapTexture").draw(E,T.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,g.colorModeForRenderPass(),a.CullFaceMode.disabled,((I,R,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}))(0,v),v.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,v.paint,g.transform.zoom)}(h,l))},line:function(h,i,l,f){if(h.renderPass!=="translucent")return;const g=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(g.constantOr(1)===0||v.constantOr(1)===0)return;const E=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),A=h.terrain&&h.terrain.renderingToTexture?1:a.exported.devicePixelRatio,P=l.paint.get("line-dasharray"),I=P.constantOr(1),R=l.layout.get("line-cap"),U=l.paint.get("line-pattern"),q=U.constantOr(1),X=l.paint.get("line-gradient"),W=q?"linePattern":"line",K=h.context,O=K.gl,G=(ne=>{const pe=[];ml(ne)&&pe.push("RENDER_LINE_DASH"),ne.paint.get("line-gradient")&&pe.push("RENDER_LINE_GRADIENT");const ge=ne.paint.get("line-trim-offset");ge[0]===0&&ge[1]===0||pe.push("RENDER_LINE_TRIM_OFFSET");const me=ne.paint.get("line-pattern").constantOr(1),we=ne.paint.get("line-opacity").constantOr(1)!==1;return!me&&we&&pe.push("RENDER_LINE_ALPHA_DISCARD"),pe})(l);let te=G.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(te=!1);for(const ne of f){const pe=i.getTile(ne);if(q&&!pe.patternsLoaded())continue;const ge=pe.getBucket(l);if(!ge)continue;h.prepareDrawTile();const me=ge.programConfigurations.get(l.id),we=h.useProgram(W,me,G),xe=U.constantOr(null);if(xe&&pe.imageAtlas){const Fe=pe.imageAtlas.patternPositions[xe.toString()];Fe&&me.setConstantPatternPositions(Fe)}const Ae=P.constantOr(null),Xe=R.constantOr(null);if(!q&&Ae&&Xe&&pe.lineAtlas){const Fe=pe.lineAtlas.getDash(Ae,Xe);Fe&&me.setConstantPatternPositions(Fe)}let[Te,Ne]=l.paint.get("line-trim-offset");(Xe==="round"||Xe==="square")&&Te!==Ne&&(Te===0&&(Te-=1),Ne===1&&(Ne+=1));const ke=h.terrain?ne.projMatrix:null,We=q?pl(h,pe,l,ke,A):c_(h,pe,l,ke,ge.lineClipsArray.length,A,[Te,Ne]);if(X){const Fe=ge.gradients[l.id];let Ye=Fe.texture;if(l.gradientVersion!==Fe.version){let Ge=256;if(l.stepInterpolant){const Qe=i.getSource().maxzoom,yt=ne.canonical.z===Qe?Math.ceil(1<<h.transform.maxZoom-ne.canonical.z):1;Ge=a.clamp(a.nextPowerOfTwo(ge.maxLineLength/a.EXTENT*1024*yt),256,K.maxTextureSize)}Fe.gradient=a.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Ge,image:Fe.gradient||void 0,clips:ge.lineClipsArray}),Fe.texture?Fe.texture.update(Fe.gradient):Fe.texture=new a.Texture(K,Fe.gradient,O.RGBA),Fe.version=l.gradientVersion,Ye=Fe.texture}K.activeTexture.set(O.TEXTURE1),Ye.bind(l.stepInterpolant?O.NEAREST:O.LINEAR,O.CLAMP_TO_EDGE)}I&&(K.activeTexture.set(O.TEXTURE0),pe.lineAtlasTexture.bind(O.LINEAR,O.REPEAT),me.updatePaintBuffers()),q&&(K.activeTexture.set(O.TEXTURE0),pe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),me.updatePaintBuffers()),h.prepareDrawProgram(K,we,ne.toUnwrapped());const Ce=Fe=>{we.draw(K,O.TRIANGLES,E,Fe,T,a.CullFaceMode.disabled,We,l.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,l.paint,h.transform.zoom,me,[ge.layoutVertexBuffer2])};if(te){const Fe=h.stencilModeForClipping(ne).ref;Fe===0&&h.terrain&&K.clear({stencil:0});const Ye={func:O.EQUAL,mask:255};We.u_alpha_discard_threshold=.8,Ce(new a.StencilMode(Ye,Fe,255,O.KEEP,O.KEEP,O.INVERT)),We.u_alpha_discard_threshold=0,Ce(new a.StencilMode(Ye,Fe,255,O.KEEP,O.KEEP,O.KEEP))}else Ce(h.stencilModeForClipping(ne))}te&&(h.resetStencilClippingMasks(),h.terrain&&K.clear({stencil:0}))},fill:function(h,i,l,f){const g=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const E=h.colorModeForRenderPass(),T=l.paint.get("fill-pattern"),A=h.opaquePassEnabledForLayer()&&!T.constantOr(1)&&g.constantOr(a.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===A){const P=h.depthModeForSublayer(1,h.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Qf(h,i,l,f,P,E,!1)}if(h.renderPass==="translucent"&&l.paint.get("fill-antialias")){const P=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Qf(h,i,l,f,P,E,!0)}},"fill-extrusion":function(h,i,l,f){const g=l.paint.get("fill-extrusion-opacity");if(g!==0&&h.renderPass==="translucent"){const v=new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D);if(g!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Cc(h,i,l,f,v,a.StencilMode.disabled,a.ColorMode.disabled),Cc(h,i,l,f,v,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const E=h.colorModeForRenderPass();Cc(h,i,l,f,v,a.StencilMode.disabled,E)}}},hillshade:function(h,i,l,f){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const g=h.context,v=h.depthModeForSublayer(0,a.DepthMode.ReadOnly),E=h.colorModeForRenderPass(),T=h.terrain&&h.terrain.renderingToTexture,[A,P]=h.renderPass!=="translucent"||T?[{},f]:h.stencilConfigForOverlap(f);for(const I of P){const R=i.getTile(I);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")Gf(h,R,l,v,a.StencilMode.disabled,E);else if(h.renderPass==="translucent"){const U=T&&h.terrain?h.terrain.stencilModeForRTTOverlap(I):A[I.overscaledZ];$f(h,I,R,l,v,U,E)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,l,f,g,v){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0||!f.length)return;const E=h.context,T=E.gl,A=i.getSource(),P=h.useProgram("raster"),I=h.colorModeForRenderPass(),R=h.terrain&&h.terrain.renderingToTexture,[U,q]=A instanceof Ft||R?[{},f]:h.stencilConfigForOverlap(f),X=q[q.length-1].overscaledZ,W=!h.options.moving;for(const K of q){const O=R?a.DepthMode.disabled:h.depthModeForSublayer(K.overscaledZ-X,l.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,T.LESS),G=K.toUnwrapped(),te=i.getTile(K);if(R&&(!te||!te.hasData()))continue;const ne=R?K.projMatrix:h.transform.calculateProjMatrix(G,W),pe=h.terrain&&R?h.terrain.stencilModeForRTTOverlap(K):U[K.overscaledZ],ge=v?0:l.paint.get("raster-fade-duration");te.registerFadeDuration(ge);const me=i.findLoadedParent(K,0),we=fh(te,me,i,h.transform,ge);let xe,Ae;h.terrain&&h.terrain.prepareDrawTile();const Xe=l.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;E.activeTexture.set(T.TEXTURE0),te.texture.bind(Xe,T.CLAMP_TO_EDGE),E.activeTexture.set(T.TEXTURE1),me?(me.texture.bind(Xe,T.CLAMP_TO_EDGE),xe=Math.pow(2,me.tileID.overscaledZ-te.tileID.overscaledZ),Ae=[te.tileID.canonical.x*xe%1,te.tileID.canonical.y*xe%1]):te.texture.bind(Xe,T.CLAMP_TO_EDGE),te.texture.useMipmap&&E.extTextureFilterAnisotropic&&h.transform.pitch>20&&T.texParameterf(T.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const Te=bh(ne,Ae||[0,0],xe||1,we,l,A instanceof Ft?A.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(E,P,G),A instanceof Ft)A.boundsBuffer&&A.boundsSegments&&P.draw(E,T.TRIANGLES,O,a.StencilMode.disabled,I,a.CullFaceMode.disabled,Te,l.id,A.boundsBuffer,h.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:ke,tileBoundsSegments:We}=h.getTileBoundsBuffers(te);P.draw(E,T.TRIANGLES,O,pe,I,a.CullFaceMode.disabled,Te,l.id,Ne,ke,We)}}h.resetStencilClippingMasks()},background:function(h,i,l,f){const g=l.paint.get("background-color"),v=l.paint.get("background-opacity");if(v===0)return;const E=h.context,T=E.gl,A=h.transform,P=A.tileSize,I=l.paint.get("background-pattern");if(h.isPatternMissing(I))return;const R=!I&&g.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==R)return;const U=a.StencilMode.disabled,q=h.depthModeForSublayer(0,R==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),X=h.colorModeForRenderPass(),W=h.useProgram(I?"backgroundPattern":"background");let K,O=f;O||(K=h.getBackgroundTiles(),O=Object.values(K).map(G=>G.tileID)),I&&(E.activeTexture.set(T.TEXTURE0),h.imageManager.bind(h.context));for(const G of O){const te=G.toUnwrapped(),ne=f?G.projMatrix:h.transform.calculateProjMatrix(te);h.prepareDrawTile();const pe=i?i.getTile(G):K?K[G.key]:new a.Tile(G,P,A.zoom,h),ge=I?u_(ne,v,h,I,{tileID:G,tileSize:P}):Th(ne,v,g);h.prepareDrawProgram(E,W,te);const{tileBoundsBuffer:me,tileBoundsIndexBuffer:we,tileBoundsSegments:xe}=h.getTileBoundsBuffers(pe);W.draw(E,T.TRIANGLES,q,U,X,a.CullFaceMode.disabled,ge,l.id,me,we,xe)}},sky:function(h,i,l){const f=h.transform,g=f.projection.name==="mercator"||f.projection.name==="globe"?1:a.smoothstep(7,8,f.zoom),v=l.paint.get("sky-opacity")*g;if(v===0)return;const E=h.context,T=l.paint.get("sky-type"),A=new a.DepthMode(E.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),P=h.frameCounter/1e3%1;T==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(I,R,U,q){const X=I.context,W=X.gl;let K=R.skyboxFbo;if(!K){K=R.skyboxFbo=X.createFramebuffer(32,32,!1),R.skyboxGeometry=new Mc(X),R.skyboxTexture=X.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,R.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ne=0;ne<6;++ne)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(K.framebuffer),X.viewport.set([0,0,32,32]);const O=R.getCenter(I,!0),G=I.useProgram("skyboxCapture"),te=new Float64Array(16);a.identity(te),a.rotateY(te,te,.5*-Math.PI),ci(X,R,G,te,O,0),a.identity(te),a.rotateY(te,te,.5*Math.PI),ci(X,R,G,te,O,1),a.identity(te),a.rotateX(te,te,.5*-Math.PI),ci(X,R,G,te,O,2),a.identity(te),a.rotateX(te,te,.5*Math.PI),ci(X,R,G,te,O,3),a.identity(te),ci(X,R,G,te,O,4),a.identity(te),a.rotateY(te,te,Math.PI),ci(X,R,G,te,O,5),X.viewport.set([0,0,I.width,I.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(I,R,U,q,X){const W=I.context,K=W.gl,O=I.transform,G=I.useProgram("skybox");W.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_CUBE_MAP,R.skyboxTexture);const te=((ne,pe,ge,me,we)=>({u_matrix:ne,u_sun_direction:pe,u_cubemap:0,u_opacity:me,u_temporal_offset:we}))(O.skyboxMatrix,R.getCenter(I,!1),0,q,X);I.prepareDrawProgram(W,G),G.draw(W,K.TRIANGLES,U,a.StencilMode.disabled,I.colorModeForRenderPass(),a.CullFaceMode.backCW,te,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,A,v,P):T==="gradient"&&h.renderPass==="sky"&&function(I,R,U,q,X){const W=I.context,K=W.gl,O=I.transform,G=I.useProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Mc(W)),W.activeTexture.set(K.TEXTURE0);let te=R.colorRampTexture;te||(te=R.colorRampTexture=new a.Texture(W,R.colorRamp,K.RGBA)),te.bind(K.LINEAR,K.CLAMP_TO_EDGE);const ne=((pe,ge,me,we,xe)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:ge,u_radius:a.degToRad(me),u_opacity:we,u_temporal_offset:xe}))(O.skyboxMatrix,R.getCenter(I,!1),R.paint.get("sky-gradient-radius"),q,X);I.prepareDrawProgram(W,G),G.draw(W,K.TRIANGLES,U,a.StencilMode.disabled,I.colorModeForRenderPass(),a.CullFaceMode.backCW,ne,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(h,l,A,v,P)},debug:function(h,i,l){for(let f=0;f<l.length;f++)g_(h,i,l[f])},custom:function(h,i,l,f){const g=h.context,v=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&l.isLayerDraped()){if(h.renderPass==="offscreen"){const E=v.prerender;if(E){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;E.call(v,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else E.call(v,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const T=v.renderToTile;if(T){const A=f[0].canonical,P=new a.MercatorCoordinate(A.x+f[0].wrap*(1<<A.z),A.y,A.z);g.setDepthMode(a.DepthMode.disabled),g.setStencilMode(a.StencilMode.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),T.call(v,g.gl,P),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(a.StencilMode.disabled);const E=v.renderingMode==="3d"?new a.DepthMode(h.context.gl.LEQUAL,a.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(g.setDepthMode(E),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;v.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else v.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class na{constructor(i,l,f=!1){this.context=new it(i,f),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,l){const f=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new mh(this,i));const g=this._terrain;this.transform.elevation=f?g:null,g.update(i,this.transform,l)}_updateFog(i){const l=i.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,g]=l.getFovAdjustedRange(this.transform._fov);if(f>g)return void(this.transform.fogCullDistSq=null);const v=f+.78*(g-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,l){if(this.width=i*a.exported.devicePixelRatio,this.height=l*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._layers[f].resize()}setup(){const i=this.context,l=new a.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(a.EXTENT,0),l.emplaceBack(0,a.EXTENT),l.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const f=new a.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(a.EXTENT,0),f.emplaceBack(0,a.EXTENT),f.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=i.createVertexBuffer(f,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const g=new a.StructArrayLayout2i4;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const v=new a.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(a.EXTENT,0,a.EXTENT,0),v.emplaceBack(0,a.EXTENT,0,a.EXTENT),v.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(v,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const E=new a.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const T=new a.StructArrayLayout1ui2;for(const P of[0,1,3,2,0])T.emplaceBack(P);this.debugIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new a.Texture(i,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=a.create();const A=this.context.gl;this.stencilClearMode=new a.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new ip(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,l.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,dl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,f){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const A of f)if(this._tileClippingMaskIDs[A.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=l.id;const g=this.context,v=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(a.ColorMode.disabled),g.setDepthMode(a.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of f){const A=l.getTile(T),P=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:R,tileBoundsSegments:U}=this.getTileBoundsBuffers(A);E.draw(g,v.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:v.ALWAYS,mask:0},P,255,v.KEEP,v.KEEP,v.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,dl(T.projMatrix),"$clipping",I,R,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new a.StencilMode({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new a.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,f=i.sort((E,T)=>T.overscaledZ-E.overscaledZ),g=f[f.length-1].overscaledZ,v=f[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let T=0;T<v;T++)E[T+g]=new a.StencilMode({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[E,f]}return[{[g]:a.StencilMode.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([i.CONSTANT_COLOR,i.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(i,l,f){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new a.DepthMode(f||this.context.gl.LEQUAL,l,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const f=this.style.order,g=this.style._sourceCaches;for(const P in g){const I=g[P];I.used&&I.prepare(this.context)}const v={},E={},T={};for(const P in g){const I=g[P];v[P]=I.getVisibleCoordinates(),E[P]=v[P].slice().reverse(),T[P]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<f.length;P++)if(this.style._layers[f[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const P of f){const I=this.style._layers[P],R=i._getLayerSourceCache(I);if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const U=R?E[R.id]:void 0;(I.type==="custom"||I.isSky()||U&&U.length)&&this.renderLayer(this,R,I,U)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const A=this.terrain;if(A&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&A.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[f[this.currentLayer]],I=i._getLayerSourceCache(P);if(P.isSky())continue;const R=I?E[I.id]:void 0;this._renderTileClippingMasks(P,I,R),this.renderLayer(this,I,P,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(P,I){const R=P.context,U=R.gl,q=P.transform,X=new a.DepthMode(U.LEQUAL,a.DepthMode.ReadOnly,[0,1]),W=P.useProgram("globeAtmosphere",null,q.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),K=a.globeToMercatorTransition(q.zoom),O=I.properties.get("color").toArray01(),G=I.properties.get("high-color").toArray01(),te=I.properties.get("space-color").toArray01PremultipliedAlpha(),ne=a.identity$1([]);a.rotateY$1(ne,ne,-a.degToRad(q._center.lng)),a.rotateX$1(ne,ne,a.degToRad(q._center.lat)),a.rotateZ$1(ne,ne,q.angle),a.rotateX$1(ne,ne,-q._pitch);const pe=a.fromQuat(new Float32Array(16),ne),ge=a.mapValue(I.properties.get("star-intensity"),0,1,0,.25),me=5e-4,we=a.mapValue(I.properties.get("horizon-blend"),0,1,me,.25),xe=a.globeUseCustomAntiAliasing(P,R,q)&&we===me?q.worldSize/(2*Math.PI*1.025)-1:q.globeRadius,Ae=P.frameCounter/1e3%1,Xe=a.length(q.globeCenterInViewSpace),Te=Math.sqrt(Math.pow(Xe,2)-Math.pow(xe,2)),Ne=Math.acos(Te/Xe),ke=((Ce,Fe,Ye,Ge,Qe,yt,kt,pt,Et,$t,jt,gt,on,cn)=>({u_frustum_tl:Ce,u_frustum_tr:Fe,u_frustum_br:Ye,u_frustum_bl:Ge,u_horizon:Qe,u_transition:yt,u_fadeout_range:kt,u_color:pt,u_high_color:Et,u_space_color:$t,u_star_intensity:jt,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:gt,u_horizon_angle:on,u_rotation_matrix:cn}))(q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.frustumCorners.horizon,K,we,O,G,te,ge,Ae,Ne,pe);P.prepareDrawProgram(R,W);const We=P.atmosphereBuffer;We&&W.draw(R,U.TRIANGLES,X,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,ke,"skybox",We.vertexBuffer,We.indexBuffer,We.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const P=this.style._layers[f[this.currentLayer]],I=i._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,I,P,I?E[I.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;){const P=this.style._layers[f[this.currentLayer]],I=i._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=I?(P.type==="symbol"?T:E)[I.id]:void 0;this._renderTileClippingMasks(P,I,I?v[I.id]:void 0),this.renderLayer(this,I,P,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let P=null;a.values(this.style._layers).forEach(I=>{const R=i._getLayerSourceCache(I);R&&!I.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<R.getSource().maxzoom)&&(P=R)}),P&&this.options.showTileBoundaries&&ds.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const I=P.transform.padding;tp(P,P.transform.height-(I.top||0),3,ea),tp(P,I.bottom||0,3,d_),Ac(P,I.left||0,3,f_),Ac(P,P.transform.width-(I.right||0),3,p_);const R=P.transform.centerPoint;(function(U,q,X,W){ta(U,q-1,X-10,2,20,W),ta(U,q-10,X-1,20,2,W)})(P,R.x,P.transform.height-R.y,m_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,l,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||g&&g.length)&&(this.id=f.id,this.gpuTimingStart(f),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(f.type)||i.terrain&&f.type==="custom")&&ds[f.type](i,l,f,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let f=this.gpuTimers[i.id];f||(f=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),f.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),i.beginQueryEXT(i.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const f in i){const g=i[f],v=this.context.extTimerQuery,E=v.getQueryObjectEXT(g.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(g.query),l[f]=E}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let f=0;for(const g of i)f+=l.getQueryObjectEXT(g,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(g);return f}translatePosMatrix(i,l,f,g,v){if(!f[0]&&!f[1])return i;const E=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(E){const P=Math.sin(E),I=Math.cos(E);f=[f[0]*I-f[1]*P,f[0]*P+f[1]*I]}const T=[v?f[0]:Gt(l,f[0],this.transform.zoom),v?f[1]:Gt(l,f[1],this.transform.zoom),0],A=new Float32Array(16);return a.translate(A,i,T),A}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){return i===null||i!==void 0&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&this.terrain.exaggeration()===0,f=this.style&&this.style.fog,g=[];return this.terrainRenderModeElevated()&&g.push("TERRAIN"),this.transform.projection.name==="globe"&&g.push("GLOBE"),l&&g.push("ZERO_EXAGGERATION"),f&&!i&&f.getOpacity(this.transform.pitch)!==0&&g.push("FOG"),i&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(i,l,f){this.cache=this.cache||{};const g=f||[],v=this.currentGlobalDefines().concat(g),E=Xt.cacheKey(ch[i],i,v,l);return this.cache[E]||(this.cache[E]=new Xt(this.context,i,ch[i],l,Sh[i],v)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,l,f){if(this.terrain&&this.terrain.renderingToTexture)return;const g=this.style.fog;if(g){const v=g.getOpacity(this.transform.pitch),E=((T,A,P,I,R,U,q,X,W,K,O)=>{const G=T.transform,te=A.properties.get("color").toArray01();te[3]=I;const ne=T.frameCounter/1e3%1;return{u_fog_matrix:P?G.calculateFogTileMatrix(P):T.identityMat,u_fog_range:A.getFovAdjustedRange(G._fov),u_fog_color:te,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:ne,u_frustum_tl:R,u_frustum_tr:U,u_frustum_br:q,u_frustum_bl:X,u_globe_pos:W,u_globe_radius:K,u_viewport:O,u_globe_transition:a.globeToMercatorTransition(G.zoom),u_is_globe:+(G.projection.name==="globe")}})(this,g,f,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);l.setFogUniformValues(i,E)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const g of f)l[g.key]=i[g.key]||new a.Tile(g,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class kc{constructor(i=0,l=0,f=0,g=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=f,this.right=g}interpolate(i,l,f){return l.top!=null&&i.top!=null&&(this.top=a.number(i.top,l.top,f)),l.bottom!=null&&i.bottom!=null&&(this.bottom=a.number(i.bottom,l.bottom,f)),l.left!=null&&i.left!=null&&(this.left=a.number(i.left,l.left,f)),l.right!=null&&i.right!=null&&(this.right=a.number(i.right,l.right,f)),this}getCenter(i,l){const f=a.clamp((this.left+i-this.right)/2,0,i),g=a.clamp((this.top+l-this.bottom)/2,0,l);return new a.Point(f,g)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new kc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ic(h,i){const l=a.getColumn(h,3);a.fromQuat(h,i),a.setColumn(h,3,l)}function Ht(h,i){const l=a.identity$1([]);return a.rotateZ$1(l,l,-i),a.rotateX$1(l,l,-h),l}function vl(h,i){const l=[h[0],h[1],0],f=[i[0],i[1],0];if(a.length(l)>=1e-15){const E=a.normalize([],l);a.scale$2(f,E,a.dot(f,E)),i[0]=f[0],i[1]=f[1]}const g=a.cross([],i,h);if(a.len(g)<1e-15)return null;const v=Math.atan2(-g[1],g[0]);return Ht(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class op{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof a.MercatorCoordinate?i:new a.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=a.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const f=this.position,g=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(i)):0,v=a.MercatorCoordinate.fromLngLat(i,g),E=[v.x-f.x,v.y-f.y,v.z-f.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=vl(E,l)}setPitchBearing(i,l){this.orientation=Ht(a.degToRad(i),a.degToRad(-l))}}class Pc{constructor(i,l){this._transform=a.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new a.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=a.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&a.setColumn(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||a.identity$1([]),i&&Ic(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=Ht(i,l),Ic(this._transform,this._orientation)}forward(){const i=a.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=a.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=a.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const f=new Float64Array(16);return a.invert(f,this.getWorldToCamera(i,l)),f}getWorldToCameraPosition(i,l,f){const g=this.position;a.scale$2(g,g,-i);const v=new Float64Array(16);return a.fromScaling(v,[f,f,f]),a.translate(v,v,g),v[10]*=l,v}getWorldToCamera(i,l){const f=new Float64Array(16),g=new Float64Array(4),v=this.position;return a.conjugate(g,this._orientation),a.scale$2(v,v,-i),a.fromQuat(f,g),a.translate(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=l,f[9]*=l,f[10]*=l,f[11]*=l,f}getCameraToClipPerspective(i,l,f,g){const v=new Float64Array(16);return a.perspective(v,i,l,f,g),v}getDistanceToElevation(i,l=!1){const f=i===0?0:a.mercatorZfromAltitude(i,l?a.latFromMercatorY(this.position[1]):this.position[1]),g=this.forward();return(f-this.position[2])/g[2]}clone(){return new Pc([...this.position],[...this.orientation])}}function ra(h,i){const l=zc(h.projection,h.zoom,h.width,h.height),f=function(v,E,T,A,P){const I=new a.LngLat(T.lng-180*ho,T.lat),R=new a.LngLat(T.lng+180*ho,T.lat),U=v.project(I.lng,I.lat),q=v.project(R.lng,R.lat),X=-Math.atan2(q.y-U.y,q.x-U.x),W=a.MercatorCoordinate.fromLngLat(T);W.y=a.clamp(W.y,-1+ho,1-ho);const K=W.toLngLat(),O=v.project(K.lng,K.lat),G=a.MercatorCoordinate.fromLngLat(K);G.x+=ho;const te=G.toLngLat(),ne=v.project(te.lng,te.lat),pe=Dc(ne.x-O.x,ne.y-O.y,X),ge=a.MercatorCoordinate.fromLngLat(K);ge.y+=ho;const me=ge.toLngLat(),we=v.project(me.lng,me.lat),xe=Dc(we.x-O.x,we.y-O.y,X),Ae=Math.abs(pe.x)/Math.abs(xe.y),Xe=a.identity([]);a.rotateZ(Xe,Xe,-X*(1-(P?0:A)));const Te=a.identity([]);return a.scale(Te,Te,[1,1-(1-Ae)*A,1]),Te[4]=-xe.x/xe.y*A,a.rotateZ(Te,Te,X),a.multiply(Te,Xe,Te),Te}(h.projection,0,h.center,l,i),g=sp(h);return a.scale(f,f,[g,g,1]),f}function sp(h){const i=h.projection,l=zc(h.projection,h.zoom,h.width,h.height),f=ap(i,h.center),g=ap(i,a.LngLat.convert(i.center));return Math.pow(2,f*l+(1-l)*g)}function zc(h,i,l,f,g=1/0){const v=h.range;if(!v)return 0;const E=Math.min(g,Math.max(l,f)),T=Math.log(E/1024)/Math.LN2;return a.smoothstep(v[0]+T,v[1]+T,i)}const ho=1/4e4;function ap(h,i){const l=a.clamp(i.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),f=new a.LngLat(i.lng-180*ho,l),g=new a.LngLat(i.lng+180*ho,l),v=h.project(f.lng,l),E=h.project(g.lng,l),T=a.MercatorCoordinate.fromLngLat(f),A=a.MercatorCoordinate.fromLngLat(g),P=E.x-v.x,I=E.y-v.y,R=A.x-T.x,U=A.y-T.y,q=Math.sqrt((R*R+U*U)/(P*P+I*I));return Math.log(q)/Math.LN2}function Dc(h,i,l){const f=Math.cos(l),g=Math.sin(l);return{x:h*f-i*g,y:h*g+i*f}}class ia{constructor(i,l,f,g,v,E,T){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=g??60,this.setProjection(E),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,l=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(i||f)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const f=!z(l,this.getProjection());return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;var f;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(f=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f),function(g,v,E){var T=v[0],A=v[1],P=v[2],I=v[3],R=Math.sin(E),U=Math.cos(E);g[0]=T*U+P*R,g[1]=A*U+I*R,g[2]=T*-R+P*U,g[3]=A*-R+I*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=a.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=a.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let g=0,v=0;for(let E=0;E<l.length;E++){const T=new a.Point(l[E][0]*this.width,f+l[E][1]*(this.height-f)),A=i.pointCoordinate(T);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);g+=A[3]*P,v+=P}return v===0?NaN:g/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*l,g=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),E=Math.max(g-f,v);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let f;f=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const g=a.length(a.sub([],this._camera.position,f));return a.clamp(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!a.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const f=[i.position.x,i.position.y,i.position.z];a.exactEquals$1(f,this._camera.position)||(this._setCameraPosition(f),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new op;return l.position=new a.MercatorCoordinate(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!a.length$1(i))return!1;a.normalize$1(i,i);const l=a.transformQuat([],[0,0,-1],i),f=a.transformQuat([],[0,-1,0],i);if(f[2]<0)return!1;const g=vl(l,f);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;i[2]=a.clamp(i[2],g/f,g/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,f){this._unmodified=!1,this._edgeInsets.interpolate(i,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new a.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const f=this.pointCoordinate(new a.Point(0,0)),g=this.pointCoordinate(new a.Point(this.width,0)),v=this.pointCoordinate(new a.Point(this.width,this.height)),E=this.pointCoordinate(new a.Point(0,this.height)),T=Math.floor(Math.min(f.x,g.x,v.x,E.x)),A=Math.floor(Math.max(f.x,g.x,v.x,E.x)),P=1;for(let I=T-P;I<=A+P;I++)I!==0&&l.push(new a.UnwrappedTileID(I,i))}return l}coveringTiles(i){let l=this.coveringZoomLevel(i);const f=l,g=this.elevation&&!i.isTerrainDEM,v=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);const E=this.locationCoordinate(this.center),T=this.center.lat,A=1<<l,P=[A*E.x,A*E.y,0],I=this.projection.name==="globe",R=!I,U=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,R),q=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=A*a.mercatorZfromAltitude(1,this.center.lat),W=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),K=[A*q.x,A*q.y,W*(R?1:X)],O=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),G=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,te=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ne=i.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,pe=this.projection.isReprojectedInTileSpace?sp(this):1,ge=Ce=>{const Ye=new a.MercatorCoordinate(Ce.x+25e-6,Ce.y,Ce.z),Ge=new a.MercatorCoordinate(Ce.x,Ce.y+25e-6,Ce.z),Qe=Ce.toLngLat(),yt=Ye.toLngLat(),kt=Ge.toLngLat(),pt=this.locationCoordinate(Qe),Et=this.locationCoordinate(yt),$t=this.locationCoordinate(kt),jt=Math.hypot(Et.x-pt.x,Et.y-pt.y),gt=Math.hypot($t.x-pt.x,$t.y-pt.y);return Math.sqrt(jt*gt)*pe/25e-6},me=Ce=>{const Fe=te,Ye=ne;return{aabb:a.tileAABB(this,A,0,0,0,Ce,Ye,Fe,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:Fe,wrap:Ce,fullyVisible:!1}},we=[];let xe=[];const Ae=l,Xe=i.reparseOverscaled?f:l,Te=Ce=>Ce*Ce,Ne=Te((W-this._centerAltitude)*X),ke=Ce=>{if(!this._elevation||!Ce.tileID||!v)return;const Fe=this._elevation.getMinMaxForTile(Ce.tileID),Ye=Ce.aabb;Fe?(Ye.min[2]=Fe.min,Ye.max[2]=Fe.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Ce.shouldSplit=We(Ce),Ce.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},We=Ce=>{if(Ce.zoom<G)return!0;if(Ce.zoom===Ae)return!1;if(Ce.shouldSplit!=null)return Ce.shouldSplit;const Fe=Ce.aabb.distanceX(K),Ye=Ce.aabb.distanceY(K);let Ge=Ne,Qe=1;if(I){Ge=Te(Ce.aabb.distanceZ(K));const pt=Math.pow(2,Ce.zoom),Et=a.latFromMercatorY((Ce.y+1)/pt),$t=a.latFromMercatorY(Ce.y/pt),jt=Math.min(Math.max(T,Et),$t),gt=a.circumferenceAtLatitude(jt)/a.circumferenceAtLatitude(T);if(Qe=jt===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,gt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Ce.zoom===Ae-1&&gt>=.9)return!0}else if(g&&(Ge=Te(Ce.aabb.distanceZ(K)*X)),this.projection.isReprojectedInTileSpace&&f<=5){const pt=Math.pow(2,Ce.zoom),Et=ge(new a.MercatorCoordinate((Ce.x+.5)/pt,(Ce.y+.5)/pt));Qe=Et>.85?1:Et}const yt=Fe*Fe+Ye*Ye+Ge,kt=Te((1<<Ae-Ce.zoom)*O*Qe*((pt,Et)=>{if(Et*Te(.707)<pt)return 1;const $t=Math.sqrt(Et/pt);return $t/(1.4144271570014144+(Math.pow(1.1,$t-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ge,Ne),yt));return yt<kt};if(this.renderWorldCopies)for(let Ce=1;Ce<=3;Ce++)we.push(me(-Ce)),we.push(me(Ce));for(we.push(me(0));we.length>0;){const Ce=we.pop(),Fe=Ce.x,Ye=Ce.y;let Ge=Ce.fullyVisible;if(!Ge){const Qe=Ce.aabb.intersects(U);if(Qe===0)continue;Ge=Qe===2}if(Ce.zoom!==Ae&&We(Ce))for(let Qe=0;Qe<4;Qe++){const yt=(Fe<<1)+Qe%2,kt=(Ye<<1)+(Qe>>1),pt={aabb:v?Ce.aabb.quadrant(Qe):a.tileAABB(this,A,Ce.zoom+1,yt,kt,Ce.wrap,Ce.minZ,Ce.maxZ,this.projection),zoom:Ce.zoom+1,x:yt,y:kt,wrap:Ce.wrap,fullyVisible:Ge,tileID:void 0,shouldSplit:void 0,minZ:Ce.minZ,maxZ:Ce.maxZ};g&&!I&&(pt.tileID=new a.OverscaledTileID(Ce.zoom+1===Ae?Xe:Ce.zoom+1,Ce.wrap,Ce.zoom+1,yt,kt),ke(pt)),we.push(pt)}else{const Qe=Ce.zoom===Ae?Xe:Ce.zoom;if(i.minzoom&&i.minzoom>Qe)continue;const yt=P[0]-(.5+Fe+(Ce.wrap<<Ce.zoom))*(1<<l-Ce.zoom),kt=P[1]-.5-Ye,pt=Ce.tileID?Ce.tileID:new a.OverscaledTileID(Qe,Ce.wrap,Ce.zoom,Fe,Ye);xe.push({tileID:pt,distanceSq:yt*yt+kt*kt})}}if(this.fogCullDistSq){const Ce=this.fogCullDistSq,Fe=this.horizonLineFromTop();xe=xe.filter(Ye=>{const Ge=[0,0,0,1],Qe=[a.EXTENT,a.EXTENT,0,1],yt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());a.transformMat4$1(Ge,Ge,yt),a.transformMat4$1(Qe,Qe,yt);const kt=a.getAABBPointSquareDist(Ge,Qe);if(kt===0)return!0;let pt=!1;const Et=this._elevation;if(Et&&kt>Ce&&Fe!==0){const $t=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let jt;i.isTerrainDEM||(jt=Et.getMinMaxForTile(Ye.tileID)),jt||(jt={min:ne,max:te});const gt=a.furthestTileCorner(this.rotation),on=[gt[0]*a.EXTENT,gt[1]*a.EXTENT,jt.max];a.transformMat4(on,on,$t),pt=(1-on[1])*this.height*.5<Fe}return kt<Ce||pt})}return xe.sort((Ce,Fe)=>Ce.distanceSq-Fe.distanceSq).map(Ce=>Ce.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=a.clamp(i.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),f=this.projection.project(i.lng,l);return new a.Point(f.x*this.worldSize,f.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let f,g;const v=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;f=(l.x-v.x)/T,g=(l.y-v.y)/T}else{const T=this.pointCoordinate(l),A=this.pointCoordinate(v);f=T.x-A.x,g=T.y-A.y}const E=this.locationCoordinate(i);this.setLocation(new a.MercatorCoordinate(E.x-f,E.y-g))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const f=l?a.mercatorZfromAltitude(l,i.lat):void 0,g=this.projection.project(i.lng,i.lat);return new a.MercatorCoordinate(g.x,g.y,f)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const f=l??this._centerAltitude,g=[i.x,i.y,0,1],v=[i.x,i.y,1,1];a.transformMat4$1(g,g,this.pixelMatrixInverse),a.transformMat4$1(v,v,this.pixelMatrixInverse);const E=v[3];a.scale$1(g,g,1/g[3]),a.scale$1(v,v,1/E);const T=g[2],A=v[2];return{p0:g,p1:v,t:T===A?0:(f-T)/(A-T)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],f=[i.x,i.y,1,1];return a.transformMat4$1(l,l,this.pixelMatrixInverse),a.transformMat4$1(f,f,this.pixelMatrixInverse),a.scale$1(l,l,1/l[3]),a.scale$1(f,f,1/f[3]),l[2]=a.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,f[2]=a.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,a.scale$1(l,l,1/this.worldSize),a.scale$1(f,f,1/this.worldSize),new a.Ray([l[0],l[1],l[2]],a.normalize([],a.sub([],f,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:f,t:g}=i,v=a.mercatorZfromAltitude(l[2],this._center.lat),E=a.mercatorZfromAltitude(f[2],this._center.lat);return new a.MercatorCoordinate(a.number(l[0],f[0],g)/this.worldSize,a.number(l[1],f[1],g)/this.worldSize,a.number(v,E,g))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new a.MercatorCoordinate(l[0],l[1],l[2]);let f=0,g=this.horizonLineFromTop();if(i.y>g)return this.pointCoordinate(i);const v=.02*g,E=i.clone();for(let T=0;T<10&&g-f>v;T++){E.y=a.number(f,g,.66);const A=this.projection.pointCoordinate3D(this,E.x,E.y);A?(g=E.y,l=A):f=E.y}return l?new a.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){const f=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,g=[i.x*this.worldSize,i.y*this.worldSize,f+i.toAltitude(),1];return a.transformMat4$1(g,g,this.pixelMatrix),g[3]>0?new a.Point(g[0]/g[3],g[1]/g[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:l}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,v=this.pointLocation3D(new a.Point(l,i)),E=this.pointLocation3D(new a.Point(g,i)),T=this.pointLocation3D(new a.Point(g,f)),A=this.pointLocation3D(new a.Point(l,f));let P=Math.min(v.lng,E.lng,T.lng,A.lng),I=Math.max(v.lng,E.lng,T.lng,A.lng),R=Math.min(v.lat,E.lat,T.lat,A.lat),U=Math.max(v.lat,E.lat,T.lat,A.lat);const q=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,W=(K,O,G,te,ne)=>{const pe=(K+G)/2,ge=(O+te)/2,me=new a.Point(pe,ge),{lng:we,lat:xe}=this.pointLocation3D(me),Ae=Math.max(0,P-we,R-xe,we-I,xe-U);P=Math.min(P,we),I=Math.max(I,we),R=Math.min(R,xe),U=Math.max(U,xe),(ne<X||Ae>q)&&(W(K,O,pe,ge,ne+1),W(pe,ge,G,te,ne+1))};if(W(l,i,g,i,1),W(g,i,g,f,1),W(g,f,l,f,1),W(l,f,l,i,1),this.projection.name==="globe"){const[K,O]=a.polesInViewport(this);K?(U=90,I=180,P=-180):O&&(R=-90,I=180,P=-180)}return new a.LngLatBounds(new a.LngLat(P,R),new a.LngLat(I,U))}_getBoundsRectangular(i,l){const{top:f,left:g}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,T=new a.Point(g,f),A=new a.Point(E,f),P=new a.Point(E,v),I=new a.Point(g,v);let R=this.pointCoordinate(T,i),U=this.pointCoordinate(A,i);const q=this.pointCoordinate(P,l),X=this.pointCoordinate(I,l),W=(K,O)=>(O.y-K.y)/(O.x-K.x);return R.y>1&&U.y>=0?R=new a.MercatorCoordinate((1-X.y)/W(X,R)+X.x,1):R.y<0&&U.y<=1&&(R=new a.MercatorCoordinate(-X.y/W(X,R)+X.x,0)),U.y>1&&R.y>=0?U=new a.MercatorCoordinate((1-q.y)/W(q,U)+q.x,1):U.y<0&&R.y<=1&&(U=new a.MercatorCoordinate(-q.y/W(q,U)+q.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(R)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=i.visibleDemTiles.reduce((f,g)=>{if(g.dem){const v=g.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,f=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,f=this._distanceTileDataCache;if(f[l])return f[l];const g=i.canonical,v=1/this.height,E=this.cameraWorldSize,T=E/this.zoomScale(g.z),A=(g.x+Math.pow(2,g.z)*i.wrap)*T,P=g.y*T,I=this.point;I.x*=E/this.worldSize,I.y*=E/this.worldSize;const R=this.angle,U=Math.sin(-R),q=-Math.cos(-R);return f[l]={bearing:[U,q],center:[(I.x-A)*v,(I.y-P)*v],scale:T/a.EXTENT*v},f[l]}calculateFogTileMatrix(i){const l=i.key,f=this._fogTileMatrixCache;if(f[l])return f[l];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return a.multiply(g,this.worldToFogMatrix,g),f[l]=new Float32Array(g),f[l]}calculateProjMatrix(i,l=!1){const f=i.key,g=l?this._alignedProjMatrixCache:this._projMatrixCache;if(g[f])return g[f];const v=this.calculatePosMatrix(i,this.worldSize);return a.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,v),g[f]=new Float32Array(v),g[f]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,f=this._pixelsToTileUnitsCache;if(f[l])return f[l];const g=function(v,E){const{scale:T}=v.tileTransform,A=T*a.EXTENT/(v.tileSize*Math.pow(2,E.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return P=new Float32Array(4),U=(I=E.inverseAdjustmentMatrix)[1],q=I[2],X=I[3],K=(R=[A,A])[1],P[0]=I[0]*(W=R[0]),P[1]=U*W,P[2]=q*K,P[3]=X*K,P;var P,I,R,U,q,X,W,K}(i,this);return f[l]=g,f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,l=a.fromScaling([],[i,i,i]);return a.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const l=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),g=this._camera.forward(),v=a.mercatorZfromAltitude(1,this._center.lat);f[2]/=v,g[2]/=v,a.normalize(g,g);const E=i.raycast(f,g,i.exaggeration());if(E){const T=a.scaleAndAdd([],f,g,E),A=new a.MercatorCoordinate(T[0],T[1],a.mercatorZfromAltitude(T[2],a.latFromMercatorY(T[1]))),P=(A.z+a.length([A.x-f[0],A.y-f[1],A.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const l=this._elevation,f=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(f),v=l.getAtPointOrZero(new a.MercatorCoordinate(...g)),E=this.pixelsPerMeter/this.worldSize*v,T=this._minimumHeightOverTerrain(),A=g[2]-E;if(A<=T)if(A<0||i){const P=this.locationCoordinate(this._center,this._centerAltitude),I=[g[0],g[1],P.z-g[2]],R=a.length(I);I[2]-=(T-A)/this._pixelsPerMercatorPixel;const U=a.length(I);if(U===0)return;a.scale$2(I,I,R/U*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],P.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const U=this.center;return U.lat=a.clamp(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(U.lng=a.clamp(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const l=this._unmodified,{x:f,y:g}=this.point;let v=0,E=f,T=g;const A=this.width/2,P=this.height/2,I=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(g-P<I&&(T=I+P),g+P>R&&(T=R-P),R-I<this.height&&(v=Math.max(v,this.height/(R-I)),T=(R+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,X=this.worldSize/2-(U+q)/2;E=(f+X+this.worldSize)%this.worldSize-X,E-A<U&&(E=U+A),E+A>q&&(E=q-A),q-U<this.width&&(v=Math.max(v,this.width/(q-U)),E=(q+U)/2)}E===f&&T===g||(this.center=this.unproject(new a.Point(E,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const f=zc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?l:1,v=this._camera.getWorldToCamera(this.worldSize,g),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-i.x/this.width,E[9]=2*i.y/this.height;let T=a.mul([],E,v);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),me=a.identity([]);a.translate(me,me,[ge.x*this.worldSize,ge.y*this.worldSize,0]),a.multiply(me,me,ra(this)),a.translate(me,me,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),a.multiply(T,T,me),this.inverseAdjustmentMatrix=function(we){const xe=ra(we,!0);return De([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],T,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=T,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const A=a.invert([],E);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const P=new Float32Array(16);a.identity(P),a.scale(P,P,[1,-1,1]),a.rotateX(P,P,this._pitch),a.rotateZ(P,P,this.angle);const I=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),R=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;I[8]=2*-i.x/this.width,I[9]=2*(i.y+R)/this.height,this.skyboxMatrix=a.multiply(P,I,P);const U=this.point,q=U.x,X=U.y,W=this.width%2/2,K=this.height%2/2,O=Math.cos(this.angle),G=Math.sin(this.angle),te=q-Math.round(q)+O*W+G*K,ne=X-Math.round(X)+O*K+G*W,pe=new Float64Array(T);if(a.translate(pe,pe,[te>.5?te-1:te,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=pe,T=a.create(),a.scale(T,T,[this.width/2,-this.height/2,1]),a.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=a.create(),a.scale(T,T,[1,-1,1]),a.translate(T,T,[-1,-1,0]),a.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=a.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ge,ge,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,f=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,v=[i,i,l];a.scale$2(v,v,g),a.scale$2(f,f,-1),a.multiply$2(f,f,v);const E=a.create();a.translate(E,E,f),a.scale(E,E,v),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,g)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),g=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-f[0]*v,g.y/this.worldSize-f[1]*v,i/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],g=i[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(v=Math.min((l-f)/g,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:f,bearing:g}=this._camera.getPitchBearing(),v=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),T=Math.max((i[2]-v)/Math.cos(f),E),A=this._zoomFromMercatorZ(T);a.scaleAndAdd(i,i,l,T),this._pitch=a.clamp(f,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(g,-Math.PI,Math.PI),this._setZoom(a.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,f=a.GLOBE_ZOOM_THRESHOLD_MAX,g=0,v=1/0;for(;f-l>1e-6&&f>l;){const E=l+.5*(f-l),T=this.tileSize*Math.pow(2,E),A=this.getCameraToCenterDistance(this.projection,E,T),P=this.scaleZoom(A/(i*this.tileSize)),I=Math.abs(E-P);I<v&&(v=I,g=E),E<P?l=E:f=E}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const f=Math.min(i.x,l.x),g=Math.max(i.x,l.x),v=Math.min(i.y,l.y),E=Math.max(i.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new a.Point(f,v),new a.Point(g,E),new a.Point(f,E),new a.Point(g,v)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const I of T){const R=this.pointRayIntersection(I);if(R.t<0)return!0;const U=this.rayIntersectionCoordinate(R);if(U.x<A||U.y<0||U.x>P||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(i,l){const f=a.length(a.sub([],this._camera.position,i)),g=this._zoomFromMercatorZ(f)+l;return f-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([l,f,g],v){const E=[l,f,g,1];a.transformMat4$1(E,E,v);const T=E[3]=Math.max(E[3],1e-6);return E[0]/=T,E[1]/=T,E[2]/=T,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,i))}}getCameraToCenterDistance(i,l=this.zoom,f=this.worldSize){const g=zc(i,l,this.width,this.height,1024),v=i.pixelSpaceConversion(this.center.lat,f,g);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(i,i,this.globeMatrix),i}}function oa(h,i){let l=!1,f=null;const g=()=>{f=null,l&&(h(),f=setTimeout(g,i),l=!1)};return()=>(l=!0,f||g(),f)}class Mh{constructor(i){this._hashName=i&&encodeURIComponent(i),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oa(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,a.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=xl(i);if(this._hashName){const f=this._hashName;let g=!1;const v=a.window.location.hash.slice(1).split("&").map(E=>{const T=E.split("=")[0];return T===f?(g=!0,`${T}=${l}`):E}).filter(E=>E);return g||v.push(`${f}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){const i=a.window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(f))){const f=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,i)}}function xl(h,i){const l=h.getCenter(),f=Math.round(100*h.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),E=Math.round(l.lng*v)/v,T=Math.round(l.lat*v)/v,A=h.getBearing(),P=h.getPitch();let I=i?`/${E}/${T}/${f}`:`${f}/${T}/${E}`;return(A||P)&&(I+="/"+Math.round(10*A)/10),P&&(I+=`/${Math.round(P)}`),I}const wl={linearity:.3,easing:a.bezier(0,0,.3,1)},Lc=a.extend({deceleration:2500,maxSpeed:1400},wl),Rc=a.extend({deceleration:20,maxSpeed:1400},wl),dt=a.extend({deceleration:1e3,maxSpeed:360},wl),Ei=a.extend({deceleration:1e3,maxSpeed:90},wl);class lp{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=a.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const v=El(l.pan.mag(),f,a.extend({},Lc,i||{}));g.offset=l.pan.mult(v.amount/l.pan.mag()),g.center=this._map.transform.center,bl(g,v)}if(l.zoom){const v=El(l.zoom,f,Rc);g.zoom=this._map.transform.zoom+v.amount,bl(g,v)}if(l.bearing){const v=El(l.bearing,f,dt);g.bearing=this._map.transform.bearing+a.clamp(v.amount,-179,179),bl(g,v)}if(l.pitch){const v=El(l.pitch,f,Ei);g.pitch=this._map.transform.pitch+v.amount,bl(g,v)}if(g.zoom||g.bearing){const v=l.pinchAround===void 0?l.around:l.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function bl(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function El(h,i,l){const{maxSpeed:f,linearity:g,deceleration:v}=l,E=a.clamp(h*g/(i/1e3),-f,f),T=Math.abs(E)/(v*g);return{easing:l.easing,duration:1e3*T,amount:E*(T/2)}}class ar extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,f,g={}){const v=$e(l.getCanvasContainer(),f),E=l.unproject(v);super(i,a.extend({point:v,lngLat:E,originalEvent:f},g)),this._defaultPrevented=!1,this.target=l}}class Tl extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,f){const g=i==="touchend"?f.changedTouches:f.touches,v=ot(l.getCanvasContainer(),g),E=v.map(A=>l.unproject(A)),T=v.reduce((A,P,I,R)=>A.add(P.div(R.length)),new a.Point(0,0));super(i,{points:v,point:T,lngLats:E,lngLat:l.unproject(T),originalEvent:f}),this._defaultPrevented=!1}}class Oc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,f){super(i,{originalEvent:f}),this._defaultPrevented=!1}}class kh{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Oc(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new ar(i.type,this._map,i))}mouseup(i){this._map.fire(new ar(i.type,this._map,i))}preclick(i){const l=a.extend({},i);l.type="preclick",this._map.fire(new ar(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new ar(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new ar(i.type,this._map,i))}mouseover(i){this._map.fire(new ar(i.type,this._map,i))}mouseout(i){this._map.fire(new ar(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Tl(i.type,this._map,i))}touchmove(i){this._map.fire(new Tl(i.type,this._map,i))}touchend(i){this._map.fire(new Tl(i.type,this._map,i))}touchcancel(i){this._map.fire(new Tl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bc{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new ar(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ar(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class cp{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(le(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const f=l,g=this._startPos,v=this._lastPos;if(!g||!v||v.equals(f)||!this._box&&f.dist(g)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=Y("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const E=Math.min(g.x,f.x),T=Math.max(g.x,f.x),A=Math.min(g.y,f.y),P=Math.max(g.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${A}px)`,this._box.style.width=T-E+"px",this._box.style.height=P-A+"px")})}mouseupWindow(i,l){if(!this._active)return;const f=this._startPos,g=l;if(f&&i.button===0){if(this.reset(),Be(),f.x!==g.x||f.y!==g.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(f,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ee(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new a.Event(i,{originalEvent:l}))}}function Fc(h,i){const l={};for(let f=0;f<h.length;f++)l[h[f].identifier]=i[f];return l}class sa{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){const v=new a.Point(0,0);for(const E of g)v._add(E);return v.div(g.length)}(l),this.touches=Fc(f,l)))}touchmove(i,l,f){if(this.aborted||!this.centroid)return;const g=Fc(f,l);for(const v in this.touches){const E=g[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(i,l,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Ih{constructor(i){this.singleTap=new sa(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,f){this.singleTap.touchstart(i,l,f)}touchmove(i,l,f){this.singleTap.touchmove(i,l,f)}touchend(i,l,f){const g=this.singleTap.touchend(i,l,f);if(g){const v=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(g)<30;if(v&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class __{constructor(){this._zoomIn=new Ih({numTouches:1,numTaps:2}),this._zoomOut=new Ih({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,f){this._zoomIn.touchstart(i,l,f),this._zoomOut.touchstart(i,l,f)}touchmove(i,l,f){this._zoomIn.touchmove(i,l,f),this._zoomOut.touchmove(i,l,f)}touchend(i,l,f){const g=this._zoomIn.touchend(i,l,f),v=this._zoomOut.touchend(i,l,f);return g?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(g)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const up={0:1,2:2};class aa{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const f=rt(i);this._correctButton(i,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(i,l){const f=this._lastPoint;if(f){if(i.preventDefault(),this._eventButton!=null&&function(g,v){const E=up[v];return g.buttons===void 0||(g.buttons&E)!==E}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(i){this._lastPoint&&rt(i)===this._eventButton&&(this._moved&&Be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ph extends aa{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class zh extends aa{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const f=.8*(l.x-i.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(i){i.preventDefault()}}class Dh extends aa{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const f=-.5*(l.y-i.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(i){i.preventDefault()}}class Nc{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(i,l,f){return this._calculateTransform(i,l,f)}touchmove(i,l,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,f)}}touchend(i,l,f){this._calculateTransform(i,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,f){f.length>0&&(this._active=!0);const g=Fc(f,l),v=new a.Point(0,0),E=new a.Point(0,0);let T=0;for(const P in g){const I=g[P],R=this._touches[P];R&&(v._add(I),E._add(I.sub(R)),T++,g[P]=I)}if(this._touches=g,T<this._minTouches||!E.mag())return;const A=E.div(T);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(T),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Sl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,f){return{}}touchstart(i,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,f){const g=this._firstTwoTouches;if(!g)return;i.preventDefault();const[v,E]=g,T=Cl(f,l,v),A=Cl(f,l,E);if(!T||!A)return;const P=this._aroundCenter?null:T.add(A).div(2);return this._move([T,A],P,i)}touchend(i,l,f){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,E=Cl(f,l,g),T=Cl(f,l,v);E&&T||(this._active&&Be(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cl(h,i,l){for(let f=0;f<h.length;f++)if(h[f].identifier===l)return i[f]}function Lh(h,i){return Math.log(h/i)/Math.LN2}class hp extends Sl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Lh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lh(this._distance,f),pinchAround:l}}}function Rh(h,i){return 180*h.angleWith(i)/Math.PI}class dp extends Sl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const f=this._vector;if(this._vector=i[0].sub(i[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rh(this._vector,f),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const g=Rh(i,f);return Math.abs(g)<l}}function Oo(h){return Math.abs(h.y)>Math.abs(h.x)}class fp extends Sl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Oo(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,f){const g=this._lastPoints;if(!g)return;const v=i[0].sub(g[0]),E=i[1].sub(g[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,E,f.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(v.y+E.y)/2*-.5})}gestureBeginsVertically(i,l,f){if(this._valid!==void 0)return this._valid;const g=i.mag()>=2,v=l.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const E=i.y>0==l.y>0;return Oo(i)&&Oo(l)&&E}}const pp={panStep:100,bearingStep:15,pitchStep:10};class y_{constructor(){const i=pp;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,f=0,g=0,v=0,E=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),E=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(f=0,g=0),{cameraAnimation:T=>{const A=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:mp,zoom:l?Math.round(A)+l*(i.shiftKey?2:1):A,bearing:T.getBearing()+f*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:T.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function mp(h){return h*(2-h)}const Oh=4.000244140625;class gp{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=a.exported.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%Oh==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=$e(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Oh?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&P!==0&&(P=1/P);const I=l(),R=Math.pow(2,I),U=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):R;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(U*P))),this._type==="wheel"&&(this._startZoom=I,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l(),g=this._startZoom,v=this._easing;let E,T=!1;if(this._type==="wheel"&&g&&v){const A=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),P=v(A);E=a.number(g,f,P),A<1?this._frameId||(this._frameId=!0):T=!0}else E=f,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:E-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=a.ease;if(this._prevEase){const f=this._prevEase,g=(a.exported.now()-f.start)/f.duration,v=f.easing(g+.01)-f.easing(g),E=.27/Math.sqrt(v*v+1e-4)*.01,T=Math.sqrt(.0729-E*E);l=a.bezier(E,T,.25,1)}return this._prevEase={start:a.exported.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Y("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class _p{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Er{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(i.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class v_{constructor(){this._tap=new Ih({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,f){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(i,l,f))}touchmove(i,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const g=l[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,l,f)}touchend(i,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(i,l,f)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yp{constructor(i,l,f){this._el=i,this._mousePan=l,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class x_{constructor(i,l,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class w_{constructor(i,l,f,g){this._el=i,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ui=h=>h.zoom||h.drag||h.pitch||h.rotate;class vp extends a.Event{}class b_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const f=a.sub([],l,i);this.radius=a.length(f[2]<0?a.div([],f,this.constants):[f[0],f[1],0])}projectRay(i){a.div(i,i,this.constants),a.normalize(i,i),a.mul$1(i,i,this.constants);const l=a.scale$2([],i,this.radius);if(l[2]>0){const f=a.scale$2([],[0,0,1],a.dot(l,[0,0,1])),g=a.scale$2([],a.normalize([],[l[0],l[1],0]),this.radius),v=a.add([],l,a.scale$2([],a.sub([],a.add([],g,f),l),2));l[0]=v[0],l[1]=v[1]}return l}}function Ti(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Vi{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lp(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new b_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),a.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[g,v,E]of this._listeners)g.addEventListener(v,g===a.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[i,l,f]of this._listeners)i.removeEventListener(l,i===a.window.document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(i){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new kh(l,i));const g=l.boxZoom=new cp(l,i);this._add("boxZoom",g);const v=new __,E=new Er;l.doubleClickZoom=new _p(E,v),this._add("tapZoom",v),this._add("clickZoom",E);const T=new v_;this._add("tapDragZoom",T);const A=l.touchPitch=new fp(l);this._add("touchPitch",A);const P=new zh(i),I=new Dh(i);l.dragRotate=new x_(i,P,I),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const R=new Ph(i),U=new Nc(l,i);l.dragPan=new yp(f,R,U),this._add("mousePan",R),this._add("touchPan",U,["touchZoom","touchRotate"]);const q=new dp,X=new hp;l.touchZoomRotate=new w_(f,X,q,T),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bc(l));const W=l.scrollZoom=new gp(l,this);this._add("scrollZoom",W,["mousePan"]);const K=l.keyboard=new y_;this._add("keyboard",K);for(const O of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[O]&&l[O].enable(i[O])}_add(i,l,f){this._handlers.push({handlerName:i,handler:l,allowed:f}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ui(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,f){for(const g in i)if(g!==f&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const f of i)this._el.contains(f.target)&&l.push(f);return l}handleEvent(i,l){this._updatingCamera=!0;const f=i.type==="renderFrame",g=f?void 0:i,v={needsRenderFrame:!1},E={},T={},A=i.touches?this._getMapTouches(i.touches):void 0,P=A?ot(this._el,A):f?void 0:$e(this._el,i);for(const{handlerName:U,handler:q,allowed:X}of this._handlers){if(!q.isEnabled())continue;let W;this._blockedByActive(T,X,U)?q.reset():q[l||i.type]&&(W=q[l||i.type](i,P,A),this.mergeHandlerResult(v,E,W,U,g),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||q.isActive())&&(T[U]=q)}const I={};for(const U in this._previousActiveHandlers)T[U]||(I[U]=g);this._previousActiveHandlers=T,(Object.keys(I).length||Ti(v))&&(this._changes.push([v,E,I]),this._triggerRenderFrame()),(Object.keys(T).length||Ti(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=v;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(i,l,f,g,v){if(!f)return;a.extend(i,f);const E={handlerName:g,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(l.zoom=E),f.panDelta!==void 0&&(l.drag=E),f.pitchDelta!==void 0&&(l.pitch=E),f.bearingDelta!==void 0&&(l.rotate=E)}_applyChanges(){const i={},l={},f={};for(const[g,v,E]of this._changes)g.panDelta&&(i.panDelta=(i.panDelta||new a.Point(0,0))._add(g.panDelta)),g.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(i.around=g.around),g.aroundCoord!==void 0&&(i.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(i.pinchAround=g.pinchAround),g.noInertia&&(i.noInertia=g.noInertia),a.extend(l,v),a.extend(f,E);this._updateMapTransform(i,l,f),this._changes=[]}_updateMapTransform(i,l,f){const g=this._map,v=g.transform,E=G=>[G.x,G.y,G.z];if((G=>{const te=this._eventsInProgress.drag;return te&&!this._handlersById[te.handlerName].isActive()})()&&!Ti(i)){const G=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",G!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&g._stop(!0),!Ti(i))return void this._fireEvents(l,f,!0);let{panDelta:T,zoomDelta:A,bearingDelta:P,pitchDelta:I,around:R,aroundCoord:U,pinchAround:q}=i;v._isCameraConstrained&&(A>0&&(A=0),v._isCameraConstrained=!1),q!==void 0&&(R=q),(A||(G=>l[G]&&!this._eventsInProgress[G])("drag"))&&R&&(this._dragOrigin=E(v.pointCoordinate3D(R)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",g._stop(!0),R=R||g.transform.centerPoint,P&&(v.bearing+=P),I&&(v.pitch+=I),v._updateCameraState();const X=[0,0,0];if(T)if(v.projection.name==="mercator"){const G=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R).dir),te=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(R.sub(T)).dir);X[0]=te[0]-G[0],X[1]=te[1]-G[1]}else{const G=v.pointCoordinate(R);if(v.projection.name==="globe"){T=T.rotate(-v.angle);const te=v._pixelsPerMercatorPixel/v.worldSize;X[0]=-T.x*a.mercatorScale(a.latFromMercatorY(G.y))*te,X[1]=-T.y*a.mercatorScale(v.center.lat)*te}else{const te=v.pointCoordinate(R.sub(T));G&&te&&(X[0]=te.x-G.x,X[1]=te.y-G.y)}}const W=v.zoom,K=[0,0,0];if(A){const G=E(U||v.pointCoordinate3D(R)),te={dir:a.normalize([],a.sub([],G,v._camera.position))};if(te.dir[2]<0){const ne=v.zoomDeltaToMovement(G,A);a.scale$2(K,te.dir,ne)}}const O=a.add(X,X,K);v._translateCameraConstrained(O),A&&Math.abs(v.zoom-W)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,f,!0)}_fireEvents(i,l,f){const g=ui(this._eventsInProgress),v=ui(i),E={};for(const I in i){const{originalEvent:R}=i[I];this._eventsInProgress[I]||(E[`${I}start`]=R),this._eventsInProgress[I]=i[I]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const I in E)this._fireEvent(I,E[I]);v&&this._fireEvent("move",v.originalEvent);for(const I in i){const{originalEvent:R}=i[I];this._fireEvent(I,R)}const T={};let A;for(const I in this._eventsInProgress){const{handlerName:R,originalEvent:U}=this._eventsInProgress[I];this._handlersById[R].isActive()||(delete this._eventsInProgress[I],A=l[R]||U,T[`${I}end`]=A)}for(const I in T)this._fireEvent(I,T[I]);const P=ui(this._eventsInProgress);if(f&&(g||v)&&!P){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;I?(R(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:A})):(this._map.fire(new a.Event("moveend",{originalEvent:A})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new a.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new vp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jc extends a.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,f){return i=a.Point.convert(i).mult(-1),this.panTo(this.transform.center,a.extend({offset:i},l),f)}panTo(i,l,f){return this.easeTo(a.extend({center:i},l),f)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,f){return this.easeTo(a.extend({zoom:i},l),f)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,f){return this.easeTo(a.extend({bearing:i},l),f)}resetNorth(i,l){return this.rotateTo(0,a.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=a.LngLatBounds.convert(i);const f=l&&l.bearing||0,g=l&&l.pitch||0,v=i.getNorthWest(),E=i.getSouthEast();return this._cameraForBounds(this.transform,v,E,f,g,l)}_extendCameraOptions(i){const l={top:0,bottom:0,right:0,left:0};if(typeof(i=a.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=="number"){const f=i.padding;i.padding={top:f,bottom:f,right:f,left:f}}return i.padding=a.extend(l,i.padding),i}_minimumAABBFrustumDistance(i,l){const f=l.max[0]-l.min[0],g=l.max[1]-l.min[1];return f/g>i.aspect?f/(2*Math.tan(.5*i.fovX)*i.aspect):g/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,f,g,v,E){const T=i.clone(),A=this._extendCameraOptions(E);T.bearing=g,T.pitch=v;const P=a.LngLat.convert(l),I=a.LngLat.convert(f),R=.5*(P.lat+I.lat),U=.5*(P.lng+I.lng),q=a.latLngToECEF(R,U),X=a.normalize([],q),W=a.normalize([],a.cross([],X,[0,1,0])),K=a.cross([],W,X),O=[W[0],W[1],W[2],0,K[0],K[1],K[2],0,X[0],X[1],X[2],0,0,0,0,1],G=[q,a.latLngToECEF(P.lat,P.lng),a.latLngToECEF(I.lat,P.lng),a.latLngToECEF(I.lat,I.lng),a.latLngToECEF(P.lat,I.lng),a.latLngToECEF(R,P.lng),a.latLngToECEF(R,I.lng),a.latLngToECEF(P.lat,U),a.latLngToECEF(I.lat,U)];let te=a.Aabb.fromPoints(G.map(Ge=>[a.dot(W,Ge),a.dot(K,Ge),a.dot(X,Ge)]));const ne=a.transformMat4([],te.center,O);a.squaredLength(ne)===0&&a.set(ne,0,0,1),a.normalize(ne,ne),a.scale$2(ne,ne,a.GLOBE_RADIUS),T.center=a.ecefToLatLng(ne);const pe=T.getWorldToCameraMatrix(),ge=a.invert(new Float64Array(16),pe);te=a.Aabb.applyTransform(te,a.multiply([],pe,O)),a.transformMat4(ne,ne,pe);const me=.5*(te.max[2]-te.min[2]),we=this._minimumAABBFrustumDistance(T,te),xe=a.scale$2([],[0,0,1],me),Ae=a.add(xe,ne,xe),Xe=we+(T.pitch===0?0:a.distance(ne,Ae)),Te=T.globeCenterInViewSpace,Ne=a.sub([],ne,[Te[0],Te[1],Te[2]]);a.normalize(Ne,Ne),a.scale$2(Ne,Ne,Xe);const ke=a.add([],ne,Ne);a.transformMat4(ke,ke,ge);const We=a.earthRadius/a.GLOBE_RADIUS,Ce=a.length(ke),Fe=a.mercatorZfromAltitude(Math.max(Ce*We-a.earthRadius,Number.EPSILON),0),Ye=Math.min(T.zoomFromMercatorZAdjusted(Fe),A.maxZoom);return Ye>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"mercator"}),T.zoom=Ye,this._cameraForBounds(T,l,f,g,v,E)):{center:T.center,zoom:Ye,bearing:g,pitch:v}}queryTerrainElevation(i,l){const f=this.transform.elevation;return f?(l=a.extend({},{exaggerated:!0},l),f.getAtPoint(a.MercatorCoordinate.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,f,g,v,E){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,l,f,g,v,E);const T=i.clone(),A=this._extendCameraOptions(E),P=T.padding;T.bearing=g,T.pitch=v;const I=a.LngLat.convert(l),R=a.LngLat.convert(f),U=new a.LngLat(I.lng,R.lat),q=new a.LngLat(R.lng,I.lat),X=T.project(I),W=T.project(R),K=this.queryTerrainElevation(I),O=this.queryTerrainElevation(R),G=this.queryTerrainElevation(U),te=this.queryTerrainElevation(q),ne=[[X.x,X.y,Math.min(K||0,O||0,G||0,te||0)],[W.x,W.y,Math.max(K||0,O||0,G||0,te||0)]];let pe=a.Aabb.fromPoints(ne);const ge=T.getWorldToCameraMatrix(),me=a.invert(new Float64Array(16),ge);pe=a.Aabb.applyTransform(pe,ge);const we=a.sub([],pe.max,pe.min),xe=P.left||0,Ae=P.right||0,Xe=P.bottom||0,Te=P.top||0,{left:Ne,right:ke,top:We,bottom:Ce}=A.padding,Fe=.5*(xe+Ae),Ye=.5*(Te+Xe),Ge=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(xe+Ae+Ne+ke))/we[0],(T.height-(Xe+Te+Ce+We))/we[1])),A.maxZoom),Qe=T.scale/T.zoomScale(Ge);pe=new a.Aabb([pe.min[0]-(Ne+Fe)*Qe,pe.min[1]-(Ce+Ye)*Qe,pe.min[2]],[pe.max[0]+(ke+Fe)*Qe,pe.max[1]+(We+Ye)*Qe,pe.max[2]]);const yt=.5*we[2],kt=this._minimumAABBFrustumDistance(T,pe),pt=[0,0,1,0];a.transformMat4$1(pt,pt,ge),a.normalize$2(pt,pt);const Et=a.scale$2([],pt,kt+yt),$t=a.add([],pe.center,Et),jt=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new a.Point(A.offset.x,A.offset.y):a.Point.convert(A.offset)).rotate(-a.degToRad(g));pe.center[0]-=jt.x*Qe,pe.center[1]+=jt.y*Qe,a.transformMat4(pe.center,pe.center,me),a.transformMat4($t,$t,me);const gt=[pe.center[0],pe.center[1],$t[2]*T.pixelsPerMeter];a.scale$2(gt,gt,1/T.worldSize);const on=a.lngFromMercatorX(gt[0]),cn=a.latFromMercatorY(gt[1]),un=Math.min(T._zoomFromMercatorZ(gt[2]),A.maxZoom),hn=new a.LngLat(on,cn);return T.mercatorFromTransition&&un<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"globe"}),T.zoom=un,this._cameraForBounds(T,l,f,g,v,E)):{center:hn,zoom:un,bearing:g,pitch:v}}fitBounds(i,l,f){const g=this.cameraForBounds(i,l);return this._fitInternal(g,l,f)}fitScreenCoordinates(i,l,f,g,v){const E=a.Point.convert(i),T=a.Point.convert(l),A=new a.Point(Math.min(E.x,T.x),Math.min(E.y,T.y)),P=new a.Point(Math.max(E.x,T.x),Math.max(E.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,T))return this;const I=this.transform.pointLocation3D(A),R=this.transform.pointLocation3D(P),U=this.transform.pointLocation3D(new a.Point(A.x,P.y)),q=this.transform.pointLocation3D(new a.Point(P.x,A.y)),X=[Math.min(I.lng,R.lng,U.lng,q.lng),Math.min(I.lat,R.lat,U.lat,q.lat)],W=[Math.max(I.lng,R.lng,U.lng,q.lng),Math.max(I.lat,R.lat,U.lat,q.lat)],K=g&&g.pitch?g.pitch:this.getPitch(),O=this._cameraForBounds(this.transform,X,W,f,K,g);return this._fitInternal(O,g,v)}_fitInternal(i,l,f){return i?(delete(l=a.extend(i,l)).padding,l.linear?this.easeTo(l,f):this.flyTo(l,f)):this}jumpTo(i,l){this.stop();const f=i.preloadOnly?this.transform.clone():this.transform;let g=!1,v=!1,E=!1;return"zoom"in i&&f.zoom!==+i.zoom&&(g=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=a.LngLat.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(v=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(E=!0,f.pitch=+i.pitch),i.padding==null||f.isPaddingEqual(i.padding)||(f.padding=i.padding),i.preloadOnly?(this._preloadTiles(f),this):(this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),g&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),v&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),E&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(fs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const f=this.transform;if(!f.projection.supportsFreeCamera)return a.warnOnce(fs),this;this.stop();const g=f.zoom,v=f.pitch,E=f.bearing;f.setFreeCameraOptions(i);const T=g!==f.zoom,A=v!==f.pitch,P=E!==f.bearing;return this.fire(new a.Event("movestart",l)).fire(new a.Event("move",l)),T&&this.fire(new a.Event("zoomstart",l)).fire(new a.Event("zoom",l)).fire(new a.Event("zoomend",l)),P&&this.fire(new a.Event("rotatestart",l)).fire(new a.Event("rotate",l)).fire(new a.Event("rotateend",l)),A&&this.fire(new a.Event("pitchstart",l)).fire(new a.Event("pitch",l)).fire(new a.Event("pitchend",l)),this.fire(new a.Event("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=a.extend({offset:[0,0],duration:500,easing:a.ease},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const f=this.transform,g=this.getZoom(),v=this.getBearing(),E=this.getPitch(),T=this.getPadding(),A="zoom"in i?+i.zoom:g,P="bearing"in i?this._normalizeBearing(i.bearing,v):v,I="pitch"in i?+i.pitch:E,R="padding"in i?i.padding:f.padding,U=a.Point.convert(i.offset);let q,X,W;if(f.projection.name==="globe"){const xe=a.MercatorCoordinate.fromLngLat(f.center),Ae=U.rotate(-f.angle);xe.x+=Ae.x/f.worldSize,xe.y+=Ae.y/f.worldSize;const Xe=xe.toLngLat(),Te=a.LngLat.convert(i.center||Xe);this._normalizeCenter(Te),q=f.centerPoint.add(Ae),X=new a.Point(xe.x,xe.y).mult(f.worldSize),W=new a.Point(a.mercatorXfromLng(Te.lng),a.mercatorYfromLat(Te.lat)).mult(f.worldSize).sub(X)}else{q=f.centerPoint.add(U);const xe=f.pointLocation(q),Ae=a.LngLat.convert(i.center||xe);this._normalizeCenter(Ae),X=f.project(xe),W=f.project(Ae).sub(X)}const K=f.zoomScale(A-g);let O,G;i.around&&(O=a.LngLat.convert(i.around),G=f.locationPoint(O));const te=this._zooming||A!==g,ne=this._rotating||v!==P,pe=this._pitching||I!==E,ge=!f.isPaddingEqual(R),me=xe=>Ae=>{if(te&&(xe.zoom=a.number(g,A,Ae)),ne&&(xe.bearing=a.number(v,P,Ae)),pe&&(xe.pitch=a.number(E,I,Ae)),ge&&(xe.interpolatePadding(T,R,Ae),q=xe.centerPoint.add(U)),O)xe.setLocationAtPoint(O,G);else{const Xe=xe.zoomScale(xe.zoom-g),Te=A>g?Math.min(2,K):Math.max(.5,K),Ne=Math.pow(Te,1-Ae),ke=xe.unproject(X.add(W.mult(Ae*Ne)).mult(Xe));xe.setLocationAtPoint(xe.renderWorldCopies?ke.wrap():ke,q)}return i.preloadOnly||this._fireMoveEvents(l),xe};if(i.preloadOnly){const xe=this._emulate(me,i.duration,f);return this._preloadTiles(xe),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=te,this._rotating=ne,this._pitching=pe,this._padding=ge,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,we),this._ease(me(f),xe=>{f.recenterOnTerrain(),this._afterEase(l,xe)},i),this}_prepareEase(i,l,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||f.moving||this.fire(new a.Event("movestart",i)),this._zooming&&!f.zooming&&this.fire(new a.Event("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new a.Event("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new a.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new a.Event("move",i)),this._zooming&&this.fire(new a.Event("zoom",i)),this._rotating&&this.fire(new a.Event("rotate",i)),this._pitching&&this.fire(new a.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new a.Event("zoomend",i)),g&&this.fire(new a.Event("rotateend",i)),v&&this.fire(new a.Event("pitchend",i)),this.fire(new a.Event("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){const Ge=a.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,l)}this.stop(),i=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},i);const f=this.transform,g=this.getZoom(),v=this.getBearing(),E=this.getPitch(),T=this.getPadding(),A="zoom"in i?a.clamp(+i.zoom,f.minZoom,f.maxZoom):g,P="bearing"in i?this._normalizeBearing(i.bearing,v):v,I="pitch"in i?+i.pitch:E,R="padding"in i?i.padding:f.padding,U=f.zoomScale(A-g),q=a.Point.convert(i.offset);let X=f.centerPoint.add(q);const W=f.pointLocation(X),K=a.LngLat.convert(i.center||W);this._normalizeCenter(K);const O=f.project(W),G=f.project(K).sub(O);let te=i.curve;const ne=Math.max(f.width,f.height),pe=ne/U,ge=G.mag();if("minZoom"in i){const Ge=a.clamp(Math.min(i.minZoom,g,A),f.minZoom,f.maxZoom),Qe=ne/f.zoomScale(Ge-g);te=Math.sqrt(Qe/ge*2)}const me=te*te;function we(Ge){const Qe=(pe*pe-ne*ne+(Ge?-1:1)*me*me*ge*ge)/(2*(Ge?pe:ne)*me*ge);return Math.log(Math.sqrt(Qe*Qe+1)-Qe)}function xe(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ae(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Xe=we(0);let Te=function(Ge){return Ae(Xe)/Ae(Xe+te*Ge)},Ne=function(Ge){return ne*((Ae(Xe)*(xe(Qe=Xe+te*Ge)/Ae(Qe))-xe(Xe))/me)/ge;var Qe},ke=(we(1)-Xe)/te;if(Math.abs(ge)<1e-6||!isFinite(ke)){if(Math.abs(ne-pe)<1e-6)return this.easeTo(i,l);const Ge=pe<ne?-1:1;ke=Math.abs(Math.log(pe/ne))/te,Ne=function(){return 0},Te=function(Qe){return Math.exp(Ge*te*Qe)}}i.duration="duration"in i?+i.duration:1e3*ke/("screenSpeed"in i?+i.screenSpeed/te:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const We=v!==P,Ce=I!==E,Fe=!f.isPaddingEqual(R),Ye=Ge=>Qe=>{const yt=Qe*ke,kt=1/Te(yt);Ge.zoom=Qe===1?A:g+Ge.scaleZoom(kt),We&&(Ge.bearing=a.number(v,P,Qe)),Ce&&(Ge.pitch=a.number(E,I,Qe)),Fe&&(Ge.interpolatePadding(T,R,Qe),X=Ge.centerPoint.add(q));const pt=Qe===1?K:Ge.unproject(O.add(G.mult(Ne(yt))).mult(kt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?pt.wrap():pt,X),Ge._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),Ge};if(i.preloadOnly){const Ge=this._emulate(Ye,i.duration,f);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=We,this._pitching=Ce,this._padding=Fe,this._prepareEase(l,!1),this._ease(Ye(f),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,l)}if(!i){const f=this.handlers;f&&f.stop(!1)}return this}_ease(i,l,f){f.animate===!1||f.duration===0?(i(1),l()):(this._easeStart=a.exported.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=a.wrap(i,-180,180);const f=Math.abs(i-l);return Math.abs(i-360-l)<f&&(i-=360),Math.abs(i+360-l)<f&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const f=i.lng-l.center.lng;i.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,f){const g=Math.ceil(15*l/1e3),v=[],E=i(f.clone());for(let T=0;T<=g;T++){const A=E(T/g);v.push(A.clone())}return v}}class ft{constructor(i={}){this.options=i,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact;return this._map=i,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Y("button","mapboxgl-ctrl-attrib-button",this._container),Y("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Y("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const f=this._map._getUIString(`AttributionControl.${l}`);i.setAttribute("aria-label",f),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",f)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(i){const f=l.reduce((g,v,E)=>(v.value&&(g+=`${v.key}=${v.value}${E<l.length-1?"&":""}`),g),"?");i.href=`${a.config.FEEDBACK_URL}/${f}#${xl(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style._sourceCaches;for(const g in l){const v=l[g];if(v.used){const E=v.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i.sort((g,v)=>g.length-v.length),i=i.filter((g,v)=>{for(let E=v+1;E<i.length;E++)if(i[E].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bh{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Y("div","mapboxgl-ctrl");const l=Y("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const l in i){const f=i[l].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Fh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const g of f)if(g.id===i)return void(g.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function la(h,i,l){if(h=new a.LngLat(h.lng,h.lat),i){const f=new a.LngLat(h.lng-360,h.lat),g=new a.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),E=l.locationPoint(h).distSqr(i),T=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(f).distSqr(i)<E&&(T||Math.abs(f.lng-l.center.lng)<v)?h=f:l.locationPoint(g).distSqr(i)<E&&(T||Math.abs(g.lng-l.center.lng)<v)&&(h=g)}for(;Math.abs(h.lng-l.center.lng)>180;){const f=l.locationPoint(h);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ut extends a.Evented{constructor(i,l){if(super(),(i instanceof a.window.HTMLElement||l)&&(i=a.extend({element:i},l)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=a.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Y("div");const g=41,v=27,E=ie("svg",{display:"block",height:g*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${g}`},this._element),T=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},E));ie("stop",{offset:"10%","stop-opacity":.4},T),ie("stop",{offset:"100%","stop-opacity":.05},T),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=a.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const f=this._element.classList;for(const g in ps)f.remove(`mapboxgl-marker-anchor-${g}`);f.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=a.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,f=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,l=this._pos;if(!i||!l)return!1;const f=i.unproject(l),g=i.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const f=i.unproject(l);let g;i._showingGlobe()&&a.isLngLatBehindGlobe(i.transform,this._lngLat)?g=0:(g=1-i._queryFogOpacity(f),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${ps[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const i=this._pos,l=this._map,f=this.getPitchAlignment();if(!l||!i||f!=="map")return"";if(!l._showingGlobe()){const A=l.getPitch();return A?`rotateX(${A}deg)`:""}const g=a.radToDeg(a.globeTiltAtLngLat(l.transform,this._lngLat)),v=i.sub(a.globeCenterToScreenPoint(l.transform)),E=Math.abs(v.x)+Math.abs(v.y);if(E===0)return"";const T=g/E;return`rotateX(${-v.y*T}deg) rotateY(${v.x*T}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let f=0;const g=this.getRotationAlignment();if(g==="map")if(l._showingGlobe()){const v=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),E=l.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);f=a.radToDeg(Math.atan2(E.y,E.x))-90}else f=-l.getBearing();else if(g==="horizon"){const v=a.smoothstep(4,6,l.getZoom()),E=a.globeCenterToScreenPoint(l.transform);E.y+=v*l.transform.height;const T=i.sub(E),A=a.radToDeg(Math.atan2(T.y,T.x));f=(A>90?A-270:A+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(i){a.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=la(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),i===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=a.Point.convert(i),this._update(),this}_onMove(i){const l=this._map;if(!l)return;const f=this._pointerdownPos,g=this._positionDelta;if(f&&g){if(!this._isDragging){const v=this._clickTolerance||l._clickTolerance;if(i.point.dist(f)<v)return;this._isDragging=!0}this._pos=i.point.sub(g),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map,f=this._pos;l&&f&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(f),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Nh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},E_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xp(h=new a.Point(0,0),i="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(i){case"top":return new a.Point(0,h);case"top-left":return new a.Point(l,l);case"top-right":return new a.Point(-l,l);case"bottom":return new a.Point(0,-h);case"bottom-left":return new a.Point(l,-l);case"bottom-right":return new a.Point(-l,-l);case"left":return new a.Point(h,0);case"right":return new a.Point(-h,0)}return new a.Point(0,0)}return h instanceof a.Point||Array.isArray(h)?a.Point.convert(h):a.Point.convert(h[i]||[0,0])}class jh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=a.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,f){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+f}}const wp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},bp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},T_={showCompass:!0,showZoom:!0,visualizePitch:!1};class S_{constructor(i,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new zh({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,f&&(this.mousePitch=new Dh({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),le()}move(i,l){const f=this.map,g=this.mouseRotate.mousemoveWindow(i,l),v=g&&g.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const E=this.mousePitch.mousemoveWindow(i,l),T=E&&E.pitchDelta;T&&f.setPitch(f.getPitch()+T)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ee(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(a.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),$e(this.element,i)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,$e(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ot(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=ot(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Uh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Vh={maxWidth:100,unit:"metric"},$h={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ca={version:a.version,supported:F,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends jc{constructor(h){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(h=a.extend({},bp,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(h.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ia(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Fh,this._domRenderTaskQueue=new Fh,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},wp,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=a.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Vi(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new Mh(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,a.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new ft({customAttribution:h.customAttribution})),this._logoControl=new Bh,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update(i.dataType==="style"),this.fire(new a.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new a.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(h,i){if(i===void 0&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new a.Event("movestart",h)).fire(new a.Event("move",h)),this.fire(new a.Event("resize",h)),i&&this.fire(new a.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(a.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?a.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(i=>i==="auto"?a.window.navigator.language:i):h}setLanguage(h){const i=this._parseLanguage(h);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,i=h.projection.name;let l;i==="globe"&&h.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):i==="mercator"&&h.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,i){return this._updateProjection(h||i||{name:"mercator"})}_updateProjection(h){let i;if(i=h.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(a.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(a.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,i,l){if(h==="mouseenter"||h==="mouseover"){let f=!1;const g=E=>{const T=i.filter(P=>this.getLayer(P)),A=T.length?this.queryRenderedFeatures(E.point,{layers:T}):[];A.length?f||(f=!0,l.call(this,new ar(h,this,E.originalEvent,{features:A}))):f=!1},v=()=>{f=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:g,mouseout:v}}}if(h==="mouseleave"||h==="mouseout"){let f=!1;const g=E=>{const T=i.filter(A=>this.getLayer(A));(T.length?this.queryRenderedFeatures(E.point,{layers:T}):[]).length?f=!0:f&&(f=!1,l.call(this,new ar(h,this,E.originalEvent)))},v=E=>{f&&(f=!1,l.call(this,new ar(h,this,E.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:g,mouseout:v}}}{const f=g=>{const v=i.filter(T=>this.getLayer(T)),E=v.length?this.queryRenderedFeatures(g.point,{layers:v}):[];E.length&&(g.features=E,l.call(this,g),delete g.features)};return{layers:new Set(i),listener:l,delegates:{[h]:f}}}}on(h,i,l){if(l===void 0)return super.on(h,i);Array.isArray(i)||(i=[i]);const f=this._createDelegatedListener(h,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(f);for(const g in f.delegates)this.on(g,f.delegates[g]);return this}once(h,i,l){if(l===void 0)return super.once(h,i);Array.isArray(i)||(i=[i]);const f=this._createDelegatedListener(h,i,l);for(const g in f.delegates)this.once(g,f.delegates[g]);return this}off(h,i,l){if(l===void 0)return super.off(h,i);i=new Set(Array.isArray(i)?i:[i]);const f=(v,E)=>{if(v.size!==E.size)return!1;for(const T of v)if(!E.has(T))return!1;return!0},g=this._delegatedListeners?this._delegatedListeners[h]:void 0;return g&&(v=>{for(let E=0;E<v.length;E++){const T=v[E];if(T.listener===l&&f(T.layers,i)){for(const A in T.delegates)this.off(A,T.delegates[A]);return v.splice(E,1),this}}})(g),this}queryRenderedFeatures(h,i){return this.style?(i!==void 0||h===void 0||h instanceof a.Point||Array.isArray(h)||(i=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(h,i){return this.style.querySourceFeatures(h,i)}isPointOnSurface(h){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&a.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(h))}setStyle(h,i){return(i=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(i==null)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new ji(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,i){if(typeof h=="string"){const l=this._requestManager.normalizeStyleURL(h),f=this._requestManager.transformRequest(l,a.ResourceType.Style);a.getJSON(f,(g,v)=>{g?this.fire(new a.ErrorEvent(g)):v&&this._updateDiff(v,i)})}else typeof h=="object"&&this._updateDiff(h,i)}_updateDiff(h,i){try{this.style.setState(h)&&this._update(!0)}catch(l){a.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(h,i){return this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const i in h){const l=h[i]._tiles;for(const f in l){const g=l[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}addSourceType(h,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,i,{pixelRatio:l=1,sdf:f=!1,stretchX:g,stretchY:v,content:E}={}){if(this._lazyInitEmptyStyle(),i instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&i instanceof a.window.ImageBitmap){const{width:T,height:A,data:P}=a.exported.getImageData(i);this.style.addImage(h,{data:new a.RGBAImage({width:T,height:A},P),pixelRatio:l,stretchX:g,stretchY:v,content:E,sdf:f,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:A}=i,P=i;this.style.addImage(h,{data:new a.RGBAImage({width:T,height:A},new Uint8Array(P.data)),pixelRatio:l,stretchX:g,stretchY:v,content:E,sdf:f,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}updateImage(h,i){const l=this.style.getImage(h);if(!l)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&i instanceof a.window.ImageBitmap?a.exported.getImageData(i):i,{width:g,height:v}=f;g!==void 0&&v!==void 0?g===l.data.width&&v===l.data.height?(l.data.replace(f.data,!(i instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&i instanceof a.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${g}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){a.getImage(this._requestManager.transformRequest(h,a.ResourceType.Image),(l,f)=>{i(l,f instanceof a.window.HTMLImageElement?a.exported.getImageData(f):f)})}listImages(){return this.style.listImages()}addLayer(h,i){return this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)}moveLayer(h,i){return this.style.moveLayer(h,i),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,i,l){return this.style.setLayerZoomRange(h,i,l),this._update(!0)}setFilter(h,i,l={}){return this.style.setFilter(h,i,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,i,l,f={}){return this.style.setPaintProperty(h,i,l,f),this._update(!0)}getPaintProperty(h,i){return this.style.getPaintProperty(h,i)}setLayoutProperty(h,i,l,f={}){return this.style.setLayoutProperty(h,i,l,f),this._update(!0)}getLayoutProperty(h,i){return this.style.getLayoutProperty(h,i)}setLight(h,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(h),this.transform):0}setFeatureState(h,i){return this.style.setFeatureState(h,i),this._update()}removeFeatureState(h,i){return this.style.removeFeatureState(h,i),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,f,g,v=this._container;for(;v&&(!f||!g);){const E=a.window.getComputedStyle(v).transform;E&&E!=="none"&&(l=E.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(f=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(g=l[3])),v=v.parentElement}this._containerWidth=f?Math.abs(h/f):h,this._containerHeight=g?Math.abs(i/g):i}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Y("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Y("div","mapboxgl-canvas-container",h);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Y("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Y("div","mapboxgl-control-container",h),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{f[g]=Y("div",`mapboxgl-ctrl-${g}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const l=a.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);i!==-1&&this._markers.splice(i,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const i=this._popups.indexOf(h);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const h=a.extend({},F.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",h),l=i||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);l?(this._useWebGL2&&!i&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(l,!0),this.painter=new na(l,this.transform,!!i),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(l)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;const l=this.painter.context.extTimerQuery,f=a.exported.now();if(this.listens("gpu-timing-frame")&&(i=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,A=this.transform.pitch,P=a.exported.now(),I=new a.EvaluationParameters(T,{now:P,fadeDuration:g,pitch:A,transition:this.style.getTransition()});this.style.update(I)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(f),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(f),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const T=a.exported.now()-f;l.endQueryEXT(l.TIME_ELAPSED_EXT,i),setTimeout(()=>{const A=l.getQueryObjectEXT(i,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(i),this.fire(new a.Event("gpu-timing-frame",{cpuTime:T,gpuTime:A})),a.window.performance.mark("frame-gpu",{startTime:f,detail:{gpuTime:A}})},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(T);this.fire(new a.Event("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const A=this.painter.queryGpuTimeDeferredRender(T);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:A}))},50)}const E=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(E||this._repaint)this.triggerRepaint();else{const T=!this.isMoving()&&this.loaded();if(T&&(v=this._updateAverageElevation(f,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const A=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const i of this._markers)h&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!h||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(h,i=!1){const l=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);if((i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const f=this.transform.averageElevation;let g=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const E=Math.abs(f-g);if(E>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(g),l(g);this._averageElevation.easeTo(g,h,300)}else if(E>1e-4)return this._averageElevation.jumpTo(g),l(g)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===a.AUTH_ERR_MSG||h.status===401)){const i=this.painter.context.gl;a.storeAuthState(i,!1),this._logoControl instanceof Bh&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,f=l.createFramebuffer();function g(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);const E=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,E),E}return l.bindFramebuffer(l.FRAMEBUFFER,f),this._canvasPixelComparison(g(h),i.canvasCopies.map(g),i.timeStamps)}_canvasPixelComparison(h,i,l){let f=l[1]-l[0];const g=h.length/4;for(let v=0;v<i.length;v++){const E=i[v];let T=0;for(let A=0;A<E.length;A+=4)E[A]===h[A]&&E[A+1]===h[A+1]&&E[A+2]===h[A+2]&&E[A+3]===h[A+3]&&(T+=1);f+=(l[v+2]-l[v+1])*(1-T/g)}return f}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=a.exported.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(h){const i=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(i,(l,f)=>l._preloadTiles(h,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,i){a.setCacheLimits(h,i)}get version(){return a.version}},NavigationControl:class{constructor(h){this.options=a.extend({},T_,h),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Y("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=Y("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const i=h.getZoom(),l=i===h.getMaxZoom(),f=i===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new S_(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,i){const l=Y("button",h,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(h,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends a.Evented{constructor(h){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},Uh,h),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(l=>i(l.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),l=h.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",h)),this._finish()}}_updateCamera(h){const i=new a.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,f=this._map.getBearing(),g=a.extend({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),g,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new a.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,i=a.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Y("button","mapboxgl-ctrl-geolocate",this._container),Y("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Y("div","mapboxgl-user-location"),this._dotElement.appendChild(Y("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Y("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ut({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Y("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ut({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ft,ScaleControl:class{constructor(h){this.options=a.extend({},Vh,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,f=i._containerWidth/2-h/2,g=i.unproject([f,l]),v=i.unproject([f+h,l]),E=g.distanceTo(v);if(this.options.unit==="imperial"){const T=3.2808*E;T>5280?this._setScale(h,T/5280,"mile"):this._setScale(h,T,"foot")}else this.options.unit==="nautical"?this._setScale(h,E/1852,"nautical-mile"):E>=1e3?this._setScale(h,E/1e3,"kilometer"):this._setScale(h,E,"meter")}_setScale(h,i,l){this._map._requestDomTask(()=>{const f=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let T=v/E;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(A){const P=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*P)/P}(T),E*T}(i),g=f/i;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(f):`${f}&nbsp;${$h[l]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Y("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof a.window.HTMLElement?this._container=h.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Y("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Y("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Y("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(h){super(),this.options=a.extend(Object.create(Nh),h),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=a.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(a.window.document.createTextNode(h))}setHTML(h){const i=a.window.document.createDocumentFragment(),l=a.window.document.createElement("body");let f;for(l.innerHTML=h;f=l.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Y("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(h),this.options.closeButton){const l=this._closeButton=Y("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._updateClassList(),i}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,f=this._pos;if(!i||!l||!f)return"bottom";const g=l.offsetWidth,v=l.offsetHeight,E=f.x<g/2,T=f.x>i.transform.width-g/2;if(f.y+h<v)return E?"top-left":T?"top-right":"top";if(f.y>i.transform.height-v){if(E)return"bottom-left";if(T)return"bottom-right"}return E?"left":T?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),h.className=i.join(" ")}_update(h){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let f=this._container;if(f||(f=this._container=Y("div","mapboxgl-popup",i.getContainer()),this._tip=Y("div","mapboxgl-popup-tip",f),f.appendChild(l)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=la(this._lngLat,this._pos,i.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h?h:i.project(this._lngLat),v=xp(this.options.offset),E=this._anchor=this._getAnchor(v.y),T=xp(this.options.offset,E),A=g.add(T).round();i._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${ps[E]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&i._showingGlobe()){const g=a.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(E_);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:ut,Style:ji,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:op,Evented:a.Evented,config:a.config,prewarm:function(){qs().acquire(Bi)},clearPrewarmedResources:function(){const h=Ir;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Bi),Ir=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(h){a.config.ACCESS_TOKEN=h},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(h){a.config.API_URL=h},get workerCount(){return or.workerCount},set workerCount(h){or.workerCount=h},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){a.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){a.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return ca});var C=y;return C})})(sC);var iD=sC.exports;const Tm=Rv(iD);var oD={exports:{}};(function(t){(function(o,u,p){t.exports?t.exports=p():u[o]=p()})("h337",BE,function(){var o={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}},u=function(){var F=function(Y){this._coordinator={},this._data=[],this._radi=[],this._min=10,this._max=1,this._xField=Y.xField||Y.defaultXField,this._yField=Y.yField||Y.defaultYField,this._valueField=Y.valueField||Y.defaultValueField,Y.radius&&(this._cfgRadius=Y.radius)},H=o.defaultRadius;return F.prototype={_organiseData:function(Z,Y){var ie=Z[this._xField],ce=Z[this._yField],_e=this._radi,ze=this._data,le=this._max,ee=this._min,ue=Z[this._valueField]||1,Be=Z.radius||this._cfgRadius||H;ze[ie]||(ze[ie]=[],_e[ie]=[]),ze[ie][ce]?ze[ie][ce]+=ue:(ze[ie][ce]=ue,_e[ie][ce]=Be);var $e=ze[ie][ce];return $e>le?(Y?this.setDataMax($e):this._max=$e,!1):$e<ee?(Y?this.setDataMin($e):this._min=$e,!1):{x:ie,y:ce,value:ue,radius:Be,min:ee,max:le}},_unOrganizeData:function(){var Z=[],Y=this._data,ie=this._radi;for(var ce in Y)for(var _e in Y[ce])Z.push({x:ce,y:_e,radius:ie[ce][_e],value:Y[ce][_e]});return{min:this._min,max:this._max,data:Z}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0)for(var Z=arguments[0],Y=Z.length;Y--;)this.addData.call(this,Z[Y]);else{var ie=this._organiseData(arguments[0],!0);ie&&(this._data.length===0&&(this._min=this._max=ie.value),this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[ie]}))}return this},setData:function(Z){var Y=Z.data,ie=Y.length;this._data=[],this._radi=[];for(var ce=0;ce<ie;ce++)this._organiseData(Y[ce],!1);return this._max=Z.max,this._min=Z.min||0,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},removeData:function(){},setDataMax:function(Z){return this._max=Z,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setDataMin:function(Z){return this._min=Z,this._onExtremaChange(),this._coordinator.emit("renderall",this._getInternalData()),this},setCoordinator:function(Z){this._coordinator=Z},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}},F}(),p=function(){var F=function(ie){var ce=ie.gradient||ie.defaultGradient,_e=document.createElement("canvas"),ze=_e.getContext("2d");_e.width=256,_e.height=1;var le=ze.createLinearGradient(0,0,256,1);for(var ee in ce)le.addColorStop(ee,ce[ee]);return ze.fillStyle=le,ze.fillRect(0,0,256,1),ze.getImageData(0,0,256,1).data},H=function(ie,ce){var _e=document.createElement("canvas"),ze=_e.getContext("2d"),le=ie,ee=ie;if(_e.width=_e.height=ie*2,ce==1)ze.beginPath(),ze.arc(le,ee,ie,0,2*Math.PI,!1),ze.fillStyle="rgba(0,0,0,1)",ze.fill();else{var ue=ze.createRadialGradient(le,ee,ie*ce,le,ee,ie);ue.addColorStop(0,"rgba(0,0,0,1)"),ue.addColorStop(1,"rgba(0,0,0,0)"),ze.fillStyle=ue,ze.fillRect(0,0,2*ie,2*ie)}return _e},Z=function(ee){for(var ce=[],_e=ee.min,ze=ee.max,le=ee.radi,ee=ee.data,ue=Object.keys(ee),Be=ue.length;Be--;)for(var $e=ue[Be],ot=Object.keys(ee[$e]),rt=ot.length;rt--;){var Je=ot[rt],De=ee[$e][Je],_t=le[$e][Je];ce.push({x:$e,y:Je,value:De,radius:_t})}return{min:_e,max:ze,data:ce}};function Y(ie){var ce=ie.container,_e=this.shadowCanvas=document.createElement("canvas"),ze=this.canvas=ie.canvas||document.createElement("canvas");this._renderBoundaries=[1e4,1e4,0,0];var le=getComputedStyle(ie.container)||{};ze.className="heatmap-canvas",this._width=ze.width=_e.width=ie.width||+le.width.replace(/px/,""),this._height=ze.height=_e.height=ie.height||+le.height.replace(/px/,""),this.shadowCtx=_e.getContext("2d"),this.ctx=ze.getContext("2d"),ze.style.cssText=_e.style.cssText="position:absolute;left:0;top:0;",ce.style.position="relative",ce.appendChild(ze),this._palette=F(ie),this._templates={},this._setStyles(ie)}return Y.prototype={renderPartial:function(ie){ie.data.length>0&&(this._drawAlpha(ie),this._colorize())},renderAll:function(ie){this._clear(),ie.data.length>0&&(this._drawAlpha(Z(ie)),this._colorize())},_updateGradient:function(ie){this._palette=F(ie)},updateConfig:function(ie){ie.gradient&&this._updateGradient(ie),this._setStyles(ie)},setDimensions:function(ie,ce){this._width=ie,this._height=ce,this.canvas.width=this.shadowCanvas.width=ie,this.canvas.height=this.shadowCanvas.height=ce},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height),this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(ie){this._blur=ie.blur==0?0:ie.blur||ie.defaultBlur,ie.backgroundColor&&(this.canvas.style.backgroundColor=ie.backgroundColor),this._width=this.canvas.width=this.shadowCanvas.width=ie.width||this._width,this._height=this.canvas.height=this.shadowCanvas.height=ie.height||this._height,this._opacity=(ie.opacity||0)*255,this._maxOpacity=(ie.maxOpacity||ie.defaultMaxOpacity)*255,this._minOpacity=(ie.minOpacity||ie.defaultMinOpacity)*255,this._useGradientOpacity=!!ie.useGradientOpacity},_drawAlpha:function(ze){for(var ce=this._min=ze.min,_e=this._max=ze.max,ze=ze.data||[],le=ze.length,ee=1-this._blur;le--;){var ue=ze[le],Be=ue.x,$e=ue.y,ot=ue.radius,rt=Math.min(ue.value,_e),Je=Be-ot,De=$e-ot,_t=this.shadowCtx,sn;this._templates[ot]?sn=this._templates[ot]:this._templates[ot]=sn=H(ot,ee);var At=(rt-ce)/(_e-ce);_t.globalAlpha=At<.01?.01:At,_t.drawImage(sn,Je,De),Je<this._renderBoundaries[0]&&(this._renderBoundaries[0]=Je),De<this._renderBoundaries[1]&&(this._renderBoundaries[1]=De),Je+2*ot>this._renderBoundaries[2]&&(this._renderBoundaries[2]=Je+2*ot),De+2*ot>this._renderBoundaries[3]&&(this._renderBoundaries[3]=De+2*ot)}},_colorize:function(){var ie=this._renderBoundaries[0],ce=this._renderBoundaries[1],_e=this._renderBoundaries[2]-ie,ze=this._renderBoundaries[3]-ce,le=this._width,ee=this._height,ue=this._opacity,Be=this._maxOpacity,$e=this._minOpacity,ot=this._useGradientOpacity;ie<0&&(ie=0),ce<0&&(ce=0),ie+_e>le&&(_e=le-ie),ce+ze>ee&&(ze=ee-ce);for(var rt=this.shadowCtx.getImageData(ie,ce,_e,ze),Je=rt.data,De=Je.length,_t=this._palette,sn=3;sn<De;sn+=4){var At=Je[sn],rn=At*4;if(rn){var kr;ue>0?kr=ue:At<Be?At<$e?kr=$e:kr=At:kr=Be,Je[sn-3]=_t[rn],Je[sn-2]=_t[rn+1],Je[sn-1]=_t[rn+2],Je[sn]=ot?_t[rn+3]:kr}}rt.data=Je,this.ctx.putImageData(rt,ie,ce),this._renderBoundaries=[1e3,1e3,0,0]},getValueAt:function(ie){var ce,_e=this.shadowCtx,ze=_e.getImageData(ie.x,ie.y,1,1),le=ze.data[3],ee=this._max,ue=this._min;return ce=Math.abs(ee-ue)*(le/255)>>0,ce},getDataURL:function(){return this.canvas.toDataURL()}},Y}(),y=function(){var F=!1;return o.defaultRenderer==="canvas2d"&&(F=p),F}(),w={merge:function(){for(var z={},F=arguments.length,H=0;H<F;H++){var Z=arguments[H];for(var Y in Z)z[Y]=Z[Y]}return z}},C=function(){var F=function(){function ie(){this.cStore={}}return ie.prototype={on:function(ce,_e,ze){var le=this.cStore;le[ce]||(le[ce]=[]),le[ce].push(function(ee){return _e.call(ze,ee)})},emit:function(ce,_e){var ze=this.cStore;if(ze[ce])for(var le=ze[ce].length,ee=0;ee<le;ee++){var ue=ze[ce][ee];ue(_e)}}},ie}(),H=function(Y){var ie=Y._renderer,ce=Y._coordinator,_e=Y._store;ce.on("renderpartial",ie.renderPartial,ie),ce.on("renderall",ie.renderAll,ie),ce.on("extremachange",function(ze){Y._config.onExtremaChange&&Y._config.onExtremaChange({min:ze.min,max:ze.max,gradient:Y._config.gradient||Y._config.defaultGradient})}),_e.setCoordinator(ce)};function Z(){var Y=this._config=w.merge(o,arguments[0]||{});if(this._coordinator=new F,Y.plugin){var ie=Y.plugin;if(o.plugins[ie]){var ce=o.plugins[ie];this._renderer=new ce.renderer(Y),this._store=new ce.store(Y)}else throw new Error("Plugin '"+ie+"' not found. Maybe it was not registered.")}else this._renderer=new y(Y),this._store=new u(Y);H(this)}return Z.prototype={addData:function(){return this._store.addData.apply(this._store,arguments),this},removeData:function(){return this._store.removeData&&this._store.removeData.apply(this._store,arguments),this},setData:function(){return this._store.setData.apply(this._store,arguments),this},setDataMax:function(){return this._store.setDataMax.apply(this._store,arguments),this},setDataMin:function(){return this._store.setDataMin.apply(this._store,arguments),this},configure:function(Y){return this._config=w.merge(this._config,Y),this._renderer.updateConfig(this._config),this._coordinator.emit("renderall",this._store._getInternalData()),this},repaint:function(){return this._coordinator.emit("renderall",this._store._getInternalData()),this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(Y){return this._store.getValueAt?this._store.getValueAt(Y):this._renderer.getValueAt?this._renderer.getValueAt(Y):null}},Z}(),a={create:function(z){return new C(z)},register:function(z,F){o.plugins[z]=F}};return a})})(oD);function lC(t,o){return function(){return t.apply(o,arguments)}}const{toString:sD}=Object.prototype,{getPrototypeOf:Dx}=Object,Wg=(t=>o=>{const u=sD.call(o);return t[u]||(t[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),es=t=>(t=t.toLowerCase(),o=>Wg(o)===t),Xg=t=>o=>typeof o===t,{isArray:Wu}=Array,_f=Xg("undefined");function aD(t){return t!==null&&!_f(t)&&t.constructor!==null&&!_f(t.constructor)&&Ji(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const cC=es("ArrayBuffer");function lD(t){let o;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?o=ArrayBuffer.isView(t):o=t&&t.buffer&&cC(t.buffer),o}const cD=Xg("string"),Ji=Xg("function"),uC=Xg("number"),Hg=t=>t!==null&&typeof t=="object",uD=t=>t===!0||t===!1,Zm=t=>{if(Wg(t)!=="object")return!1;const o=Dx(t);return(o===null||o===Object.prototype||Object.getPrototypeOf(o)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},hD=es("Date"),dD=es("File"),fD=es("Blob"),pD=es("FileList"),mD=t=>Hg(t)&&Ji(t.pipe),gD=t=>{let o;return t&&(typeof FormData=="function"&&t instanceof FormData||Ji(t.append)&&((o=Wg(t))==="formdata"||o==="object"&&Ji(t.toString)&&t.toString()==="[object FormData]"))},_D=es("URLSearchParams"),yD=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Pf(t,o,{allOwnKeys:u=!1}={}){if(t===null||typeof t>"u")return;let p,y;if(typeof t!="object"&&(t=[t]),Wu(t))for(p=0,y=t.length;p<y;p++)o.call(null,t[p],p,t);else{const w=u?Object.getOwnPropertyNames(t):Object.keys(t),C=w.length;let a;for(p=0;p<C;p++)a=w[p],o.call(null,t[a],a,t)}}function hC(t,o){o=o.toLowerCase();const u=Object.keys(t);let p=u.length,y;for(;p-- >0;)if(y=u[p],o===y.toLowerCase())return y;return null}const dC=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),fC=t=>!_f(t)&&t!==dC;function gv(){const{caseless:t}=fC(this)&&this||{},o={},u=(p,y)=>{const w=t&&hC(o,y)||y;Zm(o[w])&&Zm(p)?o[w]=gv(o[w],p):Zm(p)?o[w]=gv({},p):Wu(p)?o[w]=p.slice():o[w]=p};for(let p=0,y=arguments.length;p<y;p++)arguments[p]&&Pf(arguments[p],u);return o}const vD=(t,o,u,{allOwnKeys:p}={})=>(Pf(o,(y,w)=>{u&&Ji(y)?t[w]=lC(y,u):t[w]=y},{allOwnKeys:p}),t),xD=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),wD=(t,o,u,p)=>{t.prototype=Object.create(o.prototype,p),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:o.prototype}),u&&Object.assign(t.prototype,u)},bD=(t,o,u,p)=>{let y,w,C;const a={};if(o=o||{},t==null)return o;do{for(y=Object.getOwnPropertyNames(t),w=y.length;w-- >0;)C=y[w],(!p||p(C,t,o))&&!a[C]&&(o[C]=t[C],a[C]=!0);t=u!==!1&&Dx(t)}while(t&&(!u||u(t,o))&&t!==Object.prototype);return o},ED=(t,o,u)=>{t=String(t),(u===void 0||u>t.length)&&(u=t.length),u-=o.length;const p=t.indexOf(o,u);return p!==-1&&p===u},TD=t=>{if(!t)return null;if(Wu(t))return t;let o=t.length;if(!uC(o))return null;const u=new Array(o);for(;o-- >0;)u[o]=t[o];return u},SD=(t=>o=>t&&o instanceof t)(typeof Uint8Array<"u"&&Dx(Uint8Array)),CD=(t,o)=>{const p=(t&&t[Symbol.iterator]).call(t);let y;for(;(y=p.next())&&!y.done;){const w=y.value;o.call(t,w[0],w[1])}},AD=(t,o)=>{let u;const p=[];for(;(u=t.exec(o))!==null;)p.push(u);return p},MD=es("HTMLFormElement"),kD=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(u,p,y){return p.toUpperCase()+y}),q2=(({hasOwnProperty:t})=>(o,u)=>t.call(o,u))(Object.prototype),ID=es("RegExp"),pC=(t,o)=>{const u=Object.getOwnPropertyDescriptors(t),p={};Pf(u,(y,w)=>{o(y,w,t)!==!1&&(p[w]=y)}),Object.defineProperties(t,p)},PD=t=>{pC(t,(o,u)=>{if(Ji(t)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const p=t[u];if(Ji(p)){if(o.enumerable=!1,"writable"in o){o.writable=!1;return}o.set||(o.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},zD=(t,o)=>{const u={},p=y=>{y.forEach(w=>{u[w]=!0})};return Wu(t)?p(t):p(String(t).split(o)),u},DD=()=>{},LD=(t,o)=>(t=+t,Number.isFinite(t)?t:o),c0="abcdefghijklmnopqrstuvwxyz",Z2="0123456789",mC={DIGIT:Z2,ALPHA:c0,ALPHA_DIGIT:c0+c0.toUpperCase()+Z2},RD=(t=16,o=mC.ALPHA_DIGIT)=>{let u="";const{length:p}=o;for(;t--;)u+=o[Math.random()*p|0];return u};function OD(t){return!!(t&&Ji(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const BD=t=>{const o=new Array(10),u=(p,y)=>{if(Hg(p)){if(o.indexOf(p)>=0)return;if(!("toJSON"in p)){o[y]=p;const w=Wu(p)?[]:{};return Pf(p,(C,a)=>{const z=u(C,y+1);!_f(z)&&(w[a]=z)}),o[y]=void 0,w}}return p};return u(t,0)},FD=es("AsyncFunction"),ND=t=>t&&(Hg(t)||Ji(t))&&Ji(t.then)&&Ji(t.catch),Ze={isArray:Wu,isArrayBuffer:cC,isBuffer:aD,isFormData:gD,isArrayBufferView:lD,isString:cD,isNumber:uC,isBoolean:uD,isObject:Hg,isPlainObject:Zm,isUndefined:_f,isDate:hD,isFile:dD,isBlob:fD,isRegExp:ID,isFunction:Ji,isStream:mD,isURLSearchParams:_D,isTypedArray:SD,isFileList:pD,forEach:Pf,merge:gv,extend:vD,trim:yD,stripBOM:xD,inherits:wD,toFlatObject:bD,kindOf:Wg,kindOfTest:es,endsWith:ED,toArray:TD,forEachEntry:CD,matchAll:AD,isHTMLForm:MD,hasOwnProperty:q2,hasOwnProp:q2,reduceDescriptors:pC,freezeMethods:PD,toObjectSet:zD,toCamelCase:kD,noop:DD,toFiniteNumber:LD,findKey:hC,global:dC,isContextDefined:fC,ALPHABET:mC,generateString:RD,isSpecCompliantForm:OD,toJSONObject:BD,isAsyncFn:FD,isThenable:ND};function an(t,o,u,p,y){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",o&&(this.code=o),u&&(this.config=u),p&&(this.request=p),y&&(this.response=y)}Ze.inherits(an,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ze.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const gC=an.prototype,_C={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{_C[t]={value:t}});Object.defineProperties(an,_C);Object.defineProperty(gC,"isAxiosError",{value:!0});an.from=(t,o,u,p,y,w)=>{const C=Object.create(gC);return Ze.toFlatObject(t,C,function(z){return z!==Error.prototype},a=>a!=="isAxiosError"),an.call(C,t.message,o,u,p,y),C.cause=t,C.name=t.name,w&&Object.assign(C,w),C};const jD=null;function _v(t){return Ze.isPlainObject(t)||Ze.isArray(t)}function yC(t){return Ze.endsWith(t,"[]")?t.slice(0,-2):t}function W2(t,o,u){return t?t.concat(o).map(function(y,w){return y=yC(y),!u&&w?"["+y+"]":y}).join(u?".":""):o}function UD(t){return Ze.isArray(t)&&!t.some(_v)}const VD=Ze.toFlatObject(Ze,{},null,function(o){return/^is[A-Z]/.test(o)});function Yg(t,o,u){if(!Ze.isObject(t))throw new TypeError("target must be an object");o=o||new FormData,u=Ze.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_e,ze){return!Ze.isUndefined(ze[_e])});const p=u.metaTokens,y=u.visitor||H,w=u.dots,C=u.indexes,z=(u.Blob||typeof Blob<"u"&&Blob)&&Ze.isSpecCompliantForm(o);if(!Ze.isFunction(y))throw new TypeError("visitor must be a function");function F(ce){if(ce===null)return"";if(Ze.isDate(ce))return ce.toISOString();if(!z&&Ze.isBlob(ce))throw new an("Blob is not supported. Use a Buffer instead.");return Ze.isArrayBuffer(ce)||Ze.isTypedArray(ce)?z&&typeof Blob=="function"?new Blob([ce]):Buffer.from(ce):ce}function H(ce,_e,ze){let le=ce;if(ce&&!ze&&typeof ce=="object"){if(Ze.endsWith(_e,"{}"))_e=p?_e:_e.slice(0,-2),ce=JSON.stringify(ce);else if(Ze.isArray(ce)&&UD(ce)||(Ze.isFileList(ce)||Ze.endsWith(_e,"[]"))&&(le=Ze.toArray(ce)))return _e=yC(_e),le.forEach(function(ue,Be){!(Ze.isUndefined(ue)||ue===null)&&o.append(C===!0?W2([_e],Be,w):C===null?_e:_e+"[]",F(ue))}),!1}return _v(ce)?!0:(o.append(W2(ze,_e,w),F(ce)),!1)}const Z=[],Y=Object.assign(VD,{defaultVisitor:H,convertValue:F,isVisitable:_v});function ie(ce,_e){if(!Ze.isUndefined(ce)){if(Z.indexOf(ce)!==-1)throw Error("Circular reference detected in "+_e.join("."));Z.push(ce),Ze.forEach(ce,function(le,ee){(!(Ze.isUndefined(le)||le===null)&&y.call(o,le,Ze.isString(ee)?ee.trim():ee,_e,Y))===!0&&ie(le,_e?_e.concat(ee):[ee])}),Z.pop()}}if(!Ze.isObject(t))throw new TypeError("data must be an object");return ie(t),o}function X2(t){const o={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(p){return o[p]})}function Lx(t,o){this._pairs=[],t&&Yg(t,this,o)}const vC=Lx.prototype;vC.append=function(o,u){this._pairs.push([o,u])};vC.toString=function(o){const u=o?function(p){return o.call(this,p,X2)}:X2;return this._pairs.map(function(y){return u(y[0])+"="+u(y[1])},"").join("&")};function $D(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function xC(t,o,u){if(!o)return t;const p=u&&u.encode||$D,y=u&&u.serialize;let w;if(y?w=y(o,u):w=Ze.isURLSearchParams(o)?o.toString():new Lx(o,u).toString(p),w){const C=t.indexOf("#");C!==-1&&(t=t.slice(0,C)),t+=(t.indexOf("?")===-1?"?":"&")+w}return t}class GD{constructor(){this.handlers=[]}use(o,u,p){return this.handlers.push({fulfilled:o,rejected:u,synchronous:p?p.synchronous:!1,runWhen:p?p.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){Ze.forEach(this.handlers,function(p){p!==null&&o(p)})}}const H2=GD,wC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},qD=typeof URLSearchParams<"u"?URLSearchParams:Lx,ZD=typeof FormData<"u"?FormData:null,WD=typeof Blob<"u"?Blob:null,XD=(()=>{let t;return typeof navigator<"u"&&((t=navigator.product)==="ReactNative"||t==="NativeScript"||t==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),HD=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Yo={isBrowser:!0,classes:{URLSearchParams:qD,FormData:ZD,Blob:WD},isStandardBrowserEnv:XD,isStandardBrowserWebWorkerEnv:HD,protocols:["http","https","file","blob","url","data"]};function YD(t,o){return Yg(t,new Yo.classes.URLSearchParams,Object.assign({visitor:function(u,p,y,w){return Yo.isNode&&Ze.isBuffer(u)?(this.append(p,u.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},o))}function KD(t){return Ze.matchAll(/\w+|\[(\w*)]/g,t).map(o=>o[0]==="[]"?"":o[1]||o[0])}function JD(t){const o={},u=Object.keys(t);let p;const y=u.length;let w;for(p=0;p<y;p++)w=u[p],o[w]=t[w];return o}function bC(t){function o(u,p,y,w){let C=u[w++];const a=Number.isFinite(+C),z=w>=u.length;return C=!C&&Ze.isArray(y)?y.length:C,z?(Ze.hasOwnProp(y,C)?y[C]=[y[C],p]:y[C]=p,!a):((!y[C]||!Ze.isObject(y[C]))&&(y[C]=[]),o(u,p,y[C],w)&&Ze.isArray(y[C])&&(y[C]=JD(y[C])),!a)}if(Ze.isFormData(t)&&Ze.isFunction(t.entries)){const u={};return Ze.forEachEntry(t,(p,y)=>{o(KD(p),y,u,0)}),u}return null}const QD={"Content-Type":void 0};function eL(t,o,u){if(Ze.isString(t))try{return(o||JSON.parse)(t),Ze.trim(t)}catch(p){if(p.name!=="SyntaxError")throw p}return(u||JSON.stringify)(t)}const Kg={transitional:wC,adapter:["xhr","http"],transformRequest:[function(o,u){const p=u.getContentType()||"",y=p.indexOf("application/json")>-1,w=Ze.isObject(o);if(w&&Ze.isHTMLForm(o)&&(o=new FormData(o)),Ze.isFormData(o))return y&&y?JSON.stringify(bC(o)):o;if(Ze.isArrayBuffer(o)||Ze.isBuffer(o)||Ze.isStream(o)||Ze.isFile(o)||Ze.isBlob(o))return o;if(Ze.isArrayBufferView(o))return o.buffer;if(Ze.isURLSearchParams(o))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let a;if(w){if(p.indexOf("application/x-www-form-urlencoded")>-1)return YD(o,this.formSerializer).toString();if((a=Ze.isFileList(o))||p.indexOf("multipart/form-data")>-1){const z=this.env&&this.env.FormData;return Yg(a?{"files[]":o}:o,z&&new z,this.formSerializer)}}return w||y?(u.setContentType("application/json",!1),eL(o)):o}],transformResponse:[function(o){const u=this.transitional||Kg.transitional,p=u&&u.forcedJSONParsing,y=this.responseType==="json";if(o&&Ze.isString(o)&&(p&&!this.responseType||y)){const C=!(u&&u.silentJSONParsing)&&y;try{return JSON.parse(o)}catch(a){if(C)throw a.name==="SyntaxError"?an.from(a,an.ERR_BAD_RESPONSE,this,null,this.response):a}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yo.classes.FormData,Blob:Yo.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ze.forEach(["delete","get","head"],function(o){Kg.headers[o]={}});Ze.forEach(["post","put","patch"],function(o){Kg.headers[o]=Ze.merge(QD)});const Rx=Kg,tL=Ze.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nL=t=>{const o={};let u,p,y;return t&&t.split(`
`).forEach(function(C){y=C.indexOf(":"),u=C.substring(0,y).trim().toLowerCase(),p=C.substring(y+1).trim(),!(!u||o[u]&&tL[u])&&(u==="set-cookie"?o[u]?o[u].push(p):o[u]=[p]:o[u]=o[u]?o[u]+", "+p:p)}),o},Y2=Symbol("internals");function Ld(t){return t&&String(t).trim().toLowerCase()}function Wm(t){return t===!1||t==null?t:Ze.isArray(t)?t.map(Wm):String(t)}function rL(t){const o=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let p;for(;p=u.exec(t);)o[p[1]]=p[2];return o}const iL=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function u0(t,o,u,p,y){if(Ze.isFunction(p))return p.call(this,o,u);if(y&&(o=u),!!Ze.isString(o)){if(Ze.isString(p))return o.indexOf(p)!==-1;if(Ze.isRegExp(p))return p.test(o)}}function oL(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(o,u,p)=>u.toUpperCase()+p)}function sL(t,o){const u=Ze.toCamelCase(" "+o);["get","set","has"].forEach(p=>{Object.defineProperty(t,p+u,{value:function(y,w,C){return this[p].call(this,o,y,w,C)},configurable:!0})})}class Jg{constructor(o){o&&this.set(o)}set(o,u,p){const y=this;function w(a,z,F){const H=Ld(z);if(!H)throw new Error("header name must be a non-empty string");const Z=Ze.findKey(y,H);(!Z||y[Z]===void 0||F===!0||F===void 0&&y[Z]!==!1)&&(y[Z||z]=Wm(a))}const C=(a,z)=>Ze.forEach(a,(F,H)=>w(F,H,z));return Ze.isPlainObject(o)||o instanceof this.constructor?C(o,u):Ze.isString(o)&&(o=o.trim())&&!iL(o)?C(nL(o),u):o!=null&&w(u,o,p),this}get(o,u){if(o=Ld(o),o){const p=Ze.findKey(this,o);if(p){const y=this[p];if(!u)return y;if(u===!0)return rL(y);if(Ze.isFunction(u))return u.call(this,y,p);if(Ze.isRegExp(u))return u.exec(y);throw new TypeError("parser must be boolean|regexp|function")}}}has(o,u){if(o=Ld(o),o){const p=Ze.findKey(this,o);return!!(p&&this[p]!==void 0&&(!u||u0(this,this[p],p,u)))}return!1}delete(o,u){const p=this;let y=!1;function w(C){if(C=Ld(C),C){const a=Ze.findKey(p,C);a&&(!u||u0(p,p[a],a,u))&&(delete p[a],y=!0)}}return Ze.isArray(o)?o.forEach(w):w(o),y}clear(o){const u=Object.keys(this);let p=u.length,y=!1;for(;p--;){const w=u[p];(!o||u0(this,this[w],w,o,!0))&&(delete this[w],y=!0)}return y}normalize(o){const u=this,p={};return Ze.forEach(this,(y,w)=>{const C=Ze.findKey(p,w);if(C){u[C]=Wm(y),delete u[w];return}const a=o?oL(w):String(w).trim();a!==w&&delete u[w],u[a]=Wm(y),p[a]=!0}),this}concat(...o){return this.constructor.concat(this,...o)}toJSON(o){const u=Object.create(null);return Ze.forEach(this,(p,y)=>{p!=null&&p!==!1&&(u[y]=o&&Ze.isArray(p)?p.join(", "):p)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([o,u])=>o+": "+u).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(o){return o instanceof this?o:new this(o)}static concat(o,...u){const p=new this(o);return u.forEach(y=>p.set(y)),p}static accessor(o){const p=(this[Y2]=this[Y2]={accessors:{}}).accessors,y=this.prototype;function w(C){const a=Ld(C);p[a]||(sL(y,C),p[a]=!0)}return Ze.isArray(o)?o.forEach(w):w(o),this}}Jg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ze.freezeMethods(Jg.prototype);Ze.freezeMethods(Jg);const ks=Jg;function h0(t,o){const u=this||Rx,p=o||u,y=ks.from(p.headers);let w=p.data;return Ze.forEach(t,function(a){w=a.call(u,w,y.normalize(),o?o.status:void 0)}),y.normalize(),w}function EC(t){return!!(t&&t.__CANCEL__)}function zf(t,o,u){an.call(this,t??"canceled",an.ERR_CANCELED,o,u),this.name="CanceledError"}Ze.inherits(zf,an,{__CANCEL__:!0});function aL(t,o,u){const p=u.config.validateStatus;!u.status||!p||p(u.status)?t(u):o(new an("Request failed with status code "+u.status,[an.ERR_BAD_REQUEST,an.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}const lL=Yo.isStandardBrowserEnv?function(){return{write:function(u,p,y,w,C,a){const z=[];z.push(u+"="+encodeURIComponent(p)),Ze.isNumber(y)&&z.push("expires="+new Date(y).toGMTString()),Ze.isString(w)&&z.push("path="+w),Ze.isString(C)&&z.push("domain="+C),a===!0&&z.push("secure"),document.cookie=z.join("; ")},read:function(u){const p=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return p?decodeURIComponent(p[3]):null},remove:function(u){this.write(u,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function cL(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function uL(t,o){return o?t.replace(/\/+$/,"")+"/"+o.replace(/^\/+/,""):t}function TC(t,o){return t&&!cL(o)?uL(t,o):o}const hL=Yo.isStandardBrowserEnv?function(){const o=/(msie|trident)/i.test(navigator.userAgent),u=document.createElement("a");let p;function y(w){let C=w;return o&&(u.setAttribute("href",C),C=u.href),u.setAttribute("href",C),{href:u.href,protocol:u.protocol?u.protocol.replace(/:$/,""):"",host:u.host,search:u.search?u.search.replace(/^\?/,""):"",hash:u.hash?u.hash.replace(/^#/,""):"",hostname:u.hostname,port:u.port,pathname:u.pathname.charAt(0)==="/"?u.pathname:"/"+u.pathname}}return p=y(window.location.href),function(C){const a=Ze.isString(C)?y(C):C;return a.protocol===p.protocol&&a.host===p.host}}():function(){return function(){return!0}}();function dL(t){const o=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return o&&o[1]||""}function fL(t,o){t=t||10;const u=new Array(t),p=new Array(t);let y=0,w=0,C;return o=o!==void 0?o:1e3,function(z){const F=Date.now(),H=p[w];C||(C=F),u[y]=z,p[y]=F;let Z=w,Y=0;for(;Z!==y;)Y+=u[Z++],Z=Z%t;if(y=(y+1)%t,y===w&&(w=(w+1)%t),F-C<o)return;const ie=H&&F-H;return ie?Math.round(Y*1e3/ie):void 0}}function K2(t,o){let u=0;const p=fL(50,250);return y=>{const w=y.loaded,C=y.lengthComputable?y.total:void 0,a=w-u,z=p(a),F=w<=C;u=w;const H={loaded:w,total:C,progress:C?w/C:void 0,bytes:a,rate:z||void 0,estimated:z&&C&&F?(C-w)/z:void 0,event:y};H[o?"download":"upload"]=!0,t(H)}}const pL=typeof XMLHttpRequest<"u",mL=pL&&function(t){return new Promise(function(u,p){let y=t.data;const w=ks.from(t.headers).normalize(),C=t.responseType;let a;function z(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}Ze.isFormData(y)&&(Yo.isStandardBrowserEnv||Yo.isStandardBrowserWebWorkerEnv?w.setContentType(!1):w.setContentType("multipart/form-data;",!1));let F=new XMLHttpRequest;if(t.auth){const ie=t.auth.username||"",ce=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";w.set("Authorization","Basic "+btoa(ie+":"+ce))}const H=TC(t.baseURL,t.url);F.open(t.method.toUpperCase(),xC(H,t.params,t.paramsSerializer),!0),F.timeout=t.timeout;function Z(){if(!F)return;const ie=ks.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders()),_e={data:!C||C==="text"||C==="json"?F.responseText:F.response,status:F.status,statusText:F.statusText,headers:ie,config:t,request:F};aL(function(le){u(le),z()},function(le){p(le),z()},_e),F=null}if("onloadend"in F?F.onloadend=Z:F.onreadystatechange=function(){!F||F.readyState!==4||F.status===0&&!(F.responseURL&&F.responseURL.indexOf("file:")===0)||setTimeout(Z)},F.onabort=function(){F&&(p(new an("Request aborted",an.ECONNABORTED,t,F)),F=null)},F.onerror=function(){p(new an("Network Error",an.ERR_NETWORK,t,F)),F=null},F.ontimeout=function(){let ce=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const _e=t.transitional||wC;t.timeoutErrorMessage&&(ce=t.timeoutErrorMessage),p(new an(ce,_e.clarifyTimeoutError?an.ETIMEDOUT:an.ECONNABORTED,t,F)),F=null},Yo.isStandardBrowserEnv){const ie=(t.withCredentials||hL(H))&&t.xsrfCookieName&&lL.read(t.xsrfCookieName);ie&&w.set(t.xsrfHeaderName,ie)}y===void 0&&w.setContentType(null),"setRequestHeader"in F&&Ze.forEach(w.toJSON(),function(ce,_e){F.setRequestHeader(_e,ce)}),Ze.isUndefined(t.withCredentials)||(F.withCredentials=!!t.withCredentials),C&&C!=="json"&&(F.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&F.addEventListener("progress",K2(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&F.upload&&F.upload.addEventListener("progress",K2(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=ie=>{F&&(p(!ie||ie.type?new zf(null,t,F):ie),F.abort(),F=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const Y=dL(H);if(Y&&Yo.protocols.indexOf(Y)===-1){p(new an("Unsupported protocol "+Y+":",an.ERR_BAD_REQUEST,t));return}F.send(y||null)})},Xm={http:jD,xhr:mL};Ze.forEach(Xm,(t,o)=>{if(t){try{Object.defineProperty(t,"name",{value:o})}catch{}Object.defineProperty(t,"adapterName",{value:o})}});const gL={getAdapter:t=>{t=Ze.isArray(t)?t:[t];const{length:o}=t;let u,p;for(let y=0;y<o&&(u=t[y],!(p=Ze.isString(u)?Xm[u.toLowerCase()]:u));y++);if(!p)throw p===!1?new an(`Adapter ${u} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Ze.hasOwnProp(Xm,u)?`Adapter '${u}' is not available in the build`:`Unknown adapter '${u}'`);if(!Ze.isFunction(p))throw new TypeError("adapter is not a function");return p},adapters:Xm};function d0(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new zf(null,t)}function J2(t){return d0(t),t.headers=ks.from(t.headers),t.data=h0.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),gL.getAdapter(t.adapter||Rx.adapter)(t).then(function(p){return d0(t),p.data=h0.call(t,t.transformResponse,p),p.headers=ks.from(p.headers),p},function(p){return EC(p)||(d0(t),p&&p.response&&(p.response.data=h0.call(t,t.transformResponse,p.response),p.response.headers=ks.from(p.response.headers))),Promise.reject(p)})}const Q2=t=>t instanceof ks?t.toJSON():t;function ju(t,o){o=o||{};const u={};function p(F,H,Z){return Ze.isPlainObject(F)&&Ze.isPlainObject(H)?Ze.merge.call({caseless:Z},F,H):Ze.isPlainObject(H)?Ze.merge({},H):Ze.isArray(H)?H.slice():H}function y(F,H,Z){if(Ze.isUndefined(H)){if(!Ze.isUndefined(F))return p(void 0,F,Z)}else return p(F,H,Z)}function w(F,H){if(!Ze.isUndefined(H))return p(void 0,H)}function C(F,H){if(Ze.isUndefined(H)){if(!Ze.isUndefined(F))return p(void 0,F)}else return p(void 0,H)}function a(F,H,Z){if(Z in o)return p(F,H);if(Z in t)return p(void 0,F)}const z={url:w,method:w,data:w,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:a,headers:(F,H)=>y(Q2(F),Q2(H),!0)};return Ze.forEach(Object.keys(Object.assign({},t,o)),function(H){const Z=z[H]||y,Y=Z(t[H],o[H],H);Ze.isUndefined(Y)&&Z!==a||(u[H]=Y)}),u}const SC="1.4.0",Ox={};["object","boolean","number","function","string","symbol"].forEach((t,o)=>{Ox[t]=function(p){return typeof p===t||"a"+(o<1?"n ":" ")+t}});const eE={};Ox.transitional=function(o,u,p){function y(w,C){return"[Axios v"+SC+"] Transitional option '"+w+"'"+C+(p?". "+p:"")}return(w,C,a)=>{if(o===!1)throw new an(y(C," has been removed"+(u?" in "+u:"")),an.ERR_DEPRECATED);return u&&!eE[C]&&(eE[C]=!0,console.warn(y(C," has been deprecated since v"+u+" and will be removed in the near future"))),o?o(w,C,a):!0}};function _L(t,o,u){if(typeof t!="object")throw new an("options must be an object",an.ERR_BAD_OPTION_VALUE);const p=Object.keys(t);let y=p.length;for(;y-- >0;){const w=p[y],C=o[w];if(C){const a=t[w],z=a===void 0||C(a,w,t);if(z!==!0)throw new an("option "+w+" must be "+z,an.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new an("Unknown option "+w,an.ERR_BAD_OPTION)}}const yv={assertOptions:_L,validators:Ox},ba=yv.validators;class Tg{constructor(o){this.defaults=o,this.interceptors={request:new H2,response:new H2}}request(o,u){typeof o=="string"?(u=u||{},u.url=o):u=o||{},u=ju(this.defaults,u);const{transitional:p,paramsSerializer:y,headers:w}=u;p!==void 0&&yv.assertOptions(p,{silentJSONParsing:ba.transitional(ba.boolean),forcedJSONParsing:ba.transitional(ba.boolean),clarifyTimeoutError:ba.transitional(ba.boolean)},!1),y!=null&&(Ze.isFunction(y)?u.paramsSerializer={serialize:y}:yv.assertOptions(y,{encode:ba.function,serialize:ba.function},!0)),u.method=(u.method||this.defaults.method||"get").toLowerCase();let C;C=w&&Ze.merge(w.common,w[u.method]),C&&Ze.forEach(["delete","get","head","post","put","patch","common"],ce=>{delete w[ce]}),u.headers=ks.concat(C,w);const a=[];let z=!0;this.interceptors.request.forEach(function(_e){typeof _e.runWhen=="function"&&_e.runWhen(u)===!1||(z=z&&_e.synchronous,a.unshift(_e.fulfilled,_e.rejected))});const F=[];this.interceptors.response.forEach(function(_e){F.push(_e.fulfilled,_e.rejected)});let H,Z=0,Y;if(!z){const ce=[J2.bind(this),void 0];for(ce.unshift.apply(ce,a),ce.push.apply(ce,F),Y=ce.length,H=Promise.resolve(u);Z<Y;)H=H.then(ce[Z++],ce[Z++]);return H}Y=a.length;let ie=u;for(Z=0;Z<Y;){const ce=a[Z++],_e=a[Z++];try{ie=ce(ie)}catch(ze){_e.call(this,ze);break}}try{H=J2.call(this,ie)}catch(ce){return Promise.reject(ce)}for(Z=0,Y=F.length;Z<Y;)H=H.then(F[Z++],F[Z++]);return H}getUri(o){o=ju(this.defaults,o);const u=TC(o.baseURL,o.url);return xC(u,o.params,o.paramsSerializer)}}Ze.forEach(["delete","get","head","options"],function(o){Tg.prototype[o]=function(u,p){return this.request(ju(p||{},{method:o,url:u,data:(p||{}).data}))}});Ze.forEach(["post","put","patch"],function(o){function u(p){return function(w,C,a){return this.request(ju(a||{},{method:o,headers:p?{"Content-Type":"multipart/form-data"}:{},url:w,data:C}))}}Tg.prototype[o]=u(),Tg.prototype[o+"Form"]=u(!0)});const Hm=Tg;class Bx{constructor(o){if(typeof o!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(w){u=w});const p=this;this.promise.then(y=>{if(!p._listeners)return;let w=p._listeners.length;for(;w-- >0;)p._listeners[w](y);p._listeners=null}),this.promise.then=y=>{let w;const C=new Promise(a=>{p.subscribe(a),w=a}).then(y);return C.cancel=function(){p.unsubscribe(w)},C},o(function(w,C,a){p.reason||(p.reason=new zf(w,C,a),u(p.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]}unsubscribe(o){if(!this._listeners)return;const u=this._listeners.indexOf(o);u!==-1&&this._listeners.splice(u,1)}static source(){let o;return{token:new Bx(function(y){o=y}),cancel:o}}}const yL=Bx;function vL(t){return function(u){return t.apply(null,u)}}function xL(t){return Ze.isObject(t)&&t.isAxiosError===!0}const vv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vv).forEach(([t,o])=>{vv[o]=t});const wL=vv;function CC(t){const o=new Hm(t),u=lC(Hm.prototype.request,o);return Ze.extend(u,Hm.prototype,o,{allOwnKeys:!0}),Ze.extend(u,o,null,{allOwnKeys:!0}),u.create=function(y){return CC(ju(t,y))},u}const yr=CC(Rx);yr.Axios=Hm;yr.CanceledError=zf;yr.CancelToken=yL;yr.isCancel=EC;yr.VERSION=SC;yr.toFormData=Yg;yr.AxiosError=an;yr.Cancel=yr.CanceledError;yr.all=function(o){return Promise.all(o)};yr.spread=vL;yr.isAxiosError=xL;yr.mergeConfig=ju;yr.AxiosHeaders=ks;yr.formToJSON=t=>bC(Ze.isHTMLForm(t)?new FormData(t):t);yr.HttpStatusCode=wL;yr.default=yr;const Pi=yr,bL=()=>{const t=Ve.useRef(null);return Ve.useEffect(()=>{(async()=>{try{const p=(await Pi.get("https://walksafenyc-api-production-ba84.up.railway.app/api/posts")).data;Tm.accessToken="pk.eyJ1IjoidmluY2V2dWxsbyIsImEiOiJjbGpoczRmaDIwbW42M3BxdnkzYTl0ZjF4In0.cwJZ5kOguSalc742_qdAPg";const y=new Tm.Map({container:t.current,style:"mapbox://styles/mapbox/streets-v12",center:[-73.9,40.7],zoom:9.4});p.forEach(w=>{const C=w.lon,a=w.lat,z=w.incident_type,F=w.post_time,H=w.post_date,Z=new Tm.Marker({color:"#fdaeec"}).setLngLat([C,a]).setPopup(new Tm.Popup({className:"popup"}).setHTML(`<h2>Report of ${z} at ${F} on ${H}</h2>`)).addTo(y)})}catch(u){console.error("error:",u)}})()},[]),V.jsx("div",{className:"mappo",children:V.jsx("div",{className:"map",ref:t})})},tE=()=>V.jsx("div",{className:"homePage",children:V.jsx(bL,{})}),sc="/assets/city-06b7eeb3.png",ac=Ve.createContext(),EL=({children:t})=>{const[o,u]=Ve.useState(!1),[p,y]=Ve.useState(null),w=a=>{u(!0),y(a)},C=a=>{u(!1),y(null)};return V.jsx(ac.Provider,{value:{loggedIn:o,user:p,login:w,logout:C},children:t})},nE={email:"",password:"",passwordConfirm:"",valid:""},xv=()=>{const{login:t,logout:o}=Ve.useContext(ac),u=Cf(),p=Sf(),[y,w]=Ve.useState(nE),[C,a]=Ve.useState([]),[z,F]=Ve.useState(null);Ve.useEffect(()=>{H()},[]),Ve.useEffect(()=>{const _e=localStorage.getItem("user");if(_e){const ze=JSON.parse(_e);t(ze),F(ze)}},[t]),Ve.useEffect(()=>{const _e=new URLSearchParams(p.search).get("id");_e&&z&&_e===z._id&&(F(null),localStorage.removeItem("user"))},[p.search,z]);const H=async()=>{try{const _e=await Pi.get("https://walksafenyc-api-production-ba84.up.railway.app/api/users");a(_e.data)}catch(_e){console.error("Error fetching users:",_e)}},Z=_e=>{_e.preventDefault(),w(nE);const{email:ze,password:le}=y,ee=C.find(ue=>ue.email===ze&&ue.password===le);ee?(console.log("Logged in:",ee),w({...y,valid:"Credentials are correct"}),localStorage.setItem("user",JSON.stringify(ee)),t(ee),F(ee)):w({...y,valid:"Invalid credentials"})},Y=_e=>{w({...y,[_e.target.name]:_e.target.value})},ie=()=>{localStorage.removeItem("user"),o(),F(null),u(`/login?id=${z._id}`)},ce=()=>{z&&u(`${z._id}/`)};return V.jsx("div",{className:"login-page",children:V.jsxs("div",{className:"form-container",children:[V.jsxs("form",{className:"login-form",onSubmit:Z,children:[V.jsx("h4",{children:"Login to your account."}),V.jsxs("div",{className:"login-question",children:[V.jsx("label",{htmlFor:"email",children:"Email:"}),V.jsx("input",{value:y.email,onChange:Y,name:"email",id:"email",type:"email",placeholder:"youremail@gmail.com"})]}),V.jsxs("div",{className:"login-question",children:[V.jsx("label",{htmlFor:"password",children:"Password:"}),V.jsx("input",{value:y.password,onChange:Y,name:"password",id:"password",type:"password",placeholder:"*******"})]}),V.jsx("button",{id:"log-in-button",className:"submit-button",type:"submit",children:"Log in"}),y.valid&&V.jsx("p",{children:y.valid}),z?V.jsxs("div",{className:"loginbuttons",children:[V.jsx("button",{className:"profbutton",onClick:ce,children:"Go to profile page"}),V.jsx("button",{className:"logout",onClick:ie,children:"Logout"})]}):V.jsx(ti,{to:"/createAnAccount",id:"linktocreate",children:V.jsx("button",{id:"create-account",className:"createAccount",children:"Create an account."})})]}),V.jsx("img",{src:sc,alt:"City"})]})})};const rE=()=>{const{loggedIn:t,user:o}=Ve.useContext(ac);if(console.log(o),!t||!o)return V.jsxs("div",{children:[V.jsx("h1",{className:"pleaselogin",children:"please login"}),V.jsx(xv,{})]});const[u,p]=Ve.useState(""),[y,w]=Ve.useState("12:00 AM"),[C,a]=Ve.useState("Verbal harassment"),[z,F]=Ve.useState(""),[H,Z]=Ve.useState(""),[Y,ie]=Ve.useState(""),[ce,_e]=Ve.useState(""),[ze,le]=Ve.useState(!1),[ee,ue]=Ve.useState(!1),Be=Je=>{Je.preventDefault(),navigator.geolocation?(le(!0),navigator.geolocation.getCurrentPosition(De=>{let _t=De.coords.latitude,sn=De.coords.longitude;Z(sn),ie(_t),le(!1)},De=>{console.log("error",De),le(!1)})):console.log("geolocation is not supported by this browse.")},$e=async Je=>{try{const _t=(await Pi.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Je)}.json?access_token=pk.eyJ1IjoidmluY2V2dWxsbyIsImEiOiJjbGpoczRmaDIwbW42M3BxdnkzYTl0ZjF4In0.cwJZ5kOguSalc742_qdAPg`)).data.features[0].geometry.coordinates;console.log("latiude",_t[1]),console.log("longitude",_t[0]),Z(_t[0]),ie(_t[1]),ot(_t[1],_t[0])}catch(De){console.log(De)}},ot=async(Je,De)=>{await Pi.post("https://walksafenyc-api-production-ba84.up.railway.app/api/posts",{lat:Je,lon:De,post_date:u,post_time:y,user_account:o._id,incident_type:C,comment:z}).then(function(_t){console.log(_t.data)}).catch(function(_t){console.log(_t)})},rt=Je=>{if(Je.preventDefault(),u===""){alert("Please select Date.");return}else ce!=""?($e(ce),ue(!0)):Y!=""&&ce===""&&(ot(Y,H),ue(!0))};return V.jsx("div",{className:"report-form-page",children:ee?V.jsxs("section",{children:[V.jsx("h1",{children:"Report successfully created."}),V.jsx("p",{children:V.jsx(ti,{className:"home",to:"/",children:V.jsx("button",{id:"home",className:"submit-button",children:"Go home."})})})]}):V.jsxs("div",{className:"form-container",children:[V.jsxs("form",{className:"report-form",onSubmit:rt,children:[V.jsx("h4",{children:"Report an incident of street harrassment:"}),V.jsxs("div",{className:"question",children:[V.jsx("label",{htmlFor:"date",children:"Date of Incident: "}),V.jsx("input",{type:"date",onChange:Je=>p(Je.target.value),id:"date"})]}),V.jsxs("div",{className:"question",children:[V.jsx("label",{htmlFor:"time",children:"Time of Incident: "}),V.jsxs("select",{onChange:Je=>w(Je.target.value),id:"time",children:[V.jsx("option",{value:"12:00 AM",children:"12:00 AM"}),V.jsx("option",{value:"12:15 AM",children:"12:15 AM"}),V.jsx("option",{value:"12:30 AM",children:"12:30 AM"}),V.jsx("option",{value:"12:45 AM",children:"12:45 AM"}),V.jsx("option",{value:"1:00 AM",children:"1:00 AM"}),V.jsx("option",{value:"1:15 AM",children:"1:15 AM"}),V.jsx("option",{value:"1:30 AM",children:"1:30 AM"}),V.jsx("option",{value:"1:45 AM",children:"1:45 AM"}),V.jsx("option",{value:"2:00 AM",children:"2:00 AM"}),V.jsx("option",{value:"2:15 AM",children:"2:15 AM"}),V.jsx("option",{value:"2:30 AM",children:"2:30 AM"}),V.jsx("option",{value:"2:45 AM",children:"2:45 AM"}),V.jsx("option",{value:"3:00 AM",children:"3:00 AM"}),V.jsx("option",{value:"3:15 AM",children:"3:15 AM"}),V.jsx("option",{value:"3:30 AM",children:"3:30 AM"}),V.jsx("option",{value:"3:45 AM",children:"3:45 AM"}),V.jsx("option",{value:"4:00 AM",children:"4:00 AM"}),V.jsx("option",{value:"4:15 AM",children:"4:15 AM"}),V.jsx("option",{value:"4:30 AM",children:"4:30 AM"}),V.jsx("option",{value:"4:45 AM",children:"4:45 AM"}),V.jsx("option",{value:"5:00 AM",children:"5:00 AM"}),V.jsx("option",{value:"5:15 AM",children:"5:15 AM"}),V.jsx("option",{value:"5:30 AM",children:"5:30 AM"}),V.jsx("option",{value:"5:45 AM",children:"5:45 AM"}),V.jsx("option",{value:"6:00 AM",children:"6:00 AM"}),V.jsx("option",{value:"6:15 AM",children:"6:15 AM"}),V.jsx("option",{value:"6:30 AM",children:"6:30 AM"}),V.jsx("option",{value:"6:45 AM",children:"6:45 AM"}),V.jsx("option",{value:"7:00 AM",children:"7:00 AM"}),V.jsx("option",{value:"7:15 AM",children:"7:15 AM"}),V.jsx("option",{value:"7:30 AM",children:"7:30 AM"}),V.jsx("option",{value:"7:45 AM",children:"7:45 AM"}),V.jsx("option",{value:"8:00 AM",children:"8:00 AM"}),V.jsx("option",{value:"8:15 AM",children:"8:15 AM"}),V.jsx("option",{value:"8:30 AM",children:"8:30 AM"}),V.jsx("option",{value:"8:45 AM",children:"8:45 AM"}),V.jsx("option",{value:"9:00 AM",children:"9:00 AM"}),V.jsx("option",{value:"9:15 AM",children:"9:15 AM"}),V.jsx("option",{value:"9:30 AM",children:"9:30 AM"}),V.jsx("option",{value:"9:45 AM",children:"9:45 AM"}),V.jsx("option",{value:"10:00 AM",children:"10:00 AM"}),V.jsx("option",{value:"10:15 AM",children:"10:15 AM"}),V.jsx("option",{value:"10:30 AM",children:"10:30 AM"}),V.jsx("option",{value:"10:45 AM",children:"10:45 AM"}),V.jsx("option",{value:"11:00 AM",children:"11:00 AM"}),V.jsx("option",{value:"11:15 AM",children:"11:15 AM"}),V.jsx("option",{value:"11:30 AM",children:"11:30 AM"}),V.jsx("option",{value:"11:45 AM",children:"11:45 AM"}),V.jsx("option",{value:"12:00 PM",children:"12:00 PM"}),V.jsx("option",{value:"12:15 PM",children:"12:15 PM"}),V.jsx("option",{value:"12:30 PM",children:"12:30 PM"}),V.jsx("option",{value:"12:45 PM",children:"12:45 PM"}),V.jsx("option",{value:"1:00 PM",children:"1:00 PM"}),V.jsx("option",{value:"1:15 PM",children:"1:15 PM"}),V.jsx("option",{value:"1:30 PM",children:"1:30 PM"}),V.jsx("option",{value:"1:45 PM",children:"1:45 PM"}),V.jsx("option",{value:"2:00 PM",children:"2:00 PM"}),V.jsx("option",{value:"2:15 PM",children:"2:15 PM"}),V.jsx("option",{value:"2:30 PM",children:"2:30 PM"}),V.jsx("option",{value:"2:45 PM",children:"2:45 PM"}),V.jsx("option",{value:"3:00 PM",children:"3:00 PM"}),V.jsx("option",{value:"3:15 PM",children:"3:15 PM"}),V.jsx("option",{value:"3:30 PM",children:"3:30 PM"}),V.jsx("option",{value:"3:45 PM",children:"3:45 PM"}),V.jsx("option",{value:"4:00 PM",children:"4:00 PM"}),V.jsx("option",{value:"4:15 PM",children:"4:15 PM"}),V.jsx("option",{value:"4:30 PM",children:"4:30 PM"}),V.jsx("option",{value:"4:45 PM",children:"4:45 PM"}),V.jsx("option",{value:"5:00 PM",children:"5:00 PM"}),V.jsx("option",{value:"5:15 PM",children:"5:15 PM"}),V.jsx("option",{value:"5:30 PM",children:"5:30 PM"}),V.jsx("option",{value:"5:45 PM",children:"5:45 PM"}),V.jsx("option",{value:"6:00 PM",children:"6:00 PM"}),V.jsx("option",{value:"6:15 PM",children:"6:15 PM"}),V.jsx("option",{value:"6:30 PM",children:"6:30 PM"}),V.jsx("option",{value:"6:45 PM",children:"6:45 PM"}),V.jsx("option",{value:"7:00 PM",children:"7:00 PM"}),V.jsx("option",{value:"7:15 PM",children:"7:15 PM"}),V.jsx("option",{value:"7:30 PM",children:"7:30 PM"}),V.jsx("option",{value:"7:45 PM",children:"7:45 PM"}),V.jsx("option",{value:"8:00 PM",children:"8:00 PM"}),V.jsx("option",{value:"8:15 PM",children:"8:15 PM"}),V.jsx("option",{value:"8:30 PM",children:"8:30 PM"}),V.jsx("option",{value:"8:45 PM",children:"8:45 PM"}),V.jsx("option",{value:"9:00 PM",children:"9:00 PM"}),V.jsx("option",{value:"9:15 PM",children:"9:15 PM"}),V.jsx("option",{value:"9:30 PM",children:"9:30 PM"}),V.jsx("option",{value:"9:45 PM",children:"9:45 PM"}),V.jsx("option",{value:"10:00 PM",children:"10:00 PM"}),V.jsx("option",{value:"10:15 PM",children:"10:15 PM"}),V.jsx("option",{value:"10:30 PM",children:"10:30 PM"}),V.jsx("option",{value:"10:45 PM",children:"10:45 PM"}),V.jsx("option",{value:"11:00 PM",children:"11:00 PM"}),V.jsx("option",{value:"11:15 PM",children:"11:15 PM"}),V.jsx("option",{value:"11:30 PM",children:"11:30 PM"}),V.jsx("option",{value:"11:45 PM",children:"11:45 PM"})]})]}),V.jsxs("div",{className:"question",children:[V.jsx("label",{htmlFor:"incidentType",children:"Incident Type: "}),V.jsxs("select",{id:"incidentType",onChange:Je=>a(Je.target.value),children:[V.jsx("option",{value:"Verbal Harrassment",children:"Verbal Harrassment"}),V.jsx("option",{value:"Physical Harrassment",children:"Physical Harrassment"}),V.jsx("option",{value:"Sexual Harrassment",children:"Sexual Harrassment"})]})]}),V.jsxs("div",{className:"question",children:[V.jsx("label",{htmlFor:"comment",children:"Comment: "}),V.jsx("textarea",{id:"comment",onChange:Je=>F(Je.target.value)})]}),V.jsxs("div",{className:"question",children:[V.jsx("label",{htmlFor:"currentLocation",children:"Location: "}),V.jsxs("div",{className:"locationdiv",children:[ze?V.jsx("button",{id:"loadinglocation",children:"Getting Location"}):Y!==""?V.jsx("button",{id:"havelocation",children:"Received"}):V.jsx("button",{id:"currentLocation",type:"button",onClick:Be,children:"Use Location"}),V.jsx("p",{id:"or",children:"OR"}),V.jsx("textarea",{id:"address",onChange:Je=>_e(Je.target.value),placeholder:"Enter address"})]})]}),V.jsx("button",{className:"submit-button",type:"submit",children:"Submit Report"})]}),V.jsx("img",{src:sc})]})})};var TL={prefix:"fas",iconName:"circle-info",icon:[512,512,["info-circle"],"f05a","M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"]},iE=TL,SL={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"]},oE=SL,sE={prefix:"fas",iconName:"check",icon:[448,512,[10003,10004],"f00c","M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"]};function aE(t,o){var u=Object.keys(t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);o&&(p=p.filter(function(y){return Object.getOwnPropertyDescriptor(t,y).enumerable})),u.push.apply(u,p)}return u}function xt(t){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?arguments[o]:{};o%2?aE(Object(u),!0).forEach(function(p){vr(t,p,u[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(u)):aE(Object(u)).forEach(function(p){Object.defineProperty(t,p,Object.getOwnPropertyDescriptor(u,p))})}return t}function Sg(t){"@babel/helpers - typeof";return Sg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Sg(t)}function CL(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function lE(t,o){for(var u=0;u<o.length;u++){var p=o[u];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(t,p.key,p)}}function AL(t,o,u){return o&&lE(t.prototype,o),u&&lE(t,u),Object.defineProperty(t,"prototype",{writable:!1}),t}function vr(t,o,u){return o in t?Object.defineProperty(t,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[o]=u,t}function Fx(t,o){return kL(t)||PL(t,o)||AC(t,o)||DL()}function Df(t){return ML(t)||IL(t)||AC(t)||zL()}function ML(t){if(Array.isArray(t))return wv(t)}function kL(t){if(Array.isArray(t))return t}function IL(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function PL(t,o){var u=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(u!=null){var p=[],y=!0,w=!1,C,a;try{for(u=u.call(t);!(y=(C=u.next()).done)&&(p.push(C.value),!(o&&p.length===o));y=!0);}catch(z){w=!0,a=z}finally{try{!y&&u.return!=null&&u.return()}finally{if(w)throw a}}return p}}function AC(t,o){if(t){if(typeof t=="string")return wv(t,o);var u=Object.prototype.toString.call(t).slice(8,-1);if(u==="Object"&&t.constructor&&(u=t.constructor.name),u==="Map"||u==="Set")return Array.from(t);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return wv(t,o)}}function wv(t,o){(o==null||o>t.length)&&(o=t.length);for(var u=0,p=new Array(o);u<o;u++)p[u]=t[u];return p}function zL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var cE=function(){},Nx={},MC={},kC=null,IC={mark:cE,measure:cE};try{typeof window<"u"&&(Nx=window),typeof document<"u"&&(MC=document),typeof MutationObserver<"u"&&(kC=MutationObserver),typeof performance<"u"&&(IC=performance)}catch{}var LL=Nx.navigator||{},uE=LL.userAgent,hE=uE===void 0?"":uE,$a=Nx,Bn=MC,dE=kC,Sm=IC;$a.document;var Fs=!!Bn.documentElement&&!!Bn.head&&typeof Bn.addEventListener=="function"&&typeof Bn.createElement=="function",PC=~hE.indexOf("MSIE")||~hE.indexOf("Trident/"),Cm,Am,Mm,km,Im,Ls="___FONT_AWESOME___",bv=16,zC="fa",DC="svg-inline--fa",nc="data-fa-i2svg",Ev="data-fa-pseudo-element",RL="data-fa-pseudo-element-pending",jx="data-prefix",Ux="data-icon",fE="fontawesome-i2svg",OL="async",BL=["HTML","HEAD","STYLE","SCRIPT"],LC=function(){try{return!0}catch{return!1}}(),Rn="classic",nr="sharp",Vx=[Rn,nr];function Lf(t){return new Proxy(t,{get:function(u,p){return p in u?u[p]:u[Rn]}})}var yf=Lf((Cm={},vr(Cm,Rn,{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit","fa-kit":"kit"}),vr(Cm,nr,{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light"}),Cm)),vf=Lf((Am={},vr(Am,Rn,{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"}),vr(Am,nr,{solid:"fass",regular:"fasr",light:"fasl"}),Am)),xf=Lf((Mm={},vr(Mm,Rn,{fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"}),vr(Mm,nr,{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light"}),Mm)),FL=Lf((km={},vr(km,Rn,{"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"}),vr(km,nr,{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl"}),km)),NL=/fa(s|r|l|t|d|b|k|ss|sr|sl)?[\-\ ]/,RC="fa-layers-text",jL=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp|Kit)?.*/i,UL=Lf((Im={},vr(Im,Rn,{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"}),vr(Im,nr,{900:"fass",400:"fasr",300:"fasl"}),Im)),OC=[1,2,3,4,5,6,7,8,9,10],VL=OC.concat([11,12,13,14,15,16,17,18,19,20]),$L=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],Wl={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},wf=new Set;Object.keys(vf[Rn]).map(wf.add.bind(wf));Object.keys(vf[nr]).map(wf.add.bind(wf));var GL=[].concat(Vx,Df(wf),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",Wl.GROUP,Wl.SWAP_OPACITY,Wl.PRIMARY,Wl.SECONDARY]).concat(OC.map(function(t){return"".concat(t,"x")})).concat(VL.map(function(t){return"w-".concat(t)})),Hd=$a.FontAwesomeConfig||{};function qL(t){var o=Bn.querySelector("script["+t+"]");if(o)return o.getAttribute(t)}function ZL(t){return t===""?!0:t==="false"?!1:t==="true"?!0:t}if(Bn&&typeof Bn.querySelector=="function"){var WL=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];WL.forEach(function(t){var o=Fx(t,2),u=o[0],p=o[1],y=ZL(qL(u));y!=null&&(Hd[p]=y)})}var BC={styleDefault:"solid",familyDefault:"classic",cssPrefix:zC,replacementClass:DC,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Hd.familyPrefix&&(Hd.cssPrefix=Hd.familyPrefix);var Uu=xt(xt({},BC),Hd);Uu.autoReplaceSvg||(Uu.observeMutations=!1);var Ct={};Object.keys(BC).forEach(function(t){Object.defineProperty(Ct,t,{enumerable:!0,set:function(u){Uu[t]=u,Yd.forEach(function(p){return p(Ct)})},get:function(){return Uu[t]}})});Object.defineProperty(Ct,"familyPrefix",{enumerable:!0,set:function(o){Uu.cssPrefix=o,Yd.forEach(function(u){return u(Ct)})},get:function(){return Uu.cssPrefix}});$a.FontAwesomeConfig=Ct;var Yd=[];function XL(t){return Yd.push(t),function(){Yd.splice(Yd.indexOf(t),1)}}var Ea=bv,Ko={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function HL(t){if(!(!t||!Fs)){var o=Bn.createElement("style");o.setAttribute("type","text/css"),o.innerHTML=t;for(var u=Bn.head.childNodes,p=null,y=u.length-1;y>-1;y--){var w=u[y],C=(w.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(C)>-1&&(p=w)}return Bn.head.insertBefore(o,p),t}}var YL="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function bf(){for(var t=12,o="";t-- >0;)o+=YL[Math.random()*62|0];return o}function Xu(t){for(var o=[],u=(t||[]).length>>>0;u--;)o[u]=t[u];return o}function $x(t){return t.classList?Xu(t.classList):(t.getAttribute("class")||"").split(" ").filter(function(o){return o})}function FC(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function KL(t){return Object.keys(t||{}).reduce(function(o,u){return o+"".concat(u,'="').concat(FC(t[u]),'" ')},"").trim()}function Qg(t){return Object.keys(t||{}).reduce(function(o,u){return o+"".concat(u,": ").concat(t[u].trim(),";")},"")}function Gx(t){return t.size!==Ko.size||t.x!==Ko.x||t.y!==Ko.y||t.rotate!==Ko.rotate||t.flipX||t.flipY}function JL(t){var o=t.transform,u=t.containerWidth,p=t.iconWidth,y={transform:"translate(".concat(u/2," 256)")},w="translate(".concat(o.x*32,", ").concat(o.y*32,") "),C="scale(".concat(o.size/16*(o.flipX?-1:1),", ").concat(o.size/16*(o.flipY?-1:1),") "),a="rotate(".concat(o.rotate," 0 0)"),z={transform:"".concat(w," ").concat(C," ").concat(a)},F={transform:"translate(".concat(p/2*-1," -256)")};return{outer:y,inner:z,path:F}}function QL(t){var o=t.transform,u=t.width,p=u===void 0?bv:u,y=t.height,w=y===void 0?bv:y,C=t.startCentered,a=C===void 0?!1:C,z="";return a&&PC?z+="translate(".concat(o.x/Ea-p/2,"em, ").concat(o.y/Ea-w/2,"em) "):a?z+="translate(calc(-50% + ".concat(o.x/Ea,"em), calc(-50% + ").concat(o.y/Ea,"em)) "):z+="translate(".concat(o.x/Ea,"em, ").concat(o.y/Ea,"em) "),z+="scale(".concat(o.size/Ea*(o.flipX?-1:1),", ").concat(o.size/Ea*(o.flipY?-1:1),") "),z+="rotate(".concat(o.rotate,"deg) "),z}var e3=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-counter-scale, 0.25));
          transform: scale(var(--fa-counter-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  -webkit-transform: scale(var(--fa-layers-scale, 0.25));
          transform: scale(var(--fa-layers-scale, 0.25));
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(var(--fa-li-width, 2em) * -1);
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  -webkit-animation-name: fa-beat;
          animation-name: fa-beat;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  -webkit-animation-name: fa-bounce;
          animation-name: fa-bounce;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  -webkit-animation-name: fa-fade;
          animation-name: fa-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  -webkit-animation-name: fa-beat-fade;
          animation-name: fa-beat-fade;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  -webkit-animation-name: fa-flip;
          animation-name: fa-flip;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);
          animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  -webkit-animation-name: fa-shake;
          animation-name: fa-shake;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-delay: var(--fa-animation-delay, 0s);
          animation-delay: var(--fa-animation-delay, 0s);
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 2s);
          animation-duration: var(--fa-animation-duration, 2s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, linear);
          animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  -webkit-animation-name: fa-spin;
          animation-name: fa-spin;
  -webkit-animation-direction: var(--fa-animation-direction, normal);
          animation-direction: var(--fa-animation-direction, normal);
  -webkit-animation-duration: var(--fa-animation-duration, 1s);
          animation-duration: var(--fa-animation-duration, 1s);
  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);
          animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));
          animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    -webkit-animation-delay: -1ms;
            animation-delay: -1ms;
    -webkit-animation-duration: 1ms;
            animation-duration: 1ms;
    -webkit-animation-iteration-count: 1;
            animation-iteration-count: 1;
    -webkit-transition-delay: 0s;
            transition-delay: 0s;
    -webkit-transition-duration: 0s;
            transition-duration: 0s;
  }
}
@-webkit-keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-beat {
  0%, 90% {
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  45% {
    -webkit-transform: scale(var(--fa-beat-scale, 1.25));
            transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@-webkit-keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-bounce {
  0% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  10% {
    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
  100% {
    -webkit-transform: scale(1, 1) translateY(0);
            transform: scale(1, 1) translateY(0);
  }
}
@-webkit-keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@-webkit-keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    -webkit-transform: scale(1);
            transform: scale(1);
  }
  50% {
    opacity: 1;
    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));
            transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@-webkit-keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-flip {
  50% {
    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@-webkit-keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@keyframes fa-shake {
  0% {
    -webkit-transform: rotate(-15deg);
            transform: rotate(-15deg);
  }
  4% {
    -webkit-transform: rotate(15deg);
            transform: rotate(15deg);
  }
  8%, 24% {
    -webkit-transform: rotate(-18deg);
            transform: rotate(-18deg);
  }
  12%, 28% {
    -webkit-transform: rotate(18deg);
            transform: rotate(18deg);
  }
  16% {
    -webkit-transform: rotate(-22deg);
            transform: rotate(-22deg);
  }
  20% {
    -webkit-transform: rotate(22deg);
            transform: rotate(22deg);
  }
  32% {
    -webkit-transform: rotate(-12deg);
            transform: rotate(-12deg);
  }
  36% {
    -webkit-transform: rotate(12deg);
            transform: rotate(12deg);
  }
  40%, 100% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
}
@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

.fa-rotate-by {
  -webkit-transform: rotate(var(--fa-rotate-angle, none));
          transform: rotate(var(--fa-rotate-angle, none));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function NC(){var t=zC,o=DC,u=Ct.cssPrefix,p=Ct.replacementClass,y=e3;if(u!==t||p!==o){var w=new RegExp("\\.".concat(t,"\\-"),"g"),C=new RegExp("\\--".concat(t,"\\-"),"g"),a=new RegExp("\\.".concat(o),"g");y=y.replace(w,".".concat(u,"-")).replace(C,"--".concat(u,"-")).replace(a,".".concat(p))}return y}var pE=!1;function f0(){Ct.autoAddCss&&!pE&&(HL(NC()),pE=!0)}var t3={mixout:function(){return{dom:{css:NC,insertCss:f0}}},hooks:function(){return{beforeDOMElementCreation:function(){f0()},beforeI2svg:function(){f0()}}}},Rs=$a||{};Rs[Ls]||(Rs[Ls]={});Rs[Ls].styles||(Rs[Ls].styles={});Rs[Ls].hooks||(Rs[Ls].hooks={});Rs[Ls].shims||(Rs[Ls].shims=[]);var Ao=Rs[Ls],jC=[],n3=function t(){Bn.removeEventListener("DOMContentLoaded",t),Cg=1,jC.map(function(o){return o()})},Cg=!1;Fs&&(Cg=(Bn.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Bn.readyState),Cg||Bn.addEventListener("DOMContentLoaded",n3));function r3(t){Fs&&(Cg?setTimeout(t,0):jC.push(t))}function Rf(t){var o=t.tag,u=t.attributes,p=u===void 0?{}:u,y=t.children,w=y===void 0?[]:y;return typeof t=="string"?FC(t):"<".concat(o," ").concat(KL(p),">").concat(w.map(Rf).join(""),"</").concat(o,">")}function mE(t,o,u){if(t&&t[o]&&t[o][u])return{prefix:o,iconName:u,icon:t[o][u]}}var i3=function(o,u){return function(p,y,w,C){return o.call(u,p,y,w,C)}},p0=function(o,u,p,y){var w=Object.keys(o),C=w.length,a=y!==void 0?i3(u,y):u,z,F,H;for(p===void 0?(z=1,H=o[w[0]]):(z=0,H=p);z<C;z++)F=w[z],H=a(H,o[F],F,o);return H};function o3(t){for(var o=[],u=0,p=t.length;u<p;){var y=t.charCodeAt(u++);if(y>=55296&&y<=56319&&u<p){var w=t.charCodeAt(u++);(w&64512)==56320?o.push(((y&1023)<<10)+(w&1023)+65536):(o.push(y),u--)}else o.push(y)}return o}function Tv(t){var o=o3(t);return o.length===1?o[0].toString(16):null}function s3(t,o){var u=t.length,p=t.charCodeAt(o),y;return p>=55296&&p<=56319&&u>o+1&&(y=t.charCodeAt(o+1),y>=56320&&y<=57343)?(p-55296)*1024+y-56320+65536:p}function gE(t){return Object.keys(t).reduce(function(o,u){var p=t[u],y=!!p.icon;return y?o[p.iconName]=p.icon:o[u]=p,o},{})}function Sv(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p=u.skipHooks,y=p===void 0?!1:p,w=gE(o);typeof Ao.hooks.addPack=="function"&&!y?Ao.hooks.addPack(t,gE(o)):Ao.styles[t]=xt(xt({},Ao.styles[t]||{}),w),t==="fas"&&Sv("fa",o)}var Pm,zm,Dm,Eu=Ao.styles,a3=Ao.shims,l3=(Pm={},vr(Pm,Rn,Object.values(xf[Rn])),vr(Pm,nr,Object.values(xf[nr])),Pm),qx=null,UC={},VC={},$C={},GC={},qC={},c3=(zm={},vr(zm,Rn,Object.keys(yf[Rn])),vr(zm,nr,Object.keys(yf[nr])),zm);function u3(t){return~GL.indexOf(t)}function h3(t,o){var u=o.split("-"),p=u[0],y=u.slice(1).join("-");return p===t&&y!==""&&!u3(y)?y:null}var ZC=function(){var o=function(w){return p0(Eu,function(C,a,z){return C[z]=p0(a,w,{}),C},{})};UC=o(function(y,w,C){if(w[3]&&(y[w[3]]=C),w[2]){var a=w[2].filter(function(z){return typeof z=="number"});a.forEach(function(z){y[z.toString(16)]=C})}return y}),VC=o(function(y,w,C){if(y[C]=C,w[2]){var a=w[2].filter(function(z){return typeof z=="string"});a.forEach(function(z){y[z]=C})}return y}),qC=o(function(y,w,C){var a=w[2];return y[C]=C,a.forEach(function(z){y[z]=C}),y});var u="far"in Eu||Ct.autoFetchSvg,p=p0(a3,function(y,w){var C=w[0],a=w[1],z=w[2];return a==="far"&&!u&&(a="fas"),typeof C=="string"&&(y.names[C]={prefix:a,iconName:z}),typeof C=="number"&&(y.unicodes[C.toString(16)]={prefix:a,iconName:z}),y},{names:{},unicodes:{}});$C=p.names,GC=p.unicodes,qx=e_(Ct.styleDefault,{family:Ct.familyDefault})};XL(function(t){qx=e_(t.styleDefault,{family:Ct.familyDefault})});ZC();function Zx(t,o){return(UC[t]||{})[o]}function d3(t,o){return(VC[t]||{})[o]}function Xl(t,o){return(qC[t]||{})[o]}function WC(t){return $C[t]||{prefix:null,iconName:null}}function f3(t){var o=GC[t],u=Zx("fas",t);return o||(u?{prefix:"fas",iconName:u}:null)||{prefix:null,iconName:null}}function Ga(){return qx}var Wx=function(){return{prefix:null,iconName:null,rest:[]}};function e_(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=o.family,p=u===void 0?Rn:u,y=yf[p][t],w=vf[p][t]||vf[p][y],C=t in Ao.styles?t:null;return w||C||null}var _E=(Dm={},vr(Dm,Rn,Object.keys(xf[Rn])),vr(Dm,nr,Object.keys(xf[nr])),Dm);function t_(t){var o,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=u.skipLookups,y=p===void 0?!1:p,w=(o={},vr(o,Rn,"".concat(Ct.cssPrefix,"-").concat(Rn)),vr(o,nr,"".concat(Ct.cssPrefix,"-").concat(nr)),o),C=null,a=Rn;(t.includes(w[Rn])||t.some(function(F){return _E[Rn].includes(F)}))&&(a=Rn),(t.includes(w[nr])||t.some(function(F){return _E[nr].includes(F)}))&&(a=nr);var z=t.reduce(function(F,H){var Z=h3(Ct.cssPrefix,H);if(Eu[H]?(H=l3[a].includes(H)?FL[a][H]:H,C=H,F.prefix=H):c3[a].indexOf(H)>-1?(C=H,F.prefix=e_(H,{family:a})):Z?F.iconName=Z:H!==Ct.replacementClass&&H!==w[Rn]&&H!==w[nr]&&F.rest.push(H),!y&&F.prefix&&F.iconName){var Y=C==="fa"?WC(F.iconName):{},ie=Xl(F.prefix,F.iconName);Y.prefix&&(C=null),F.iconName=Y.iconName||ie||F.iconName,F.prefix=Y.prefix||F.prefix,F.prefix==="far"&&!Eu.far&&Eu.fas&&!Ct.autoFetchSvg&&(F.prefix="fas")}return F},Wx());return(t.includes("fa-brands")||t.includes("fab"))&&(z.prefix="fab"),(t.includes("fa-duotone")||t.includes("fad"))&&(z.prefix="fad"),!z.prefix&&a===nr&&(Eu.fass||Ct.autoFetchSvg)&&(z.prefix="fass",z.iconName=Xl(z.prefix,z.iconName)||z.iconName),(z.prefix==="fa"||C==="fa")&&(z.prefix=Ga()||"fas"),z}var p3=function(){function t(){CL(this,t),this.definitions={}}return AL(t,[{key:"add",value:function(){for(var u=this,p=arguments.length,y=new Array(p),w=0;w<p;w++)y[w]=arguments[w];var C=y.reduce(this._pullDefinitions,{});Object.keys(C).forEach(function(a){u.definitions[a]=xt(xt({},u.definitions[a]||{}),C[a]),Sv(a,C[a]);var z=xf[Rn][a];z&&Sv(z,C[a]),ZC()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(u,p){var y=p.prefix&&p.iconName&&p.icon?{0:p}:p;return Object.keys(y).map(function(w){var C=y[w],a=C.prefix,z=C.iconName,F=C.icon,H=F[2];u[a]||(u[a]={}),H.length>0&&H.forEach(function(Z){typeof Z=="string"&&(u[a][Z]=F)}),u[a][z]=F}),u}}]),t}(),yE=[],Tu={},zu={},m3=Object.keys(zu);function g3(t,o){var u=o.mixoutsTo;return yE=t,Tu={},Object.keys(zu).forEach(function(p){m3.indexOf(p)===-1&&delete zu[p]}),yE.forEach(function(p){var y=p.mixout?p.mixout():{};if(Object.keys(y).forEach(function(C){typeof y[C]=="function"&&(u[C]=y[C]),Sg(y[C])==="object"&&Object.keys(y[C]).forEach(function(a){u[C]||(u[C]={}),u[C][a]=y[C][a]})}),p.hooks){var w=p.hooks();Object.keys(w).forEach(function(C){Tu[C]||(Tu[C]=[]),Tu[C].push(w[C])})}p.provides&&p.provides(zu)}),u}function Cv(t,o){for(var u=arguments.length,p=new Array(u>2?u-2:0),y=2;y<u;y++)p[y-2]=arguments[y];var w=Tu[t]||[];return w.forEach(function(C){o=C.apply(null,[o].concat(p))}),o}function rc(t){for(var o=arguments.length,u=new Array(o>1?o-1:0),p=1;p<o;p++)u[p-1]=arguments[p];var y=Tu[t]||[];y.forEach(function(w){w.apply(null,u)})}function Os(){var t=arguments[0],o=Array.prototype.slice.call(arguments,1);return zu[t]?zu[t].apply(null,o):void 0}function Av(t){t.prefix==="fa"&&(t.prefix="fas");var o=t.iconName,u=t.prefix||Ga();if(o)return o=Xl(u,o)||o,mE(XC.definitions,u,o)||mE(Ao.styles,u,o)}var XC=new p3,_3=function(){Ct.autoReplaceSvg=!1,Ct.observeMutations=!1,rc("noAuto")},y3={i2svg:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Fs?(rc("beforeI2svg",o),Os("pseudoElements2svg",o),Os("i2svg",o)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=o.autoReplaceSvgRoot;Ct.autoReplaceSvg===!1&&(Ct.autoReplaceSvg=!0),Ct.observeMutations=!0,r3(function(){x3({autoReplaceSvgRoot:u}),rc("watch",o)})}},v3={icon:function(o){if(o===null)return null;if(Sg(o)==="object"&&o.prefix&&o.iconName)return{prefix:o.prefix,iconName:Xl(o.prefix,o.iconName)||o.iconName};if(Array.isArray(o)&&o.length===2){var u=o[1].indexOf("fa-")===0?o[1].slice(3):o[1],p=e_(o[0]);return{prefix:p,iconName:Xl(p,u)||u}}if(typeof o=="string"&&(o.indexOf("".concat(Ct.cssPrefix,"-"))>-1||o.match(NL))){var y=t_(o.split(" "),{skipLookups:!0});return{prefix:y.prefix||Ga(),iconName:Xl(y.prefix,y.iconName)||y.iconName}}if(typeof o=="string"){var w=Ga();return{prefix:w,iconName:Xl(w,o)||o}}}},Ri={noAuto:_3,config:Ct,dom:y3,parse:v3,library:XC,findIconDefinition:Av,toHtml:Rf},x3=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=o.autoReplaceSvgRoot,p=u===void 0?Bn:u;(Object.keys(Ao.styles).length>0||Ct.autoFetchSvg)&&Fs&&Ct.autoReplaceSvg&&Ri.dom.i2svg({node:p})};function n_(t,o){return Object.defineProperty(t,"abstract",{get:o}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(function(p){return Rf(p)})}}),Object.defineProperty(t,"node",{get:function(){if(Fs){var p=Bn.createElement("div");return p.innerHTML=t.html,p.children}}}),t}function w3(t){var o=t.children,u=t.main,p=t.mask,y=t.attributes,w=t.styles,C=t.transform;if(Gx(C)&&u.found&&!p.found){var a=u.width,z=u.height,F={x:a/z/2,y:.5};y.style=Qg(xt(xt({},w),{},{"transform-origin":"".concat(F.x+C.x/16,"em ").concat(F.y+C.y/16,"em")}))}return[{tag:"svg",attributes:y,children:o}]}function b3(t){var o=t.prefix,u=t.iconName,p=t.children,y=t.attributes,w=t.symbol,C=w===!0?"".concat(o,"-").concat(Ct.cssPrefix,"-").concat(u):w;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:xt(xt({},y),{},{id:C}),children:p}]}]}function Xx(t){var o=t.icons,u=o.main,p=o.mask,y=t.prefix,w=t.iconName,C=t.transform,a=t.symbol,z=t.title,F=t.maskId,H=t.titleId,Z=t.extra,Y=t.watchable,ie=Y===void 0?!1:Y,ce=p.found?p:u,_e=ce.width,ze=ce.height,le=y==="fak",ee=[Ct.replacementClass,w?"".concat(Ct.cssPrefix,"-").concat(w):""].filter(function(De){return Z.classes.indexOf(De)===-1}).filter(function(De){return De!==""||!!De}).concat(Z.classes).join(" "),ue={children:[],attributes:xt(xt({},Z.attributes),{},{"data-prefix":y,"data-icon":w,class:ee,role:Z.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(_e," ").concat(ze)})},Be=le&&!~Z.classes.indexOf("fa-fw")?{width:"".concat(_e/ze*16*.0625,"em")}:{};ie&&(ue.attributes[nc]=""),z&&(ue.children.push({tag:"title",attributes:{id:ue.attributes["aria-labelledby"]||"title-".concat(H||bf())},children:[z]}),delete ue.attributes.title);var $e=xt(xt({},ue),{},{prefix:y,iconName:w,main:u,mask:p,maskId:F,transform:C,symbol:a,styles:xt(xt({},Be),Z.styles)}),ot=p.found&&u.found?Os("generateAbstractMask",$e)||{children:[],attributes:{}}:Os("generateAbstractIcon",$e)||{children:[],attributes:{}},rt=ot.children,Je=ot.attributes;return $e.children=rt,$e.attributes=Je,a?b3($e):w3($e)}function vE(t){var o=t.content,u=t.width,p=t.height,y=t.transform,w=t.title,C=t.extra,a=t.watchable,z=a===void 0?!1:a,F=xt(xt(xt({},C.attributes),w?{title:w}:{}),{},{class:C.classes.join(" ")});z&&(F[nc]="");var H=xt({},C.styles);Gx(y)&&(H.transform=QL({transform:y,startCentered:!0,width:u,height:p}),H["-webkit-transform"]=H.transform);var Z=Qg(H);Z.length>0&&(F.style=Z);var Y=[];return Y.push({tag:"span",attributes:F,children:[o]}),w&&Y.push({tag:"span",attributes:{class:"sr-only"},children:[w]}),Y}function E3(t){var o=t.content,u=t.title,p=t.extra,y=xt(xt(xt({},p.attributes),u?{title:u}:{}),{},{class:p.classes.join(" ")}),w=Qg(p.styles);w.length>0&&(y.style=w);var C=[];return C.push({tag:"span",attributes:y,children:[o]}),u&&C.push({tag:"span",attributes:{class:"sr-only"},children:[u]}),C}var m0=Ao.styles;function Mv(t){var o=t[0],u=t[1],p=t.slice(4),y=Fx(p,1),w=y[0],C=null;return Array.isArray(w)?C={tag:"g",attributes:{class:"".concat(Ct.cssPrefix,"-").concat(Wl.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Ct.cssPrefix,"-").concat(Wl.SECONDARY),fill:"currentColor",d:w[0]}},{tag:"path",attributes:{class:"".concat(Ct.cssPrefix,"-").concat(Wl.PRIMARY),fill:"currentColor",d:w[1]}}]}:C={tag:"path",attributes:{fill:"currentColor",d:w}},{found:!0,width:o,height:u,icon:C}}var T3={found:!1,width:512,height:512};function S3(t,o){!LC&&!Ct.showMissingIcons&&t&&console.error('Icon with name "'.concat(t,'" and prefix "').concat(o,'" is missing.'))}function kv(t,o){var u=o;return o==="fa"&&Ct.styleDefault!==null&&(o=Ga()),new Promise(function(p,y){if(Os("missingIconAbstract"),u==="fa"){var w=WC(t)||{};t=w.iconName||t,o=w.prefix||o}if(t&&o&&m0[o]&&m0[o][t]){var C=m0[o][t];return p(Mv(C))}S3(t,o),p(xt(xt({},T3),{},{icon:Ct.showMissingIcons&&t?Os("missingIconAbstract")||{}:{}}))})}var xE=function(){},Iv=Ct.measurePerformance&&Sm&&Sm.mark&&Sm.measure?Sm:{mark:xE,measure:xE},Nd='FA "6.4.0"',C3=function(o){return Iv.mark("".concat(Nd," ").concat(o," begins")),function(){return HC(o)}},HC=function(o){Iv.mark("".concat(Nd," ").concat(o," ends")),Iv.measure("".concat(Nd," ").concat(o),"".concat(Nd," ").concat(o," begins"),"".concat(Nd," ").concat(o," ends"))},Hx={begin:C3,end:HC},Ym=function(){};function wE(t){var o=t.getAttribute?t.getAttribute(nc):null;return typeof o=="string"}function A3(t){var o=t.getAttribute?t.getAttribute(jx):null,u=t.getAttribute?t.getAttribute(Ux):null;return o&&u}function M3(t){return t&&t.classList&&t.classList.contains&&t.classList.contains(Ct.replacementClass)}function k3(){if(Ct.autoReplaceSvg===!0)return Km.replace;var t=Km[Ct.autoReplaceSvg];return t||Km.replace}function I3(t){return Bn.createElementNS("http://www.w3.org/2000/svg",t)}function P3(t){return Bn.createElement(t)}function YC(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=o.ceFn,p=u===void 0?t.tag==="svg"?I3:P3:u;if(typeof t=="string")return Bn.createTextNode(t);var y=p(t.tag);Object.keys(t.attributes||[]).forEach(function(C){y.setAttribute(C,t.attributes[C])});var w=t.children||[];return w.forEach(function(C){y.appendChild(YC(C,{ceFn:p}))}),y}function z3(t){var o=" ".concat(t.outerHTML," ");return o="".concat(o,"Font Awesome fontawesome.com "),o}var Km={replace:function(o){var u=o[0];if(u.parentNode)if(o[1].forEach(function(y){u.parentNode.insertBefore(YC(y),u)}),u.getAttribute(nc)===null&&Ct.keepOriginalSource){var p=Bn.createComment(z3(u));u.parentNode.replaceChild(p,u)}else u.remove()},nest:function(o){var u=o[0],p=o[1];if(~$x(u).indexOf(Ct.replacementClass))return Km.replace(o);var y=new RegExp("".concat(Ct.cssPrefix,"-.*"));if(delete p[0].attributes.id,p[0].attributes.class){var w=p[0].attributes.class.split(" ").reduce(function(a,z){return z===Ct.replacementClass||z.match(y)?a.toSvg.push(z):a.toNode.push(z),a},{toNode:[],toSvg:[]});p[0].attributes.class=w.toSvg.join(" "),w.toNode.length===0?u.removeAttribute("class"):u.setAttribute("class",w.toNode.join(" "))}var C=p.map(function(a){return Rf(a)}).join(`
`);u.setAttribute(nc,""),u.innerHTML=C}};function bE(t){t()}function KC(t,o){var u=typeof o=="function"?o:Ym;if(t.length===0)u();else{var p=bE;Ct.mutateApproach===OL&&(p=$a.requestAnimationFrame||bE),p(function(){var y=k3(),w=Hx.begin("mutate");t.map(y),w(),u()})}}var Yx=!1;function JC(){Yx=!0}function Pv(){Yx=!1}var Ag=null;function EE(t){if(dE&&Ct.observeMutations){var o=t.treeCallback,u=o===void 0?Ym:o,p=t.nodeCallback,y=p===void 0?Ym:p,w=t.pseudoElementsCallback,C=w===void 0?Ym:w,a=t.observeMutationsRoot,z=a===void 0?Bn:a;Ag=new dE(function(F){if(!Yx){var H=Ga();Xu(F).forEach(function(Z){if(Z.type==="childList"&&Z.addedNodes.length>0&&!wE(Z.addedNodes[0])&&(Ct.searchPseudoElements&&C(Z.target),u(Z.target)),Z.type==="attributes"&&Z.target.parentNode&&Ct.searchPseudoElements&&C(Z.target.parentNode),Z.type==="attributes"&&wE(Z.target)&&~$L.indexOf(Z.attributeName))if(Z.attributeName==="class"&&A3(Z.target)){var Y=t_($x(Z.target)),ie=Y.prefix,ce=Y.iconName;Z.target.setAttribute(jx,ie||H),ce&&Z.target.setAttribute(Ux,ce)}else M3(Z.target)&&y(Z.target)})}}),Fs&&Ag.observe(z,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function D3(){Ag&&Ag.disconnect()}function L3(t){var o=t.getAttribute("style"),u=[];return o&&(u=o.split(";").reduce(function(p,y){var w=y.split(":"),C=w[0],a=w.slice(1);return C&&a.length>0&&(p[C]=a.join(":").trim()),p},{})),u}function R3(t){var o=t.getAttribute("data-prefix"),u=t.getAttribute("data-icon"),p=t.innerText!==void 0?t.innerText.trim():"",y=t_($x(t));return y.prefix||(y.prefix=Ga()),o&&u&&(y.prefix=o,y.iconName=u),y.iconName&&y.prefix||(y.prefix&&p.length>0&&(y.iconName=d3(y.prefix,t.innerText)||Zx(y.prefix,Tv(t.innerText))),!y.iconName&&Ct.autoFetchSvg&&t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&(y.iconName=t.firstChild.data)),y}function O3(t){var o=Xu(t.attributes).reduce(function(y,w){return y.name!=="class"&&y.name!=="style"&&(y[w.name]=w.value),y},{}),u=t.getAttribute("title"),p=t.getAttribute("data-fa-title-id");return Ct.autoA11y&&(u?o["aria-labelledby"]="".concat(Ct.replacementClass,"-title-").concat(p||bf()):(o["aria-hidden"]="true",o.focusable="false")),o}function B3(){return{iconName:null,title:null,titleId:null,prefix:null,transform:Ko,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function TE(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},u=R3(t),p=u.iconName,y=u.prefix,w=u.rest,C=O3(t),a=Cv("parseNodeAttributes",{},t),z=o.styleParser?L3(t):[];return xt({iconName:p,title:t.getAttribute("title"),titleId:t.getAttribute("data-fa-title-id"),prefix:y,transform:Ko,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:w,styles:z,attributes:C}},a)}var F3=Ao.styles;function QC(t){var o=Ct.autoReplaceSvg==="nest"?TE(t,{styleParser:!1}):TE(t);return~o.extra.classes.indexOf(RC)?Os("generateLayersText",t,o):Os("generateSvgReplacementMutation",t,o)}var qa=new Set;Vx.map(function(t){qa.add("fa-".concat(t))});Object.keys(yf[Rn]).map(qa.add.bind(qa));Object.keys(yf[nr]).map(qa.add.bind(qa));qa=Df(qa);function SE(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!Fs)return Promise.resolve();var u=Bn.documentElement.classList,p=function(Z){return u.add("".concat(fE,"-").concat(Z))},y=function(Z){return u.remove("".concat(fE,"-").concat(Z))},w=Ct.autoFetchSvg?qa:Vx.map(function(H){return"fa-".concat(H)}).concat(Object.keys(F3));w.includes("fa")||w.push("fa");var C=[".".concat(RC,":not([").concat(nc,"])")].concat(w.map(function(H){return".".concat(H,":not([").concat(nc,"])")})).join(", ");if(C.length===0)return Promise.resolve();var a=[];try{a=Xu(t.querySelectorAll(C))}catch{}if(a.length>0)p("pending"),y("complete");else return Promise.resolve();var z=Hx.begin("onTree"),F=a.reduce(function(H,Z){try{var Y=QC(Z);Y&&H.push(Y)}catch(ie){LC||ie.name==="MissingIcon"&&console.error(ie)}return H},[]);return new Promise(function(H,Z){Promise.all(F).then(function(Y){KC(Y,function(){p("active"),p("complete"),y("pending"),typeof o=="function"&&o(),z(),H()})}).catch(function(Y){z(),Z(Y)})})}function N3(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;QC(t).then(function(u){u&&KC([u],o)})}function j3(t){return function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=(o||{}).icon?o:Av(o||{}),y=u.mask;return y&&(y=(y||{}).icon?y:Av(y||{})),t(p,xt(xt({},u),{},{mask:y}))}}var U3=function(o){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=u.transform,y=p===void 0?Ko:p,w=u.symbol,C=w===void 0?!1:w,a=u.mask,z=a===void 0?null:a,F=u.maskId,H=F===void 0?null:F,Z=u.title,Y=Z===void 0?null:Z,ie=u.titleId,ce=ie===void 0?null:ie,_e=u.classes,ze=_e===void 0?[]:_e,le=u.attributes,ee=le===void 0?{}:le,ue=u.styles,Be=ue===void 0?{}:ue;if(o){var $e=o.prefix,ot=o.iconName,rt=o.icon;return n_(xt({type:"icon"},o),function(){return rc("beforeDOMElementCreation",{iconDefinition:o,params:u}),Ct.autoA11y&&(Y?ee["aria-labelledby"]="".concat(Ct.replacementClass,"-title-").concat(ce||bf()):(ee["aria-hidden"]="true",ee.focusable="false")),Xx({icons:{main:Mv(rt),mask:z?Mv(z.icon):{found:!1,width:null,height:null,icon:{}}},prefix:$e,iconName:ot,transform:xt(xt({},Ko),y),symbol:C,title:Y,maskId:H,titleId:ce,extra:{attributes:ee,styles:Be,classes:ze}})})}},V3={mixout:function(){return{icon:j3(U3)}},hooks:function(){return{mutationObserverCallbacks:function(u){return u.treeCallback=SE,u.nodeCallback=N3,u}}},provides:function(o){o.i2svg=function(u){var p=u.node,y=p===void 0?Bn:p,w=u.callback,C=w===void 0?function(){}:w;return SE(y,C)},o.generateSvgReplacementMutation=function(u,p){var y=p.iconName,w=p.title,C=p.titleId,a=p.prefix,z=p.transform,F=p.symbol,H=p.mask,Z=p.maskId,Y=p.extra;return new Promise(function(ie,ce){Promise.all([kv(y,a),H.iconName?kv(H.iconName,H.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(_e){var ze=Fx(_e,2),le=ze[0],ee=ze[1];ie([u,Xx({icons:{main:le,mask:ee},prefix:a,iconName:y,transform:z,symbol:F,maskId:Z,title:w,titleId:C,extra:Y,watchable:!0})])}).catch(ce)})},o.generateAbstractIcon=function(u){var p=u.children,y=u.attributes,w=u.main,C=u.transform,a=u.styles,z=Qg(a);z.length>0&&(y.style=z);var F;return Gx(C)&&(F=Os("generateAbstractTransformGrouping",{main:w,transform:C,containerWidth:w.width,iconWidth:w.width})),p.push(F||w.icon),{children:p,attributes:y}}}},$3={mixout:function(){return{layer:function(u){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=p.classes,w=y===void 0?[]:y;return n_({type:"layer"},function(){rc("beforeDOMElementCreation",{assembler:u,params:p});var C=[];return u(function(a){Array.isArray(a)?a.map(function(z){C=C.concat(z.abstract)}):C=C.concat(a.abstract)}),[{tag:"span",attributes:{class:["".concat(Ct.cssPrefix,"-layers")].concat(Df(w)).join(" ")},children:C}]})}}}},G3={mixout:function(){return{counter:function(u){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=p.title,w=y===void 0?null:y,C=p.classes,a=C===void 0?[]:C,z=p.attributes,F=z===void 0?{}:z,H=p.styles,Z=H===void 0?{}:H;return n_({type:"counter",content:u},function(){return rc("beforeDOMElementCreation",{content:u,params:p}),E3({content:u.toString(),title:w,extra:{attributes:F,styles:Z,classes:["".concat(Ct.cssPrefix,"-layers-counter")].concat(Df(a))}})})}}}},q3={mixout:function(){return{text:function(u){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=p.transform,w=y===void 0?Ko:y,C=p.title,a=C===void 0?null:C,z=p.classes,F=z===void 0?[]:z,H=p.attributes,Z=H===void 0?{}:H,Y=p.styles,ie=Y===void 0?{}:Y;return n_({type:"text",content:u},function(){return rc("beforeDOMElementCreation",{content:u,params:p}),vE({content:u,transform:xt(xt({},Ko),w),title:a,extra:{attributes:Z,styles:ie,classes:["".concat(Ct.cssPrefix,"-layers-text")].concat(Df(F))}})})}}},provides:function(o){o.generateLayersText=function(u,p){var y=p.title,w=p.transform,C=p.extra,a=null,z=null;if(PC){var F=parseInt(getComputedStyle(u).fontSize,10),H=u.getBoundingClientRect();a=H.width/F,z=H.height/F}return Ct.autoA11y&&!y&&(C.attributes["aria-hidden"]="true"),Promise.resolve([u,vE({content:u.innerHTML,width:a,height:z,transform:w,title:y,extra:C,watchable:!0})])}}},Z3=new RegExp('"',"ug"),CE=[1105920,1112319];function W3(t){var o=t.replace(Z3,""),u=s3(o,0),p=u>=CE[0]&&u<=CE[1],y=o.length===2?o[0]===o[1]:!1;return{value:Tv(y?o[0]:o),isSecondary:p||y}}function AE(t,o){var u="".concat(RL).concat(o.replace(":","-"));return new Promise(function(p,y){if(t.getAttribute(u)!==null)return p();var w=Xu(t.children),C=w.filter(function(rt){return rt.getAttribute(Ev)===o})[0],a=$a.getComputedStyle(t,o),z=a.getPropertyValue("font-family").match(jL),F=a.getPropertyValue("font-weight"),H=a.getPropertyValue("content");if(C&&!z)return t.removeChild(C),p();if(z&&H!=="none"&&H!==""){var Z=a.getPropertyValue("content"),Y=~["Sharp"].indexOf(z[2])?nr:Rn,ie=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(z[2])?vf[Y][z[2].toLowerCase()]:UL[Y][F],ce=W3(Z),_e=ce.value,ze=ce.isSecondary,le=z[0].startsWith("FontAwesome"),ee=Zx(ie,_e),ue=ee;if(le){var Be=f3(_e);Be.iconName&&Be.prefix&&(ee=Be.iconName,ie=Be.prefix)}if(ee&&!ze&&(!C||C.getAttribute(jx)!==ie||C.getAttribute(Ux)!==ue)){t.setAttribute(u,ue),C&&t.removeChild(C);var $e=B3(),ot=$e.extra;ot.attributes[Ev]=o,kv(ee,ie).then(function(rt){var Je=Xx(xt(xt({},$e),{},{icons:{main:rt,mask:Wx()},prefix:ie,iconName:ue,extra:ot,watchable:!0})),De=Bn.createElement("svg");o==="::before"?t.insertBefore(De,t.firstChild):t.appendChild(De),De.outerHTML=Je.map(function(_t){return Rf(_t)}).join(`
`),t.removeAttribute(u),p()}).catch(y)}else p()}else p()})}function X3(t){return Promise.all([AE(t,"::before"),AE(t,"::after")])}function H3(t){return t.parentNode!==document.head&&!~BL.indexOf(t.tagName.toUpperCase())&&!t.getAttribute(Ev)&&(!t.parentNode||t.parentNode.tagName!=="svg")}function ME(t){if(Fs)return new Promise(function(o,u){var p=Xu(t.querySelectorAll("*")).filter(H3).map(X3),y=Hx.begin("searchPseudoElements");JC(),Promise.all(p).then(function(){y(),Pv(),o()}).catch(function(){y(),Pv(),u()})})}var Y3={hooks:function(){return{mutationObserverCallbacks:function(u){return u.pseudoElementsCallback=ME,u}}},provides:function(o){o.pseudoElements2svg=function(u){var p=u.node,y=p===void 0?Bn:p;Ct.searchPseudoElements&&ME(y)}}},kE=!1,K3={mixout:function(){return{dom:{unwatch:function(){JC(),kE=!0}}}},hooks:function(){return{bootstrap:function(){EE(Cv("mutationObserverCallbacks",{}))},noAuto:function(){D3()},watch:function(u){var p=u.observeMutationsRoot;kE?Pv():EE(Cv("mutationObserverCallbacks",{observeMutationsRoot:p}))}}}},IE=function(o){var u={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return o.toLowerCase().split(" ").reduce(function(p,y){var w=y.toLowerCase().split("-"),C=w[0],a=w.slice(1).join("-");if(C&&a==="h")return p.flipX=!0,p;if(C&&a==="v")return p.flipY=!0,p;if(a=parseFloat(a),isNaN(a))return p;switch(C){case"grow":p.size=p.size+a;break;case"shrink":p.size=p.size-a;break;case"left":p.x=p.x-a;break;case"right":p.x=p.x+a;break;case"up":p.y=p.y-a;break;case"down":p.y=p.y+a;break;case"rotate":p.rotate=p.rotate+a;break}return p},u)},J3={mixout:function(){return{parse:{transform:function(u){return IE(u)}}}},hooks:function(){return{parseNodeAttributes:function(u,p){var y=p.getAttribute("data-fa-transform");return y&&(u.transform=IE(y)),u}}},provides:function(o){o.generateAbstractTransformGrouping=function(u){var p=u.main,y=u.transform,w=u.containerWidth,C=u.iconWidth,a={transform:"translate(".concat(w/2," 256)")},z="translate(".concat(y.x*32,", ").concat(y.y*32,") "),F="scale(".concat(y.size/16*(y.flipX?-1:1),", ").concat(y.size/16*(y.flipY?-1:1),") "),H="rotate(".concat(y.rotate," 0 0)"),Z={transform:"".concat(z," ").concat(F," ").concat(H)},Y={transform:"translate(".concat(C/2*-1," -256)")},ie={outer:a,inner:Z,path:Y};return{tag:"g",attributes:xt({},ie.outer),children:[{tag:"g",attributes:xt({},ie.inner),children:[{tag:p.icon.tag,children:p.icon.children,attributes:xt(xt({},p.icon.attributes),ie.path)}]}]}}}},g0={x:0,y:0,width:"100%",height:"100%"};function PE(t){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.attributes&&(t.attributes.fill||o)&&(t.attributes.fill="black"),t}function Q3(t){return t.tag==="g"?t.children:[t]}var eR={hooks:function(){return{parseNodeAttributes:function(u,p){var y=p.getAttribute("data-fa-mask"),w=y?t_(y.split(" ").map(function(C){return C.trim()})):Wx();return w.prefix||(w.prefix=Ga()),u.mask=w,u.maskId=p.getAttribute("data-fa-mask-id"),u}}},provides:function(o){o.generateAbstractMask=function(u){var p=u.children,y=u.attributes,w=u.main,C=u.mask,a=u.maskId,z=u.transform,F=w.width,H=w.icon,Z=C.width,Y=C.icon,ie=JL({transform:z,containerWidth:Z,iconWidth:F}),ce={tag:"rect",attributes:xt(xt({},g0),{},{fill:"white"})},_e=H.children?{children:H.children.map(PE)}:{},ze={tag:"g",attributes:xt({},ie.inner),children:[PE(xt({tag:H.tag,attributes:xt(xt({},H.attributes),ie.path)},_e))]},le={tag:"g",attributes:xt({},ie.outer),children:[ze]},ee="mask-".concat(a||bf()),ue="clip-".concat(a||bf()),Be={tag:"mask",attributes:xt(xt({},g0),{},{id:ee,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[ce,le]},$e={tag:"defs",children:[{tag:"clipPath",attributes:{id:ue},children:Q3(Y)},Be]};return p.push($e,{tag:"rect",attributes:xt({fill:"currentColor","clip-path":"url(#".concat(ue,")"),mask:"url(#".concat(ee,")")},g0)}),{children:p,attributes:y}}}},tR={provides:function(o){var u=!1;$a.matchMedia&&(u=$a.matchMedia("(prefers-reduced-motion: reduce)").matches),o.missingIconAbstract=function(){var p=[],y={fill:"currentColor"},w={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};p.push({tag:"path",attributes:xt(xt({},y),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var C=xt(xt({},w),{},{attributeName:"opacity"}),a={tag:"circle",attributes:xt(xt({},y),{},{cx:"256",cy:"364",r:"28"}),children:[]};return u||a.children.push({tag:"animate",attributes:xt(xt({},w),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:xt(xt({},C),{},{values:"1;0;1;1;0;1;"})}),p.push(a),p.push({tag:"path",attributes:xt(xt({},y),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:u?[]:[{tag:"animate",attributes:xt(xt({},C),{},{values:"1;0;0;0;0;1;"})}]}),u||p.push({tag:"path",attributes:xt(xt({},y),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:xt(xt({},C),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:p}}}},nR={hooks:function(){return{parseNodeAttributes:function(u,p){var y=p.getAttribute("data-fa-symbol"),w=y===null?!1:y===""?!0:y;return u.symbol=w,u}}}},rR=[t3,V3,$3,G3,q3,Y3,K3,J3,eR,tR,nR];g3(rR,{mixoutsTo:Ri});Ri.noAuto;Ri.config;Ri.library;Ri.dom;var zv=Ri.parse;Ri.findIconDefinition;Ri.toHtml;var iR=Ri.icon;Ri.layer;Ri.text;Ri.counter;var eA={exports:{}},oR="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",sR=oR,aR=sR;function tA(){}function nA(){}nA.resetWarningCache=tA;var lR=function(){function t(p,y,w,C,a,z){if(z!==aR){var F=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw F.name="Invariant Violation",F}}t.isRequired=t;function o(){return t}var u={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:o,element:t,elementType:t,instanceOf:o,node:t,objectOf:o,oneOf:o,oneOfType:o,shape:o,exact:o,checkPropTypes:nA,resetWarningCache:tA};return u.PropTypes=u,u};eA.exports=lR();var cR=eA.exports;const Qt=Rv(cR);function zE(t,o){var u=Object.keys(t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(t);o&&(p=p.filter(function(y){return Object.getOwnPropertyDescriptor(t,y).enumerable})),u.push.apply(u,p)}return u}function Pa(t){for(var o=1;o<arguments.length;o++){var u=arguments[o]!=null?arguments[o]:{};o%2?zE(Object(u),!0).forEach(function(p){Su(t,p,u[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(u)):zE(Object(u)).forEach(function(p){Object.defineProperty(t,p,Object.getOwnPropertyDescriptor(u,p))})}return t}function Mg(t){"@babel/helpers - typeof";return Mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},Mg(t)}function Su(t,o,u){return o in t?Object.defineProperty(t,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):t[o]=u,t}function uR(t,o){if(t==null)return{};var u={},p=Object.keys(t),y,w;for(w=0;w<p.length;w++)y=p[w],!(o.indexOf(y)>=0)&&(u[y]=t[y]);return u}function hR(t,o){if(t==null)return{};var u=uR(t,o),p,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(t);for(y=0;y<w.length;y++)p=w[y],!(o.indexOf(p)>=0)&&Object.prototype.propertyIsEnumerable.call(t,p)&&(u[p]=t[p])}return u}function Dv(t){return dR(t)||fR(t)||pR(t)||mR()}function dR(t){if(Array.isArray(t))return Lv(t)}function fR(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function pR(t,o){if(t){if(typeof t=="string")return Lv(t,o);var u=Object.prototype.toString.call(t).slice(8,-1);if(u==="Object"&&t.constructor&&(u=t.constructor.name),u==="Map"||u==="Set")return Array.from(t);if(u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return Lv(t,o)}}function Lv(t,o){(o==null||o>t.length)&&(o=t.length);for(var u=0,p=new Array(o);u<o;u++)p[u]=t[u];return p}function mR(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gR(t){var o,u=t.beat,p=t.fade,y=t.beatFade,w=t.bounce,C=t.shake,a=t.flash,z=t.spin,F=t.spinPulse,H=t.spinReverse,Z=t.pulse,Y=t.fixedWidth,ie=t.inverse,ce=t.border,_e=t.listItem,ze=t.flip,le=t.size,ee=t.rotation,ue=t.pull,Be=(o={"fa-beat":u,"fa-fade":p,"fa-beat-fade":y,"fa-bounce":w,"fa-shake":C,"fa-flash":a,"fa-spin":z,"fa-spin-reverse":H,"fa-spin-pulse":F,"fa-pulse":Z,"fa-fw":Y,"fa-inverse":ie,"fa-border":ce,"fa-li":_e,"fa-flip":ze===!0,"fa-flip-horizontal":ze==="horizontal"||ze==="both","fa-flip-vertical":ze==="vertical"||ze==="both"},Su(o,"fa-".concat(le),typeof le<"u"&&le!==null),Su(o,"fa-rotate-".concat(ee),typeof ee<"u"&&ee!==null&&ee!==0),Su(o,"fa-pull-".concat(ue),typeof ue<"u"&&ue!==null),Su(o,"fa-swap-opacity",t.swapOpacity),o);return Object.keys(Be).map(function($e){return Be[$e]?$e:null}).filter(function($e){return $e})}function _R(t){return t=t-0,t===t}function rA(t){return _R(t)?t:(t=t.replace(/[\-_\s]+(.)?/g,function(o,u){return u?u.toUpperCase():""}),t.substr(0,1).toLowerCase()+t.substr(1))}var yR=["style"];function vR(t){return t.charAt(0).toUpperCase()+t.slice(1)}function xR(t){return t.split(";").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,u){var p=u.indexOf(":"),y=rA(u.slice(0,p)),w=u.slice(p+1).trim();return y.startsWith("webkit")?o[vR(y)]=w:o[y]=w,o},{})}function iA(t,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof o=="string")return o;var p=(o.children||[]).map(function(z){return iA(t,z)}),y=Object.keys(o.attributes||{}).reduce(function(z,F){var H=o.attributes[F];switch(F){case"class":z.attrs.className=H,delete o.attributes.class;break;case"style":z.attrs.style=xR(H);break;default:F.indexOf("aria-")===0||F.indexOf("data-")===0?z.attrs[F.toLowerCase()]=H:z.attrs[rA(F)]=H}return z},{attrs:{}}),w=u.style,C=w===void 0?{}:w,a=hR(u,yR);return y.attrs.style=Pa(Pa({},y.attrs.style),C),t.apply(void 0,[o.tag,Pa(Pa({},y.attrs),a)].concat(Dv(p)))}var oA=!1;try{oA=!0}catch{}function wR(){if(!oA&&console&&typeof console.error=="function"){var t;(t=console).error.apply(t,arguments)}}function DE(t){if(t&&Mg(t)==="object"&&t.prefix&&t.iconName&&t.icon)return t;if(zv.icon)return zv.icon(t);if(t===null)return null;if(t&&Mg(t)==="object"&&t.prefix&&t.iconName)return t;if(Array.isArray(t)&&t.length===2)return{prefix:t[0],iconName:t[1]};if(typeof t=="string")return{prefix:"fas",iconName:t}}function _0(t,o){return Array.isArray(o)&&o.length>0||!Array.isArray(o)&&o?Su({},t,o):{}}var Xo=Ig.forwardRef(function(t,o){var u=t.icon,p=t.mask,y=t.symbol,w=t.className,C=t.title,a=t.titleId,z=t.maskId,F=DE(u),H=_0("classes",[].concat(Dv(gR(t)),Dv(w.split(" ")))),Z=_0("transform",typeof t.transform=="string"?zv.transform(t.transform):t.transform),Y=_0("mask",DE(p)),ie=iR(F,Pa(Pa(Pa(Pa({},H),Z),Y),{},{symbol:y,title:C,titleId:a,maskId:z}));if(!ie)return wR("Could not find icon",F),null;var ce=ie.abstract,_e={ref:o};return Object.keys(t).forEach(function(ze){Xo.defaultProps.hasOwnProperty(ze)||(_e[ze]=t[ze])}),bR(ce[0],_e)});Xo.displayName="FontAwesomeIcon";Xo.propTypes={beat:Qt.bool,border:Qt.bool,beatFade:Qt.bool,bounce:Qt.bool,className:Qt.string,fade:Qt.bool,flash:Qt.bool,mask:Qt.oneOfType([Qt.object,Qt.array,Qt.string]),maskId:Qt.string,fixedWidth:Qt.bool,inverse:Qt.bool,flip:Qt.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Qt.oneOfType([Qt.object,Qt.array,Qt.string]),listItem:Qt.bool,pull:Qt.oneOf(["right","left"]),pulse:Qt.bool,rotation:Qt.oneOf([0,90,180,270]),shake:Qt.bool,size:Qt.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Qt.bool,spinPulse:Qt.bool,spinReverse:Qt.bool,symbol:Qt.oneOfType([Qt.bool,Qt.string]),title:Qt.string,titleId:Qt.string,transform:Qt.oneOfType([Qt.string,Qt.object]),swapOpacity:Qt.bool};Xo.defaultProps={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1};var bR=iA.bind(null,Ig.createElement);const LE=/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%]).{8,24}$/,RE=()=>{const t=Ve.useRef(),o=Ve.useRef(),[u,p]=Ve.useState(""),[y,w]=Ve.useState(""),[C,a]=Ve.useState(!1),[z,F]=Ve.useState(""),[H,Z]=Ve.useState(!1),[Y,ie]=Ve.useState(!1),[ce,_e]=Ve.useState(!1),[ze,le]=Ve.useState(!1),[ee,ue]=Ve.useState(""),[Be,$e]=Ve.useState(!1),[ot,rt]=Ve.useState(""),[Je,De]=Ve.useState(!1),[_t,sn]=Ve.useState(""),[At,rn]=Ve.useState(!1),[kr,Po]=Ve.useState(""),[Oi,wi]=Ve.useState(!1),[Ke,Mt]=Ve.useState(""),[Tt,Gt]=Ve.useState(!1);Ve.useEffect(()=>{t.current.focus()},[]),Ve.useEffect(()=>{const Bt=LE.test(y);console.log(Bt),console.log(y),a(Bt),Z(y===z)},[y,z]),Ve.useEffect(()=>{Mt("")},[y,z]);const _n=async Bt=>{if(Bt.preventDefault(),!LE.test(y)){Mt("Invalid Entry");return}try{const xr=await Pi.post("https://walksafenyc-api-production-ba84.up.railway.app/api/users",{first_name:ee,last_name:ot,email:u,password:y,date_of_birth:_t,gender:kr});console.log(xr.data),Gt(!0)}catch(xr){xr!=null&&xr.response?Mt("Registration failed"):Mt("No server response"),o.current.focus()}};return V.jsx("section",{className:"create-account-page",children:Tt?V.jsxs("section",{children:[V.jsx("h1",{children:"Account successfully created."}),V.jsx("p",{children:V.jsx(ti,{className:"login",to:"/login",children:V.jsx("button",{id:"already-have-account",className:"submit-button",children:"Log in."})})})]}):V.jsxs("section",{className:"form-container",children:[V.jsx("section",{children:V.jsx("p",{ref:o,className:Ke?"errorMessage":"offscreen","aria-live":"assertive",children:Ke})}),V.jsxs("form",{className:"create-account-form",onSubmit:_n,children:[V.jsx("h4",{children:"Create an account"}),V.jsxs("section",{className:"account-question",children:[V.jsx("label",{htmlFor:"firstName",children:"First Name:"}),V.jsx("input",{onChange:Bt=>ue(Bt.target.value),required:!0,type:"text",ref:t,autoComplete:"off",placeholder:"First Name",value:ee,name:"firstName",id:"firstName",onFocus:()=>$e(!0),onBlur:()=>$e(!1)})]}),V.jsxs("section",{className:"account-question",children:[V.jsx("label",{htmlFor:"lastName",children:"Last Name:"}),V.jsx("input",{onChange:Bt=>rt(Bt.target.value),type:"text",placeholder:"Last Name",value:ot,name:"lastName",id:"lastName",ref:t,autoComplete:"off",onFocus:()=>De(!0),onBlur:()=>De(!1)})]}),V.jsxs("section",{className:"account-question",children:[V.jsx("label",{htmlFor:"dateOfBirth",children:"Date of Birth:"}),V.jsx("input",{onChange:Bt=>sn(Bt.target.value),type:"date",placeholder:"Date of Birth",value:_t,name:"dateOfBirth",id:"dateOfBirth",ref:t,autoComplete:"off",required:!0,onFocus:()=>rn(!0),onBlur:()=>rn(!1)})]}),V.jsxs("section",{className:"account-question",children:[V.jsx("label",{htmlFor:"gender",children:"Gender:"}),V.jsx("input",{onChange:Bt=>Po(Bt.target.value),type:"text",placeholder:"gender",value:kr,name:"gender",id:"gender",ref:t,autoComplete:"off",required:!0,onFocus:()=>wi(!0),onBlur:()=>wi(!1)})]}),V.jsxs("section",{className:"account-question",children:[V.jsx("label",{htmlFor:"email",children:"Email:"}),V.jsx("input",{value:u,onChange:Bt=>p(Bt.target.value),name:"email",id:"email",type:"email",placeholder:"youremail@gmail.com",ref:t,autoComplete:"off",required:!0,onFocus:()=>_e(!0),onBlur:()=>_e(!1)})]}),V.jsxs("section",{className:"account-question",children:[V.jsxs("label",{htmlFor:"password",children:["Password:",V.jsx(Xo,{icon:sE,className:C?"valid":"hide"}),V.jsx(Xo,{icon:oE,className:C||!y?"hide":"invalid"})]}),V.jsx("input",{onChange:Bt=>w(Bt.target.value),name:"password",value:y,id:"password",type:"password",placeholder:"*******",ref:t,autoComplete:"off",required:!0,"aria-invalid":C?"false":"true",onFocus:()=>le(!0),onBlur:()=>le(!1),"aria-describedby":"pwdnote"})]}),V.jsxs("p",{id:"pwdnote",className:ze&&!C?"instructions":"offscreen",children:[V.jsx(Xo,{icon:iE}),"8 to 24 characters.",V.jsx("br",{}),"Must include uppercase and lowercase letters, a number and a special charcter. ",V.jsx("br",{}),"Allowed special characters: ",V.jsx("span",{"aria-label":"exclamation mark",children:"!"}),V.jsx("span",{"aria-label":"at symbol",children:"@"}),V.jsx("span",{"aria-label":"hashtag",children:"#"}),V.jsx("span",{"aria-label":"percent",children:"%"})]}),V.jsxs("section",{className:"account-question",children:[V.jsxs("label",{htmlFor:"confirmPassword",children:["Confirm Password:",V.jsx(Xo,{icon:sE,className:H&&z?"valid":"hide"}),V.jsx(Xo,{icon:oE,className:H||!z?"hide":"invalid"})]}),V.jsx("input",{onChange:Bt=>F(Bt.target.value),name:"confirmPassword",value:z,id:"confirmPassword",type:"password",placeholder:"*******",ref:t,autoComplete:"off",required:!0,"aria-invalid":H?"false":"true",onFocus:()=>ie(!0),onBlur:()=>ie(!1),"aria-describedby":"confirmnote"})]}),V.jsxs("p",{id:"confirmnote",className:Y&&!H?"instructions":"offscreen",children:[V.jsx(Xo,{icon:iE}),"Must match the first password input field."]}),V.jsx("button",{disabled:!C||!H,id:"create-account-button",className:"submit-button",type:"submit",children:"Create Account"}),V.jsx(ti,{className:"login",to:"/login",children:V.jsx("button",{id:"already-have-account",className:"submit-button",children:"Already have an account? Log in here."})})]}),V.jsx("img",{src:sc})]})})},y0=()=>{const[t,o]=Ve.useState("");let{id:u}=PI();return Ve.useEffect(()=>{(async()=>{try{const w=(await Pi.get("https://walksafenyc-api-production-ba84.up.railway.app/api/posts/")).data[u];console.log(w),o(w)}catch(y){console.error("Error fetching report",y)}})()},[u]),V.jsx("div",{className:"reportPage",children:V.jsxs("div",{className:"form-container",children:[V.jsxs("div",{className:"reportcont",children:[V.jsx("h4",{children:"Incident Report"}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Date of Incident:"})," ",V.jsx("p",{children:t.post_date})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Time of Incident:"})," ",V.jsx("p",{children:t.post_time})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Incident Type:"})," ",V.jsx("p",{children:t.incident_type})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Comment:"})," ",V.jsx("p",{children:t.comment})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Location:"})," ",V.jsxs("p",{children:["Latitude: ",t.lat,", Longitude: ",t.lon," "]})]})]}),V.jsx("img",{src:sc,alt:"City"})]})})},ER=()=>{const{loggedIn:t,user:o,logout:u}=Ve.useContext(ac);let p=Cf();const y=o._id;Ve.useEffect(()=>{(async()=>{try{const De=(await Pi.get(`https://walksafenyc-api-production-ba84.up.railway.app/api/users/${y}`)).data;console.log(De)}catch(Je){console.error("Error fetching user",Je)}})()},[y]);const[w,C]=Ve.useState(o.email),[a,z]=Ve.useState(o.first_name),[F,H]=Ve.useState(o.last_name),[Z,Y]=Ve.useState(o.password),[ie,ce]=Ve.useState(o.date_of_birth),[_e,ze]=Ve.useState(o.gender),[le,ee]=Ve.useState(!1),ue=async()=>{try{const rt=await Pi.put(`https://walksafenyc-api-production-ba84.up.railway.app/api/users/${y}`,{first_name:a,last_name:F,email:w,password:Z,date_of_birth:ie,gender:_e});ee(!0)}catch(rt){console.error("Error updating user",rt)}},Be=async()=>{try{await Pi.delete(`https://walksafenyc-api-production-ba84.up.railway.app/api/users/${y}`),ee(!0),$e()}catch(rt){console.error("Error deleting user",rt)}},$e=()=>{localStorage.removeItem("user"),u(o),setSelectedUser(null)},ot=()=>{p(`userReports/${y}/`)};return V.jsx("div",{className:"userPage",children:le?V.jsxs("section",{children:[V.jsx("h4",{children:"Changes saved successfully."}),V.jsx("p",{children:V.jsx(ti,{className:"home",to:"/",children:V.jsx("button",{id:"already-have-account",className:"submit-button",children:"Go home."})})})]}):V.jsxs("div",{className:"form-container",children:[V.jsxs("div",{className:"accountcont",children:[V.jsx("h4",{children:"Profile Page"}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsxs("strong",{children:["First Name: ",o.first_name," "]})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"text",placeholder:"Update First Name",onChange:rt=>z(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]})]}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsxs("strong",{children:["Last Name: ",o.last_name," "]})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"text",placeholder:"Update Last Name",onChange:rt=>H(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]})]}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsxs("strong",{children:["Email: ",o.email," "]})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"email",placeholder:"Update Email",onChange:rt=>C(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]}),"         "]}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsxs("strong",{children:["Date of Birth: ",o.date_of_birth," "]})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"date",id:"date",onChange:rt=>ce(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]})]}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsxs("strong",{children:["Gender: ",o.gender]})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"text",placeholder:"Update Gender",onChange:rt=>ze(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]})]}),V.jsxs("div",{className:"accountinfo",children:[V.jsx("p",{children:V.jsx("strong",{children:"Password: "})}),V.jsxs("div",{className:"userupdate",children:[V.jsx("input",{type:"text",placeholder:"Update Password",onChange:rt=>Y(rt.target.value)}),V.jsx("button",{type:"submit",onClick:ue,children:"Update"})]})]}),V.jsxs("div",{className:"userbuttons",children:[V.jsx(ti,{to:"/",class:"home",children:V.jsx("button",{id:"deleteaccount",type:"button",onClick:Be,children:"Delete Profile"})}),V.jsx("button",{id:"logout",type:"button",onClick:$e,children:"Logout"}),V.jsx("button",{id:"userReports",onClick:ot,children:"My Reports"})]})]}),V.jsx("img",{src:sc,alt:"City"})]})})},OE=()=>{let t=Cf();const[o,u]=Ve.useState([]);Ve.useEffect(()=>{try{(async()=>{const w=await Pi.get("https://walksafenyc-api-production-ba84.up.railway.app/api/posts");u(w.data)})()}catch(y){console.error("Error fetching reports:",y)}},[o]);const p=y=>{t(`${y}/`)};return V.jsx("div",{className:"allReportsPage",children:V.jsxs("div",{className:"form-container",children:[V.jsx("section",{className:"report-grid",children:o.map((y,w)=>V.jsxs("section",{onClick:()=>p(w),className:"reports",children:[V.jsxs("p",{children:["Date of Incident: ",y.post_date]}),V.jsxs("p",{children:["Type of Harassment: ",y.incident_type]})]},w))}),V.jsx("img",{src:sc,alt:"City"})]})})},TR=()=>{const[t,o]=Ve.useState(""),{loggedIn:u,user:p}=Ve.useContext(ac),y=p._id;Cf();const[w,C]=Ve.useState([]),[a,z]=Ve.useState(!1);Ve.useEffect(()=>{(async()=>{try{const Y=await Pi.get(`https://walksafenyc-api-production-ba84.up.railway.app/api/posts/getPostsByUser/${y}`);console.log(Y.data),C(Y.data),console.log(w)}catch(Y){console.error("Error fetching user reports:",Y)}})()},[]),Ve.useEffect(()=>{console.log(w)},[w]);const F=async Z=>{try{await Pi.delete(`https://walksafenyc-api-production-ba84.up.railway.app/api/posts/${w[Z]._id}`),z(!0)}catch(Y){console.error("Error deleting report",Y)}},H=async Z=>{try{const Y=await Pi.put(`https://walksafenyc-api-production-ba84.up.railway.app/api/posts/${w[Z]._id}`,{comment:t});z(!0)}catch(Y){console.error("Error updating user",Y)}};return V.jsx("div",{className:"allReportsPage",children:a?V.jsxs("section",{children:[V.jsx("h1",{children:"Changes saved successfully."}),V.jsx("p",{children:V.jsx(ti,{className:"home",to:"/",children:V.jsx("button",{id:"already-have-account",className:"submit-button",children:"Go home."})})})]}):V.jsxs("div",{className:"form-container",children:[V.jsx("section",{className:"report-grid",children:w.map((Z,Y)=>V.jsxs("section",{className:"userreports",children:[V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Date of Incident:"})," ",V.jsx("p",{children:Z.post_date})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Time of Incident:"})," ",V.jsx("p",{children:Z.post_time})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Type of harassment:"})," ",V.jsx("p",{children:Z.incident_type})]}),V.jsxs("div",{className:"reportdetails",children:[V.jsx("p",{children:"Description:"})," ",V.jsx("p",{children:Z.comment})]}),V.jsxs("div",{className:"commentupdate",children:[V.jsx("input",{type:"text",id:"updateinput",placeholder:"Edit comment",onChange:ie=>o(ie.target.value)}),V.jsx("button",{type:"submit",id:"updateComment",onClick:()=>H(Y),children:"Update Comment"})]}),V.jsx("button",{id:"deleteReport",onClick:()=>F(Y),children:"Delete Report"})]},Y))}),V.jsx("img",{src:sc,alt:"City"})]})})},SR=()=>{const{loggedIn:t,user:o}=Ve.useContext(ac);if(t){const u=o._id;return V.jsx("div",{className:"routes-container",children:V.jsxs(Lb,{children:[V.jsx(Zr,{path:"/",element:V.jsx(tE,{})}),V.jsx(Zr,{path:"/reportForm",element:V.jsx(rE,{})}),V.jsx(Zr,{path:"/login",element:V.jsx(xv,{})}),V.jsx(Zr,{path:"/createAnAccount",element:V.jsx(RE,{})}),V.jsx(Zr,{path:`/login/${u}`,element:V.jsx(ER,{})}),V.jsx(Zr,{path:"/reports",element:V.jsx(OE,{})}),V.jsx(Zr,{path:"/reports/:id",element:V.jsx(y0,{})}),V.jsx(Zr,{path:`/login/${u}/userReports/${u}`,element:V.jsx(TR,{})}),V.jsx(Zr,{path:"/reports/:id",element:V.jsx(y0,{})})]})})}else return V.jsxs(Lb,{children:[V.jsx(Zr,{path:"/",element:V.jsx(tE,{})}),V.jsx(Zr,{path:"/reportForm",element:V.jsx(rE,{})}),V.jsx(Zr,{path:"/login",element:V.jsx(xv,{})}),V.jsx(Zr,{path:"/createAnAccount",element:V.jsx(RE,{})}),V.jsx(Zr,{path:"/reports",element:V.jsx(OE,{})}),V.jsx(Zr,{path:"/reports/:id",element:V.jsx(y0,{})})]})},CR=()=>V.jsx("footer",{className:"app-footer",children:V.jsx("h4",{className:"footertxt",children:"Report street harassment and help keep others safe."})}),AR=()=>{const{loggedIn:t,user:o}=Ve.useContext(ac);if(t){const u=o._id;return V.jsxs("div",{className:"nav-links",children:[V.jsx(ti,{className:"nav",to:"/",children:"Home"}),V.jsx(ti,{className:"nav",to:"/reportForm",children:"Submit a Report"}),V.jsx(ti,{className:"nav",to:`login/${u}`,children:"Account"}),V.jsx(ti,{className:"nav",to:"/reports",children:"View all reports"})]})}else return V.jsxs("div",{className:"nav-links",children:[V.jsx(ti,{className:"nav",to:"/",children:"Home"}),V.jsx(ti,{className:"nav",to:"/reportForm",children:"Submit a Report"}),V.jsx(ti,{className:"nav",to:"/login",children:"Login"}),V.jsx(ti,{className:"nav",to:"/reports",children:"View all reports"})]})},MR=()=>V.jsxs("div",{className:"header",children:[V.jsx("h3",{className:"wlksf",children:"Walk Safe NYC"}),V.jsx(AR,{})]});function kR(){return V.jsxs("div",{className:"App",children:[V.jsx("header",{className:"app-header",children:V.jsx(MR,{})}),V.jsx("main",{className:"app-main",children:V.jsx(SR,{})}),V.jsx("footer",{className:"app-footer",children:V.jsx(CR,{})})]})}E0.createRoot(document.getElementById("root")).render(V.jsx(Ig.StrictMode,{children:V.jsx(YI,{children:V.jsx(EL,{children:V.jsx(kR,{})})})}));
